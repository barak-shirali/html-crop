{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 4f888bb269fce720c60d","webpack:///./src/index.js","webpack:///./src/base-object.js","webpack:///./src/canvas-state.js","webpack:///./src/rect.js"],"names":["HtmlCrop","doc","options","_document","Object","assign","_debugMode","debug","_canvasState","getElementById","log","BaseObject","message","isDebug","args","getName","CanvasState","canvas","debugMode","_canvas","_width","width","_height","height","_ctx","getContext","html","body","parentNode","_htmlTop","offsetTop","_htmlLeft","offsetLeft","_valid","_shape","_dragging","_dragoffx","_dragoffy","_initRect","_initEvents","_interval","setInterval","draw","addEventListener","e","preventDefault","mouse","getMouse","mx","x","my","y","contains","_x","_y","clearRect","clear","strokeStyle","lineWidth","strokeRect","_w","_h","el","offsetX","offsetY","offsetParent","undefined","pageX","pageY","Rect","w","h","fill","_fill","ctx","fillStyle","fillRect"],"mappings":"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","file":"HtmlCrop.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"HtmlCrop\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"HtmlCrop\"] = factory();\n\telse\n\t\troot[\"HtmlCrop\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 4f888bb269fce720c60d\n **/","import BaseObject from './base-object';\nimport CanvasState from './canvas-state';\n\nexport default class HtmlCrop extends BaseObject {\n  /**\n   * object constructor\n   * @param {HTMLDocument} doc\n   * @param {Object} options\n   */\n  constructor(doc, options = {}) {\n    super();\n    this._document = doc;\n    this.options = Object.assign({}, options);\n    this._debugMode = options.debug;\n    this._canvasState = new CanvasState(doc, doc.getElementById('canvas'), this._debugMode);\n    this.log('initialized');\n  }\n\n  /**\n   * returns class name\n   * @returns {string}\n   */\n  getName() {\n    return 'HtmlCrop';\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","/**\n * base class for all object in the library\n * @class Baseobject\n */\nexport default class BaseObject {\n  /**\n   * virtual function for returning class name\n   * @returns {string}\n   */\n  getName() {\n    return '';\n  }\n\n  /**\n   * returns if current mode is debugging mode\n   * @returns {bool}\n   */\n  isDebug() {\n    return this._debugMode;\n  }\n\n  /**\n   * logs message and object for debugging purpose\n   * @param {string} message\n   * @param {Array<any>} args\n   */\n  log(message, ...args) {\n    if (!this.isDebug()) {\n      return;\n    }\n\n    console.log(`${this.getName()}: ${message}`, ...args);\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/base-object.js\n **/","import BaseObject from './base-object';\nimport Rect from './rect';\n\n/**\n * State enabled class to manage grey canvas on top of html page for cropping\n * @class CanvasState\n */\nexport default class CanvasState extends BaseObject {\n  /**\n   * object constructor\n   * @param {HTMLDocument} doc\n   * @param {HTMLElement} canvas - canvas DOM element\n   */\n  constructor(doc, canvas, debugMode = true) {\n    super();\n\n    this._document = doc;\n    this._canvas = canvas;\n    this._width = canvas.width;\n    this._height = canvas.height;\n    this._ctx = canvas.getContext('2d');\n    this._debugMode = debugMode;\n\n    const html = this._document.body.parentNode;\n\n    this._htmlTop = html.offsetTop;\n    this._htmlLeft = html.offsetLeft;\n\n    this._valid = false; // when set to false, the canvas will redraw everything\n    this._shape = null;  // the rectangle shape\n    this._dragging = false; // Keep track of when we are dragging\n    this._dragoffx = 0; // See mousedown and mousemove events for explanation\n    this._dragoffy = 0;\n\n    this.log('initialized');\n\n    this._initRect();\n    this._initEvents();\n\n    this._interval = 30;\n    setInterval(() => {\n      this.draw();\n    }, this._interval);\n  }\n\n  /**\n   * returns class name\n   * @returns {string}\n   */\n  getName() {\n    return 'CanvasState';\n  }\n\n  /**\n   * attaches event handlers to canvas\n   * @private\n   */\n  _initEvents() {\n    const { _canvas } = this;\n    // fixes a problem where double clicking causesShape text to get selected on the canvas\n    _canvas.addEventListener('selectstart', (e) => {\n      e.preventDefault();\n      return false;\n    }, false);\n\n    // up, down, and move are for dragging\n    _canvas.addEventListener('mousedown', (e) => {\n      const { _shape } = this;\n      const mouse = this.getMouse(e);\n      const mx = mouse.x;\n      const my = mouse.y;\n      this._valid = false;\n      if (_shape.contains(mx, my)) {\n        this._dragoffx = mx - _shape._x;\n        this._dragoffy = my - _shape._y;\n        this._dragging = true;\n\n        this.log('mouse down detected. starting drag', mx, my);\n      }\n    }, true);\n\n    _canvas.addEventListener('mousemove', (e) => {\n      if (this._dragging) {\n        const mouse = this.getMouse(e);\n        // We don't want to drag the object by its top-left corner, we want to drag it\n        // from where we clicked. Thats why we saved the offset and use it here\n        this._shape._x = mouse.x - this._dragoffx;\n        this._shape._y = mouse.y - this._dragoffy;\n        this._valid = false; // Something's dragging so we must redraw\n\n        // this.log('moving the rect', mouse.x, mouse.y);\n      }\n    }, true);\n\n    _canvas.addEventListener('mouseup', () => {\n      this._dragging = false;\n      this.log('dragging finished');\n    });\n\n    this.log('initialized events');\n  }\n\n  /**\n   * creates a movable rectangle and attach to canvas\n   * @private\n   */\n  _initRect() {\n    this._shape = new Rect(\n      this._width / 4,\n      this._height / 4,\n      this._width / 2,\n      this._height / 2,\n      'rgba(0, 200, 0, 0.5)'\n    );\n    this._valid = false;\n  }\n\n  /**\n   * clears the canvas for next draw\n   */\n  clear() {\n    this._ctx.clearRect(0, 0, this._width, this._height);\n  }\n\n  /**\n   * while draw is called as often as the INTERVAL variable demands,\n   * it only ever does something if the canvas gets invalidated by our code\n   */\n  draw() {\n    // if our state is invalid, redraw and validate!\n    if (!this._valid) {\n      const { _ctx, _shape } = this;\n      this.clear();\n\n      // @TODO draw background here\n\n      // draw shape\n      _shape.draw(_ctx);\n\n      _ctx.strokeStyle = '#CC0000';\n      _ctx.lineWidth = 2;\n      _ctx.strokeRect(_shape._x, _shape._y, _shape._w, _shape._h);\n\n      this._valid = true;\n\n      this.log('shape drew', _shape._x, _shape._y, _shape._w, _shape._h);\n    }\n  }\n\n  /**\n   * creates an object with x and y defined, set to the mouse position relative to the state's canvas\n   * If you wanna be super-correct this can be tricky, we have to worry about padding and borders\n   * @param {Event} e\n   * @returns {{x: number, y: number}}\n   */\n  getMouse(e) {\n    let el = this._canvas;\n    let offsetX = 0;\n    let offsetY = 0;\n\n    // Compute the total offset\n    if (el.offsetParent !== undefined) {\n      do {\n        offsetX += el.offsetLeft;\n        offsetY += el.offsetTop;\n        el = el.offsetParent;\n      } while (el);\n    }\n\n    // Also add the <html> offsets in case there's a position:fixed bar\n    offsetX += this._htmlLeft;\n    offsetY += this._htmlTop;\n\n    const mx = e.pageX - offsetX;\n    const my = e.pageY - offsetY;\n\n    return { x: mx, y: my };\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/canvas-state.js\n **/","import BaseObject from './base-object';\n\n/**\n * Rectangle for highlighting the cropping area\n * @class Rect\n */\nexport default class Rect extends BaseObject {\n  /**\n   * object constructor\n   * @param {number} x - left position of shape\n   * @param {number} y - top position of shape\n   * @param {number} w - width\n   * @param {number} h - height\n   * @param {string} fill - background color of the shape\n   */\n  constructor(x, y, w, h, fill, debugMode = true) {\n    super();\n\n    this._x = x || 0;\n    this._y = y || 0;\n    this._w = w || 1;\n    this._h = h || 1;\n    this._fill = fill || '#AAAAAA';\n    this._debugMode = debugMode;\n\n    this.log('initialized');\n  }\n\n  /**\n   * returns class name\n   * @returns {string}\n   */\n  getName() {\n    return 'Rect';\n  }\n\n  /**\n   * draws the shape\n   * @param {CanvasContext} ctx\n   */\n  draw(ctx) {\n    const { _x, _y, _w, _h, _fill } = this;\n    ctx.fillStyle = _fill; // eslint-disable-line\n    ctx.fillRect(_x, _y, _w, _h);\n\n    this.log('filling the rectangle', _x, _y, _w, _h);\n  }\n\n  /**\n   * checks if point is inside the shape\n   * @param {number} mx\n   * @param {number} my\n   * @returns {bool}\n   */\n  contains(mx, my) {\n    const { _x, _y, _w, _h } = this;\n    return (_x <= mx) && (_x + _w >= mx) &&\n      (_y <= my) && (_y + _h >= my);\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/rect.js\n **/"],"sourceRoot":""}