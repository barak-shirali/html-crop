{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///HtmlCrop.min.js","webpack:///webpack/bootstrap 4d15a1dd9686a73b7634","webpack:///./src/index.js","webpack:///./~/html2canvas/dist/html2canvas.js","webpack:///./src/base-object.js","webpack:///./src/canvas-state.js","webpack:///./src/rect.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","defineProperty","_createClass","defineProperties","target","props","i","length","descriptor","key","protoProps","staticProps","_html2canvas","_html2canvas2","_baseObject","_baseObject2","_canvasState","_canvasState2","defaultOptions","ctrlKey","shiftKey","startButton","debug","HtmlCrop","_BaseObject","doc","options","arguments","undefined","_this","getPrototypeOf","_document","assign","_debugMode","log","_onKeyDown","bind","reset","_listenHotKey","_attachStartButton","_this2","html","then","canvas","_canvas","selectionCanvas","createElement","_selectionCanvas","width","height","style","position","left","top","body","appendChild","_startButton","removeChild","removeEventListener","_attachCaptureButton","addEventListener","button","textNode","createTextNode","right","bottom","onclick","startCropping","_onCapture","_captureButton","event","keyOptions","ctx","getContext","selection","getSelection","imgData","getImageData","x","y","w","h","newCanvas","newCtx","putImageData","dataURL","toDataURL","window","location","href","__WEBPACK_AMD_DEFINE_FACTORY__","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","require","global","_typeof","Symbol","iterator","f","apply","e","t","n","r","s","o","u","a","Error","code","l","1","_dereq_","error","type","RangeError","errors","map","array","fn","result","mapDomain","string","parts","split","replace","regexSeparators","labels","encoded","join","ucs2decode","extra","output","counter","charCodeAt","push","ucs2encode","stringFromCharCode","basicToDigit","codePoint","base","digitToBasic","digit","flag","adapt","delta","numPoints","firstTime","k","floor","damp","baseMinusTMin","tMax","skew","decode","input","out","basic","j","index","oldi","baseMinusT","inputLength","initialN","bias","initialBias","lastIndexOf","delimiter","maxInt","tMin","splice","encode","handledCPCount","basicLength","q","currentValue","handledCPCountPlusOne","qMinusT","toUnicode","regexPunycode","test","slice","toLowerCase","toASCII","regexNonASCII","freeExports","nodeType","freeModule","freeGlobal","punycode","overflow","not-basic","invalid-input","Math","String","fromCharCode","version","ucs2","hasOwnProperty","2","restoreOwnerScroll","ownerDocument","defaultView","pageXOffset","pageYOffset","scrollTo","cloneCanvasContents","clonedCanvas","cloneNode","node","javascriptEnabled","clone","document","nodeValue","child","firstChild","nodeName","nextSibling","_scrollTop","scrollTop","_scrollLeft","scrollLeft","initNode","containerDocument","documentElement","container","className","visibility","border","scrolling","Promise","resolve","documentClone","contentWindow","onload","interval","setInterval","childNodes","clearInterval","navigator","userAgent","scrollY","scrollX","open","write","replaceChild","adoptNode","close","./log","3","Color","g","b","fromArray","namedColor","rgb","rgba","hex6","hex3","darken","amount","round","isTransparent","isBlack","Array","isArray","min","_hex3","match","parseInt","_hex6","substring","_rgb","Number","_rgba","toString","color","colors","isColor","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","4","html2canvas","nodeList","html2canvasCloneIndex","logging","start","Date","now","async","allowTaint","removeContainer","imageTimeout","renderer","CanvasRenderer","strict","proxy","reject","innerWidth","innerHeight","loadUrlDocument","absoluteUrl","renderWindow","setAttribute","html2canvasNodeAttribute","renderDocument","onrendered","windowWidth","windowHeight","html2canvasIndex","createWindowClone","attributeName","selector","querySelector","removeAttribute","clonedWindow","oncloneHandler","onclone","support","Support","imageLoader","ImageLoader","bounds","getBounds","documentWidth","documentHeight","parser","NodeParser","ready","crop","cleanupContainer","parentNode","croppedCanvas","x1","max","x2","y1","y2","drawImage","scrollWidth","offsetWidth","clientWidth","scrollHeight","offsetHeight","clientHeight","url","link","NodeContainer","utils","html2canvasExport","./clone","./imageloader","./nodecontainer","./nodeparser","./proxy","./renderers/canvas","./support","./utils","5","DummyImageContainer","src","promise","image","Image","onerror","smallImage","complete","6","Font","family","size","baseline","middle","img","span","sampleText","fontFamily","fontSize","margin","padding","verticalAlign","offsetTop","lineHeight","lineWidth","7","FontMetrics","data","getMetrics","./font","8","FrameContainer","sameOrigin","URL","proxyLoad","./core","9","GradientContainer","imageData","colorStops","x0","y0","TYPES","LINEAR","RADIAL","REGEXP_COLORSTOP","10","ImageContainer","cors","tainted","crossOrigin","11","origin","getOrigin","ProxyImageContainer","SVGContainer","SVGNodeContainer","LinearGradientContainer","WebkitGradientContainer","findImages","nodes","images","reduce","imageNodes","concat","args","method","forEach","addImage","loadImage","findBackgroundImage","parseBackgroundImages","filter","hasImageBackground","callback","newImage","imageExists","isSVG","svg","isSameOrigin","useCORS","isInline","some","protocol","hostname","port","getPromise","timeout","dummy","get","found","fetch","all","timer","race","res","setTimeout","clearTimeout","./dummyimagecontainer","./framecontainer","./imagecontainer","./lineargradientcontainer","./proxyimagecontainer","./svgcontainer","./svgnodecontainer","./webkitgradientcontainer","12","hasDirection","REGEXP_DIRECTION","reverse","ratio","parseFloat","isNaN","colorStop","colorStopMatch","unit","stop","find","count","./color","./gradientcontainer","13","logger","console","Function","14","parent","stack","borders","clip","backgroundClip","offsetBounds","visible","computedStyles","styles","backgroundImages","transformData","transformMatrix","isPseudoElement","opacity","selectionValue","option","selectedIndex","text","parseMatrix","trim","matrix3d","isPercentage","indexOf","removePx","str","asFloat","parseBackgrounds","cloneTo","getOpacity","cssFloat","assignStack","children","isElementVisible","Node","TEXT_NODE","css","hasAttribute","getAttribute","attribute","computedStyle","before","prefixedCss","prefixes","prefix","substr","toUpperCase","getComputedStyle","cssInt","fontWeight","weight","parseClip","matches","CLIP","cssList","property","parseBackgroundSize","targetRatio","currentRatio","parseBackgroundPosition","backgroundSize","parseBackgroundRepeat","parseTextShadows","textShadow","results","shadows","TEXT_SHADOW_PROPERTY","TEXT_SHADOW_VALUES","offsetX","offsetY","blur","parseTransform","hasTransform","offset","parseBounds","matrix","parseTransformMatrix","transform","MATRIX_PROPERTY","getValue","tagName","placeholder","15","element","range","renderQueue","StackingContext","background","rectangle","canvasBackground","visibile","createPseudoHideStyles","disableAnimations","flatten","getChildren","getPseudoElements","fontMetrics","calculateOverflowClips","isElement","createStackingContexts","sortStackingContexts","parse","renderIndex","asyncRenderer","paint","hasParentClip","toCamelCase","ClearTransform","calculateBorders","nodeBounds","borderPoints","radius","borderSide","bx","by","bw","bh","drawSide","c1","c2","c3","c4","topLeftOuter","topLeftInner","topRightOuter","topRightInner","bottomRightOuter","bottomRightInner","bottomLeftOuter","bottomLeftInner","getCurvePoints","r1","r2","kappa","sqrt","ox","oy","xm","ym","topLeft","bezierCurve","topRight","bottomRight","bottomLeft","calculateCurvePoints","borderRadius","tlh","tlv","trh","trv","brh","brv","blh","blv","topWidth","rightHeight","bottomWidth","leftHeight","subdivide","startControl","endControl","end","lerp","ab","bc","cd","abbc","bccd","dest","curveTo","borderArgs","curveToReversed","borderData","radius1","radius2","outer1","inner1","outer2","inner2","parseCorner","corner1","corner2","negativeZIndex","positiveZIndex","zIndex0","inlineLevel","isStackingContext","hasText","noLetterSpacing","getBorderRadiusData","side","arr","asInt","renderableNode","ELEMENT_NODE","isPositionedForStacking","zIndex","isPositioned","isFloating","isInlineBlock","not","context","isTextNode","zIndexSort","contexts","hasOpacity","getWidth","nonIgnoredElement","nodeContainer","arrays","stripQuotes","content","first","getWords","characters","word","words","onWordBoundary","isWordBoundary","characterCode","hasUnicode","TextContainer","PseudoElementContainer","appendToDOM","parseBorders","cssClip","cleanDOM","queue","asyncTimer","createStyles","PSEUDO_HIDE_ELEMENT_CLASS_BEFORE","PSEUDO_HIDE_ELEMENT_CLASS_AFTER","hidePseudoElements","innerHTML","getPseudoElement","after","display","isImage","pseudoNode","pseudoContainer","item","parentContainer","newStackingContext","hasOwnStacking","parentStack","getParentStack","isRootElement","isBodyWithTransparentRoot","sort","parseTextBounds","textList","rangeBounds","getRangeBounds","replacementNode","splitText","getWrapperBounds","wrapper","backupText","createRange","setStart","setEnd","getBoundingClientRect","negativeZindex","descendantElements","descendantNonFloats","nonInlineNonPositionedDescendants","nonPositionedFloats","inFlow","stackLevel0","positiveZindex","restore","paintText","paintNode","setOpacity","save","setTransform","paintCheckbox","paintRadio","paintElement","renderBackground","renderBorders","imgContainer","renderImage","imageContainer","paintFormValue","checked","font","circleStroke","circle","ceil","properties","message","textContent","applyTextTransform","letterRendering","character","fontShadow","clearShadow","renderTextDecoration","metrics","borderColorTransforms","inset","colorTransform","parseBackgroundClip","./fontmetrics","./pseudoelementcontainer","./stackingcontext","./textcontainer","16","Proxy","proxyUrl","supportsCORS","XMLHttpRequest","createCallback","createProxyUrl","XHR","jsonp","response","decode64","ProxyURL","supportsCORSImage","cleanup","proxyCount","random","encodeURIComponent","documentFromHTML","DOMParser","parseFromString","implementation","createHTMLDocument","ee","host","head","insertBefore","./xhr","17","18","getHideClass","19","Renderer","paddingLeft","paddingTop","paddingRight","paddingBottom","renderBackgroundColor","renderBackgroundImage","renderBorder","drawShape","backgroundImage","renderBackgroundRepeating","gradientImage","renderBackgroundGradient","repeat","backgroundRepeatShape","renderBackgroundRepeat","20","taintCtx","textBaseline","variables","hasEntries","setFillStyle","fillStyle","fillRect","beginPath","arc","PI","closePath","fill","stroke","strokeColor","strokeStyle","shape","taints","sx","sy","sw","sh","dx","dy","dw","dh","shapes","point","rect","variant","setVariable","globalAlpha","translate","fillText","backgroundPosition","borderLeft","borderTop","createPattern","resizeImage","gradient","createLinearGradient","addColorStop","../lineargradientcontainer","../log","../renderer","21","ownStacking","22","testRangeBounds","testCORS","testSVG","testElement","rangeHeight","selectNode","23","hasFabric","inlineFormatting","fabric","loadSVGFromString","createCanvas","removeContentType","objects","StaticCanvas","lowerCanvasEl","setWidth","setHeight","add","util","groupSVGElements","renderAll","atob","24","_native","XMLSerializer","serializeToString","parseSVGDocument","25","capitalize","p1","p2","26","base64","encoded1","encoded2","encoded3","encoded4","byte1","byte2","byte3","chars","len","clientRect","offsetParent","offsetLeft","definition","prefix_i","block","quote","whitespace","mode","numParen","appendResult","27","28","xhr","status","responseText","statusText","send","BaseObject","_console","isDebug","_len","_key","getName","_rect","_rect2","CanvasState","debugMode","_onMouseDown","_onMouseMove","_onMouseUp","_onTouch","_width","_height","_ctx","_htmlTop","_htmlLeft","_valid","_shape","_dragging","_dragoffx","_dragoffy","_initRect","_initEvents","_interval","draw","mouse","getMouse","mx","my","contains","_x","_y","_currentHandle","getHoverSelectionHandle","oldx","oldy","handleIndex","cursor","_w","_h","evt","touches","newEvt","createEvent","touch","changedTouches","initMouseEvent","originalTarget","screenX","screenY","clientX","clientY","altKey","metaKey","dispatchEvent","preventDefault","_shape2","clearRect","clear","el","pageX","pageY","Rect","_selectionHandles","_selectionBoxSize","_fill","setLineDash","strokeRect","half","cur","handle"],"mappings":"CAAA,SAAAA,EAAAC,GACA,gBAAAC,UAAA,gBAAAC,QACAA,OAAAD,QAAAD,IACA,kBAAAG,gBAAAC,IACAD,OAAA,cAAAH,GACA,gBAAAC,SACAA,QAAA,SAAAD,IAEAD,EAAA,SAAAC,KACCK,KAAA,WACD,MCAgB,UAAUC,GCN1B,QAAAC,GAAAC,GAGA,GAAAC,EAAAD,GACA,MAAAC,GAAAD,GAAAP,OAGA,IAAAC,GAAAO,EAAAD,IACAP,WACAS,GAAAF,EACAG,QAAA,EAUA,OANAL,GAAAE,GAAAI,KAAAV,EAAAD,QAAAC,IAAAD,QAAAM,GAGAL,EAAAS,QAAA,EAGAT,EAAAD,QAvBA,GAAAQ,KAqCA,OATAF,GAAAM,EAAAP,EAGAC,EAAAO,EAAAL,EAGAF,EAAAQ,EAAA,GAGAR,EAAA,KDgBM,SAASL,EAAQD,EAASM,GAE/B,YAoBA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAEhH,QAASC,GAA2BC,EAAMb,GAAQ,IAAKa,EAAQ,KAAM,IAAIC,gBAAe,4DAAgE,QAAOd,GAAyB,gBAATA,IAAqC,kBAATA,GAA8Ba,EAAPb,EAElO,QAASe,GAAUC,EAAUC,GAAc,GAA0B,kBAAfA,IAA4C,OAAfA,EAAuB,KAAM,IAAIN,WAAU,iEAAoEM,GAAeD,GAASE,UAAYC,OAAOC,OAAOH,GAAcA,EAAWC,WAAaG,aAAeC,MAAON,EAAUO,YAAY,EAAOC,UAAU,EAAMC,cAAc,KAAeR,IAAYE,OAAOO,eAAiBP,OAAOO,eAAeV,EAAUC,GAAcD,EAASW,UAAYV,GAxBjeE,OAAOS,eAAevC,EAAS,cAC7BiC,OAAO,GAGT,IAAIO,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIC,GAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,GAAIE,GAAaH,EAAMC,EAAIE,GAAWZ,WAAaY,EAAWZ,aAAc,EAAOY,EAAWV,cAAe,EAAU,SAAWU,KAAYA,EAAWX,UAAW,GAAML,OAAOS,eAAeG,EAAQI,EAAWC,IAAKD,IAAiB,MAAO,UAAUzB,EAAa2B,EAAYC,GAAiJ,MAA9HD,IAAYP,EAAiBpB,EAAYQ,UAAWmB,GAAiBC,GAAaR,EAAiBpB,EAAa4B,GAAqB5B,ME9DjiB6B,EAAA5C,EAAA,GFkEK6C,EAAgBpC,EAAuBmC,GEjE5CE,EAAA9C,EAAA,GFqEK+C,EAAetC,EAAuBqC,GEpE3CE,EAAAhD,EAAA,GFwEKiD,EAAgBxC,EAAuBuC,GEtEtCE,GACJT,KACEU,SAAS,EACTC,UAAU,EACVX,IAAK,MAEPY,aAAa,EACbC,OAAO,GAGYC,EFgFL,SAAUC,GE1ExB,QAAAD,GAAYE,GAAmB,GAAdC,GAAcC,UAAApB,QAAA,GAAAqB,SAAAD,UAAA,MAAAA,UAAA,EAAA9C,GAAAf,KAAAyD,EAAA,IAAAM,GAAA5C,EAAAnB,MAAAyD,EAAAvB,WAAAR,OAAAsC,eAAAP,IAAAlD,KAAAP,MAAA,OAG7B+D,GAAKE,UAAYN,EACjBI,EAAKH,QAAUlC,OAAOwC,UAAWd,EAAgBQ,GACjDG,EAAKI,WAAaP,EAAQJ,MAC1BO,EAAKK,IAAI,eAITL,EAAKM,WAAaN,EAAKM,WAAWC,KAAhBP,GAElBA,EAAKQ,QAZwBR,EFiR9B,MAtMAzC,GAAUmC,EAAUC,GAgCpBtB,EAAaqB,IACXd,IAAK,QACLd,MAAO,WE1FR7B,KAAKwE,gBAEDxE,KAAK4D,QAAQL,aACfvD,KAAKyE,wBFoGN9B,IAAK,gBACLd,MAAO,WE9FM,GAAA6C,GAAA1E,MACd,EAAA+C,cAAY/C,KAAKiE,UAAUU,MAAMC,KAAK,SAACC,GACrCH,EAAKI,QAAUD,CAEf,IAAME,GAAkBL,EAAKT,UAAUe,cAAc,SACrDN,GAAKO,iBAAmBF,EACxBA,EAAgBG,MAAQL,EAAOK,MAC/BH,EAAgBI,OAASN,EAAOM,OAChCJ,EAAgBK,MAAMC,SAAW,QACjCN,EAAgBK,MAAME,KAAO,IAC7BP,EAAgBK,MAAMG,IAAM,IAC5BR,EAAgBK,MAAM,WAAa,QAEnCV,EAAKT,UAAUuB,KAAKC,YAAYV,GAGhCL,EAAKxB,aAAe,GAAAC,cAAgBuB,EAAKT,UAAWc,IAAiB,IAGjEL,EAAKgB,cACPhB,EAAKT,UAAUuB,KAAKG,YAAYjB,EAAKgB,cAEvChB,EAAKT,UAAU2B,oBAAoB,UAAWlB,EAAKL,YACnDK,EAAKmB,4BFyGNlD,IAAK,cACLd,MAAO,eAQPc,IAAK,UACLd,MAAO,WEnGR,MAAO,cF4GNc,IAAK,gBACLd,MAAO,WEtGR7B,KAAKiE,UAAU6B,iBAAiB,UAAW9F,KAAKqE,eF+G/C1B,IAAK,qBACLd,MAAO,WE1GW,GACXoC,GAAcjE,KAAdiE,UACF8B,EAAS9B,EAAUe,cAAc,UACjCgB,EAAW/B,EAAUgC,eAAe,iBAC1CF,GAAON,YAAYO,GACnBD,EAAOX,MAAMC,SAAW,QACxBU,EAAOX,MAAMc,MAAQ,OACrBH,EAAOX,MAAMe,OAAS,OACtBJ,EAAOX,MAAM,WAAa,QAC1BW,EAAOK,QAAUpG,KAAKqG,cAAc/B,KAAKtE,MAEzCA,KAAK0F,aAAeK,EACpB9B,EAAUuB,KAAKC,YAAYM,MFoH1BpD,IAAK,uBACLd,MAAO,WE9Ga,GACboC,GAAcjE,KAAdiE,UACF8B,EAAS9B,EAAUe,cAAc,UACjCgB,EAAW/B,EAAUgC,eAAe,UAC1CF,GAAON,YAAYO,GACnBD,EAAOX,MAAMC,SAAW,QACxBU,EAAOX,MAAMc,MAAQ,OACrBH,EAAOX,MAAMe,OAAS,OACtBJ,EAAOX,MAAM,WAAa,QAC1BW,EAAOK,QAAUpG,KAAKsG,WAAWhC,KAAKtE,MAEtCA,KAAKuG,eAAiBR,EACtB9B,EAAUuB,KAAKC,YAAYM,MFwH1BpD,IAAK,aACLd,MAAO,SElHC2E,GAAO,GAEd7D,GAGE6D,EAHF7D,IACAU,EAEEmD,EAFFnD,QACAC,EACEkD,EADFlD,SAGKmD,EACHzG,KAAK4D,QADPjB,GAGF3C,MAAKoE,IAAL,0BAAmCf,EAAnC,UAAoDC,EAApD,QAAoEX,GAEhEA,IAAQ8D,EAAW9D,KAAOU,IAAYoD,EAAWpD,SAAWoD,EAAWnD,WACzEtD,KAAKoE,IAAI,kDACTpE,KAAKqG,oBFyHN1D,IAAK,aACLd,MAAO,WEjHR,GAAM6E,GAAM1G,KAAK8E,QAAQ6B,WAAW,MAC9BC,EAAY5G,KAAKkD,aAAa2D,eAC9BC,EAAUJ,EAAIK,aAAaH,EAAUI,EAAGJ,EAAUK,EAAGL,EAAUM,EAAGN,EAAUO,GAE5EC,EAAYpH,KAAKiE,UAAUe,cAAc,SAC/CoC,GAAUlC,MAAQ0B,EAAUM,EAC5BE,EAAUjC,OAASyB,EAAUO,CAC7B,IAAME,GAASD,EAAUT,WAAW,KACpCU,GAAOC,aAAaR,EAAS,EAAG,EAEhC,IAAMS,GAAUH,EAAUI,UAAU,YAGpCC,QAAOC,SAASC,KAAOJ,MFsHjB9D,GACPR,aAEFrD,cE1RoB6D,EF2RpB5D,EAAOD,QAAUA,EAAQ,YAIpB,SAASC,EAAQD,EAASM,GAE/B,GAAI0H,GAAgCC,EAA8BC,EAAkCC,EAAYA,GAAoC,SAASC,GAAS,YAAa,IAAIC,GAAwB,kBAATC,SAA8C,gBAAlBA,QAAOC,SAAoB,SAASvH,GAAK,aAAcA,IAAM,SAASA,GAAK,MAAOA,IAAqB,kBAATsH,SAAqBtH,EAAIgB,cAAcsG,OAAO,eAAgBtH,KGxS/X,SAAUwH,GAAG,GAAoB,WAAjBH,EAAOrI,IAAoC,mBAATC,GAAsBA,EAAOD,QAAQwI,QAAS,CAA2CP,KAAAD,EAAA,EAAAE,EAAA,kBAAAF,KAAAS,MAAAzI,EAAAiI,GAAAD,IAAA9D,SAAAgE,IAAAjI,EAAAD,QAAAkI,MAA4L,WAAW,GAAIhI,EAAsB,OAAQ,SAASwI,GAAEC,EAAEC,EAAEC,GAAG,QAASC,GAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,GAAIE,GAAkB,kBAATd,IAAqBA,CAAQ,KAAIa,GAAGC,EAAE,MAAOd,GAAEY,GAAE,EAAI,IAAGnG,EAAE,MAAOA,GAAEmG,GAAE,EAAI,IAAIP,GAAE,GAAIU,OAAM,uBAAuBH,EAAE,IAAK,MAAMP,GAAEW,KAAK,mBAAmBX,EAAE,GAAIY,GAAER,EAAEG,IAAI/I,WAAY2I,GAAEI,GAAG,GAAGpI,KAAKyI,EAAEpJ,QAAQ,SAAS0I,GAAG,GAAIE,GAAED,EAAEI,GAAG,GAAGL,EAAG,OAAOI,GAAEF,EAAEA,EAAEF,IAAIU,EAAEA,EAAEpJ,QAAQ0I,EAAEC,EAAEC,EAAEC,GAAG,MAAOD,GAAEG,GAAG/I,QAAkD,IAAI,GAA1C4C,GAAkB,kBAATuF,IAAqBA,EAAgBY,EAAE,EAAEA,EAAEF,EAAEhG,OAAOkG,IAAID,EAAED,EAAEE,GAAI,OAAOD,KAAKO,GAAG,SAASC,EAAQrJ,EAAOD,IAC10B,SAAWoI,IAET,SAAStI,GAgEV,QAASyJ,GAAMC,GACd,KAAM,IAAIC,YAAWC,EAAOF,IAW7B,QAASG,GAAIC,EAAOC,GAGnB,IAFA,GAAIhH,GAAS+G,EAAM/G,OACfiH,KACGjH,KACNiH,EAAOjH,GAAUgH,EAAGD,EAAM/G,GAE3B,OAAOiH,GAaR,QAASC,GAAUC,EAAQH,GAC1B,GAAII,GAAQD,EAAOE,MAAM,KACrBJ,EAAS,EACTG,GAAMpH,OAAS,IAGlBiH,EAASG,EAAM,GAAK,IACpBD,EAASC,EAAM,IAGhBD,EAASA,EAAOG,QAAQC,EAAiB,IACzC,IAAIC,GAASL,EAAOE,MAAM,KACtBI,EAAUX,EAAIU,EAAQR,GAAIU,KAAK,IACnC,OAAOT,GAASQ,EAgBjB,QAASE,GAAWR,GAMnB,IALA,GAGI/H,GACAwI,EAJAC,KACAC,EAAU,EACV9H,EAASmH,EAAOnH,OAGb8H,EAAU9H,GAChBZ,EAAQ+H,EAAOY,WAAWD,KACtB1I,GAAS,OAAUA,GAAS,OAAU0I,EAAU9H,GAEnD4H,EAAQT,EAAOY,WAAWD,KACF,QAAX,MAARF,GACJC,EAAOG,OAAe,KAAR5I,IAAkB,KAAe,KAARwI,GAAiB,QAIxDC,EAAOG,KAAK5I,GACZ0I,MAGDD,EAAOG,KAAK5I,EAGd,OAAOyI,GAWR,QAASI,GAAWlB,GACnB,MAAOD,GAAIC,EAAO,SAAS3H,GAC1B,GAAIyI,GAAS,EAOb,OANIzI,GAAQ,QACXA,GAAS,MACTyI,GAAUK,EAAmB9I,IAAU,GAAK,KAAQ,OACpDA,EAAQ,MAAiB,KAARA,GAElByI,GAAUK,EAAmB9I,KAE3BsI,KAAK,IAYT,QAASS,GAAaC,GACrB,MAAIA,GAAY,GAAK,GACbA,EAAY,GAEhBA,EAAY,GAAK,GACbA,EAAY,GAEhBA,EAAY,GAAK,GACbA,EAAY,GAEbC,EAcR,QAASC,GAAaC,EAAOC,GAG5B,MAAOD,GAAQ,GAAK,IAAMA,EAAQ,MAAgB,GAARC,IAAc,GAQzD,QAASC,GAAMC,EAAOC,EAAWC,GAChC,GAAIC,GAAI,CAGR,KAFAH,EAAQE,EAAYE,EAAMJ,EAAQK,GAAQL,GAAS,EACnDA,GAASI,EAAMJ,EAAQC,GACOD,EAAQM,EAAgBC,GAAQ,EAAGJ,GAAKR,EACrEK,EAAQI,EAAMJ,EAAQM,EAEvB,OAAOF,GAAMD,GAAKG,EAAgB,GAAKN,GAASA,EAAQQ,IAUzD,QAASC,GAAOC,GAEf,GAEIC,GAIAC,EACAC,EACAC,EACAC,EACAhF,EACAoE,EACAN,EACAzC,EAEA4D,EAfA7B,KACA8B,EAAcP,EAAMpJ,OAEpBD,EAAI,EACJgG,EAAI6D,EACJC,EAAOC,CAqBX,KALAR,EAAQF,EAAMW,YAAYC,GACtBV,EAAQ,IACXA,EAAQ,GAGJC,EAAI,EAAGA,EAAID,IAASC,EAEpBH,EAAMrB,WAAWwB,IAAM,KAC1B7C,EAAM,aAEPmB,EAAOG,KAAKoB,EAAMrB,WAAWwB,GAM9B,KAAKC,EAAQF,EAAQ,EAAIA,EAAQ,EAAI,EAAGE,EAAQG,GAAwC,CAOvF,IAAKF,EAAO1J,EAAG0E,EAAI,EAAGoE,EAAIR,EAErBmB,GAASG,GACZjD,EAAM,iBAGP6B,EAAQJ,EAAaiB,EAAMrB,WAAWyB,OAElCjB,GAASF,GAAQE,EAAQO,GAAOmB,EAASlK,GAAK0E,KACjDiC,EAAM,YAGP3G,GAAKwI,EAAQ9D,EACbqB,EAAI+C,GAAKgB,EAAOK,EAAQrB,GAAKgB,EAAOZ,EAAOA,EAAOJ,EAAIgB,IAElDtB,EAAQzC,GAfuC+C,GAAKR,EAmBxDqB,EAAarB,EAAOvC,EAChBrB,EAAIqE,EAAMmB,EAASP,IACtBhD,EAAM,YAGPjC,GAAKiF,CAINL,GAAMxB,EAAO7H,OAAS,EACtB6J,EAAOpB,EAAM1I,EAAI0J,EAAMJ,EAAa,GAARI,GAIxBX,EAAM/I,EAAIsJ,GAAOY,EAASlE,GAC7BW,EAAM,YAGPX,GAAK+C,EAAM/I,EAAIsJ,GACftJ,GAAKsJ,EAGLxB,EAAOsC,OAAOpK,IAAK,EAAGgG,GAIvB,MAAOkC,GAAWJ,GAUnB,QAASuC,GAAOhB,GACf,GAAIrD,GACA2C,EACA2B,EACAC,EACAT,EACAN,EACAxL,EACAwM,EACA1B,EACA/C,EACA0E,EAGAb,EAEAc,EACAf,EACAgB,EANA7C,IAoBJ,KAXAuB,EAAQzB,EAAWyB,GAGnBO,EAAcP,EAAMpJ,OAGpB+F,EAAI6D,EACJlB,EAAQ,EACRmB,EAAOC,EAGFP,EAAI,EAAGA,EAAII,IAAeJ,EAC9BiB,EAAepB,EAAMG,GACjBiB,EAAe,KAClB3C,EAAOG,KAAKE,EAAmBsC,GAejC,KAXAH,EAAiBC,EAAczC,EAAO7H,OAMlCsK,GACHzC,EAAOG,KAAKgC,GAINK,EAAiBV,GAAa,CAIpC,IAAK5L,EAAIkM,EAAQV,EAAI,EAAGA,EAAII,IAAeJ,EAC1CiB,EAAepB,EAAMG,GACjBiB,GAAgBzE,GAAKyE,EAAezM,IACvCA,EAAIyM,EAcN,KARAC,EAAwBJ,EAAiB,EACrCtM,EAAIgI,EAAI+C,GAAOmB,EAASvB,GAAS+B,IACpC/D,EAAM,YAGPgC,IAAU3K,EAAIgI,GAAK0E,EACnB1E,EAAIhI,EAECwL,EAAI,EAAGA,EAAII,IAAeJ,EAO9B,GANAiB,EAAepB,EAAMG,GAEjBiB,EAAezE,KAAO2C,EAAQuB,GACjCvD,EAAM,YAGH8D,GAAgBzE,EAAG,CAEtB,IAAKwE,EAAI7B,EAAOG,EAAIR,EACnBvC,EAAI+C,GAAKgB,EAAOK,EAAQrB,GAAKgB,EAAOZ,EAAOA,EAAOJ,EAAIgB,IAClDU,EAAIzE,GAFqC+C,GAAKR,EAKlDqC,EAAUH,EAAIzE,EACd4D,EAAarB,EAAOvC,EACpB+B,EAAOG,KACNE,EAAmBI,EAAaxC,EAAI4E,EAAUhB,EAAY,KAE3Da,EAAIzB,EAAM4B,EAAUhB,EAGrB7B,GAAOG,KAAKE,EAAmBI,EAAaiC,EAAG,KAC/CV,EAAOpB,EAAMC,EAAO+B,EAAuBJ,GAAkBC,GAC7D5B,EAAQ,IACN2B,IAIF3B,IACA3C,EAGH,MAAO8B,GAAOH,KAAK,IAcpB,QAASiD,GAAUvB,GAClB,MAAOlC,GAAUkC,EAAO,SAASjC,GAChC,MAAOyD,GAAcC,KAAK1D,GACvBgC,EAAOhC,EAAO2D,MAAM,GAAGC,eACvB5D,IAeL,QAAS6D,GAAQ5B,GAChB,MAAOlC,GAAUkC,EAAO,SAASjC,GAChC,MAAO8D,GAAcJ,KAAK1D,GACvB,OAASiD,EAAOjD,GAChBA,IAvdL,GAAI+D,GAAgC,WAAlB,mBAAO/N,GAAP,YAAAqI,EAAOrI,KAAuBA,IAC9CA,EAAQgO,UAAYhO,EAClBiO,EAA8B,WAAjB,mBAAOhO,GAAP,YAAAoI,EAAOpI,KAAsBA,IAC5CA,EAAO+N,UAAY/N,EACjBiO,EAA8B,WAAjB,mBAAO9F,GAAP,YAAAC,EAAOD,KAAsBA,CAE7C8F,GAAW9F,SAAW8F,GACtBA,EAAWrG,SAAWqG,GACtBA,EAAW1M,OAAS0M,IAEpBpO,EAAOoO,EAQR,IAAIC,GAiCJpL,EA9BA+J,EAAS,WAGT5B,EAAO,GACP6B,EAAO,EACPjB,EAAO,GACPC,EAAO,GACPH,EAAO,IACPe,EAAc,GACdF,EAAW,IACXI,EAAY,IAGZY,EAAgB,QAChBK,EAAgB,eAChB1D,EAAkB,4BAGlBV,GACC0E,SAAY,kDACZC,YAAa,iDACbC,gBAAiB,iBAIlBzC,EAAgBX,EAAO6B,EACvBpB,EAAQ4C,KAAK5C,MACbZ,EAAqByD,OAAOC,YAyc5B,IA3BAN,GAMCO,QAAW,QAQXC,MACC3C,OAAUxB,EACVyC,OAAUnC,GAEXkB,OAAUA,EACViB,OAAUA,EACVY,QAAWA,EACXL,UAAaA,GAOI,kBAAVtN,IACc,UAArBmI,EAAOnI,EAAOC,MACdD,EAAOC,IAEPD,EAAO,WAAY,WAClB,MAAOiO,SAEF,IAAIJ,GAAeE,EACzB,GAAIhO,EAAOD,SAAW+N,EAErBE,EAAWjO,QAAUmO,MAGrB,KAAKpL,IAAOoL,GACXA,EAASS,eAAe7L,KAASgL,EAAYhL,GAAOoL,EAASpL,QAK/DjD,GAAKqO,SAAWA,GAGhB/N,QAECO,KAAKP,KAAuB,mBAAXgI,GAAyBA,EAAyB,mBAAT5G,MAAuBA,KAAyB,mBAAXqG,QAAyBA,gBACrHgH,GAAG,SAASvF,EAAQrJ,EAAOD,GAGjC,QAAS8O,GAAmBC,EAAe3H,EAAGC,IACtC0H,EAAcC,aAAgB5H,IAAM2H,EAAcC,YAAYC,aAAe5H,IAAM0H,EAAcC,YAAYE,aAC7GH,EAAcC,YAAYG,SAAS/H,EAAGC,GAI9C,QAAS+H,GAAoBnK,EAAQoK,GACjC,IACQA,IACAA,EAAa/J,MAAQL,EAAOK,MAC5B+J,EAAa9J,OAASN,EAAOM,OAC7B8J,EAAatI,WAAW,MAAMW,aAAazC,EAAO8B,WAAW,MAAMI,aAAa,EAAG,EAAGlC,EAAOK,MAAOL,EAAOM,QAAS,EAAG,IAE7H,MAAMmD,GACJlE,EAAI,qCAAsCS,EAAQyD,IAI1D,QAAS4G,GAAUC,EAAMC,GAIrB,IAHA,GAAIC,GAA0B,IAAlBF,EAAKvB,SAAiB0B,SAASrJ,eAAekJ,EAAKI,WAAaJ,EAAKD,WAAU,GAEvFM,EAAQL,EAAKM,WACXD,GACEJ,KAAsB,GAA2B,IAAnBI,EAAM5B,UAAqC,WAAnB4B,EAAME,UAC5DL,EAAM5J,YAAYyJ,EAAUM,EAAOJ,IAEvCI,EAAQA,EAAMG,WAalB,OAVsB,KAAlBR,EAAKvB,WACLyB,EAAMO,WAAaT,EAAKU,UACxBR,EAAMS,YAAcX,EAAKY,WACH,WAAlBZ,EAAKO,SACLV,EAAoBG,EAAME,GACD,aAAlBF,EAAKO,UAA6C,WAAlBP,EAAKO,WAC5CL,EAAMxN,MAAQsN,EAAKtN,QAIpBwN,EAGX,QAASW,GAASb,GACd,GAAsB,IAAlBA,EAAKvB,SAAgB,CACrBuB,EAAKU,UAAYV,EAAKS,WACtBT,EAAKY,WAAaZ,EAAKW,WAGvB,KADA,GAAIN,GAAQL,EAAKM,WACXD,GACFQ,EAASR,GACTA,EAAQA,EAAMG,aApD1B,GAAIvL,GAAM8E,EAAQ,QAyDlBrJ,GAAOD,QAAU,SAAS+O,EAAesB,EAAmB/K,EAAOC,EAAQvB,EAASoD,EAAGC,GACnF,GAAIiJ,GAAkBhB,EAAUP,EAAcuB,gBAAiBtM,EAAQwL,mBACnEe,EAAYF,EAAkBjL,cAAc,SAahD,OAXAmL,GAAUC,UAAY,wBACtBD,EAAU/K,MAAMiL,WAAa,SAC7BF,EAAU/K,MAAMC,SAAW,QAC3B8K,EAAU/K,MAAME,KAAO,WACvB6K,EAAU/K,MAAMG,IAAM,MACtB4K,EAAU/K,MAAMkL,OAAS,IACzBH,EAAUjL,MAAQA,EAClBiL,EAAUhL,OAASA,EACnBgL,EAAUI,UAAY,KACtBN,EAAkBzK,KAAKC,YAAY0K,GAE5B,GAAIK,SAAQ,SAASC,GACxB,GAAIC,GAAgBP,EAAUQ,cAAcrB,QAK5Ca,GAAUQ,cAAcC,OAAST,EAAUS,OAAS,WAChD,GAAIC,GAAWC,YAAY,WACnBJ,EAAclL,KAAKuL,WAAWtO,OAAS,IACvCuN,EAASU,EAAcR,iBACvBc,cAAcH,GACO,SAAjBjN,EAAQwF,OACR+G,EAAUQ,cAAc5B,SAAS/H,EAAGC,IAC/B,sBAAuBqG,KAAK2D,UAAUC,YAAef,EAAUQ,cAAcQ,UAAYlK,GAAKkJ,EAAUQ,cAAcS,UAAYpK,IACnI0J,EAAcR,gBAAgB9K,MAAMG,KAAQ0B,EAAK,KACjDyJ,EAAcR,gBAAgB9K,MAAME,MAAS0B,EAAK,KAClD0J,EAAcR,gBAAgB9K,MAAMC,SAAW,aAGvDoL,EAAQN,KAEb,KAGPO,EAAcW,OACdX,EAAcY,MAAM,gCAEpB5C,EAAmBC,EAAe3H,EAAGC,GACrCyJ,EAAca,aAAab,EAAcc,UAAUtB,GAAkBQ,EAAcR,iBACnFQ,EAAce,aAInBC,QAAQ,KAAKC,GAAG,SAASzI,EAAQrJ,EAAOD,GAG3C,QAASgS,GAAM/P,GACX7B,KAAKyI,EAAI,EACTzI,KAAK6R,EAAI,EACT7R,KAAK8R,EAAI,EACT9R,KAAK6I,EAAI,IACI7I,MAAK+R,UAAUlQ,IACxB7B,KAAKgS,WAAWnQ,IAChB7B,KAAKiS,IAAIpQ,IACT7B,KAAKkS,KAAKrQ,IACV7B,KAAKmS,KAAKtQ,IACV7B,KAAKoS,KAAKvQ,GAGlB+P,EAAMnQ,UAAU4Q,OAAS,SAASC,GAC9B,GAAIzJ,GAAI,EAAIyJ,CACZ,OAAQ,IAAIV,IACRzD,KAAKoE,MAAMvS,KAAKyI,EAAII,GACpBsF,KAAKoE,MAAMvS,KAAK6R,EAAIhJ,GACpBsF,KAAKoE,MAAMvS,KAAK8R,EAAIjJ,GACpB7I,KAAK6I,KAIb+I,EAAMnQ,UAAU+Q,cAAgB,WAC5B,MAAkB,KAAXxS,KAAK6I,GAGhB+I,EAAMnQ,UAAUgR,QAAU,WACtB,MAAkB,KAAXzS,KAAKyI,GAAsB,IAAXzI,KAAK6R,GAAsB,IAAX7R,KAAK8R,GAGhDF,EAAMnQ,UAAUsQ,UAAY,SAASvI,GAUjC,MATIkJ,OAAMC,QAAQnJ,KACdxJ,KAAKyI,EAAI0F,KAAKyE,IAAIpJ,EAAM,GAAI,KAC5BxJ,KAAK6R,EAAI1D,KAAKyE,IAAIpJ,EAAM,GAAI,KAC5BxJ,KAAK8R,EAAI3D,KAAKyE,IAAIpJ,EAAM,GAAI,KACxBA,EAAM/G,OAAS,IACfzC,KAAK6I,EAAIW,EAAM,KAIfkJ,MAAMC,QAAQnJ,GAG1B,IAAIqJ,GAAQ,mBAEZjB,GAAMnQ,UAAU2Q,KAAO,SAASvQ,GAC5B,GAAIiR,GAAQ,IAMZ,OALqC,SAAhCA,EAAQjR,EAAMiR,MAAMD,MACrB7S,KAAKyI,EAAIsK,SAASD,EAAM,GAAG,GAAKA,EAAM,GAAG,GAAI,IAC7C9S,KAAK6R,EAAIkB,SAASD,EAAM,GAAG,GAAKA,EAAM,GAAG,GAAI,IAC7C9S,KAAK8R,EAAIiB,SAASD,EAAM,GAAG,GAAKA,EAAM,GAAG,GAAI,KAEhC,OAAVA,EAGX,IAAIE,GAAQ,mBAEZpB,GAAMnQ,UAAU0Q,KAAO,SAAStQ,GAC5B,GAAIiR,GAAQ,IAMZ,OALqC,SAAhCA,EAAQjR,EAAMiR,MAAME,MACrBhT,KAAKyI,EAAIsK,SAASD,EAAM,GAAGG,UAAU,EAAG,GAAI,IAC5CjT,KAAK6R,EAAIkB,SAASD,EAAM,GAAGG,UAAU,EAAG,GAAI,IAC5CjT,KAAK8R,EAAIiB,SAASD,EAAM,GAAGG,UAAU,EAAG,GAAI,KAE/B,OAAVH,EAIX,IAAII,GAAO,0DAEXtB,GAAMnQ,UAAUwQ,IAAM,SAASpQ,GAC3B,GAAIiR,GAAQ,IAMZ,OALoC,SAA/BA,EAAQjR,EAAMiR,MAAMI,MACrBlT,KAAKyI,EAAI0K,OAAOL,EAAM,IACtB9S,KAAK6R,EAAIsB,OAAOL,EAAM,IACtB9S,KAAK8R,EAAIqB,OAAOL,EAAM,KAET,OAAVA,EAGX,IAAIM,GAAQ,6EAEZxB,GAAMnQ,UAAUyQ,KAAO,SAASrQ,GAC5B,GAAIiR,GAAQ,IAOZ,OANqC,SAAhCA,EAAQjR,EAAMiR,MAAMM,MACrBpT,KAAKyI,EAAI0K,OAAOL,EAAM,IACtB9S,KAAK6R,EAAIsB,OAAOL,EAAM,IACtB9S,KAAK8R,EAAIqB,OAAOL,EAAM,IACtB9S,KAAK6I,EAAIsK,OAAOL,EAAM,KAET,OAAVA,GAGXlB,EAAMnQ,UAAU4R,SAAW,WACvB,MAAkB,QAAXrT,KAAK6I,GAAyB,IAAX7I,KAAK6I,EAC/B,SAAW7I,KAAKyI,EAAGzI,KAAK6R,EAAG7R,KAAK8R,EAAG9R,KAAK6I,GAAGsB,KAAK,KAAO,IACvD,QAAUnK,KAAKyI,EAAGzI,KAAK6R,EAAG7R,KAAK8R,GAAG3H,KAAK,KAAO,KAGlDyH,EAAMnQ,UAAUuQ,WAAa,SAASnQ,GAClCA,EAAQA,EAAM2L,aACd,IAAI8F,GAAQC,EAAO1R,EACnB,IAAIyR,EACAtT,KAAKyI,EAAI6K,EAAM,GACftT,KAAK6R,EAAIyB,EAAM,GACftT,KAAK8R,EAAIwB,EAAM,OACZ,IAAc,gBAAVzR,EAEP,MADA7B,MAAKyI,EAAIzI,KAAK6R,EAAI7R,KAAK8R,EAAI9R,KAAK6I,EAAI,GAC7B,CAGX,SAASyK,GAGb1B,EAAMnQ,UAAU+R,SAAU,CAG1B,IAAID,IACAE,WAAc,IAAK,IAAK,KACxBC,cAAiB,IAAK,IAAK,KAC3BC,MAAS,EAAG,IAAK,KACjBC,YAAe,IAAK,IAAK,KACzBC,OAAU,IAAK,IAAK,KACpBC,OAAU,IAAK,IAAK,KACpBC,QAAW,IAAK,IAAK,KACrBC,OAAU,EAAG,EAAG,GAChBC,gBAAmB,IAAK,IAAK,KAC7BC,MAAS,EAAG,EAAG,KACfC,YAAe,IAAK,GAAI,KACxBC,OAAU,IAAK,GAAI,IACnBC,WAAc,IAAK,IAAK,KACxBC,WAAc,GAAI,IAAK,KACvBC,YAAe,IAAK,IAAK,GACzBC,WAAc,IAAK,IAAK,IACxBC,OAAU,IAAK,IAAK,IACpBC,gBAAmB,IAAK,IAAK,KAC7BC,UAAa,IAAK,IAAK,KACvBC,SAAY,IAAK,GAAI,IACrBC,MAAS,EAAG,IAAK,KACjBC,UAAa,EAAG,EAAG,KACnBC,UAAa,EAAG,IAAK,KACrBC,eAAkB,IAAK,IAAK,IAC5BC,UAAa,IAAK,IAAK,KACvBC,WAAc,EAAG,IAAK,GACtBC,UAAa,IAAK,IAAK,KACvBC,WAAc,IAAK,IAAK,KACxBC,aAAgB,IAAK,EAAG,KACxBC,gBAAmB,GAAI,IAAK,IAC5BC,YAAe,IAAK,IAAK,GACzBC,YAAe,IAAK,GAAI,KACxBC,SAAY,IAAK,EAAG,GACpBC,YAAe,IAAK,IAAK,KACzBC,cAAiB,IAAK,IAAK,KAC3BC,eAAkB,GAAI,GAAI,KAC1BC,eAAkB,GAAI,GAAI,IAC1BC,eAAkB,GAAI,GAAI,IAC1BC,eAAkB,EAAG,IAAK,KAC1BC,YAAe,IAAK,EAAG,KACvBC,UAAa,IAAK,GAAI,KACtBC,aAAgB,EAAG,IAAK,KACxBC,SAAY,IAAK,IAAK,KACtBC,SAAY,IAAK,IAAK,KACtBC,YAAe,GAAI,IAAK,KACxBC,WAAc,IAAK,GAAI,IACvBC,aAAgB,IAAK,IAAK,KAC1BC,aAAgB,GAAI,IAAK,IACzBC,SAAY,IAAK,EAAG,KACpBC,WAAc,IAAK,IAAK,KACxBC,YAAe,IAAK,IAAK,KACzBC,MAAS,IAAK,IAAK,GACnBC,WAAc,IAAK,IAAK,IACxBC,MAAS,IAAK,IAAK,KACnBC,OAAU,EAAG,IAAK,GAClBC,aAAgB,IAAK,IAAK,IAC1BC,MAAS,IAAK,IAAK,KACnBC,UAAa,IAAK,IAAK,KACvBC,SAAY,IAAK,IAAK,KACtBC,WAAc,IAAK,GAAI,IACvBC,QAAW,GAAI,EAAG,KAClBC,OAAU,IAAK,IAAK,KACpBC,OAAU,IAAK,IAAK,KACpBC,UAAa,IAAK,IAAK,KACvBC,eAAkB,IAAK,IAAK,KAC5BC,WAAc,IAAK,IAAK,GACxBC,cAAiB,IAAK,IAAK,KAC3BC,WAAc,IAAK,IAAK,KACxBC,YAAe,IAAK,IAAK,KACzBC,WAAc,IAAK,IAAK,KACxBC,sBAAyB,IAAK,IAAK,KACnCC,WAAc,IAAK,IAAK,KACxBC,YAAe,IAAK,IAAK,KACzBC,WAAc,IAAK,IAAK,KACxBC,WAAc,IAAK,IAAK,KACxBC,aAAgB,IAAK,IAAK,KAC1BC,eAAkB,GAAI,IAAK,KAC3BC,cAAiB,IAAK,IAAK,KAC3BC,gBAAmB,IAAK,IAAK,KAC7BC,gBAAmB,IAAK,IAAK,KAC7BC,gBAAmB,IAAK,IAAK,KAC7BC,aAAgB,IAAK,IAAK,KAC1BC,MAAS,EAAG,IAAK,GACjBC,WAAc,GAAI,IAAK,IACvBC,OAAU,IAAK,IAAK,KACpBC,SAAY,IAAK,EAAG,KACpBC,QAAW,IAAK,EAAG,GACnBC,kBAAqB,IAAK,IAAK,KAC/BC,YAAe,EAAG,EAAG,KACrBC,cAAiB,IAAK,GAAI,KAC1BC,cAAiB,IAAK,IAAK,KAC3BC,gBAAmB,GAAI,IAAK,KAC5BC,iBAAoB,IAAK,IAAK,KAC9BC,mBAAsB,EAAG,IAAK,KAC9BC,iBAAoB,GAAI,IAAK,KAC7BC,iBAAoB,IAAK,GAAI,KAC7BC,cAAiB,GAAI,GAAI,KACzBC,WAAc,IAAK,IAAK,KACxBC,WAAc,IAAK,IAAK,KACxBC,UAAa,IAAK,IAAK,KACvBC,aAAgB,IAAK,IAAK,KAC1BC,MAAS,EAAG,EAAG,KACfC,SAAY,IAAK,IAAK,KACtBC,OAAU,IAAK,IAAK,GACpBC,WAAc,IAAK,IAAK,IACxBC,QAAW,IAAK,IAAK,GACrBC,WAAc,IAAK,GAAI,GACvBC,QAAW,IAAK,IAAK,KACrBC,eAAkB,IAAK,IAAK,KAC5BC,WAAc,IAAK,IAAK,KACxBC,eAAkB,IAAK,IAAK,KAC5BC,eAAkB,IAAK,IAAK,KAC5BC,YAAe,IAAK,IAAK,KACzBC,WAAc,IAAK,IAAK,KACxBC,MAAS,IAAK,IAAK,IACnBC,MAAS,IAAK,IAAK,KACnBC,MAAS,IAAK,IAAK,KACnBC,YAAe,IAAK,IAAK,KACzBC,QAAW,IAAK,EAAG,KACnBC,eAAkB,IAAK,GAAI,KAC3BC,KAAQ,IAAK,EAAG,GAChBC,WAAc,IAAK,IAAK,KACxBC,WAAc,GAAI,IAAK,KACvBC,aAAgB,IAAK,GAAI,IACzBC,QAAW,IAAK,IAAK,KACrBC,YAAe,IAAK,IAAK,IACzBC,UAAa,GAAI,IAAK,IACtBC,UAAa,IAAK,IAAK,KACvBC,QAAW,IAAK,GAAI,IACpBC,QAAW,IAAK,IAAK,KACrBC,SAAY,IAAK,IAAK,KACtBC,WAAc,IAAK,GAAI,KACvBC,WAAc,IAAK,IAAK,KACxBC,WAAc,IAAK,IAAK,KACxBC,MAAS,IAAK,IAAK,KACnBC,aAAgB,EAAG,IAAK,KACxBC,WAAc,GAAI,IAAK,KACvBC,KAAQ,IAAK,IAAK,KAClBC,MAAS,EAAG,IAAK,KACjBC,SAAY,IAAK,IAAK,KACtBC,QAAW,IAAK,GAAI,IACpBC,WAAc,GAAI,IAAK,KACvBC,QAAW,IAAK,IAAK,KACrBC,OAAU,IAAK,IAAK,KACpBC,OAAU,IAAK,IAAK,KACpBC,YAAe,IAAK,IAAK,KACzBC,QAAW,IAAK,IAAK,GACrBC,aAAgB,IAAK,IAAK,IAG9B/c,GAAOD,QAAUgS,OAEXiL,GAAG,SAAS3T,EAAQrJ,EAAOD,GAejC,QAASkd,GAAYC,EAAUnZ,GAC3B,GAAIqI,GAAQ+Q,GAeZ,IAdApZ,EAAUA,MACNA,EAAQqZ,UACR7Y,EAAIR,QAAQqZ,SAAU,EACtB7Y,EAAIR,QAAQsZ,MAAQC,KAAKC,OAG7BxZ,EAAQyZ,MAAkC,mBAAnBzZ,GAAQyZ,OAAgCzZ,EAAQyZ,MACvEzZ,EAAQ0Z,WAA4C,mBAAxB1Z,GAAQ0Z,YAAsC1Z,EAAQ0Z,WAClF1Z,EAAQ2Z,gBAAsD,mBAA7B3Z,GAAQ2Z,iBAA0C3Z,EAAQ2Z,gBAC3F3Z,EAAQwL,kBAA0D,mBAA/BxL,GAAQwL,mBAA6CxL,EAAQwL,kBAChGxL,EAAQ4Z,aAAgD,mBAA1B5Z,GAAQ4Z,aAAgC,IAAQ5Z,EAAQ4Z,aACtF5Z,EAAQ6Z,SAAwC,kBAAtB7Z,GAAQ6Z,SAA2B7Z,EAAQ6Z,SAAWC,EAChF9Z,EAAQ+Z,SAAW/Z,EAAQ+Z,OAEF,gBAAdZ,GAAwB,CAC/B,GAA8B,gBAAnBnZ,GAAQga,MACf,MAAOpN,SAAQqN,OAAO,wCAE1B,IAAI3Y,GAAyB,MAAjBtB,EAAQsB,MAAgBtB,EAAQsB,MAAQuC,OAAOqW,WACvD3Y,EAA2B,MAAlBvB,EAAQuB,OAAiBvB,EAAQuB,OAASsC,OAAOsW,WAC9D,OAAOC,GAAgBC,EAAYlB,GAAWnZ,EAAQga,MAAOtO,SAAUpK,EAAOC,EAAQvB,GAASgB,KAAK,SAASuL,GACzG,MAAO+N,GAAa/N,EAAUQ,cAAcrB,SAASY,gBAAiBC,EAAWvM,EAASsB,EAAOC,KAIzG,GAAIgK,IAAsBrL,SAAbiZ,GAA2BzN,SAASY,iBAAqB6M,EAASta,OAAUsa,GAAYA,IAAY,EAEjH,OADA5N,GAAKgP,aAAaC,EAA2BnS,EAAOA,GAC7CoS,EAAelP,EAAKR,cAAe/K,EAASuL,EAAKR,cAAcC,YAAYkP,WAAY3O,EAAKR,cAAcC,YAAYmP,YAAa9R,GAAOrH,KAAK,SAASC,GAK3J,MAJmC,kBAAxBjB,GAAQ0a,aACfla,EAAI,yFACJR,EAAQ0a,WAAWzZ,IAEhBA,IAqBf,QAASwZ,GAAe/O,EAAU1L,EAAS2a,EAAaC,EAAcC,GAClE,MAAOC,GAAkBpP,EAAUA,EAAUiP,EAAaC,EAAc5a,EAAS0L,EAASV,YAAYC,YAAaS,EAASV,YAAYE,aAAalK,KAAK,SAASuL,GAC/J/L,EAAI,kBACJ,IAAIua,GAAgBP,EAA2BK,EAC3CG,EAAW,IAAMD,EAAgB,KAAOF,EAAmB,IAC/DnP,GAASuP,cAAcD,GAAUE,gBAAgBH,EACjD,IAAII,GAAe5O,EAAUQ,cACzBxB,EAAO4P,EAAazP,SAASuP,cAAcD,GAC3CI,EAA8C,kBAArBpb,GAAQqb,QAA2BzO,QAAQC,QAAQ7M,EAAQqb,QAAQF,EAAazP,WAAakB,QAAQC,SAAQ,EAC1I,OAAOuO,GAAepa,KAAK,WACvB,MAAOsZ,GAAa/O,EAAMgB,EAAWvM,EAAS2a,EAAaC,OAKvE,QAASN,GAAa/O,EAAMgB,EAAWvM,EAAS2a,EAAaC,GACzD,GAAIO,GAAe5O,EAAUQ,cACzBuO,EAAU,GAAIC,GAAQJ,EAAazP,UACnC8P,EAAc,GAAIC,GAAYzb,EAASsb,GACvCI,EAASC,EAAUpQ,GACnBjK,EAAyB,SAAjBtB,EAAQwF,KAAkBmV,EAAciB,EAAcT,EAAazP,UAC3EnK,EAA0B,SAAjBvB,EAAQwF,KAAkBoV,EAAeiB,EAAeV,EAAazP,UAC9EmO,EAAW,GAAI7Z,GAAQ6Z,SAASvY,EAAOC,EAAQia,EAAaxb,EAAS0L,UACrEoQ,EAAS,GAAIC,GAAWxQ,EAAMsO,EAAUyB,EAASE,EAAaxb,EAClE,OAAO8b,GAAOE,MAAMhb,KAAK,WACrBR,EAAI,qBACJ,IAAIS,EAWJ,OARIA,GADiB,SAAjBjB,EAAQwF,KACCyW,EAAKpC,EAAS5Y,QAASK,MAAOuY,EAAS5Y,OAAOK,MAAOC,OAAQsY,EAAS5Y,OAAOM,OAAQI,IAAK,EAAGD,KAAM,EAAG0B,EAAG,EAAGC,EAAG,IACjHkI,IAAS4P,EAAazP,SAAS9J,MAAQ2J,IAAS4P,EAAazP,SAASY,iBAAqC,MAAlBtM,EAAQiB,OAC/F4Y,EAAS5Y,OAETgb,EAAKpC,EAAS5Y,QAASK,MAAyB,MAAjBtB,EAAQsB,MAAgBtB,EAAQsB,MAAQoa,EAAOpa,MAAOC,OAA0B,MAAlBvB,EAAQuB,OAAiBvB,EAAQuB,OAASma,EAAOna,OAAQI,IAAK+Z,EAAO/Z,IAAKD,KAAMga,EAAOha,KAAM0B,EAAG,EAAGC,EAAG,IAGhN6Y,EAAiB3P,EAAWvM,GACrBiB,IAIf,QAASib,GAAiB3P,EAAWvM,GAC7BA,EAAQ2Z,kBACRpN,EAAU4P,WAAWpa,YAAYwK,GACjC/L,EAAI,yBAIZ,QAASyb,GAAKhb,EAAQya,GAClB,GAAIU,GAAgB1Q,SAAStK,cAAc,UACvCib,EAAK9R,KAAKyE,IAAI/N,EAAOK,MAAQ,EAAGiJ,KAAK+R,IAAI,EAAGZ,EAAOha,OACnD6a,EAAKhS,KAAKyE,IAAI/N,EAAOK,MAAOiJ,KAAK+R,IAAI,EAAGZ,EAAOha,KAAOga,EAAOpa,QAC7Dkb,EAAKjS,KAAKyE,IAAI/N,EAAOM,OAAS,EAAGgJ,KAAK+R,IAAI,EAAGZ,EAAO/Z,MACpD8a,EAAKlS,KAAKyE,IAAI/N,EAAOM,OAAQgJ,KAAK+R,IAAI,EAAGZ,EAAO/Z,IAAM+Z,EAAOna,QACjE6a,GAAc9a,MAAQoa,EAAOpa,MAC7B8a,EAAc7a,OAAUma,EAAOna,MAC/B,IAAID,GAAQib,EAAGF,EACX9a,EAASkb,EAAGD,CAIhB,OAHAhc,GAAI,sBAAuB,QAASkb,EAAOha,KAAM,OAAQga,EAAO/Z,IAAK,SAAUL,EAAO,UAAWC,GACjGf,EAAI,4BAA6Bkb,EAAOpa,MAAO,aAAcoa,EAAOna,OAAQ,SAAU8a,EAAI,QAASG,GACnGJ,EAAcrZ,WAAW,MAAM2Z,UAAUzb,EAAQob,EAAIG,EAAIlb,EAAOC,EAAQma,EAAOtY,EAAGsY,EAAOrY,EAAG/B,EAAOC,GAC5F6a,EAGX,QAASR,GAAe7b,GACpB,MAAOwK,MAAK+R,IACR/R,KAAK+R,IAAIvc,EAAI6B,KAAK+a,YAAa5c,EAAIuM,gBAAgBqQ,aACnDpS,KAAK+R,IAAIvc,EAAI6B,KAAKgb,YAAa7c,EAAIuM,gBAAgBsQ,aACnDrS,KAAK+R,IAAIvc,EAAI6B,KAAKib,YAAa9c,EAAIuM,gBAAgBuQ,cAI3D,QAAShB,GAAgB9b,GACrB,MAAOwK,MAAK+R,IACR/R,KAAK+R,IAAIvc,EAAI6B,KAAKkb,aAAc/c,EAAIuM,gBAAgBwQ,cACpDvS,KAAK+R,IAAIvc,EAAI6B,KAAKmb,aAAchd,EAAIuM,gBAAgByQ,cACpDxS,KAAK+R,IAAIvc,EAAI6B,KAAKob,aAAcjd,EAAIuM,gBAAgB0Q,eAI5D,QAAS3C,GAAY4C,GACjB,GAAIC,GAAOxR,SAAStK,cAAc,IAGlC,OAFA8b,GAAKnZ,KAAOkZ,EACZC,EAAKnZ,KAAOmZ,EAAKnZ,KACVmZ,EAzJX,GAAI3B,GAAUjW,EAAQ,aAClBwU,EAAiBxU,EAAQ,sBACzBmW,EAAcnW,EAAQ,iBACtByW,EAAazW,EAAQ,gBACrB6X,EAAgB7X,EAAQ,mBACxB9E,EAAM8E,EAAQ,SACd8X,EAAQ9X,EAAQ,WAChBwV,EAAoBxV,EAAQ,WAC5B8U,EAAkB9U,EAAQ,WAAW8U,gBACrCuB,EAAYyB,EAAMzB,UAElBnB,EAA2B,wBAC3BpB,EAAwB,CAwC5BF,GAAYY,eAAiBA,EAC7BZ,EAAYiE,cAAgBA,EAC5BjE,EAAY1Y,IAAMA,EAClB0Y,EAAYkE,MAAQA,CAEpB,IAAIC,GAA0C,mBAAd3R,WAAuD,kBAAnB5N,QAAOC,QAAkF,kBAAjD2N,UAAStK,cAAc,UAAU2B,WAA8B,WACvK,MAAO6J,SAAQqN,OAAO,sBACtBf,CAEJjd,GAAOD,QAAUqhB,EAEM,kBAAZnhB,IAA0BA,EAAOC,KACxCD,EAAO,iBAAmB,WACtB,MAAOmhB,OA2FZC,UAAU,EAAEC,gBAAgB,GAAGzP,QAAQ,GAAG0P,kBAAkB,GAAGC,eAAe,GAAGC,UAAU,GAAGC,qBAAqB,GAAGC,YAAY,GAAGC,UAAU,KAAKC,GAAG,SAASxY,EAAQrJ,EAAOD,GAIlL,QAAS+hB,GAAoBC,GAGzB,GAFA5hB,KAAK4hB,IAAMA,EACXxd,EAAI,0BAA2Bwd,IAC1B5hB,KAAK6hB,UAAY7hB,KAAK8hB,MAAO,CAC9B1d,EAAI,kCACJud,EAAoBlgB,UAAUqgB,MAAQ,GAAIC,MAC1C,IAAID,GAAQ9hB,KAAK8hB,KACjBH,GAAoBlgB,UAAUogB,QAAU,GAAIrR,SAAQ,SAASC,EAASoN,GAClEiE,EAAMlR,OAASH,EACfqR,EAAME,QAAUnE,EAChBiE,EAAMF,IAAMK,IACRH,EAAMI,YAAa,GACnBzR,EAAQqR,MAfxB,GAAI1d,GAAM8E,EAAQ,SACd+Y,EAAa/Y,EAAQ,WAAW+Y,UAoBpCpiB,GAAOD,QAAU+hB,IAEdjQ,QAAQ,GAAG+P,UAAU,KAAKU,GAAG,SAASjZ,EAAQrJ,EAAOD,GAGxD,QAASwiB,GAAKC,EAAQC,GAClB,GAIIC,GACAC,EALArS,EAAYb,SAAStK,cAAc,OACnCyd,EAAMnT,SAAStK,cAAc,OAC7B0d,EAAOpT,SAAStK,cAAc,QAC9B2d,EAAa,aAIjBxS,GAAU/K,MAAMiL,WAAa,SAC7BF,EAAU/K,MAAMwd,WAAaP,EAC7BlS,EAAU/K,MAAMyd,SAAWP,EAC3BnS,EAAU/K,MAAM0d,OAAS,EACzB3S,EAAU/K,MAAM2d,QAAU,EAE1BzT,SAAS9J,KAAKC,YAAY0K,GAE1BsS,EAAIb,IAAMK,IACVQ,EAAIvd,MAAQ,EACZud,EAAItd,OAAS,EAEbsd,EAAIrd,MAAM0d,OAAS,EACnBL,EAAIrd,MAAM2d,QAAU,EACpBN,EAAIrd,MAAM4d,cAAgB,WAE1BN,EAAKtd,MAAMwd,WAAaP,EACxBK,EAAKtd,MAAMyd,SAAWP,EACtBI,EAAKtd,MAAM0d,OAAS,EACpBJ,EAAKtd,MAAM2d,QAAU,EAErBL,EAAKjd,YAAY6J,SAASrJ,eAAe0c,IACzCxS,EAAU1K,YAAYid,GACtBvS,EAAU1K,YAAYgd,GACtBF,EAAYE,EAAIQ,UAAYP,EAAKO,UAAa,EAE9C9S,EAAUxK,YAAY+c,GACtBvS,EAAU1K,YAAY6J,SAASrJ,eAAe0c,IAE9CxS,EAAU/K,MAAM8d,WAAa,SAC7BT,EAAIrd,MAAM4d,cAAgB,QAE1BR,EAAUC,EAAIQ,UAAU9S,EAAU8S,UAAa,EAE/C3T,SAAS9J,KAAKG,YAAYwK,GAE1BnQ,KAAKuiB,SAAWA,EAChBviB,KAAKmjB,UAAY,EACjBnjB,KAAKwiB,OAASA,EAhDlB,GAAIP,GAAa/Y,EAAQ,WAAW+Y,UAmDpCpiB,GAAOD,QAAUwiB,IAEdX,UAAU,KAAK2B,GAAG,SAASla,EAAQrJ,EAAOD,GAG7C,QAASyjB,KACLrjB,KAAKsjB,QAHT,GAAIlB,GAAOlZ,EAAQ,SAMnBma,GAAY5hB,UAAU8hB,WAAa,SAASlB,EAAQC,GAIhD,MAHuCxe,UAAnC9D,KAAKsjB,KAAKjB,EAAS,IAAMC,KACzBtiB,KAAKsjB,KAAKjB,EAAS,IAAMC,GAAQ,GAAIF,GAAKC,EAAQC,IAE/CtiB,KAAKsjB,KAAKjB,EAAS,IAAMC,IAGpCziB,EAAOD,QAAUyjB,IAEdG,SAAS,IAAIC,GAAG,SAASva,EAAQrJ,EAAOD,GAK3C,QAAS8jB,GAAevT,EAAWwT,EAAY/f,GAC3C5D,KAAK8hB,MAAQ,KACb9hB,KAAK4hB,IAAMzR,CACX,IAAI/O,GAAOpB,KACPsf,EAASC,EAAUpP,EACvBnQ,MAAK6hB,SAAY8B,EAA8D,GAAInT,SAAQ,SAASC,GACnD,gBAAzCN,EAAUQ,cAAcrB,SAASsU,KAA6E,MAApDzT,EAAUQ,cAAcrB,SAASY,gBAC3FC,EAAUQ,cAAcC,OAAST,EAAUS,OAAS,WAChDH,EAAQN,IAGZM,EAAQN,KANcnQ,KAAK6jB,UAAUjgB,EAAQga,MAAO0B,EAAQ1b,IAQhEgB,KAAK,SAASuL,GACd,GAAI2M,GAAc5T,EAAQ,SAC1B,OAAO4T,GAAY3M,EAAUQ,cAAcrB,SAASY,iBAAkB9G,KAAM,OAAQlE,MAAOiL,EAAUjL,MAAOC,OAAQgL,EAAUhL,OAAQyY,MAAOha,EAAQga,MAAOxO,kBAAmBxL,EAAQwL,kBAAmBmO,gBAAiB3Z,EAAQ2Z,gBAAiBD,WAAY1Z,EAAQ0Z,WAAYE,aAAc5Z,EAAQ4Z,aAAe,MAC1T5Y,KAAK,SAASC,GACb,MAAOzD,GAAK0gB,MAAQjd,IArB5B,GAAImc,GAAQ9X,EAAQ,WAChBqW,EAAYyB,EAAMzB,UAClBvB,EAAkB9U,EAAQ,WAAW8U,eAuBzC0F,GAAejiB,UAAUoiB,UAAY,SAASjG,EAAO0B,EAAQ1b,GACzD,GAAIuM,GAAYnQ,KAAK4hB,GACrB,OAAO5D,GAAgB7N,EAAUyR,IAAKhE,EAAOzN,EAAUxB,cAAe2Q,EAAOpa,MAAOoa,EAAOna,OAAQvB,IAGvG/D,EAAOD,QAAU8jB,IAEdI,SAAS,EAAExC,UAAU,GAAGG,UAAU,KAAKsC,GAAG,SAAS7a,EAAQrJ,EAAOD,GACrE,QAASokB,GAAkBC,GACvBjkB,KAAK4hB,IAAMqC,EAAUpiB,MACrB7B,KAAKkkB,cACLlkB,KAAKoJ,KAAO,KACZpJ,KAAKmkB,GAAK,GACVnkB,KAAKokB,GAAK,GACVpkB,KAAKigB,GAAK,GACVjgB,KAAKogB,GAAK,GACVpgB,KAAK6hB,QAAUrR,QAAQC,SAAQ,GAGnCuT,EAAkBK,OACdC,OAAQ,EACRC,OAAQ,GAKZP,EAAkBQ,iBAAmB,4IAErC3kB,EAAOD,QAAUokB,OAEXS,IAAI,SAASvb,EAAQrJ,EAAOD,GAClC,QAAS8kB,GAAe9C,EAAK+C,GACzB3kB,KAAK4hB,IAAMA,EACX5hB,KAAK8hB,MAAQ,GAAIC,MACjB,IAAI3gB,GAAOpB,IACXA,MAAK4kB,QAAU,KACf5kB,KAAK6hB,QAAU,GAAIrR,SAAQ,SAASC,EAASoN,GACzCzc,EAAK0gB,MAAMlR,OAASH,EACpBrP,EAAK0gB,MAAME,QAAUnE,EACjB8G,IACAvjB,EAAK0gB,MAAM+C,YAAc,aAE7BzjB,EAAK0gB,MAAMF,IAAMA,EACbxgB,EAAK0gB,MAAMI,YAAa,GACxBzR,EAAQrP,EAAK0gB,SAKzBjiB,EAAOD,QAAU8kB,OAEXI,IAAI,SAAS5b,EAAQrJ,EAAOD,GAYlC,QAASyf,GAAYzb,EAASsb,GAC1Blf,KAAK8gB,KAAO,KACZ9gB,KAAK4D,QAAUA,EACf5D,KAAKkf,QAAUA,EACflf,KAAK+kB,OAAS/kB,KAAKglB,UAAUvd,OAAOC,SAASC,MAfjD,GAAIvD,GAAM8E,EAAQ,SACdwb,EAAiBxb,EAAQ,oBACzByY,EAAsBzY,EAAQ,yBAC9B+b,EAAsB/b,EAAQ,yBAC9Bwa,EAAiBxa,EAAQ,oBACzBgc,EAAehc,EAAQ,kBACvBic,EAAmBjc,EAAQ,sBAC3Bkc,EAA0Blc,EAAQ,6BAClCmc,EAA0Bnc,EAAQ,6BAClC5E,EAAO4E,EAAQ,WAAW5E,IAS9B+a,GAAY5d,UAAU6jB,WAAa,SAASC,GACxC,GAAIC,KAiBJ,OAhBAD,GAAME,OAAO,SAASC,EAAYvV,GAC9B,OAAOA,EAAUhB,KAAKO,UACtB,IAAK,MACD,MAAOgW,GAAWC,SACdC,MAAOzV,EAAUhB,KAAKyS,KACtBiE,OAAQ,QAEhB,KAAK,MACL,IAAK,SACD,MAAOH,GAAWC,SACdC,MAAOzV,EAAUhB,MACjB0W,OAAQ1V,EAAUhB,KAAKO,YAG/B,MAAOgW,QACJI,QAAQ9lB,KAAK+lB,SAASP,EAAQxlB,KAAKgmB,WAAYhmB,MAC/CwlB,GAGXnG,EAAY5d,UAAUwkB,oBAAsB,SAAST,EAAQrV,GAEzD,MADAA,GAAU+V,wBAAwBC,OAAOnmB,KAAKomB,oBAAoBN,QAAQ9lB,KAAK+lB,SAASP,EAAQxlB,KAAKgmB,WAAYhmB,MAC1GwlB,GAGXnG,EAAY5d,UAAUskB,SAAW,SAASP,EAAQa,GAC9C,MAAO,UAASC,GACZA,EAASV,KAAKE,QAAQ,SAAShE,GACtB9hB,KAAKumB,YAAYf,EAAQ1D,KAC1B0D,EAAO5Y,OAAO,EAAG,EAAGyZ,EAAS9lB,KAAKP,KAAMsmB,IACxCliB,EAAI,gBAAmBohB,EAAO/iB,OAA2B,gBAAXqf,GAAsBA,EAAM7O,UAAU,EAAG,KAAO6O,KAEnG9hB,QAIXqf,EAAY5d,UAAU2kB,mBAAqB,SAASnC,GAChD,MAA4B,SAArBA,EAAU4B,QAGrBxG,EAAY5d,UAAUukB,UAAY,SAAS/B,GACvC,GAAyB,QAArBA,EAAU4B,OAAkB,CAC5B,GAAIjE,GAAMqC,EAAU2B,KAAK,EACzB,QAAI5lB,KAAKwmB,MAAM5E,IAAS5hB,KAAKkf,QAAQuH,KAAQzmB,KAAK4D,QAAQ0Z,WAE/CsE,EAAI9O,MAAM,2BACV,GAAI4R,GAAe9C,EAAI7X,QAAQ,8BAA+B,MAAK,IACnE/J,KAAK0mB,aAAa9E,IAAQ5hB,KAAK4D,QAAQ0Z,cAAe,GAAQtd,KAAKwmB,MAAM5E,GACzE,GAAI8C,GAAe9C,IAAK,IACxB5hB,KAAKkf,QAAQyF,OAAS3kB,KAAK4D,QAAQ0Z,YAActd,KAAK4D,QAAQ+iB,QAC9D,GAAIjC,GAAe9C,IAAK,IACxB5hB,KAAK4D,QAAQga,MACb,GAAIqH,GAAoBrD,EAAK5hB,KAAK4D,QAAQga,OAE1C,GAAI+D,GAAoBC,GAVxB,GAAIsD,GAAatD,GAYzB,MAAyB,oBAArBqC,EAAU4B,OACV,GAAIT,GAAwBnB,GACP,aAArBA,EAAU4B,OACV,GAAIR,GAAwBpB,GACP,QAArBA,EAAU4B,OACV,GAAIV,GAAiBlB,EAAU2B,KAAK,GAAI5lB,KAAKkf,QAAQuH,KAChC,WAArBxC,EAAU4B,OACV,GAAInC,GAAeO,EAAU2B,KAAK,GAAI5lB,KAAK0mB,aAAazC,EAAU2B,KAAK,GAAGhE,KAAM5hB,KAAK4D,SAErF,GAAI+d,GAAoBsC,IAIvC5E,EAAY5d,UAAU+kB,MAAQ,SAAS5E,GACnC,MAAuD,QAAhDA,EAAI3O,UAAU2O,EAAInf,OAAS,GAAG+K,eAA2B0X,EAAazjB,UAAUmlB,SAAShF,IAGpGvC,EAAY5d,UAAU8kB,YAAc,SAASf,EAAQ5D,GACjD,MAAO4D,GAAOqB,KAAK,SAAS/E,GACxB,MAAOA,GAAMF,MAAQA,KAI7BvC,EAAY5d,UAAUilB,aAAe,SAAS7F,GAC1C,MAAQ7gB,MAAKglB,UAAUnE,KAAS7gB,KAAK+kB,QAGzC1F,EAAY5d,UAAUujB,UAAY,SAASnE,GACvC,GAAIC,GAAO9gB,KAAK8gB,OAAS9gB,KAAK8gB,KAAOxR,SAAStK,cAAc,KAG5D,OAFA8b,GAAKnZ,KAAOkZ,EACZC,EAAKnZ,KAAOmZ,EAAKnZ,KACVmZ,EAAKgG,SAAWhG,EAAKiG,SAAWjG,EAAKkG,MAGhD3H,EAAY5d,UAAUwlB,WAAa,SAAS9W,GACxC,MAAOnQ,MAAKknB,QAAQ/W,EAAWnQ,KAAK4D,QAAQ4Z,cAAc,SAAS,WAC/D,GAAI2J,GAAQ,GAAIxF,GAAoBxR,EAAUyR,IAC9C,OAAOuF,GAAMtF,QAAQjd,KAAK,SAASkd,GAC/B3R,EAAU2R,MAAQA,OAK9BzC,EAAY5d,UAAU2lB,IAAM,SAASxF,GACjC,GAAIyF,GAAQ,IACZ,OAAOrnB,MAAKwlB,OAAOqB,KAAK,SAASpE,GAC7B,OAAQ4E,EAAQ5E,GAAKb,MAAQA,IAC5ByF,EAAQ,MAGjBhI,EAAY5d,UAAU6lB,MAAQ,SAAS/B,GAWnC,MAVAvlB,MAAKwlB,OAASD,EAAME,OAAOnhB,EAAKtE,KAAKimB,oBAAqBjmB,MAAOA,KAAKslB,WAAWC,IACjFvlB,KAAKwlB,OAAOM,QAAQ,SAAShE,EAAO7V,GAChC6V,EAAMD,QAAQjd,KAAK,WACfR,EAAI,8BAA+B6H,EAAM,GAAI6V,IAC9C,SAASxZ,GACRlE,EAAI,0BAA2B6H,EAAM,GAAI6V,EAAOxZ,OAGxDtI,KAAK4f,MAAQpP,QAAQ+W,IAAIvnB,KAAKwlB,OAAOjc,IAAIvJ,KAAKinB,WAAYjnB,OAC1DoE,EAAI,6BACGpE,MAGXqf,EAAY5d,UAAUylB,QAAU,SAAS/W,EAAW+W,GAChD,GAAIM,GACA3F,EAAUrR,QAAQiX,MAAMtX,EAAU0R,QAAS,GAAIrR,SAAQ,SAASkX,EAAK7J,GACrE2J,EAAQG,WAAW,WACfvjB,EAAI,0BAA2B+L,GAC/B0N,EAAO1N,IACR+W,OACFtiB,KAAK,SAASuL,GAEf,MADAyX,cAAaJ,GACNrX,GAKX,OAHA0R,GAAQ,SAAS,WACb+F,aAAaJ,KAEV3F,GAGXhiB,EAAOD,QAAUyf,IAEdwI,wBAAwB,EAAEC,mBAAmB,EAAEC,mBAAmB,GAAGC,4BAA4B,GAAGtW,QAAQ,GAAGuW,wBAAwB,GAAGC,iBAAiB,GAAGC,qBAAqB,GAAG1G,UAAU,GAAG2G,4BAA4B,KAAKC,IAAI,SAASnf,EAAQrJ,EAAOD,GAInQ,QAASwlB,GAAwBnB,GAC7BD,EAAkB3b,MAAMrI,KAAM6D,WAC9B7D,KAAKoJ,KAAO4a,EAAkBK,MAAMC,MAEpC,IAAIgE,GAAelD,EAAwBmD,iBAAiBjb,KAAM2W,EAAU2B,KAAK,MAC5E5B,EAAkBQ,iBAAiBlX,KAAM2W,EAAU2B,KAAK,GAEzD0C,GACArE,EAAU2B,KAAK,GAAG9b,MAAM,OAAO0e,UAAU1C,QAAQ,SAASzgB,EAAU4G,GAChE,OAAO5G,GACP,IAAK,OACDrF,KAAKmkB,GAAK,EACVnkB,KAAKigB,GAAK,CACV,MACJ,KAAK,MACDjgB,KAAKokB,GAAK,EACVpkB,KAAKogB,GAAK,CACV,MACJ,KAAK,QACDpgB,KAAKmkB,GAAK,EACVnkB,KAAKigB,GAAK,CACV,MACJ,KAAK,SACDjgB,KAAKokB,GAAK,EACVpkB,KAAKogB,GAAK,CACV,MACJ,KAAK,KACD,GAAIgE,GAAKpkB,KAAKokB,GACVD,EAAKnkB,KAAKmkB,EACdnkB,MAAKokB,GAAKpkB,KAAKogB,GACfpgB,KAAKmkB,GAAKnkB,KAAKigB,GACfjgB,KAAKigB,GAAKkE,EACVnkB,KAAKogB,GAAKgE,CACV,MACJ,KAAK,SACD,KAGJ,SAEI,GAAIqE,GAAmC,IAA3BC,WAAWrjB,EAAU,GACjC,IAAIsjB,MAAMF,GACN,KAEU,KAAVxc,GACAjM,KAAKokB,GAAKqE,EACVzoB,KAAKogB,GAAK,EAAIpgB,KAAKokB,KAEnBpkB,KAAKmkB,GAAKsE,EACVzoB,KAAKigB,GAAK,EAAIjgB,KAAKmkB,MAI5BnkB,OAEHA,KAAKokB,GAAK,EACVpkB,KAAKogB,GAAK,GAGdpgB,KAAKkkB,WAAaD,EAAU2B,KAAKrY,MAAM+a,EAAe,EAAI,GAAG/e,IAAI,SAASqf,GACtE,GAAIC,GAAiBD,EAAU9V,MAAMkR,EAAkBQ,kBACnD3iB,GAASgnB,EAAe,GACxBC,EAAiB,IAAVjnB,EAAc,IAAMgnB,EAAe,EAC9C,QACIvV,MAAO,GAAI1B,GAAMiX,EAAe,IAEhCE,KAAe,MAATD,EAAejnB,EAAQ,IAAM,QAIX,OAA5B7B,KAAKkkB,WAAW,GAAG6E,OACnB/oB,KAAKkkB,WAAW,GAAG6E,KAAO,GAG2B,OAArD/oB,KAAKkkB,WAAWlkB,KAAKkkB,WAAWzhB,OAAS,GAAGsmB,OAC5C/oB,KAAKkkB,WAAWlkB,KAAKkkB,WAAWzhB,OAAS,GAAGsmB,KAAO,GAIvD/oB,KAAKkkB,WAAW4B,QAAQ,SAAS8C,EAAW3c,GACjB,OAAnB2c,EAAUG,MACV/oB,KAAKkkB,WAAW3W,MAAMtB,GAAO4a,KAAK,SAASmC,EAAMC,GAC7C,MAAkB,QAAdD,EAAKD,OACLH,EAAUG,MAASC,EAAKD,KAAO/oB,KAAKkkB,WAAWjY,EAAQ,GAAG8c,OAASE,EAAQ,GAAMjpB,KAAKkkB,WAAWjY,EAAQ,GAAG8c,MACrG,IAIZ/oB,OAERA,MA7FP,GAAIgkB,GAAoB9a,EAAQ,uBAC5B0I,EAAQ1I,EAAQ,UA+FpBkc,GAAwB3jB,UAAYC,OAAOC,OAAOqiB,EAAkBviB,WAGpE2jB,EAAwBmD,iBAAmB,uEAE3C1oB,EAAOD,QAAUwlB,IAEd8D,UAAU,EAAEC,sBAAsB,IAAIC,IAAI,SAASlgB,EAAQrJ,EAAOD,GACrE,GAAIypB,GAAS,QAATA,KACIA,EAAOzlB,QAAQqZ,SAAWxV,OAAO6hB,SAAW7hB,OAAO6hB,QAAQllB,KAC3DmlB,SAAS9nB,UAAU6C,KAAK/D,KAAKkH,OAAO6hB,QAAQllB,IAAMqD,OAAO6hB,SAAUjhB,MAAMZ,OAAO6hB,SAAWnM,KAAKC,MAAQiM,EAAOzlB,QAAQsZ,MAAS,KAAM,gBAAgByI,UAAUpY,MAAMhN,KAAKsD,UAAW,KAI9LwlB,GAAOzlB,SAAWqZ,SAAS,GAC3Bpd,EAAOD,QAAUypB,OAEXG,IAAI,SAAStgB,EAAQrJ,EAAOD,GAOlC,QAASmhB,GAAc5R,EAAMsa,GACzBzpB,KAAKmP,KAAOA,EACZnP,KAAKypB,OAASA,EACdzpB,KAAK0pB,MAAQ,KACb1pB,KAAKsf,OAAS,KACdtf,KAAK2pB,QAAU,KACf3pB,KAAK4pB,QACL5pB,KAAK6pB,kBACL7pB,KAAK8pB,aAAe,KACpB9pB,KAAK+pB,QAAU,KACf/pB,KAAKgqB,eAAiB,KACtBhqB,KAAKuT,UACLvT,KAAKiqB,UACLjqB,KAAKkqB,iBAAmB,KACxBlqB,KAAKmqB,cAAgB,KACrBnqB,KAAKoqB,gBAAkB,KACvBpqB,KAAKqqB,iBAAkB,EACvBrqB,KAAKsqB,QAAU,KAkPnB,QAASC,GAAepb,GACpB,GAAIqb,GAASrb,EAAKvL,QAAQuL,EAAKsb,eAAiB,EAChD,OAAOD,GAAUA,EAAOE,MAAQ,GAAM,GAG1C,QAASC,GAAY7X,GACjB,GAAIA,GAAsB,WAAbA,EAAM,GACf,MAAOA,GAAM,GAAGhJ,MAAM,KAAKP,IAAI,SAASb,GACpC,MAAOggB,YAAWhgB,EAAEkiB,SAErB,IAAI9X,GAAsB,aAAbA,EAAM,GAAmB,CACzC,GAAI+X,GAAW/X,EAAM,GAAGhJ,MAAM,KAAKP,IAAI,SAASb,GAC9C,MAAOggB,YAAWhgB,EAAEkiB,SAEtB,QAAQC,EAAS,GAAIA,EAAS,GAAIA,EAAS,GAAIA,EAAS,GAAIA,EAAS,IAAKA,EAAS,MAI3F,QAASC,GAAajpB,GAClB,MAAOA,GAAMwR,WAAW0X,QAAQ,UAGpC,QAASC,GAASC,GACd,MAAOA,GAAIlhB,QAAQ,KAAM,IAG7B,QAASmhB,GAAQD,GACb,MAAOvC,YAAWuC,GApStB,GAAIrZ,GAAQ1I,EAAQ,WAChB8X,EAAQ9X,EAAQ,WAChBqW,EAAYyB,EAAMzB,UAClB4L,EAAmBnK,EAAMmK,iBACzBrB,EAAe9I,EAAM8I,YAsBzB/I,GAActf,UAAU2pB,QAAU,SAAS1B,GACvCA,EAAMK,QAAU/pB,KAAK+pB,QACrBL,EAAMC,QAAU3pB,KAAK2pB,QACrBD,EAAMpK,OAAStf,KAAKsf,OACpBoK,EAAME,KAAO5pB,KAAK4pB,KAClBF,EAAMG,eAAiB7pB,KAAK6pB,eAC5BH,EAAMM,eAAiBhqB,KAAKgqB,eAC5BN,EAAMO,OAASjqB,KAAKiqB,OACpBP,EAAMQ,iBAAmBlqB,KAAKkqB,iBAC9BR,EAAMY,QAAUtqB,KAAKsqB,SAGzBvJ,EAActf,UAAU4pB,WAAa,WACjC,MAAwB,QAAjBrrB,KAAKsqB,QAAoBtqB,KAAKsqB,QAAUtqB,KAAKsrB,SAAS,WAActrB,KAAKsqB,SAGpFvJ,EAActf,UAAU8pB,YAAc,SAAS7B,GAC3C1pB,KAAK0pB,MAAQA,EACbA,EAAM8B,SAAS/gB,KAAKzK,OAGxB+gB,EAActf,UAAUgqB,iBAAmB,WACvC,MAAOzrB,MAAKmP,KAAKvB,WAAa8d,KAAKC,UAAY3rB,KAAKypB,OAAOM,QAC/B,SAAxB/pB,KAAK4rB,IAAI,YACkB,WAA3B5rB,KAAK4rB,IAAI,gBACR5rB,KAAKmP,KAAK0c,aAAa,6BACA,UAAvB7rB,KAAKmP,KAAKO,UAA2D,WAAnC1P,KAAKmP,KAAK2c,aAAa,UAIlE/K,EAActf,UAAUmqB,IAAM,SAASG,GAKnC,MAJK/rB,MAAKgqB,iBACNhqB,KAAKgqB,eAAiBhqB,KAAKqqB,gBAAkBrqB,KAAKypB,OAAOuC,cAAchsB,KAAKisB,OAAS,UAAY,UAAYjsB,KAAKgsB,cAAc,OAG7HhsB,KAAKiqB,OAAO8B,KAAe/rB,KAAKiqB,OAAO8B,GAAa/rB,KAAKgqB,eAAe+B,KAGnFhL,EAActf,UAAUyqB,YAAc,SAASH,GAC3C,GAAII,IAAY,SAAU,MAAO,KAAM,KACnCtqB,EAAQ7B,KAAK4rB,IAAIG,EAOrB,OANcjoB,UAAVjC,GACAsqB,EAAStF,KAAK,SAASuF,GAEnB,MADAvqB,GAAQ7B,KAAK4rB,IAAIQ,EAASL,EAAUM,OAAO,EAAG,GAAGC,cAAgBP,EAAUM,OAAO,IACjEvoB,SAAVjC,GACR7B,MAEU8D,SAAVjC,EAAsB,KAAOA,GAGxCkf,EAActf,UAAUuqB,cAAgB,SAAS5iB,GAC7C,MAAOpJ,MAAKmP,KAAKR,cAAcC,YAAY2d,iBAAiBvsB,KAAKmP,KAAM/F,IAG3E2X,EAActf,UAAU+qB,OAAS,SAAST,GACtC,GAAIlqB,GAAQkR,SAAS/S,KAAK4rB,IAAIG,GAAY,GAC1C,OAAQpD,OAAM9mB,GAAU,EAAIA,GAGhCkf,EAActf,UAAU6R,MAAQ,SAASyY,GACrC,MAAO/rB,MAAKuT,OAAOwY,KAAe/rB,KAAKuT,OAAOwY,GAAa,GAAIna,GAAM5R,KAAK4rB,IAAIG,MAGlFhL,EAActf,UAAU6pB,SAAW,SAASS,GACxC,GAAIlqB,GAAQ6mB,WAAW1oB,KAAK4rB,IAAIG,GAChC,OAAQpD,OAAM9mB,GAAU,EAAIA,GAGhCkf,EAActf,UAAUgrB,WAAa,WACjC,GAAIC,GAAS1sB,KAAK4rB,IAAI,aACtB,QAAO7Y,SAAS2Z,EAAQ,KACxB,IAAK,KACDA,EAAS,MACT,MACJ,KAAK,KACDA,EAAS,SAGb,MAAOA,IAGX3L,EAActf,UAAUkrB,UAAY,WAChC,GAAIC,GAAU5sB,KAAK4rB,IAAI,QAAQ9Y,MAAM9S,KAAK6sB,KAC1C,OAAID,IAEIrnB,IAAKwN,SAAS6Z,EAAQ,GAAI,IAC1B1mB,MAAO6M,SAAS6Z,EAAQ,GAAI,IAC5BzmB,OAAQ4M,SAAS6Z,EAAQ,GAAI,IAC7BtnB,KAAMyN,SAAS6Z,EAAQ,GAAI,KAG5B,MAGX7L,EAActf,UAAUykB,sBAAwB,WAC5C,MAAOlmB,MAAKkqB,mBAAqBlqB,KAAKkqB,iBAAmBiB,EAAiBnrB,KAAK4rB,IAAI,sBAGvF7K,EAActf,UAAUqrB,QAAU,SAASC,EAAU9gB,GACjD,GAAIpK,IAAS7B,KAAK4rB,IAAImB,IAAa,IAAIjjB,MAAM,IAM7C,OALAjI,GAAQA,EAAMoK,GAAS,IAAMpK,EAAM,IAAM,OACzCA,EAAQA,EAAM+oB,OAAO9gB,MAAM,KACN,IAAjBjI,EAAMY,SACNZ,GAASA,EAAM,GAAIipB,EAAajpB,EAAM,IAAM,OAASA,EAAM,KAExDA,GAGXkf,EAActf,UAAUurB,oBAAsB,SAAS1N,EAAQwC,EAAO7V,GAClE,GACI/G,GAAOC,EADPmd,EAAOtiB,KAAK8sB,QAAQ,iBAAkB7gB,EAG1C,IAAI6e,EAAaxI,EAAK,IAClBpd,EAAQoa,EAAOpa,MAAQwjB,WAAWpG,EAAK,IAAM,QAC1C,IAAI,gBAAgBhV,KAAKgV,EAAK,IAAK,CACtC,GAAI2K,GAAc3N,EAAOpa,MAAQoa,EAAOna,OAAQ+nB,EAAepL,EAAM5c,MAAQ4c,EAAM3c,MACnF,OAAQ8nB,GAAcC,EAA2B,YAAZ5K,EAAK,IAAsBpd,MAAOoa,EAAOna,OAAS+nB,EAAc/nB,OAAQma,EAAOna,SAAWD,MAAOoa,EAAOpa,MAAOC,OAAQma,EAAOpa,MAAQgoB,GAE3KhoB,EAAQ6N,SAASuP,EAAK,GAAI,IAiB9B,MAbInd,GADY,SAAZmd,EAAK,IAA6B,SAAZA,EAAK,GAClBR,EAAM3c,OACI,SAAZmd,EAAK,GACHpd,EAAQ4c,EAAM5c,MAAQ4c,EAAM3c,OAC9B2lB,EAAaxI,EAAK,IACfhD,EAAOna,OAASujB,WAAWpG,EAAK,IAAM,IAEvCvP,SAASuP,EAAK,GAAI,IAGf,SAAZA,EAAK,KACLpd,EAAQC,EAAS2c,EAAM3c,OAAS2c,EAAM5c,QAGlCA,MAAOA,EAAOC,OAAQA,IAGlC4b,EAActf,UAAU0rB,wBAA0B,SAAS7N,EAAQwC,EAAO7V,EAAOmhB,GAC7E,GACI9nB,GAAMC,EADNF,EAAWrF,KAAK8sB,QAAQ,qBAAsB7gB,EAqBlD,OAjBI3G,GADAwlB,EAAazlB,EAAS,KACdia,EAAOpa,OAASkoB,GAAkBtL,GAAO5c,QAAUwjB,WAAWrjB,EAAS,IAAM,KAE9E0N,SAAS1N,EAAS,GAAI,IAI7BE,EADgB,SAAhBF,EAAS,GACHC,EAAOwc,EAAM5c,MAAQ4c,EAAM3c,OAC1B2lB,EAAazlB,EAAS,KACrBia,EAAOna,QAAUioB,GAAkBtL,GAAO3c,QAAUujB,WAAWrjB,EAAS,IAAM,IAEhF0N,SAAS1N,EAAS,GAAI,IAGZ,SAAhBA,EAAS,KACTC,EAAOC,EAAMuc,EAAM3c,OAAS2c,EAAM5c,QAG9BI,KAAMA,EAAMC,IAAKA,IAG7Bwb,EAActf,UAAU4rB,sBAAwB,SAASphB,GACrD,MAAOjM,MAAK8sB,QAAQ,mBAAoB7gB,GAAO,IAGnD8U,EAActf,UAAU6rB,iBAAmB,WACvC,GAAIC,GAAavtB,KAAK4rB,IAAI,cACtB4B,IAEJ,IAAID,GAA6B,SAAfA,EAEd,IAAK,GADDE,GAAUF,EAAWza,MAAM9S,KAAK0tB,sBAC3BlrB,EAAI,EAAGirB,GAAYjrB,EAAIirB,EAAQhrB,OAASD,IAAK,CAClD,GAAIkG,GAAI+kB,EAAQjrB,GAAGsQ,MAAM9S,KAAK2tB,mBAC9BH,GAAQ/iB,MACJ6I,MAAO,GAAI1B,GAAMlJ,EAAE,IACnBklB,QAASllB,EAAE,GAAKggB,WAAWhgB,EAAE,GAAGqB,QAAQ,KAAM,KAAO,EACrD8jB,QAASnlB,EAAE,GAAKggB,WAAWhgB,EAAE,GAAGqB,QAAQ,KAAM,KAAO,EACrD+jB,KAAMplB,EAAE,GAAKA,EAAE,GAAGqB,QAAQ,KAAM,IAAM,IAIlD,MAAOyjB,IAGXzM,EAActf,UAAUssB,eAAiB,WACrC,IAAK/tB,KAAKmqB,cACN,GAAInqB,KAAKguB,eAAgB,CACrB,GAAIC,GAASjuB,KAAKkuB,cACdnJ,EAAS/kB,KAAKksB,YAAY,mBAAmBpiB,MAAM,KAAKP,IAAIyhB,GAAUzhB,IAAI2hB,EAC9EnG,GAAO,IAAMkJ,EAAO3oB,KACpByf,EAAO,IAAMkJ,EAAO1oB,IACpBvF,KAAKmqB,eACDpF,OAAQA,EACRoJ,OAAQnuB,KAAKouB,4BAGjBpuB,MAAKmqB,eACDpF,QAAS,EAAG,GACZoJ,QAAS,EAAG,EAAG,EAAG,EAAG,EAAG,GAIpC,OAAOnuB,MAAKmqB,eAGhBpJ,EAActf,UAAU2sB,qBAAuB,WAC3C,IAAKpuB,KAAKoqB,gBAAiB,CACvB,GAAIiE,GAAYruB,KAAKksB,YAAY,aAC7BiC,EAASE,EAAY1D,EAAY0D,EAAUvb,MAAM9S,KAAKsuB,kBAAoB,IAC9EtuB,MAAKoqB,gBAAkB+D,EAASA,GAAU,EAAG,EAAG,EAAG,EAAG,EAAG,GAE7D,MAAOnuB,MAAKoqB,iBAGhBrJ,EAActf,UAAUysB,YAAc,WAClC,MAAOluB,MAAKsf,SAAWtf,KAAKsf,OAAStf,KAAKguB,eAAiBlE,EAAa9pB,KAAKmP,MAAQoQ,EAAUvf,KAAKmP,QAGxG4R,EAActf,UAAUusB,aAAe,WACnC,MAAiD,gBAA1ChuB,KAAKouB,uBAAuBjkB,KAAK,MAA2BnK,KAAKypB,QAAUzpB,KAAKypB,OAAOuE,gBAGlGjN,EAActf,UAAU8sB,SAAW,WAC/B,GAAI1sB,GAAQ7B,KAAKmP,KAAKtN,OAAS;AAM/B,MAL0B,WAAtB7B,KAAKmP,KAAKqf,QACV3sB,EAAQ0oB,EAAevqB,KAAKmP,MACF,aAAnBnP,KAAKmP,KAAK/F,OACjBvH,EAAQ6Q,MAAM7Q,EAAMY,OAAS,GAAG0H,KAAK,MAEjB,IAAjBtI,EAAMY,OAAgBzC,KAAKmP,KAAKsf,aAAe,GAAM5sB,GAGhEkf,EAActf,UAAU6sB,gBAAkB,4BAC1CvN,EAActf,UAAUisB,qBAAuB,yCAC/C3M,EAActf,UAAUksB,mBAAqB,4CAC7C5M,EAActf,UAAUorB,KAAO,kDAgC/BhtB,EAAOD,QAAUmhB,IAEdmI,UAAU,EAAEzH,UAAU,KAAKiN,IAAI,SAASxlB,EAAQrJ,EAAOD,GAe1D,QAAS+f,GAAWgP,EAASlR,EAAUyB,EAASE,EAAaxb,GACzDQ,EAAI,uBACJpE,KAAKyd,SAAWA,EAChBzd,KAAK4D,QAAUA,EACf5D,KAAK4uB,MAAQ,KACb5uB,KAAKkf,QAAUA,EACflf,KAAK6uB,eACL7uB,KAAK0pB,MAAQ,GAAIoF,KAAgB,GAAM,EAAGH,EAAQhgB,cAAe,KACjE,IAAI8a,GAAS,GAAI1I,GAAc4N,EAAS,KAIxC,IAHI/qB,EAAQmrB,YACRtR,EAASuR,UAAU,EAAG,EAAGvR,EAASvY,MAAOuY,EAAStY,OAAQ,GAAIyM,GAAMhO,EAAQmrB,aAE5EJ,IAAYA,EAAQhgB,cAAcuB,gBAAiB,CAEnD,GAAI+e,GAAmB,GAAIlO,GAAc0I,EAAOnW,MAAM,mBAAmBd,gBAAkBmc,EAAQhgB,cAAcnJ,KAAOmpB,EAAQhgB,cAAcuB,gBAAiB,KAC/JuN,GAASuR,UAAU,EAAG,EAAGvR,EAASvY,MAAOuY,EAAStY,OAAQ8pB,EAAiB3b,MAAM,oBAErFmW,EAAOyF,SAAWzF,EAAOgC,mBACzBzrB,KAAKmvB,uBAAuBR,EAAQhgB,eACpC3O,KAAKovB,kBAAkBT,EAAQhgB,eAC/B3O,KAAKulB,MAAQ8J,GAAS5F,GAAQ9D,OAAO3lB,KAAKsvB,YAAY7F,IAAStD,OAAO,SAAShW,GAC3E,MAAOA,GAAU4Z,QAAU5Z,EAAUsb,qBACtCliB,IAAIvJ,KAAKuvB,kBAAmBvvB,OAC/BA,KAAKwvB,YAAc,GAAInM,GACvBjf,EAAI,wBAAyBpE,KAAKulB,MAAM9iB,QACxC2B,EAAI,4BACJpE,KAAKyvB,yBACLrrB,EAAI,yBACJpE,KAAKwlB,OAASpG,EAAYkI,MAAMtnB,KAAKulB,MAAMY,OAAOuJ,IAClD1vB,KAAK4f,MAAQ5f,KAAKwlB,OAAO5F,MAAMhb,KAAKN,EAAK,WAQrC,MAPAF,GAAI,mCACJA,EAAI,8BACJpE,KAAK2vB,yBACLvrB,EAAI,6BACJpE,KAAK4vB,qBAAqB5vB,KAAK0pB,OAC/B1pB,KAAK6vB,MAAM7vB,KAAK0pB,OAChBtlB,EAAI,6BAA+BpE,KAAK6uB,YAAYpsB,OAAS,UACtD,GAAI+N,SAAQlM,EAAK,SAASmM,GACxB7M,EAAQyZ,MAGwB,kBAAnBzZ,GAAQyZ,MACtBzZ,EAAQyZ,MAAM9c,KAAKP,KAAMA,KAAK6uB,YAAape,GACpCzQ,KAAK6uB,YAAYpsB,OAAS,GACjCzC,KAAK8vB,YAAc,EACnB9vB,KAAK+vB,cAAc/vB,KAAK6uB,YAAape,IAErCA,KARAzQ,KAAK6uB,YAAY/I,QAAQ9lB,KAAKgwB,MAAOhwB,MACrCyQ,MASLzQ,QACJA,OAkCP,QAASiwB,GAAc9f,GACnB,MAAOA,GAAUsZ,QAAUtZ,EAAUsZ,OAAOG,KAAKnnB,OAkDrD,QAASytB,GAAYjF,GACjB,MAAOA,GAAIlhB,QAAQ,aAAc,SAAS+I,GACtC,MAAOA,GAAMwZ,cAAcviB,QAAQ,IAAI,MA+G/C,QAASomB,MA0PT,QAASC,GAAiBzG,EAAS0G,EAAYC,EAAcC,GACzD,MAAO5G,GAAQpgB,IAAI,SAAS+G,EAAQkgB,GAChC,GAAIlgB,EAAOpL,MAAQ,EAAG,CAClB,GAAIurB,GAAKJ,EAAW/qB,KAChBorB,EAAKL,EAAW9qB,IAChBorB,EAAKN,EAAWnrB,MAChB0rB,EAAKP,EAAWlrB,OAAUwkB,EAAQ,GAAGzkB,KAEzC,QAAOsrB,GACP,IAAK,GAEDI,EAAKjH,EAAQ,GAAGzkB,MAChBoL,EAAOsV,KAAOiL,GACNC,IAAKL,EAAIC,GACTK,IAAKN,EAAKE,EAAID,GACdM,IAAKP,EAAKE,EAAKhH,EAAQ,GAAGzkB,MAAOwrB,EAAKE,GACtCK,IAAKR,EAAK9G,EAAQ,GAAGzkB,MAAOwrB,EAAKE,IAClCL,EAAO,GAAIA,EAAO,GACrBD,EAAaY,aAAcZ,EAAaa,aAAcb,EAAac,cAAed,EAAae,cACnG,MACJ,KAAK,GAEDZ,EAAKJ,EAAW/qB,KAAO+qB,EAAWnrB,MAASykB,EAAQ,GAAGzkB,MACtDyrB,EAAKhH,EAAQ,GAAGzkB,MAEhBoL,EAAOsV,KAAOiL,GACNC,IAAKL,EAAKE,EAAID,GACdK,IAAKN,EAAKE,EAAID,EAAKE,EAAKjH,EAAQ,GAAGzkB,OACnC8rB,IAAKP,EAAIC,EAAKE,GACdK,IAAKR,EAAIC,EAAK/G,EAAQ,GAAGzkB,QAC1BqrB,EAAO,GAAIA,EAAO,GACrBD,EAAac,cAAed,EAAae,cAAef,EAAagB,iBAAkBhB,EAAaiB,iBACxG,MACJ,KAAK,GAEDb,EAAMA,EAAKL,EAAWlrB,OAAWwkB,EAAQ,GAAGzkB,MAC5C0rB,EAAKjH,EAAQ,GAAGzkB,MAChBoL,EAAOsV,KAAOiL,GACNC,IAAKL,EAAKE,EAAID,EAAKE,GACnBG,IAAKN,EAAIC,EAAKE,GACdI,IAAKP,EAAK9G,EAAQ,GAAGzkB,MAAOwrB,GAC5BO,IAAKR,EAAKE,EAAKhH,EAAQ,GAAGzkB,MAAOwrB,IAClCH,EAAO,GAAIA,EAAO,GACrBD,EAAagB,iBAAkBhB,EAAaiB,iBAAkBjB,EAAakB,gBAAiBlB,EAAamB,gBAC7G,MACJ,KAAK,GAEDd,EAAKhH,EAAQ,GAAGzkB,MAChBoL,EAAOsV,KAAOiL,GACNC,IAAKL,EAAIC,EAAKE,EAAKjH,EAAQ,GAAGzkB,OAC9B6rB,IAAKN,EAAIC,GACTM,IAAKP,EAAKE,EAAID,EAAK/G,EAAQ,GAAGzkB,OAC9B+rB,IAAKR,EAAKE,EAAID,EAAKE,IACpBL,EAAO,GAAIA,EAAO,GACrBD,EAAakB,gBAAiBlB,EAAamB,gBAAiBnB,EAAaY,aAAcZ,EAAaa,eAIhH,MAAO7gB,KA4Bf,QAASohB,GAAe1qB,EAAGC,EAAG0qB,EAAIC,GAC9B,GAAIC,GAAQ,IAAM1jB,KAAK2jB,KAAK,GAAK,GAAK,GAClCC,EAAMJ,EAAME,EACZG,EAAMJ,EAAMC,EACZI,EAAKjrB,EAAI2qB,EACTO,EAAKjrB,EAAI2qB,CACb,QACIO,QAASC,GAAaprB,EAAGA,EAAGC,EAAGirB,IAAMlrB,EAAGA,EAAGC,EAAGirB,EAAKF,IAAMhrB,EAAGirB,EAAKF,EAAI9qB,EAAGA,IAAKD,EAAGirB,EAAIhrB,EAAGA,IACvForB,SAAUD,GAAaprB,EAAGA,EAAGC,EAAGA,IAAKD,EAAGA,EAAI+qB,EAAG9qB,EAAGA,IAAKD,EAAGirB,EAAIhrB,EAAGirB,EAAKF,IAAMhrB,EAAGirB,EAAIhrB,EAAGirB,IACtFI,YAAaF,GAAaprB,EAAGirB,EAAIhrB,EAAGA,IAAKD,EAAGirB,EAAIhrB,EAAGA,EAAI+qB,IAAMhrB,EAAGA,EAAI+qB,EAAI9qB,EAAGirB,IAAMlrB,EAAGA,EAAGC,EAAGirB,IAC1FK,WAAYH,GAAaprB,EAAGirB,EAAIhrB,EAAGirB,IAAMlrB,EAAGirB,EAAKF,EAAI9qB,EAAGirB,IAAMlrB,EAAGA,EAAGC,EAAGA,EAAI+qB,IAAMhrB,EAAGA,EAAGC,EAAEA,KAIjG,QAASurB,GAAqBlT,EAAQmT,EAAc9I,GAChD,GAAI3iB,GAAIsY,EAAOha,KACX2B,EAAIqY,EAAO/Z,IACXL,EAAQoa,EAAOpa,MACfC,EAASma,EAAOna,OAEhButB,EAAMD,EAAa,GAAG,GAAKvtB,EAAQ,EAAIutB,EAAa,GAAG,GAAKvtB,EAAQ,EACpEytB,EAAMF,EAAa,GAAG,GAAKttB,EAAS,EAAIstB,EAAa,GAAG,GAAKttB,EAAS,EACtEytB,EAAMH,EAAa,GAAG,GAAKvtB,EAAQ,EAAIutB,EAAa,GAAG,GAAKvtB,EAAQ,EACpE2tB,EAAMJ,EAAa,GAAG,GAAKttB,EAAS,EAAIstB,EAAa,GAAG,GAAKttB,EAAS,EACtE2tB,EAAML,EAAa,GAAG,GAAKvtB,EAAQ,EAAIutB,EAAa,GAAG,GAAKvtB,EAAQ,EACpE6tB,EAAMN,EAAa,GAAG,GAAKttB,EAAS,EAAIstB,EAAa,GAAG,GAAKttB,EAAS,EACtE6tB,EAAMP,EAAa,GAAG,GAAKvtB,EAAQ,EAAIutB,EAAa,GAAG,GAAKvtB,EAAQ,EACpE+tB,EAAMR,EAAa,GAAG,GAAKttB,EAAS,EAAIstB,EAAa,GAAG,GAAKttB,EAAS,EAEtE+tB,EAAWhuB,EAAQ0tB,EACnBO,EAAchuB,EAAS4tB,EACvBK,EAAcluB,EAAQ4tB,EACtBO,EAAaluB,EAAS8tB,CAE1B,QACI/B,aAAcQ,EAAe1qB,EAAGC,EAAGyrB,EAAKC,GAAKR,QAAQmB,UAAU,IAC/DnC,aAAcO,EAAe1qB,EAAI2iB,EAAQ,GAAGzkB,MAAO+B,EAAI0iB,EAAQ,GAAGzkB,MAAOiJ,KAAK+R,IAAI,EAAGwS,EAAM/I,EAAQ,GAAGzkB,OAAQiJ,KAAK+R,IAAI,EAAGyS,EAAMhJ,EAAQ,GAAGzkB,QAAQitB,QAAQmB,UAAU,IACrKlC,cAAeM,EAAe1qB,EAAIksB,EAAUjsB,EAAG2rB,EAAKC,GAAKR,SAASiB,UAAU,IAC5EjC,cAAeK,EAAe1qB,EAAImH,KAAKyE,IAAIsgB,EAAUhuB,EAAQykB,EAAQ,GAAGzkB,OAAQ+B,EAAI0iB,EAAQ,GAAGzkB,MAAQguB,EAAWhuB,EAAQykB,EAAQ,GAAGzkB,MAAS,EAAG0tB,EAAMjJ,EAAQ,GAAGzkB,MAAO2tB,EAAMlJ,EAAQ,GAAGzkB,OAAOmtB,SAASiB,UAAU,IACpNhC,iBAAkBI,EAAe1qB,EAAIosB,EAAansB,EAAIksB,EAAaL,EAAKC,GAAKT,YAAYgB,UAAU,IACnG/B,iBAAkBG,EAAe1qB,EAAImH,KAAKyE,IAAIwgB,EAAaluB,EAAQykB,EAAQ,GAAGzkB,OAAQ+B,EAAIkH,KAAKyE,IAAIugB,EAAahuB,EAASwkB,EAAQ,GAAGzkB,OAAQiJ,KAAK+R,IAAI,EAAG4S,EAAMnJ,EAAQ,GAAGzkB,OAAS6tB,EAAMpJ,EAAQ,GAAGzkB,OAAOotB,YAAYgB,UAAU,IAChO9B,gBAAiBE,EAAe1qB,EAAGC,EAAIosB,EAAYL,EAAKC,GAAKV,WAAWe,UAAU,IAClF7B,gBAAiBC,EAAe1qB,EAAI2iB,EAAQ,GAAGzkB,MAAO+B,EAAIosB,EAAYllB,KAAK+R,IAAI,EAAG8S,EAAMrJ,EAAQ,GAAGzkB,OAAQ+tB,EAAMtJ,EAAQ,GAAGzkB,OAAOqtB,WAAWe,UAAU,KAIhK,QAASlB,GAAYlV,EAAOqW,EAAcC,EAAYC,GAClD,GAAIC,GAAO,SAAU7qB,EAAGiJ,EAAGvJ,GACvB,OACIvB,EAAG6B,EAAE7B,GAAK8K,EAAE9K,EAAI6B,EAAE7B,GAAKuB,EACvBtB,EAAG4B,EAAE5B,GAAK6K,EAAE7K,EAAI4B,EAAE5B,GAAKsB,GAI/B,QACI2U,MAAOA,EACPqW,aAAcA,EACdC,WAAYA,EACZC,IAAKA,EACLH,UAAW,SAAS/qB,GAChB,GAAIorB,GAAKD,EAAKxW,EAAOqW,EAAchrB,GAC/BqrB,EAAKF,EAAKH,EAAcC,EAAYjrB,GACpCsrB,EAAKH,EAAKF,EAAYC,EAAKlrB,GAC3BurB,EAAOJ,EAAKC,EAAIC,EAAIrrB,GACpBwrB,EAAOL,EAAKE,EAAIC,EAAItrB,GACpByrB,EAAON,EAAKI,EAAMC,EAAMxrB,EAC5B,QAAQ6pB,EAAYlV,EAAOyW,EAAIG,EAAME,GAAO5B,EAAY4B,EAAMD,EAAMF,EAAIJ,KAE5EQ,QAAS,SAASC,GACdA,EAAWzpB,MAAM,cAAe8oB,EAAavsB,EAAGusB,EAAatsB,EAAGusB,EAAWxsB,EAAGwsB,EAAWvsB,EAAGwsB,EAAIzsB,EAAGysB,EAAIxsB,KAE3GktB,gBAAiB,SAASD,GACtBA,EAAWzpB,MAAM,cAAe+oB,EAAWxsB,EAAGwsB,EAAWvsB,EAAGssB,EAAavsB,EAAGusB,EAAatsB,EAAGiW,EAAMlW,EAAGkW,EAAMjW,MAKvH,QAAS4pB,GAASuD,EAAYC,EAASC,EAASC,EAAQC,EAAQC,EAAQC,GACpE,GAAIR,KA0BJ,OAxBIG,GAAQ,GAAK,GAAKA,EAAQ,GAAK,GAC/BH,EAAWzpB,MAAM,OAAQ8pB,EAAO,GAAGrX,MAAMlW,EAAGutB,EAAO,GAAGrX,MAAMjW,IAC5DstB,EAAO,GAAGN,QAAQC,IAElBA,EAAWzpB,MAAO,OAAQ2pB,EAAWtD,GAAG,GAAIsD,EAAWtD,GAAG,KAG1DwD,EAAQ,GAAK,GAAKA,EAAQ,GAAK,GAC/BJ,EAAWzpB,MAAM,OAAQgqB,EAAO,GAAGvX,MAAMlW,EAAGytB,EAAO,GAAGvX,MAAMjW,IAC5DwtB,EAAO,GAAGR,QAAQC,GAClBA,EAAWzpB,MAAM,OAAQiqB,EAAO,GAAGjB,IAAIzsB,EAAG0tB,EAAO,GAAGjB,IAAIxsB,IACxDytB,EAAO,GAAGP,gBAAgBD,KAE1BA,EAAWzpB,MAAM,OAAQ2pB,EAAWrD,GAAG,GAAIqD,EAAWrD,GAAG,KACzDmD,EAAWzpB,MAAM,OAAQ2pB,EAAWpD,GAAG,GAAIoD,EAAWpD,GAAG,MAGzDqD,EAAQ,GAAK,GAAKA,EAAQ,GAAK,GAC/BH,EAAWzpB,MAAM,OAAQ+pB,EAAO,GAAGf,IAAIzsB,EAAGwtB,EAAO,GAAGf,IAAIxsB,IACxDutB,EAAO,GAAGL,gBAAgBD,IAE1BA,EAAWzpB,MAAM,OAAQ2pB,EAAWnD,GAAG,GAAImD,EAAWnD,GAAG,KAGtDiD,EAGX,QAASS,GAAYT,EAAYG,EAASC,EAASM,EAASC,EAAS7tB,EAAGC,GAChEotB,EAAQ,GAAK,GAAKA,EAAQ,GAAK,GAC/BH,EAAWzpB,MAAM,OAAQmqB,EAAQ,GAAG1X,MAAMlW,EAAG4tB,EAAQ,GAAG1X,MAAMjW,IAC9D2tB,EAAQ,GAAGX,QAAQC,GACnBU,EAAQ,GAAGX,QAAQC,IAEnBA,EAAWzpB,MAAM,OAAQzD,EAAGC,KAG5BqtB,EAAQ,GAAK,GAAKA,EAAQ,GAAK,IAC/BJ,EAAWzpB,MAAM,OAAQoqB,EAAQ,GAAG3X,MAAMlW,EAAG6tB,EAAQ,GAAG3X,MAAMjW,IAItE,QAAS6tB,GAAe3kB,GACpB,MAAOA,GAAUqc,OAAO,UAAY,EAGxC,QAASuI,GAAe5kB,GACpB,MAAOA,GAAUqc,OAAO,UAAY,EAGxC,QAASwI,GAAQ7kB,GACb,MAAsC,KAA/BA,EAAUqc,OAAO,UAG5B,QAASyI,GAAY9kB,GACjB,OAAQ,SAAU,eAAgB,gBAAgB4a,QAAQ5a,EAAUyb,IAAI,iBAG5E,QAASsJ,GAAkB/kB,GACvB,MAAQA,aAAqB2e,GAGjC,QAASqG,GAAQhlB,GACb,MAAOA,GAAUhB,KAAKmU,KAAKsH,OAAOnoB,OAAS,EAG/C,QAAS2yB,GAAgBjlB,GACrB,MAAQ,sBAAsB7C,KAAK6C,EAAUsZ,OAAOmC,IAAI,kBAG5D,QAASyJ,GAAoBllB,GACzB,OAAQ,UAAW,WAAY,cAAe,cAAc5G,IAAI,SAAS+rB,GACrE,GAAIzzB,GAAQsO,EAAUyb,IAAI,SAAW0J,EAAO,UACxCC,EAAM1zB,EAAMiI,MAAM,IAItB,OAHIyrB,GAAI9yB,QAAU,IACd8yB,EAAI,GAAKA,EAAI,IAEVA,EAAIhsB,IAAIisB,KAIvB,QAASC,GAAetmB,GACpB,MAAQA,GAAKvB,WAAa8d,KAAKC,WAAaxc,EAAKvB,WAAa8d,KAAKgK,aAGvE,QAASC,GAAwBxlB,GAC7B,GAAI9K,GAAW8K,EAAUyb,IAAI,YACzBgK,GAAW,WAAY,WAAY,SAAS7K,QAAQ1lB,QAAoB8K,EAAUyb,IAAI,UAAY,MACtG,OAAkB,SAAXgK,EAGX,QAASC,GAAa1lB,GAClB,MAAqC,WAA9BA,EAAUyb,IAAI,YAGzB,QAASkK,GAAW3lB,GAChB,MAAkC,SAA3BA,EAAUyb,IAAI,SAGzB,QAASmK,GAAc5lB,GACnB,OAAQ,eAAgB,gBAAgB4a,QAAQ5a,EAAUyb,IAAI,iBAGlE,QAASoK,GAAI3P,GACT,GAAI4P,GAAUj2B,IACd,OAAO,YACH,OAAQqmB,EAAShe,MAAM4tB,EAASpyB,YAIxC,QAAS6rB,GAAUvf,GACf,MAAOA,GAAUhB,KAAKvB,WAAa8d,KAAKgK,aAG5C,QAASrL,GAAgBla,GACrB,MAAOA,GAAUka,mBAAoB,EAGzC,QAAS6L,GAAW/lB,GAChB,MAAOA,GAAUhB,KAAKvB,WAAa8d,KAAKC,UAG5C,QAASwK,GAAWC,GAChB,MAAO,UAASvtB,EAAGiJ,GACf,MAAQjJ,GAAE2jB,OAAO,UAAa4J,EAASrL,QAAQliB,GAAKutB,EAAS3zB,QAAYqP,EAAE0a,OAAO,UAAa4J,EAASrL,QAAQjZ,GAAKskB,EAAS3zB,SAItI,QAAS4zB,GAAWlmB,GAChB,MAAOA,GAAUkb,aAAe,EAGpC,QAASmK,GAAM3zB,GACX,MAAOkR,UAASlR,EAAO,IAG3B,QAASy0B,GAAShmB,GACd,MAAOA,GAAOpL,MAGlB,QAASqxB,GAAkBC,GACvB,MAAQA,GAAcrnB,KAAKvB,WAAa8d,KAAKgK,eAAiB,SAAU,OAAQ,QAAS,SAAU,KAAM,UAAU3K,QAAQyL,EAAcrnB,KAAKO,eAGlJ,QAAS2f,GAAQoH,GACb,SAAU9Q,OAAOtd,SAAUouB,GAG/B,QAASC,GAAYC,GACjB,GAAIC,GAAQD,EAAQtK,OAAO,EAAG,EAC9B,OAAQuK,KAAUD,EAAQtK,OAAOsK,EAAQl0B,OAAS,IAAMm0B,EAAM9jB,MAAM,OAAU6jB,EAAQtK,OAAO,EAAGsK,EAAQl0B,OAAS,GAAKk0B,EAG1H,QAASE,GAASC,GAEd,IADA,GAA+CC,GAA3CC,KAAYx0B,EAAI,EAAGy0B,GAAiB,EAClCH,EAAWr0B,QACTy0B,EAAeJ,EAAWt0B,MAAQy0B,GAClCF,EAAOD,EAAWlqB,OAAO,EAAGpK,GACxBu0B,EAAKt0B,QACLu0B,EAAMvsB,KAAKsD,EAASQ,KAAK1B,OAAOkqB,IAEpCE,GAAkBA,EAClBz0B,EAAI,GAEJA,IAGAA,GAAKs0B,EAAWr0B,SAChBs0B,EAAOD,EAAWlqB,OAAO,EAAGpK,GACxBu0B,EAAKt0B,QACLu0B,EAAMvsB,KAAKsD,EAASQ,KAAK1B,OAAOkqB,IAI5C,OAAOC,GAGX,QAASE,GAAeC,GACpB,OACI,GACA,GACA,GACA,EACA,IACFpM,QAAQoM,QAGd,QAASC,GAAWxtB,GAChB,MAAQ,mBAAoB0D,KAAK1D,GAj2BrC,GAAIxF,GAAM8E,EAAQ,SACd6E,EAAW7E,EAAQ,YACnB6X,EAAgB7X,EAAQ,mBACxBmuB,EAAgBnuB,EAAQ,mBACxBouB,EAAyBpuB,EAAQ,4BACjCma,EAAcna,EAAQ,iBACtB0I,EAAQ1I,EAAQ,WAChB4lB,EAAkB5lB,EAAQ,qBAC1B8X,EAAQ9X,EAAQ,WAChB5E,EAAO0c,EAAM1c,KACbib,EAAYyB,EAAMzB,UAClB4L,EAAmBnK,EAAMmK,iBACzBrB,EAAe9I,EAAM8I,YAuDzBnK,GAAWle,UAAUguB,uBAAyB,WAC1CzvB,KAAKulB,MAAMO,QAAQ,SAAS3V,GACxB,GAAIuf,EAAUvf,GAAY,CAClBka,EAAgBla,IAChBA,EAAUonB,cAEdpnB,EAAUwZ,QAAU3pB,KAAKw3B,aAAarnB,EACtC,IAAIyZ,GAAsC,WAA9BzZ,EAAUyb,IAAI,aAA6Bzb,EAAUwZ,QAAQC,SACrE6N,EAAUtnB,EAAUwc,WACpB8K,KAAY,WAAY,SAAS1M,QAAQ5a,EAAUyb,IAAI,mBACvDhC,EAAKnf,OAAO,OACJ0F,EAAUmP,OAAOha,KAAOmyB,EAAQnyB,KAChC6K,EAAUmP,OAAO/Z,IAAMkyB,EAAQlyB,IAC/BkyB,EAAQvxB,MAAQuxB,EAAQnyB,KACxBmyB,EAAQtxB,OAASsxB,EAAQlyB,OAGrC4K,EAAUyZ,KAAOqG,EAAc9f,GAAaA,EAAUsZ,OAAOG,KAAKjE,OAAOiE,GAAQA,EACjFzZ,EAAU0Z,eAAgD,WAA9B1Z,EAAUyb,IAAI,YAA4Bzb,EAAUyZ,KAAKjE,QAAQxV,EAAUwZ,QAAQC,OAASzZ,EAAUyZ,KAC9HS,EAAgBla,IAChBA,EAAUunB,eAEPxB,GAAW/lB,KAClBA,EAAUyZ,KAAOqG,EAAc9f,GAAaA,EAAUsZ,OAAOG,QAE5DS,GAAgBla,KACjBA,EAAUmP,OAAS,OAExBtf,OAOP2f,EAAWle,UAAUsuB,cAAgB,SAAS4H,EAAOlnB,EAASmnB,GAC1DA,EAAaA,GAAcza,KAAKC,MAChCpd,KAAKgwB,MAAM2H,EAAM33B,KAAK8vB,gBAClB6H,EAAMl1B,SAAWzC,KAAK8vB,YACtBrf,IACOmnB,EAAa,GAAKza,KAAKC,MAC9Bpd,KAAK+vB,cAAc4H,EAAOlnB,EAASmnB,GAEnCjQ,WAAWrjB,EAAK,WACZtE,KAAK+vB,cAAc4H,EAAOlnB,IAC3BzQ,MAAO,IAIlB2f,EAAWle,UAAU0tB,uBAAyB,SAAS7f,GACnDtP,KAAK63B,aAAavoB,EAAU,IAAMgoB,EAAuB71B,UAAUq2B,iCAAmC,iEAC5FR,EAAuB71B,UAAUs2B,gCAAkC,iEAGjFpY,EAAWle,UAAU2tB,kBAAoB,SAAS9f,GAC9CtP,KAAK63B,aAAavoB,EAAU,6QAIhCqQ,EAAWle,UAAUo2B,aAAe,SAASvoB,EAAU2a,GACnD,GAAI+N,GAAqB1oB,EAAStK,cAAc,QAChDgzB,GAAmBC,UAAYhO,EAC/B3a,EAAS9J,KAAKC,YAAYuyB,IAG9BrY,EAAWle,UAAU8tB,kBAAoB,SAASpf,GAC9C,GAAIoV,KAAUpV,GACd,IAAIA,EAAUhB,KAAKvB,WAAa8d,KAAKgK,aAAc,CAC/C,GAAIzJ,GAASjsB,KAAKk4B,iBAAiB/nB,EAAW,WAC1CgoB,EAAQn4B,KAAKk4B,iBAAiB/nB,EAAW,SAEzC8b,IACA1G,EAAM9a,KAAKwhB,GAGXkM,GACA5S,EAAM9a,KAAK0tB,GAGnB,MAAO9I,GAAQ9J,IASnB5F,EAAWle,UAAUy2B,iBAAmB,SAAS/nB,EAAW/G,GACxD,GAAIhE,GAAQ+K,EAAU6b,cAAc5iB,EACpC,KAAIhE,IAAUA,EAAMuxB,SAA6B,SAAlBvxB,EAAMuxB,SAAwC,qBAAlBvxB,EAAMuxB,SAAoD,SAAlBvxB,EAAMgzB,QACrG,MAAO,KAQX,KAAK,GALDzB,GAAUD,EAAYtxB,EAAMuxB,SAC5B0B,EAAmC,QAAzB1B,EAAQtK,OAAO,EAAG,GAC5BiM,EAAahpB,SAAStK,cAAcqzB,EAAU,MAAQ,4BACtDE,EAAkB,GAAIjB,GAAuBgB,EAAYnoB,EAAW/G,GAE/D5G,EAAI4C,EAAM3C,OAAO,EAAGD,GAAK,EAAGA,IAAK,CACtC,GAAIuqB,GAAWmD,EAAY9qB,EAAMozB,KAAKh2B,GACtC81B,GAAWlzB,MAAM2nB,GAAY3nB,EAAM2nB,GAKvC,GAFAuL,EAAWloB,UAAYknB,EAAuB71B,UAAUq2B,iCAAmC,IAAMR,EAAuB71B,UAAUs2B,gCAE9HM,EAEA,MADAC,GAAW1W,IAAMuJ,EAAiBwL,GAAS,GAAG/Q,KAAK,IAC3C2S,EAER,IAAI7N,GAAOpb,SAASrJ,eAAe0wB,EAEnC,OADA2B,GAAW7yB,YAAYilB,IACf6N,EAAiB,GAAIlB,GAAc3M,EAAM6N,KAKzD5Y,EAAWle,UAAU6tB,YAAc,SAASmJ,GACxC,MAAOpJ,MAAWlJ,OAAO5lB,KAAKk4B,EAAgBtpB,KAAK4B,WAAY0kB,GAAgBlsB,IAAI,SAAS4F,GACxF,GAAIgB,IAAahB,EAAKvB,WAAa8d,KAAKC,UAAY,GAAI0L,GAAcloB,EAAMspB,GAAmB,GAAI1X,GAAc5R,EAAMspB,IAAkBtS,OAAOoQ,EAChJ,OAAOpnB,GAAKvB,WAAa8d,KAAKgK,cAAgBvlB,EAAU1N,QAA2B,aAAjB0M,EAAKqf,QAA0Bre,EAAU,GAAGsb,mBAAqBtb,EAAUwV,OAAO3lB,KAAKsvB,YAAYnf,EAAU,QAAaA,GAC7LnQ,QAGP2f,EAAWle,UAAUi3B,mBAAqB,SAASvoB,EAAWwoB,GAC1D,GAAIjP,GAAQ,GAAIoF,GAAgB6J,EAAgBxoB,EAAUkb,aAAclb,EAAUhB,KAAMgB,EAAUsZ,OAClGtZ,GAAUib,QAAQ1B,EAClB,IAAIkP,GAAcD,EAAiBjP,EAAMmP,eAAe74B,MAAQ0pB,EAAMD,OAAOC,KAC7EkP,GAAYxC,SAAS3rB,KAAKif,GAC1BvZ,EAAUuZ,MAAQA,GAGtB/J,EAAWle,UAAUkuB,uBAAyB,WAC1C3vB,KAAKulB,MAAMO,QAAQ,SAAS3V,GACpBuf,EAAUvf,KAAenQ,KAAK84B,cAAc3oB,IAAckmB,EAAWlmB,IAAcwlB,EAAwBxlB,IAAcnQ,KAAK+4B,0BAA0B5oB,IAAcA,EAAU6d,gBAChLhuB,KAAK04B,mBAAmBvoB,GAAW,GAC5Buf,EAAUvf,KAAgB0lB,EAAa1lB,IAAc6kB,EAAQ7kB,IAAe4lB,EAAc5lB,IAAc2lB,EAAW3lB,IAC1HnQ,KAAK04B,mBAAmBvoB,GAAW,GAEnCA,EAAUob,YAAYpb,EAAUsZ,OAAOC,QAE5C1pB,OAGP2f,EAAWle,UAAUs3B,0BAA4B,SAAS5oB,GACtD,MAAmC,SAA5BA,EAAUhB,KAAKO,UAAuBS,EAAUsZ,OAAOnW,MAAM,mBAAmBd,iBAG3FmN,EAAWle,UAAUq3B,cAAgB,SAAS3oB,GAC1C,MAA4B,QAArBA,EAAUsZ,QAGrB9J,EAAWle,UAAUmuB,qBAAuB,SAASlG,GACjDA,EAAM0M,SAAS4C,KAAK7C,EAAWzM,EAAM0M,SAAS7oB,MAAM,KACpDmc,EAAM0M,SAAStQ,QAAQ9lB,KAAK4vB,qBAAsB5vB,OAGtD2f,EAAWle,UAAUw3B,gBAAkB,SAAS9oB,GAC5C,MAAO,UAASua,EAAMze,EAAOitB,GACzB,GAA4D,SAAxD/oB,EAAUsZ,OAAOmC,IAAI,kBAAkBS,OAAO,EAAG,IAAwC,IAAvB3B,EAAKE,OAAOnoB,OAAc,CAC5F,GAAIzC,KAAKkf,QAAQia,cAAgBhpB,EAAUsZ,OAAOuE,eAAgB,CAC9D,GAAIC,GAASiL,EAAS3rB,MAAM,EAAGtB,GAAO9B,KAAK,IAAI1H,MAC/C,OAAOzC,MAAKo5B,eAAejpB,EAAUhB,KAAM8e,EAAQvD,EAAKjoB,QACrD,GAAI0N,EAAUhB,MAAwC,gBAAzBgB,GAAUhB,KAAKmU,KAAoB,CACnE,GAAI+V,GAAkBlpB,EAAUhB,KAAKmqB,UAAU5O,EAAKjoB,QAChD6c,EAAStf,KAAKu5B,iBAAiBppB,EAAUhB,KAAMgB,EAAUsZ,OAAOuE,eAEpE,OADA7d,GAAUhB,KAAOkqB,EACV/Z,OAEJtf,MAAKkf,QAAQia,cAAehpB,EAAUsZ,OAAOuE,iBACpD7d,EAAUhB,KAAOgB,EAAUhB,KAAKmqB,UAAU5O,EAAKjoB,QAEnD,YAIRkd,EAAWle,UAAU83B,iBAAmB,SAASpqB,EAAMkf,GACnD,GAAImL,GAAUrqB,EAAKR,cAAc3J,cAAc,sBAC3CykB,EAASta,EAAK4Q,WACd0Z,EAAatqB,EAAKD,WAAU,EAEhCsqB,GAAQ/zB,YAAY0J,EAAKD,WAAU,IACnCua,EAAOlY,aAAaioB,EAASrqB,EAC7B,IAAImQ,GAAS+O,EAAYvE,EAAa0P,GAAWja,EAAUia,EAE3D,OADA/P,GAAOlY,aAAakoB,EAAYD,GACzBla,GAGXK,EAAWle,UAAU23B,eAAiB,SAASjqB,EAAM8e,EAAQxrB,GACzD,GAAImsB,GAAQ5uB,KAAK4uB,QAAU5uB,KAAK4uB,MAAQzf,EAAKR,cAAc+qB,cAG3D,OAFA9K,GAAM+K,SAASxqB,EAAM8e,GACrBW,EAAMgL,OAAOzqB,EAAM8e,EAASxrB,GACrBmsB,EAAMiL,yBAKjBla,EAAWle,UAAUouB,MAAQ,SAASnG,GAElC,GAAIoQ,GAAiBpQ,EAAM0M,SAASjQ,OAAO2O,GACvCiF,EAAqBrQ,EAAM8B,SAASrF,OAAOuJ,GAC3CsK,EAAsBD,EAAmB5T,OAAO6P,EAAIF,IACpDmE,EAAoCD,EAAoB7T,OAAO6P,EAAIH,IAAe1P,OAAO6P,EAAIf,IAC7FiF,EAAsBH,EAAmB5T,OAAO6P,EAAIH,IAAe1P,OAAO2P,GAC1EqE,EAASH,EAAoB7T,OAAO6P,EAAIH,IAAe1P,OAAO8O,GAC9DmF,EAAc1Q,EAAM0M,SAASzQ,OAAOqU,EAAoB7T,OAAO0P,IAAe1P,OAAO6O,GACrFtK,EAAOhB,EAAM8B,SAASrF,OAAO+P,GAAY/P,OAAOgP,GAChDkF,EAAiB3Q,EAAM0M,SAASjQ,OAAO4O,EAC3C+E,GAAenU,OAAOsU,GAAmCtU,OAAOuU,GAC3DvU,OAAOwU,GAAQxU,OAAOyU,GAAazU,OAAO+E,GAAM/E,OAAO0U,GAAgBvU,QAAQ,SAAS3V,GACrFnQ,KAAK6uB,YAAYpkB,KAAK0F,GAClB+kB,EAAkB/kB,KAClBnQ,KAAK6vB,MAAM1f,GACXnQ,KAAK6uB,YAAYpkB,KAAK,GAAI0lB,MAE/BnwB,OAGX2f,EAAWle,UAAUuuB,MAAQ,SAAS7f,GAClC,IACQA,YAAqBggB,GACrBnwB,KAAKyd,SAAS/W,IAAI4zB,UACXpE,EAAW/lB,IACdka,EAAgBla,EAAUsZ,SAC1BtZ,EAAUsZ,OAAO8N,cAErBv3B,KAAKu6B,UAAUpqB,GACXka,EAAgBla,EAAUsZ,SAC1BtZ,EAAUsZ,OAAOiO,YAGrB13B,KAAKw6B,UAAUrqB,GAErB,MAAM7H,GAEJ,GADAlE,EAAIkE,GACAtI,KAAK4D,QAAQ+Z,OACb,KAAMrV,KAKlBqX,EAAWle,UAAU+4B,UAAY,SAASrqB,GAClC+kB,EAAkB/kB,KAClBnQ,KAAKyd,SAASgd,WAAWtqB,EAAUma,SACnCtqB,KAAKyd,SAAS/W,IAAIg0B,OACdvqB,EAAU6d,gBACVhuB,KAAKyd,SAASkd,aAAaxqB,EAAU4d,mBAIb,UAA5B5d,EAAUhB,KAAKO,UAAgD,aAAxBS,EAAUhB,KAAK/F,KACtDpJ,KAAK46B,cAAczqB,GACgB,UAA5BA,EAAUhB,KAAKO,UAAgD,UAAxBS,EAAUhB,KAAK/F,KAC7DpJ,KAAK66B,WAAW1qB,GAEhBnQ,KAAK86B,aAAa3qB,IAI1BwP,EAAWle,UAAUq5B,aAAe,SAAS3qB,GACzC,GAAImP,GAASnP,EAAU+d,aACvBluB,MAAKyd,SAASmM,KAAKzZ,EAAU0Z,eAAgB,WACzC7pB,KAAKyd,SAASsd,iBAAiB5qB,EAAWmP,EAAQnP,EAAUwZ,QAAQA,QAAQpgB,IAAI+sB,KACjFt2B,MAEHA,KAAKyd,SAASmM,KAAKzZ,EAAUyZ,KAAM,WAC/B5pB,KAAKyd,SAASud,cAAc7qB,EAAUwZ,QAAQA,UAC/C3pB,MAEHA,KAAKyd,SAASmM,KAAKzZ,EAAU0Z,eAAgB,WACzC,OAAQ1Z,EAAUhB,KAAKO,UACvB,IAAK,MACL,IAAK,SACD,GAAIurB,GAAej7B,KAAKwlB,OAAO4B,IAAIjX,EAAUhB,KACzC8rB,GACAj7B,KAAKyd,SAASyd,YAAY/qB,EAAWmP,EAAQnP,EAAUwZ,QAASsR,GAEhE72B,EAAI,kBAAoB+L,EAAUhB,KAAKO,SAAW,IAAKS,EAAUhB,KAErE,MACJ,KAAK,MACD,GAAIgsB,GAAiBn7B,KAAKwlB,OAAO4B,IAAIjX,EAAUhB,KAAKyS,IAChDuZ,GACAn7B,KAAKyd,SAASyd,YAAY/qB,EAAWmP,EAAQnP,EAAUwZ,QAASwR,GAEhE/2B,EAAI,sBAAuB+L,EAAUhB,KAAKyS,IAE9C,MACJ,KAAK,SACD5hB,KAAKyd,SAASyd,YAAY/qB,EAAWmP,EAAQnP,EAAUwZ,SAAU7H,MAAO3R,EAAUhB,MAClF,MACJ,KAAK,SACL,IAAK,QACL,IAAK,WACDnP,KAAKo7B,eAAejrB,KAGzBnQ,OAGP2f,EAAWle,UAAUm5B,cAAgB,SAASzqB,GAC1C,GAAI2B,GAAI3B,EAAU+d,cAEd5L,EAAOnU,KAAKyE,IAAId,EAAE5M,MAAO4M,EAAE3M,QAC3Bma,GAAUpa,MAAOod,EAAO,EAAGnd,OAAQmd,EAAO,EAAG/c,IAAKuM,EAAEvM,IAAKD,KAAMwM,EAAExM,MACjEmD,GAAK,EAAG,GACR8nB,GAAU9nB,EAAGA,EAAGA,EAAGA,GACnBkhB,GAAW,EAAE,EAAE,EAAE,GAAGpgB,IAAI,SAASrC,GACjC,OAAQoM,MAAO,GAAI1B,GAAM,WAAY1M,MAAOgC,KAG5CopB,EAAekC,EAAqBlT,EAAQiR,EAAQ5G,EAExD3pB,MAAKyd,SAASmM,KAAKzZ,EAAU0Z,eAAgB,WACzC7pB,KAAKyd,SAASuR,UAAU1P,EAAOha,KAAO,EAAGga,EAAO/Z,IAAM,EAAG+Z,EAAOpa,MAAQ,EAAGoa,EAAOna,OAAS,EAAG,GAAIyM,GAAM,YACxG5R,KAAKyd,SAASud,cAAc5K,EAAiBzG,EAASrK,EAAQgR,EAAcC,IACxEpgB,EAAUhB,KAAKksB,UACfr7B,KAAKyd,SAAS6d,KAAK,GAAI1pB,GAAM,WAAY,SAAU,SAAU,OAAS0Q,EAAO,EAAK,KAAM,SACxFtiB,KAAKyd,SAASiN,KAAK,IAAUpL,EAAOha,KAAOgd,EAAO,EAAGhD,EAAO/Z,IAAM+c,EAAO,KAE9EtiB,OAGP2f,EAAWle,UAAUo5B,WAAa,SAAS1qB,GACvC,GAAImP,GAASnP,EAAU+d,cAEnB5L,EAAOnU,KAAKyE,IAAI0M,EAAOpa,MAAOoa,EAAOna,QAAU,CAEnDnF,MAAKyd,SAASmM,KAAKzZ,EAAU0Z,eAAgB,WACzC7pB,KAAKyd,SAAS8d,aAAajc,EAAOha,KAAO,EAAGga,EAAO/Z,IAAM,EAAG+c,EAAM,GAAI1Q,GAAM,WAAY,EAAG,GAAIA,GAAM,YACjGzB,EAAUhB,KAAKksB,SACfr7B,KAAKyd,SAAS+d,OAAOrtB,KAAKstB,KAAKnc,EAAOha,KAAOgd,EAAO,GAAK,EAAGnU,KAAKstB,KAAKnc,EAAO/Z,IAAM+c,EAAO,GAAK,EAAGnU,KAAK5C,MAAM+W,EAAO,GAAI,GAAI1Q,GAAM,aAEvI5R,OAGP2f,EAAWle,UAAU25B,eAAiB,SAASjrB,GAC3C,GAAItO,GAAQsO,EAAUoe,UACtB,IAAI1sB,EAAMY,OAAS,EAAG,CAClB,GAAI6M,GAAWa,EAAUhB,KAAKR,cAC1B6qB,EAAUlqB,EAAStK,cAAc,sBACjC02B,GAAc,aAAc,YAAa,aAAc,aAAc,WAAY,QACjF,cAAe,aAAc,eAAgB,gBAC7C,QAAS,SAAU,kBAAmB,iBAAkB,kBAAmB,iBAC3E,YAAa,aAAc,WAE/BA,GAAW5V,QAAQ,SAASiH,GACxB,IACIyM,EAAQp0B,MAAM2nB,GAAY5c,EAAUyb,IAAImB,GAC1C,MAAMzkB,GAEJlE,EAAI,4DAA8DkE,EAAEqzB,WAG5E,IAAIrc,GAASnP,EAAU+d,aACvBsL,GAAQp0B,MAAMC,SAAW,QACzBm0B,EAAQp0B,MAAME,KAAOga,EAAOha,KAAO,KACnCk0B,EAAQp0B,MAAMG,IAAM+Z,EAAO/Z,IAAM,KACjCi0B,EAAQoC,YAAc/5B,EACtByN,EAAS9J,KAAKC,YAAY+zB,GAC1Bx5B,KAAKu6B,UAAU,GAAIlD,GAAcmC,EAAQ/pB,WAAYU,IACrDb,EAAS9J,KAAKG,YAAY6zB,KAIlC7Z,EAAWle,UAAU84B,UAAY,SAASpqB,GACtCA,EAAU0rB,oBACV,IAAI/E,GAAa/oB,EAASQ,KAAK3C,OAAOuE,EAAUhB,KAAKmU,MACjD4V,EAAal5B,KAAK4D,QAAQk4B,kBAAmB1G,EAAgBjlB,IAAgBinB,EAAWjnB,EAAUhB,KAAKmU,MAA+BwT,EAAWvtB,IAAI,SAASwyB,GAC9J,MAAOhuB,GAASQ,KAAK1B,QAAQkvB,MADkFlF,EAASC,GAIxHpK,EAASvc,EAAUsZ,OAAOgD,aAC1BnK,EAAOnS,EAAUsZ,OAAOmC,IAAI,YAC5BvJ,EAASlS,EAAUsZ,OAAOmC,IAAI,cAC9B6B,EAAUtd,EAAUsZ,OAAO6D,kBAE/BttB,MAAKyd,SAAS6d,KAAKnrB,EAAUsZ,OAAOnW,MAAM,SAAUnD,EAAUsZ,OAAOmC,IAAI,aAAczb,EAAUsZ,OAAOmC,IAAI,eAAgBc,EAAQpK,EAAMD,GACtIoL,EAAQhrB,OAERzC,KAAKyd,SAASue,WAAWvO,EAAQ,GAAGna,MAAOma,EAAQ,GAAGG,QAASH,EAAQ,GAAGI,QAASJ,EAAQ,GAAGK,MAE9F9tB,KAAKyd,SAASwe,cAGlBj8B,KAAKyd,SAASmM,KAAKzZ,EAAUsZ,OAAOG,KAAM,WACtCsP,EAAS3vB,IAAIvJ,KAAKi5B,gBAAgB9oB,GAAYnQ,MAAM8lB,QAAQ,SAASxG,EAAQrT,GACrEqT,IACAtf,KAAKyd,SAASiN,KAAKwO,EAASjtB,GAAQqT,EAAOha,KAAMga,EAAOnZ,QACxDnG,KAAKk8B,qBAAqB/rB,EAAUsZ,OAAQnK,EAAQtf,KAAKwvB,YAAYjM,WAAWlB,EAAQC,MAE7FtiB,OACJA,OAGP2f,EAAWle,UAAUy6B,qBAAuB,SAAS/rB,EAAWmP,EAAQ6c,GACpE,OAAOhsB,EAAUyb,IAAI,kBAAkB9hB,MAAM,KAAK,IAClD,IAAK,YAGD9J,KAAKyd,SAASuR,UAAU1P,EAAOha,KAAM6I,KAAKoE,MAAM+M,EAAO/Z,IAAM42B,EAAQ5Z,SAAW4Z,EAAQhZ,WAAY7D,EAAOpa,MAAO,EAAGiL,EAAUmD,MAAM,SACrI,MACJ,KAAK,WACDtT,KAAKyd,SAASuR,UAAU1P,EAAOha,KAAM6I,KAAKoE,MAAM+M,EAAO/Z,KAAM+Z,EAAOpa,MAAO,EAAGiL,EAAUmD,MAAM,SAC9F,MACJ,KAAK,eAEDtT,KAAKyd,SAASuR,UAAU1P,EAAOha,KAAM6I,KAAKstB,KAAKnc,EAAO/Z,IAAM42B,EAAQ3Z,OAAS2Z,EAAQhZ,WAAY7D,EAAOpa,MAAO,EAAGiL,EAAUmD,MAAM,WAK1I,IAAI8oB,IACAC,QACK,SAAU,KACV,SAAU,KACV,SAAU,KACV,SAAU,KAInB1c,GAAWle,UAAU+1B,aAAe,SAASrnB,GACzC,GAAIkgB,GAAalgB,EAAU+d,cACvBqC,EAAS8E,EAAoBllB,GAC7BwZ,GAAW,MAAO,QAAS,SAAU,QAAQpgB,IAAI,SAAS+rB,EAAMrpB,GAChE,GAAI7G,GAAQ+K,EAAUyb,IAAI,SAAW0J,EAAO,SACxChiB,EAAQnD,EAAUmD,MAAM,SAAWgiB,EAAO,QAChC,WAAVlwB,GAAqBkO,EAAMb,YAC3Ba,EAAQ,GAAI1B,IAAO,IAAK,IAAK,IAAK0B,EAAMzK,IAE5C,IAAIyzB,GAAiBF,EAAsBh3B,GAASg3B,EAAsBh3B,GAAO6G,GAAS,IAC1F,QACI/G,MAAOiL,EAAUqc,OAAO,SAAW8I,EAAO,SAC1ChiB,MAAOgpB,EAAiBhpB,EAAMgpB,EAAe,IAAIA,EAAe,IAAMhpB,EACtEsS,KAAM,QAGV0K,EAAekC,EAAqBnC,EAAYE,EAAQ5G,EAE5D,QACIC,KAAM5pB,KAAKu8B,oBAAoBpsB,EAAWmgB,EAAc3G,EAAS4G,EAAQF,GACzE1G,QAASyG,EAAiBzG,EAAS0G,EAAYC,EAAcC,KAkErE5Q,EAAWle,UAAU86B,oBAAsB,SAASpsB,EAAWmgB,EAAc3G,EAAS4G,EAAQjR,GAC1F,GAAIuK,GAAiB1Z,EAAUyb,IAAI,kBAC/BsI,IAEJ,QAAOrK,GACP,IAAK,cACL,IAAK,cACD8K,EAAYT,EAAY3D,EAAO,GAAIA,EAAO,GAAID,EAAaa,aAAcb,EAAae,cAAe/R,EAAOha,KAAOqkB,EAAQ,GAAGzkB,MAAOoa,EAAO/Z,IAAMokB,EAAQ,GAAGzkB,OAC7JyvB,EAAYT,EAAY3D,EAAO,GAAIA,EAAO,GAAID,EAAae,cAAef,EAAaiB,iBAAkBjS,EAAOha,KAAOga,EAAOpa,MAAQykB,EAAQ,GAAGzkB,MAAOoa,EAAO/Z,IAAMokB,EAAQ,GAAGzkB,OAChLyvB,EAAYT,EAAY3D,EAAO,GAAIA,EAAO,GAAID,EAAaiB,iBAAkBjB,EAAamB,gBAAiBnS,EAAOha,KAAOga,EAAOpa,MAAQykB,EAAQ,GAAGzkB,MAAOoa,EAAO/Z,IAAM+Z,EAAOna,OAASwkB,EAAQ,GAAGzkB,OAClMyvB,EAAYT,EAAY3D,EAAO,GAAIA,EAAO,GAAID,EAAamB,gBAAiBnB,EAAaa,aAAc7R,EAAOha,KAAOqkB,EAAQ,GAAGzkB,MAAOoa,EAAO/Z,IAAM+Z,EAAOna,OAASwkB,EAAQ,GAAGzkB,MAC/K,MAEJ,SACIyvB,EAAYT,EAAY3D,EAAO,GAAIA,EAAO,GAAID,EAAaY,aAAcZ,EAAac,cAAe9R,EAAOha,KAAMga,EAAO/Z,KACzHovB,EAAYT,EAAY3D,EAAO,GAAIA,EAAO,GAAID,EAAac,cAAed,EAAagB,iBAAkBhS,EAAOha,KAAOga,EAAOpa,MAAOoa,EAAO/Z,KAC5IovB,EAAYT,EAAY3D,EAAO,GAAIA,EAAO,GAAID,EAAagB,iBAAkBhB,EAAakB,gBAAiBlS,EAAOha,KAAOga,EAAOpa,MAAOoa,EAAO/Z,IAAM+Z,EAAOna,QAC3JwvB,EAAYT,EAAY3D,EAAO,GAAIA,EAAO,GAAID,EAAakB,gBAAiBlB,EAAaY,aAAc5R,EAAOha,KAAMga,EAAO/Z,IAAM+Z,EAAOna,QAI5I,MAAO+uB,IAiRXr0B,EAAOD,QAAU+f,IAEduJ,UAAU,EAAEsT,gBAAgB,EAAE9qB,QAAQ,GAAG0P,kBAAkB,GAAGqb,2BAA2B,GAAGC,oBAAoB,GAAGC,kBAAkB,GAAGlb,UAAU,GAAG1T,SAAW,IAAI6uB,IAAI,SAAS1zB,EAAQrJ,EAAOD,GAOnM,QAASi9B,GAAMjb,EAAKkb,EAAUxtB,GAC1B,GAAIytB,GAAgB,mBAAqB,IAAIC,eAC7C,KAAKF,EACD,MAAOtsB,SAAQqN,OAAO,sBAE1B,IAAIwI,GAAW4W,EAAeF,GAC1Blc,EAAMqc,EAAeJ,EAAUlb,EAAKyE,EAExC,OAAO0W,GAAeI,EAAItc,GAAQuc,EAAM9tB,EAAUuR,EAAKwF,GAAUzhB,KAAK,SAASy4B,GAC3E,MAAOC,GAASD,EAAS1G,WAKjC,QAAS4G,GAAS3b,EAAKkb,EAAUxtB,GAC7B,GAAIkuB,GAAqB,eAAiB,IAAIzb,OAC1CsE,EAAW4W,EAAeO,GAC1B3c,EAAMqc,EAAeJ,EAAUlb,EAAKyE,EACxC,OAAQmX,GAAoBhtB,QAAQC,QAAQoQ,GAAOuc,EAAM9tB,EAAUuR,EAAKwF,GAAUzhB,KAAK,SAASy4B,GAC5F,MAAO,QAAUA,EAASj0B,KAAO,WAAai0B,EAAS1G,UAI/D,QAASyG,GAAM9tB,EAAUuR,EAAKwF,GAC1B,MAAO,IAAI7V,SAAQ,SAASC,EAASoN,GACjC,GAAInV,GAAI4G,EAAStK,cAAc,UAC3By4B,EAAU,iBACHh2B,QAAOqV,YAAYc,MAAMyI,GAChC/W,EAAS9J,KAAKG,YAAY+C,GAE9BjB,QAAOqV,YAAYc,MAAMyI,GAAY,SAASgX,GAC1CI,IACAhtB,EAAQ4sB,IAEZ30B,EAAEkZ,IAAMf,EACRnY,EAAEsZ,QAAU,SAAS1Z,GACjBm1B,IACA5f,EAAOvV,IAEXgH,EAAS9J,KAAKC,YAAYiD,KAIlC,QAASu0B,GAAetW,GACpB,MAAQA,GAA0G,GAAhG,eAAiBxJ,KAAKC,MAAQ,OAASsgB,EAAc,IAAMvvB,KAAKoE,MAAsB,IAAhBpE,KAAKwvB,UAGjG,QAAST,GAAeJ,EAAUlb,EAAKyE,GACnC,MAAOyW,GAAW,QAAUc,mBAAmBhc,IAAQyE,EAAS5jB,OAAS,+BAAiC4jB,EAAW,IAGzH,QAASwX,GAAiBjc,GACtB,MAAO,UAASjd,GACZ,GAA8BhB,GAA1B+b,EAAS,GAAIoe,UACjB,KACIn6B,EAAM+b,EAAOqe,gBAAgBp5B,EAAM,aACrC,MAAM2D,GACJlE,EAAI,+DACJT,EAAM2L,SAAS0uB,eAAeC,mBAAmB,GACjD,KACIt6B,EAAI0N,OACJ1N,EAAI2N,MAAM3M,GACVhB,EAAI8N,QACN,MAAMysB,GACJ95B,EAAI,mFACJT,EAAI6B,KAAKyyB,UAAYtzB,GAI7B,GAAImN,GAAInO,EAAIkb,cAAc,OAC1B,KAAK/M,IAAMA,EAAEnK,KAAKw2B,KAAM,CACpB,GAAIrzB,GAAOnH,EAAIqB,cAAc,OAC7B8F,GAAKnD,KAAOia,EACZje,EAAIy6B,KAAKC,aAAavzB,EAAMnH,EAAIy6B,KAAK3uB,YAGzC,MAAO9L,IAIf,QAASqa,GAAgB4D,EAAKhE,EAAOtO,EAAUpK,EAAOC,EAAQvB,GAC1D,MAAO,IAAIi5B,GAAMjb,EAAKhE,EAAOnW,OAAO6H,UAAU1K,KAAKi5B,EAAiBjc,IAAMhd,KAAK,SAASjB,GACpF,MAAO+a,GAAkB/a,EAAK2L,EAAUpK,EAAOC,EAAQvB,EAAS,EAAG,KAxF3E,GAAIu5B,GAAMj0B,EAAQ,SACd8X,EAAQ9X,EAAQ,WAChB9E,EAAM8E,EAAQ,SACdwV,EAAoBxV,EAAQ,WAC5Bo0B,EAAWtc,EAAMsc,SAcjBI,EAAa,CA0EjB99B,GAAQi9B,MAAQA,EAChBj9B,EAAQ29B,SAAWA,EACnB39B,EAAQoe,gBAAkBA,IAEvBkD,UAAU,EAAExP,QAAQ,GAAG+P,UAAU,GAAG6c,QAAQ,KAAKC,IAAI,SAASr1B,EAAQrJ,EAAOD,GAGhF,QAASqlB,GAAoBrD,EAAKhE,GAC9B,GAAIkD,GAAOxR,SAAStK,cAAc,IAClC8b,GAAKnZ,KAAOia,EACZA,EAAMd,EAAKnZ,KACX3H,KAAK4hB,IAAMA,EACX5hB,KAAK8hB,MAAQ,GAAIC,MACjB,IAAI3gB,GAAOpB,IACXA,MAAK6hB,QAAU,GAAIrR,SAAQ,SAASC,EAASoN,GACzCzc,EAAK0gB,MAAM+C,YAAc,YACzBzjB,EAAK0gB,MAAMlR,OAASH,EACpBrP,EAAK0gB,MAAME,QAAUnE,EAErB,GAAI0f,GAAS3b,EAAKhE,EAAOtO,UAAU1K,KAAK,SAASic,GAC7Czf,EAAK0gB,MAAMF,IAAMf,IAClB,SAAShD,KAhBpB,GAAI0f,GAAWr0B,EAAQ,WAAWq0B,QAoBlC19B,GAAOD,QAAUqlB,IAEd3D,UAAU,KAAKkd,IAAI,SAASt1B,EAAQrJ,EAAOD,GAG9C,QAAS03B,GAAuBnoB,EAAMsa,EAAQrgB,GAC1C2X,EAAcxgB,KAAKP,KAAMmP,EAAMsa,GAC/BzpB,KAAKqqB,iBAAkB,EACvBrqB,KAAKisB,OAAkB,YAAT7iB,EALlB,GAAI2X,GAAgB7X,EAAQ,kBAQ5BouB,GAAuB71B,UAAU2pB,QAAU,SAAS1B,GAChD4N,EAAuB71B,UAAU2pB,QAAQ7qB,KAAKP,KAAM0pB,GACpDA,EAAMW,iBAAkB,EACxBX,EAAMuC,OAASjsB,KAAKisB,QAGxBqL,EAAuB71B,UAAYC,OAAOC,OAAOof,EAActf,WAE/D61B,EAAuB71B,UAAU81B,YAAc,WACvCv3B,KAAKisB,OACLjsB,KAAKypB,OAAOta,KAAKkvB,aAAar+B,KAAKmP,KAAMnP,KAAKypB,OAAOta,KAAKM,YAE1DzP,KAAKypB,OAAOta,KAAK1J,YAAYzF,KAAKmP,MAEtCnP,KAAKypB,OAAOta,KAAKiB,WAAa,IAAMpQ,KAAKy+B,gBAG7CnH,EAAuB71B,UAAUi2B,SAAW,WACxC13B,KAAKmP,KAAK4Q,WAAWpa,YAAY3F,KAAKmP,MACtCnP,KAAKypB,OAAOta,KAAKiB,UAAYpQ,KAAKypB,OAAOta,KAAKiB,UAAUrG,QAAQ/J,KAAKy+B,eAAgB,KAGzFnH,EAAuB71B,UAAUg9B,aAAe,WAC5C,MAAOz+B,MAAK,8BAAgCA,KAAKisB,OAAS,SAAW,WAGzEqL,EAAuB71B,UAAUq2B,iCAAmC,wCACpER,EAAuB71B,UAAUs2B,gCAAkC,uCAEnEl4B,EAAOD,QAAU03B,IAEdlW,kBAAkB,KAAKsd,IAAI,SAASx1B,EAAQrJ,EAAOD,GAGtD,QAAS++B,GAASz5B,EAAOC,EAAQqgB,EAAQ5hB,EAAS0L,GAC9CtP,KAAKkF,MAAQA,EACblF,KAAKmF,OAASA,EACdnF,KAAKwlB,OAASA,EACdxlB,KAAK4D,QAAUA,EACf5D,KAAKsP,SAAWA,EAPpB,GAAIlL,GAAM8E,EAAQ,QAUlBy1B,GAASl9B,UAAUy5B,YAAc,SAAS/qB,EAAWmP,EAAQ8U,EAAY+G,GACrE,GAAIyD,GAAczuB,EAAUqc,OAAO,eAC/BqS,EAAa1uB,EAAUqc,OAAO,cAC9BsS,EAAe3uB,EAAUqc,OAAO,gBAChCuS,EAAgB5uB,EAAUqc,OAAO,iBACjC7C,EAAUyK,EAAWzK,QAErBzkB,EAAQoa,EAAOpa,OAASykB,EAAQ,GAAGzkB,MAAQykB,EAAQ,GAAGzkB,MAAQ05B,EAAcE,GAC5E35B,EAASma,EAAOna,QAAUwkB,EAAQ,GAAGzkB,MAAQykB,EAAQ,GAAGzkB,MAAQ25B,EAAaE,EACjF/+B,MAAKsgB,UACD6a,EACA,EACA,EACAA,EAAerZ,MAAM5c,OAASA,EAC9Bi2B,EAAerZ,MAAM3c,QAAUA,EAC/Bma,EAAOha,KAAOs5B,EAAcjV,EAAQ,GAAGzkB,MACvCoa,EAAO/Z,IAAMs5B,EAAalV,EAAQ,GAAGzkB,MACrCA,EACAC,IAIRw5B,EAASl9B,UAAUs5B,iBAAmB,SAAS5qB,EAAWmP,EAAQ8U,GAC1D9U,EAAOna,OAAS,GAAKma,EAAOpa,MAAQ,IACpClF,KAAKg/B,sBAAsB7uB,EAAWmP,GACtCtf,KAAKi/B,sBAAsB9uB,EAAWmP,EAAQ8U,KAItDuK,EAASl9B,UAAUu9B,sBAAwB,SAAS7uB,EAAWmP,GAC3D,GAAIhM,GAAQnD,EAAUmD,MAAM,kBACvBA,GAAMd,iBACPxS,KAAKgvB,UAAU1P,EAAOha,KAAMga,EAAO/Z,IAAK+Z,EAAOpa,MAAOoa,EAAOna,OAAQmO,IAI7EqrB,EAASl9B,UAAUu5B,cAAgB,SAASrR,GACxCA,EAAQ7D,QAAQ9lB,KAAKk/B,aAAcl/B,OAGvC2+B,EAASl9B,UAAUy9B,aAAe,SAAS5b,GAClCA,EAAKhQ,MAAMd,iBAAiC,OAAd8Q,EAAKsC,MACpC5lB,KAAKm/B,UAAU7b,EAAKsC,KAAMtC,EAAKhQ,QAIvCqrB,EAASl9B,UAAUw9B,sBAAwB,SAAS9uB,EAAWmP,EAAQ8U,GACnE,GAAIlK,GAAmB/Z,EAAU+V,uBACjCgE,GAAiB1B,UAAU1C,QAAQ,SAASsZ,EAAiBnzB,EAAOspB,GAChE,OAAO6J,EAAgBvZ,QACvB,IAAK,MACD,GAAI/D,GAAQ9hB,KAAKwlB,OAAO4B,IAAIgY,EAAgBxZ,KAAK,GAC7C9D,GACA9hB,KAAKq/B,0BAA0BlvB,EAAWmP,EAAQwC,EAAOyT,EAAI9yB,QAAUwJ,EAAM,GAAImoB,GAEjFhwB,EAAI,iCAAkCg7B,EAAgBxZ,KAAK,GAE/D,MACJ,KAAK,kBACL,IAAK,WACD,GAAI0Z,GAAgBt/B,KAAKwlB,OAAO4B,IAAIgY,EAAgBv9B,MAChDy9B,GACAt/B,KAAKu/B,yBAAyBD,EAAehgB,EAAQ8U,GAErDhwB,EAAI,iCAAkCg7B,EAAgBxZ,KAAK,GAE/D,MACJ,KAAK,OACD,KACJ,SACIxhB,EAAI,gCAAiCg7B,EAAgBxZ,KAAK,MAE/D5lB,OAGP2+B,EAASl9B,UAAU49B,0BAA4B,SAASlvB,EAAWmP,EAAQ6b,EAAgBlvB,EAAOmoB,GAC9F,GAAI9R,GAAOnS,EAAU6c,oBAAoB1N,EAAQ6b,EAAerZ,MAAO7V,GACnE5G,EAAW8K,EAAUgd,wBAAwB7N,EAAQ6b,EAAerZ,MAAO7V,EAAOqW,GAClFkd,EAASrvB,EAAUkd,sBAAsBphB,EAC7C,QAAQuzB,GACR,IAAK,WACL,IAAK,mBACDx/B,KAAKy/B,sBAAsBtE,EAAgB91B,EAAUid,EAAMhD,EAAQA,EAAOha,KAAO8uB,EAAW,GAAI9U,EAAO/Z,IAAMF,EAASE,IAAM6uB,EAAW,GAAI,MAAO9R,EAAKnd,OAAQivB,EAC/J,MACJ,KAAK,WACL,IAAK,mBACDp0B,KAAKy/B,sBAAsBtE,EAAgB91B,EAAUid,EAAMhD,EAAQA,EAAOha,KAAOD,EAASC,KAAO8uB,EAAW,GAAI9U,EAAO/Z,IAAM6uB,EAAW,GAAI9R,EAAKpd,MAAO,MAAOkvB,EAC/J,MACJ,KAAK,YACDp0B,KAAKy/B,sBAAsBtE,EAAgB91B,EAAUid,EAAMhD,EAAQA,EAAOha,KAAOD,EAASC,KAAO8uB,EAAW,GAAI9U,EAAO/Z,IAAMF,EAASE,IAAM6uB,EAAW,GAAI9R,EAAKpd,MAAOod,EAAKnd,OAAQivB,EACpL,MACJ,SACIp0B,KAAK0/B,uBAAuBvE,EAAgB91B,EAAUid,GAAO/c,IAAK+Z,EAAO/Z,IAAKD,KAAMga,EAAOha,MAAO8uB,EAAW,GAAIA,EAAW,MAKpIv0B,EAAOD,QAAU++B,IAEdjtB,QAAQ,KAAKiuB,IAAI,SAASz2B,EAAQrJ,EAAOD,GAK5C,QAAS8d,GAAexY,EAAOC,GAC3Bw5B,EAASt2B,MAAMrI,KAAM6D,WACrB7D,KAAK6E,OAAS7E,KAAK4D,QAAQiB,QAAU7E,KAAKsP,SAAStK,cAAc,UAC5DhF,KAAK4D,QAAQiB,SACd7E,KAAK6E,OAAOK,MAAQA,EACpBlF,KAAK6E,OAAOM,OAASA,GAEzBnF,KAAK0G,IAAM1G,KAAK6E,OAAO8B,WAAW,MAClC3G,KAAK4/B,SAAW5/B,KAAKsP,SAAStK,cAAc,UAAU2B,WAAW,MACjE3G,KAAK0G,IAAIm5B,aAAe,SACxB7/B,KAAK8/B,aACL17B,EAAI,uCAAwCc,EAAO,IAAKC,GAiK5D,QAAS46B,GAAWv2B,GAChB,MAAOA,GAAM/G,OAAS,EAjL1B,GAAIk8B,GAAWz1B,EAAQ,eACnBkc,EAA0Blc,EAAQ,8BAClC9E,EAAM8E,EAAQ,SAgBlBwU,GAAejc,UAAYC,OAAOC,OAAOg9B,EAASl9B,WAElDic,EAAejc,UAAUu+B,aAAe,SAASC,GAE7C,MADAjgC,MAAK0G,IAAIu5B,UAAkC,YAAtB,mBAAOA,GAAP,YAAAh4B,EAAOg4B,KAA6BA,EAAUzsB,QAAUysB,EAAU5sB,WAAa4sB,EAC7FjgC,KAAK0G,KAGhBgX,EAAejc,UAAUutB,UAAY,SAAS1pB,EAAMC,EAAKL,EAAOC,EAAQmO,GACpEtT,KAAKggC,aAAa1sB,GAAO4sB,SAAS56B,EAAMC,EAAKL,EAAOC,IAGxDuY,EAAejc,UAAU+5B,OAAS,SAASl2B,EAAMC,EAAK+c,EAAMhP,GACxDtT,KAAKggC,aAAa1sB,GAClBtT,KAAK0G,IAAIy5B,YACTngC,KAAK0G,IAAI05B,IAAI96B,EAAOgd,EAAO,EAAG/c,EAAM+c,EAAO,EAAGA,EAAO,EAAG,EAAW,EAARnU,KAAKkyB,IAAM,GACtErgC,KAAK0G,IAAI45B,YACTtgC,KAAK0G,IAAI65B,QAGb7iB,EAAejc,UAAU85B,aAAe,SAASj2B,EAAMC,EAAK+c,EAAMhP,EAAOktB,EAAQC,GAC7EzgC,KAAKw7B,OAAOl2B,EAAMC,EAAK+c,EAAMhP,GAC7BtT,KAAK0G,IAAIg6B,YAAcD,EAAYptB,WACnCrT,KAAK0G,IAAI85B,UAGb9iB,EAAejc,UAAU09B,UAAY,SAASwB,EAAOrtB,GACjDtT,KAAK2gC,MAAMA,GACX3gC,KAAKggC,aAAa1sB,GAAOitB,QAG7B7iB,EAAejc,UAAUm/B,OAAS,SAASzF,GACvC,GAA+B,OAA3BA,EAAevW,QAAkB,CACjC5kB,KAAK4/B,SAAStf,UAAU6a,EAAerZ,MAAO,EAAG,EACjD,KACI9hB,KAAK4/B,SAAS74B,aAAa,EAAG,EAAG,EAAG,GACpCo0B,EAAevW,SAAU,EAC3B,MAAMtc,GACJtI,KAAK4/B,SAAWtwB,SAAStK,cAAc,UAAU2B,WAAW,MAC5Dw0B,EAAevW,SAAU,GAIjC,MAAOuW,GAAevW,SAG1BlH,EAAejc,UAAU6e,UAAY,SAAS6a,EAAgB0F,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GACjFphC,KAAK4gC,OAAOzF,KAAmBn7B,KAAK4D,QAAQ0Z,YAC7Ctd,KAAK0G,IAAI4Z,UAAU6a,EAAerZ,MAAO+e,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,IAI7E1jB,EAAejc,UAAUmoB,KAAO,SAASyX,EAAQhb,EAAU4P,GACvDj2B,KAAK0G,IAAIg0B,OACT2G,EAAOlb,OAAO4Z,GAAYja,QAAQ,SAAS6a,GACvC3gC,KAAK2gC,MAAMA,GAAO/W,QACnB5pB,MACHqmB,EAAS9lB,KAAK01B,GACdj2B,KAAK0G,IAAI4zB,WAGb5c,EAAejc,UAAUk/B,MAAQ,SAASA,GAUtC,MATA3gC,MAAK0G,IAAIy5B,YACTQ,EAAM7a,QAAQ,SAASwb,EAAOr1B,GACT,SAAbq1B,EAAM,GACNthC,KAAK0G,IAAI66B,KAAKl5B,MAAMrI,KAAK0G,IAAK46B,EAAM/zB,MAAM,IAE1CvN,KAAK0G,IAAe,IAAVuF,EAAe,SAAWq1B,EAAM,GAAK,MAAOj5B,MAAMrI,KAAK0G,IAAK46B,EAAM/zB,MAAM,KAEvFvN,MACHA,KAAK0G,IAAI45B,YACFtgC,KAAK0G,KAGhBgX,EAAejc,UAAU65B,KAAO,SAAShoB,EAAOlO,EAAOo8B,EAAS9U,EAAQpK,EAAMD,GAC1EriB,KAAKggC,aAAa1sB,GAAOgoB,MAAQl2B,EAAOo8B,EAAS9U,EAAQpK,EAAMD,GAAQlY,KAAK,KAAKL,MAAM,KAAK,IAGhG4T,EAAejc,UAAUu6B,WAAa,SAAS1oB,EAAOsa,EAASC,EAASC,GACpE9tB,KAAKyhC,YAAY,cAAenuB,EAAMD,YACjCouB,YAAY,gBAAiB7T,GAC7B6T,YAAY,gBAAiB5T,GAC7B4T,YAAY,aAAc3T,IAGnCpQ,EAAejc,UAAUw6B,YAAc,WACnCj8B,KAAKyhC,YAAY,cAAe,kBAGpC/jB,EAAejc,UAAUg5B,WAAa,SAASnQ,GAC3CtqB,KAAK0G,IAAIg7B,YAAcpX,GAG3B5M,EAAejc,UAAUk5B,aAAe,SAAStM,GAC7CruB,KAAK0G,IAAIi7B,UAAUtT,EAAUtJ,OAAO,GAAIsJ,EAAUtJ,OAAO,IACzD/kB,KAAK0G,IAAI2nB,UAAUhmB,MAAMrI,KAAK0G,IAAK2nB,EAAUF,QAC7CnuB,KAAK0G,IAAIi7B,WAAWtT,EAAUtJ,OAAO,IAAKsJ,EAAUtJ,OAAO,KAG/DrH,EAAejc,UAAUggC,YAAc,SAAS1U,EAAUlrB,GAKtD,MAJI7B,MAAK8/B,UAAU/S,KAAclrB,IAC7B7B,KAAK8/B,UAAU/S,GAAY/sB,KAAK0G,IAAIqmB,GAAYlrB,GAG7C7B,MAGX0d,EAAejc,UAAUipB,KAAO,SAASA,EAAMplB,EAAMa,GACjDnG,KAAK0G,IAAIk7B,SAASlX,EAAMplB,EAAMa,IAGlCuX,EAAejc,UAAUg+B,sBAAwB,SAAStE,EAAgB0G,EAAoBvf,EAAMhD,EAAQha,EAAMC,EAAKL,EAAOC,EAAQivB,GAClI,GAAIuM,KACC,OAAQxyB,KAAKoE,MAAMjN,GAAO6I,KAAKoE,MAAMhN,KACrC,OAAQ4I,KAAKoE,MAAMjN,EAAOJ,GAAQiJ,KAAKoE,MAAMhN,KAC7C,OAAQ4I,KAAKoE,MAAMjN,EAAOJ,GAAQiJ,KAAKoE,MAAMpN,EAASI,KACtD,OAAQ4I,KAAKoE,MAAMjN,GAAO6I,KAAKoE,MAAMpN,EAASI,IAEnDvF,MAAK4pB,MAAM+W,GAAQ,WACf3gC,KAAK0/B,uBAAuBvE,EAAgB0G,EAAoBvf,EAAMhD,EAAQ8U,EAAW,GAAIA,EAAW,KACzGp0B,OAGP0d,EAAejc,UAAUi+B,uBAAyB,SAASvE,EAAgB0G,EAAoBvf,EAAMhD,EAAQwiB,EAAYC,GACrH,GAAInU,GAAUzf,KAAKoE,MAAM+M,EAAOha,KAAOu8B,EAAmBv8B,KAAOw8B,GAAajU,EAAU1f,KAAKoE,MAAM+M,EAAO/Z,IAAMs8B,EAAmBt8B,IAAMw8B,EACzI/hC,MAAKggC,aAAahgC,KAAK0G,IAAIs7B,cAAchiC,KAAKiiC,YAAY9G,EAAgB7Y,GAAO,WACjFtiB,KAAK0G,IAAIi7B,UAAU/T,EAASC,GAC5B7tB,KAAK0G,IAAI65B,OACTvgC,KAAK0G,IAAIi7B,WAAW/T,GAAUC,IAGlCnQ,EAAejc,UAAU89B,yBAA2B,SAASD,EAAehgB,GACxE,GAAIggB,YAAyBla,GAAyB,CAClD,GAAI8c,GAAWliC,KAAK0G,IAAIy7B,qBACpB7iB,EAAOha,KAAOga,EAAOpa,MAAQo6B,EAAcnb,GAC3C7E,EAAO/Z,IAAM+Z,EAAOna,OAASm6B,EAAclb,GAC3C9E,EAAOha,KAAQga,EAAOpa,MAAQo6B,EAAcrf,GAC5CX,EAAO/Z,IAAO+Z,EAAOna,OAASm6B,EAAclf,GAChDkf,GAAcpb,WAAW4B,QAAQ,SAAS8C,GACtCsZ,EAASE,aAAaxZ,EAAUG,KAAMH,EAAUtV,MAAMD,cAE1DrT,KAAKgvB,UAAU1P,EAAOha,KAAMga,EAAO/Z,IAAK+Z,EAAOpa,MAAOoa,EAAOna,OAAQ+8B,KAI7ExkB,EAAejc,UAAUwgC,YAAc,SAAS9G,EAAgB7Y,GAC5D,GAAIR,GAAQqZ,EAAerZ,KAC3B,IAAGA,EAAM5c,QAAUod,EAAKpd,OAAS4c,EAAM3c,SAAWmd,EAAKnd,OACnD,MAAO2c,EAGX,IAAIpb,GAAK7B,EAASyK,SAAStK,cAAc,SAKzC,OAJAH,GAAOK,MAAQod,EAAKpd,MACpBL,EAAOM,OAASmd,EAAKnd,OACrBuB,EAAM7B,EAAO8B,WAAW,MACxBD,EAAI4Z,UAAUwB,EAAO,EAAG,EAAGA,EAAM5c,MAAO4c,EAAM3c,OAAQ,EAAG,EAAGmd,EAAKpd,MAAOod,EAAKnd,QACtEN,GAOXhF,EAAOD,QAAU8d,IAEd2kB,6BAA6B,GAAGC,SAAS,GAAGC,cAAc,KAAKC,IAAI,SAASt5B,EAAQrJ,EAAOD,GAG9F,QAASkvB,GAAgB6J,EAAgBrO,EAASqE,EAASlF,GACvD1I,EAAcxgB,KAAKP,KAAM2uB,EAASlF,GAClCzpB,KAAKyiC,YAAc9J,EACnB34B,KAAKo2B,YACLp2B,KAAKwrB,YACLxrB,KAAKsqB,SAAWtqB,KAAKypB,OAASzpB,KAAKypB,OAAOC,MAAMY,QAAU,GAAKA,EAPnE,GAAIvJ,GAAgB7X,EAAQ,kBAU5B4lB,GAAgBrtB,UAAYC,OAAOC,OAAOof,EAActf,WAExDqtB,EAAgBrtB,UAAUo3B,eAAiB,SAAS5C,GAChD,GAAI2C,GAAe54B,KAAKypB,OAAUzpB,KAAKypB,OAAOC,MAAQ,IACtD,OAAOkP,GAAeA,EAAY6J,YAAc7J,EAAcA,EAAYC,eAAe5C,GAAYA,EAAQvM,OAGjH7pB,EAAOD,QAAUkvB,IAEd1N,kBAAkB,KAAKshB,IAAI,SAASx5B,EAAQrJ,EAAOD,GACtD,QAASuf,GAAQ7P,GACbtP,KAAKm5B,YAAcn5B,KAAK2iC,gBAAgBrzB,GACxCtP,KAAK2kB,KAAO3kB,KAAK4iC,WACjB5iC,KAAKymB,IAAMzmB,KAAK6iC,UAGpB1jB,EAAQ1d,UAAUkhC,gBAAkB,SAASrzB,GACzC,GAAIsf,GAAOkU,EAAa3J,EAAa4J,EAAa7jB,GAAU,CAqB5D,OAnBI5P,GAASoqB,cACT9K,EAAQtf,EAASoqB,cACb9K,EAAMiL,wBACNiJ,EAAcxzB,EAAStK,cAAc,aACrC89B,EAAY19B,MAAMD,OAAS,QAC3B29B,EAAY19B,MAAMgzB,QAAU,QAC5B9oB,EAAS9J,KAAKC,YAAYq9B,GAE1BlU,EAAMoU,WAAWF,GACjB3J,EAAcvK,EAAMiL,wBACpBkJ,EAAc5J,EAAYh0B,OAEN,MAAhB49B,IACA7jB,GAAU,GAEd5P,EAAS9J,KAAKG,YAAYm9B,KAI3B5jB,GAGXC,EAAQ1d,UAAUmhC,SAAW,WACzB,MAA6C,oBAA9B,GAAI7gB,QAAS8C,aAGhC1F,EAAQ1d,UAAUohC,QAAU,WACxB,GAAIpgB,GAAM,GAAIV,OACVld,EAASyK,SAAStK,cAAc,UAChC0B,EAAO7B,EAAO8B,WAAW,KAC7B8b,GAAIb,IAAM,mEAEV,KACIlb,EAAI4Z,UAAUmC,EAAK,EAAG,GACtB5d,EAAO2C,YACT,MAAMc,GACJ,OAAO,EAEX,OAAO,GAGXzI,EAAOD,QAAUuf,OAEX8jB,IAAI,SAAS/5B,EAAQrJ,EAAOD,GAIlC,QAASslB,GAAatD,GAClB5hB,KAAK4hB,IAAMA,EACX5hB,KAAK8hB,MAAQ,IACb,IAAI1gB,GAAOpB,IAEXA,MAAK6hB,QAAU7hB,KAAKkjC,YAAYt+B,KAAK,WACjC,MAAQxD,GAAKwlB,SAAShF,GAAOpR,QAAQC,QAAQrP,EAAK+hC,iBAAiBvhB,IAAQub,EAAIvb,KAChFhd,KAAK,SAAS6hB,GACb,MAAO,IAAIjW,SAAQ,SAASC,GACxBhJ,OAAOqV,YAAY2J,IAAI2c,OAAOC,kBAAkB5c,EAAKrlB,EAAKkiC,aAAa/iC,KAAKa,EAAMqP,QAZ9F,GAAI0sB,GAAMj0B,EAAQ,SACdo0B,EAAWp0B,EAAQ,WAAWo0B,QAgBlCpY,GAAazjB,UAAUyhC,UAAY,WAC/B,MAAQz7B,QAAOqV,YAAY2J,KAAQhf,OAAOqV,YAAY2J,IAAI2c,OAA4F5yB,QAAQC,UAA3FD,QAAQqN,OAAO,GAAI/U,OAAM,yDAGhGoc,EAAazjB,UAAU0hC,iBAAmB,SAASvhB,GAC/C,MAAQ,gCAAgCtU,KAAKsU,GAAQ5hB,KAAKs9B,SAASt9B,KAAKujC,kBAAkB3hB,IAAQ5hB,KAAKujC,kBAAkB3hB,IAG7HsD,EAAazjB,UAAU8hC,kBAAoB,SAAS3hB,GAChD,MAAOA,GAAI7X,QAAQ,mCAAmC,KAG1Dmb,EAAazjB,UAAUmlB,SAAW,SAAShF,GACvC,MAAQ,yBAAyBtU,KAAKsU,IAG1CsD,EAAazjB,UAAU6hC,aAAe,SAAS7yB,GAC3C,GAAIrP,GAAOpB,IACX,OAAO,UAAUwjC,EAAS5/B,GACtB,GAAIiB,GAAS,GAAI4C,QAAOqV,YAAY2J,IAAI2c,OAAOK,aAAa,IAC5DriC,GAAK0gB,MAAQjd,EAAO6+B,cACpB7+B,EACK8+B,SAAS//B,EAAQsB,OACjB0+B,UAAUhgC,EAAQuB,QAClB0+B,IAAIp8B,OAAOqV,YAAY2J,IAAI2c,OAAOU,KAAKC,iBAAiBP,EAAS5/B,IACjEogC,YACLvzB,EAAQ5L,EAAO6+B,iBAIvBxe,EAAazjB,UAAU67B,SAAW,SAASrS,GACvC,MAAgC,kBAAjBxjB,QAAOw8B,KAAwBx8B,OAAOw8B,KAAKhZ,GAAOqS,EAASrS,IAG9EprB,EAAOD,QAAUslB,IAEdzD,UAAU,GAAG6c,QAAQ,KAAK4F,IAAI,SAASh7B,EAAQrJ,EAAOD,GAGzD,QAASulB,GAAiBhW,EAAMg1B,GAC5BnkC,KAAK4hB,IAAMzS,EACXnP,KAAK8hB,MAAQ,IACb,IAAI1gB,GAAOpB,IAEXA,MAAK6hB,QAAUsiB,EAAU,GAAI3zB,SAAQ,SAASC,EAASoN,GACnDzc,EAAK0gB,MAAQ,GAAIC,OACjB3gB,EAAK0gB,MAAMlR,OAASH,EACpBrP,EAAK0gB,MAAME,QAAUnE,EACrBzc,EAAK0gB,MAAMF,IAAM,uBAAyB,GAAIwiB,gBAAiBC,kBAAkBl1B,GAC7E/N,EAAK0gB,MAAMI,YAAa,GACxBzR,EAAQrP,EAAK0gB,SAEhB9hB,KAAKkjC,YAAYt+B,KAAK,WACvB,MAAO,IAAI4L,SAAQ,SAASC,GACxBhJ,OAAOqV,YAAY2J,IAAI2c,OAAOkB,iBAAiBn1B,EAAM/N,EAAKkiC,aAAa/iC,KAAKa,EAAMqP,QAjB9F,GAAIyU,GAAehc,EAAQ,iBAsB3Bic,GAAiB1jB,UAAYC,OAAOC,OAAOujB,EAAazjB,WAExD5B,EAAOD,QAAUulB,IAEd+C,iBAAiB,KAAKqc,IAAI,SAASr7B,EAAQrJ,EAAOD,GAGrD,QAASy3B,GAAcloB,EAAMsa,GACzB1I,EAAcxgB,KAAKP,KAAMmP,EAAMsa,GAuBnC,QAAS+a,GAAWhkC,EAAGikC,EAAIC,GACvB,GAAIlkC,EAAEiC,OAAS,EACX,MAAOgiC,GAAKC,EAAGpY,cA5BvB,GAAIvL,GAAgB7X,EAAQ,kBAM5BmuB,GAAc51B,UAAYC,OAAOC,OAAOof,EAActf,WAEtD41B,EAAc51B,UAAUo6B,mBAAqB,WACzC77B,KAAKmP,KAAKmU,KAAOtjB,KAAKquB,UAAUruB,KAAKypB,OAAOmC,IAAI,mBAGpDyL,EAAc51B,UAAU4sB,UAAY,SAASA,GACzC,GAAI3D,GAAO1qB,KAAKmP,KAAKmU,IACrB,QAAO+K,GACH,IAAK,YACD,MAAO3D,GAAKld,aAChB,KAAK,aACD,MAAOkd,GAAK3gB,QAAQ,2BAA4By6B,EACpD,KAAK,YACD,MAAO9Z,GAAK4B,aAChB,SACI,MAAO5B,KAUnB7qB,EAAOD,QAAUy3B,IAEdjW,kBAAkB,KAAKujB,IAAI,SAASz7B,EAAQrJ,EAAOD,GACtDA,EAAQqiB,WAAa,WACjB,MAAO,kFAGXriB,EAAQ0E,KAAO,SAAS+hB,EAAU4P,GAC9B,MAAO,YACH,MAAO5P,GAAShe,MAAM4tB,EAASpyB,aAYvCjE,EAAQ09B,SAAW,SAASsH,GACxB,GACyBpiC,GAAGqiC,EAAUC,EAAUC,EAAUC,EAAUC,EAAOC,EAAOC,EAD9EC,EAAQ,mEACRC,EAAMT,EAAOniC,OAEb6H,EAAS,EAEb,KAAK9H,EAAI,EAAGA,EAAI6iC,EAAK7iC,GAAG,EACpBqiC,EAAWO,EAAMra,QAAQ6Z,EAAOpiC,IAChCsiC,EAAWM,EAAMra,QAAQ6Z,EAAOpiC,EAAE,IAClCuiC,EAAWK,EAAMra,QAAQ6Z,EAAOpiC,EAAE,IAClCwiC,EAAWI,EAAMra,QAAQ6Z,EAAOpiC,EAAE,IAElCyiC,EAASJ,GAAY,EAAMC,GAAY,EACvCI,GAAqB,GAAXJ,IAAkB,EAAMC,GAAY,EAC9CI,GAAqB,EAAXJ,IAAiB,EAAKC,EAE5B16B,GADa,KAAby6B,EACU32B,OAAOC,aAAa42B,GACV,KAAbD,GAAmBA,OAChB52B,OAAOC,aAAa42B,EAAOC,GAE3B92B,OAAOC,aAAa42B,EAAOC,EAAOC,EAIpD,OAAO76B,IAGX1K,EAAQ2f,UAAY,SAASpQ,GACzB,GAAIA,EAAK0qB,sBAAuB,CAC5B,GAAIyL,GAAan2B,EAAK0qB,wBAClB30B,EAA4B,MAApBiK,EAAKqR,YAAsB8kB,EAAWpgC,MAAQiK,EAAKqR,WAC/D,QACIjb,IAAK+/B,EAAW//B,IAChBY,OAAQm/B,EAAWn/B,QAAWm/B,EAAW//B,IAAM+/B,EAAWngC,OAC1De,MAAOo/B,EAAWhgC,KAAOJ,EACzBI,KAAMggC,EAAWhgC,KACjBJ,MAAQA,EACRC,OAA6B,MAArBgK,EAAKwR,aAAuB2kB,EAAWngC,OAASgK,EAAKwR,cAGrE,UAGJ/gB,EAAQkqB,aAAe,SAAS3a,GAC5B,GAAIsa,GAASta,EAAKo2B,aAAe3lC,EAAQkqB,aAAa3a,EAAKo2B,eAAiBhgC,IAAK,EAAGD,KAAM,EAE1F,QACIC,IAAK4J,EAAK8T,UAAYwG,EAAOlkB,IAC7BY,OAAQgJ,EAAK8T,UAAY9T,EAAKwR,aAAe8I,EAAOlkB,IACpDW,MAAOiJ,EAAKq2B,WAAa/b,EAAOnkB,KAAO6J,EAAKqR,YAC5Clb,KAAM6J,EAAKq2B,WAAa/b,EAAOnkB,KAC/BJ,MAAOiK,EAAKqR,YACZrb,OAAQgK,EAAKwR,eAIrB/gB,EAAQurB,iBAAmB,SAASiU,GAChC,GACIvZ,GAAQ4f,EAAYrZ,EAAQsZ,EAAUC,EACdC,EAAOhgB,EAF/BigB,EAAa,UACgCrY,KAC7CsY,EAAO,EAAGC,EAAW,EACrBC,EAAe,WACZngB,IACiC,MAA5B4f,EAAWpZ,OAAO,EAAG,KACrBoZ,EAAaA,EAAWpZ,OAAO,EAAGoZ,EAAWhjC,OAAS,IAEtDgjC,GACA7f,EAAKnb,KAAKg7B,GAEc,MAAxB5f,EAAOwG,OAAO,EAAG,KAAeqZ,EAAW7f,EAAOkF,QAAQ,IAAK,GAAM,GAAK,IAC1EqB,EAASvG,EAAOwG,OAAO,EAAGqZ,GAC1B7f,EAASA,EAAOwG,OAAOqZ,IAE3BlY,EAAQ/iB,MACJ2hB,OAAQA,EACRvG,OAAQA,EAAOrY,cACf3L,MAAO8jC,EACP/f,KAAMA,EACN9D,MAAO;IAGf8D,KACAC,EAASuG,EAASqZ,EAAaE,EAAQ,GAoE3C,OAlEA/f,MACAC,EAASuG,EAASqZ,EAAaE,EAAQ,GACvCvG,EAAgBt1B,MAAM,IAAIgc,QAAQ,SAASrlB,GACvC,KAAa,IAATqlC,GAAcD,EAAW9a,QAAQtqB,OAArC,CAGA,OAAOA,GACP,IAAK,IACGmlC,EAEMA,IAAUnlC,IAChBmlC,EAAQ,MAFRA,EAAQnlC,CAIZ,MACJ,KAAK,IACD,GAAGmlC,EACC,KACG,IAAY,IAATE,EAGN,MAFAA,GAAO,OACPH,GAASllC,EAGTslC,IAEJ,MACJ,KAAK,IACD,GAAIH,EACA,KACG,IAAY,IAATE,EAAY,CAClB,GAAgB,IAAbC,EAIC,MAHAD,GAAO,EACPH,GAASllC,MACTulC,IAGAD,KAGR,KAEJ,KAAK,IACD,GAAIH,EACA,KACG,IAAY,IAATE,EAEN,WADAE,IAEG,IAAa,IAATF,GACU,IAAbC,IAAmBlgB,EAAO/S,MAAM,UAIhC,MAHA8S,GAAKnb,KAAKg7B,GACVA,EAAa,QACbE,GAASllC,GAOrBklC,GAASllC,EACI,IAATqlC,EACAjgB,GAAUplB,EAEVglC,GAAchlC,KAItBulC,IACOxY,QAGLyY,IAAI,SAAS/8B,EAAQrJ,EAAOD,GAGlC,QAASylB,GAAwBpB,GAC7BD,EAAkB3b,MAAMrI,KAAM6D,WAC9B7D,KAAKoJ,KAA6B,WAAtB6a,EAAU2B,KAAK,GAAkB5B,EAAkBK,MAAMC,OAASN,EAAkBK,MAAME,OAJ1G,GAAIP,GAAoB9a,EAAQ,sBAOhCmc,GAAwB5jB,UAAYC,OAAOC,OAAOqiB,EAAkBviB,WAEpE5B,EAAOD,QAAUylB,IAEd8D,sBAAsB,IAAI+c,IAAI,SAASh9B,EAAQrJ,EAAOD,GACzD,QAASu9B,GAAItc,GACT,MAAO,IAAIrQ,SAAQ,SAASC,EAASoN,GACjC,GAAIsoB,GAAM,GAAInJ,eACdmJ,GAAI90B,KAAK,MAAOwP,GAEhBslB,EAAIv1B,OAAS,WACU,MAAfu1B,EAAIC,OACJ31B,EAAQ01B,EAAIE,cAEZxoB,EAAO,GAAI/U,OAAMq9B,EAAIG,cAI7BH,EAAInkB,QAAU,WACVnE,EAAO,GAAI/U,OAAM,mBAGrBq9B,EAAII,SAIZ1mC,EAAOD,QAAUu9B,YAEN,IAAI,OHh9Fe58B,KAAKX,EAAU,WAAa,MAAOI,WAI3D,SAASH,EAAQD,GAEtB,YAQA,SAASmB,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCANhHQ,OAAOS,eAAevC,EAAS,cAC7BiC,OAAO,GAGT,IAAIO,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIC,GAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,GAAIE,GAAaH,EAAMC,EAAIE,GAAWZ,WAAaY,EAAWZ,aAAc,EAAOY,EAAWV,cAAe,EAAU,SAAWU,KAAYA,EAAWX,UAAW,GAAML,OAAOS,eAAeG,EAAQI,EAAWC,IAAKD,IAAiB,MAAO,UAAUzB,EAAa2B,EAAYC,GAAiJ,MAA9HD,IAAYP,EAAiBpB,EAAYQ,UAAWmB,GAAiBC,GAAaR,EAAiBpB,EAAa4B,GAAqB5B,MI/gB5gBulC,EJuhBH,WACf,QAASA,KACPzlC,EAAgBf,KAAMwmC,GAgDxB,MA7CApkC,GAAaokC,IACX7jC,IAAK,UAMLd,MAAO,WI7hBR,MAAO,MJuiBNc,IAAK,UACLd,MAAO,WIhiBR,MAAO7B,MAAKmE,cJ2iBXxB,IAAK,MACLd,MAAO,SIpiBN85B,GAAkB,GAAA8K,EACpB,IAAKzmC,KAAK0mC,UAAV,CADoB,OAAAC,GAAA9iC,UAAApB,OAANmjB,EAAMlT,MAAAi0B,EAAA,EAAAA,EAAA,KAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAANhhB,EAAMghB,EAAA,GAAA/iC,UAAA+iC,IAKpBH,EAAAnd,SAAQllB,IAARiE,MAAAo+B,GAAezmC,KAAK6mC,UAApB,KAAkClL,GAAlChW,OAAgDC,SJ8iB1C4gB,IAGT5mC,cI5kBoB4mC,EJ6kBpB3mC,EAAOD,QAAUA,EAAQ,YAIpB,SAASC,EAAQD,EAASM,GAE/B,YAgBA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAEhH,QAASC,GAA2BC,EAAMb,GAAQ,IAAKa,EAAQ,KAAM,IAAIC,gBAAe,4DAAgE,QAAOd,GAAyB,gBAATA,IAAqC,kBAATA,GAA8Ba,EAAPb,EAElO,QAASe,GAAUC,EAAUC,GAAc,GAA0B,kBAAfA,IAA4C,OAAfA,EAAuB,KAAM,IAAIN,WAAU,iEAAoEM,GAAeD,GAASE,UAAYC,OAAOC,OAAOH,GAAcA,EAAWC,WAAaG,aAAeC,MAAON,EAAUO,YAAY,EAAOC,UAAU,EAAMC,cAAc,KAAeR,IAAYE,OAAOO,eAAiBP,OAAOO,eAAeV,EAAUC,GAAcD,EAASW,UAAYV,GApBjeE,OAAOS,eAAevC,EAAS,cAC7BiC,OAAO,GAGT,IAAIO,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIC,GAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,GAAIE,GAAaH,EAAMC,EAAIE,GAAWZ,WAAaY,EAAWZ,aAAc,EAAOY,EAAWV,cAAe,EAAU,SAAWU,KAAYA,EAAWX,UAAW,GAAML,OAAOS,eAAeG,EAAQI,EAAWC,IAAKD,IAAiB,MAAO,UAAUzB,EAAa2B,EAAYC,GAAiJ,MAA9HD,IAAYP,EAAiBpB,EAAYQ,UAAWmB,GAAiBC,GAAaR,EAAiBpB,EAAa4B,GAAqB5B,MK7lBjiB+B,EAAA9C,EAAA,GLimBK+C,EAAetC,EAAuBqC,GKhmB3C8jC,EAAA5mC,EAAA,GLomBK6mC,EAASpmC,EAAuBmmC,GK9lBhBE,EL4mBF,SAAUtjC,GKtmB3B,QAAAsjC,GAAYrjC,EAAKkB,GAA0B,GAAlBoiC,GAAkBpjC,UAAApB,QAAA,GAAAqB,SAAAD,UAAA,IAAAA,UAAA,EAAA9C,GAAAf,KAAAgnC,EAAA,IAAAjjC,GAAA5C,EAAAnB,MAAAgnC,EAAA9kC,WAAAR,OAAAsC,eAAAgjC,IAAAzmC,KAAAP,MAGzC+D,GAAKmjC,aAAenjC,EAAKmjC,aAAa5iC,KAAlBP,GACpBA,EAAKojC,aAAepjC,EAAKojC,aAAa7iC,KAAlBP,GACpBA,EAAKqjC,WAAarjC,EAAKqjC,WAAW9iC,KAAhBP,GAClBA,EAAKsjC,SAAWtjC,EAAKsjC,SAAS/iC,KAAdP,GAEhBA,EAAKE,UAAYN,EACjBI,EAAKe,QAAUD,EACfd,EAAKujC,OAASziC,EAAOK,MACrBnB,EAAKwjC,QAAU1iC,EAAOM,OACtBpB,EAAKyjC,KAAO3iC,EAAO8B,WAAW,MAC9B5C,EAAKI,WAAa8iC,CAElB,IAAMtiC,GAAOZ,EAAKE,UAAUuB,KAAKua,UAfQ,OAiBzChc,GAAK0jC,SAAW9iC,EAAKse,UACrBlf,EAAK2jC,UAAY/iC,EAAK6gC,WAEtBzhC,EAAK4jC,QAAS,EACd5jC,EAAK6jC,OAAS,KACd7jC,EAAK8jC,WAAY,EACjB9jC,EAAK+jC,UAAY,EACjB/jC,EAAKgkC,UAAY,EAEjBhkC,EAAKK,IAAI,eAETL,EAAKikC,YACLjkC,EAAKkkC,cAELlkC,EAAKmkC,UAAY,GACjBp3B,YAAY,WACV/M,EAAKokC,QACJpkC,EAAKmkC,WAlCiCnkC,ELm8B1C,MA5VAzC,GAAU0lC,EAAatjC,GAuDvBtB,EAAa4kC,IACXrkC,IAAK,UACLd,MAAO,WKtnBR,MAAO,iBL0nBNc,IAAK,eACLd,MAAO,SKxnBGyG,GAAG,GACNs/B,GAAW5nC,KAAX4nC,OACFQ,EAAQpoC,KAAKqoC,SAAS//B,GACtBggC,EAAKF,EAAMphC,EACXuhC,EAAKH,EAAMnhC,CACjBjH,MAAK2nC,QAAS,EACVC,EAAOY,SAASF,EAAIC,KACtBvoC,KAAK8nC,UAAYQ,EAAKV,EAAOa,GAC7BzoC,KAAK+nC,UAAYQ,EAAKX,EAAOc,GAC7B1oC,KAAK6nC,WAAY,EAEjB7nC,KAAKoE,IAAI,qCAAsCkkC,EAAIC,IAGrDvoC,KAAK2oC,eAAiB3oC,KAAK4nC,OAAOgB,wBAAwBR,EAAMphC,EAAGohC,EAAMnhC,ML4nBxEtE,IAAK,eACLd,MAAO,SK1nBGyG,GAAG,GACNs/B,GAAoB5nC,KAApB4nC,OAAQ9iC,EAAY9E,KAAZ8E,QACVsjC,EAAQpoC,KAAKqoC,SAAS//B,GACtBugC,EAAOjB,EAAOa,GACdK,EAAOlB,EAAOc,GACdJ,EAAKF,EAAMphC,EACXuhC,EAAKH,EAAMnhC,EACX8hC,EAAcnB,EAAOgB,wBAAwBN,EAAIC,EACvD,QAAQQ,GACN,IAAK,GACHjkC,EAAQM,MAAM4jC,OAAS,WACvB,MACF,KAAK,GACHlkC,EAAQM,MAAM4jC,OAAS,UACvB,MACF,KAAK,GACHlkC,EAAQM,MAAM4jC,OAAS,WACvB,MACF,KAAK,GACHlkC,EAAQM,MAAM4jC,OAAS,UACvB,MACF,KAAK,GACHlkC,EAAQM,MAAM4jC,OAAS,UACvB,MACF,KAAK,GACHlkC,EAAQM,MAAM4jC,OAAS,WACvB,MACF,KAAK,GACHlkC,EAAQM,MAAM4jC,OAAS,UACvB,MACF,KAAK,GACHlkC,EAAQM,MAAM4jC,OAAS,WACvB,MACF,SACElkC,EAAQM,MAAM4jC,OAAS,OAG3B,GAAIhpC,KAAK2oC,kBAAmB,EAAO,CAEjC,OAAQ3oC,KAAK2oC,gBACX,IAAK,GACHf,EAAOa,GAAKH,EACZV,EAAOc,GAAKH,EACZX,EAAOqB,IAAMJ,EAAOP,EACpBV,EAAOsB,IAAMJ,EAAOP,CACpB,MACF,KAAK,GACHX,EAAOc,GAAKH,EACZX,EAAOsB,IAAMJ,EAAOP,CACpB,MACF,KAAK,GACHX,EAAOc,GAAKH,EACZX,EAAOqB,GAAKX,EAAKO,EACjBjB,EAAOsB,IAAMJ,EAAOP,CACpB,MACF,KAAK,GACHX,EAAOa,GAAKH,EACZV,EAAOqB,IAAMJ,EAAOP,CACpB,MACF,KAAK,GACHV,EAAOqB,GAAKX,EAAKO,CACjB,MACF,KAAK,GACHjB,EAAOa,GAAKH,EACZV,EAAOqB,IAAMJ,EAAOP,EACpBV,EAAOsB,GAAKX,EAAKO,CACjB,MACF,KAAK,GACHlB,EAAOsB,GAAKX,EAAKO,CACjB,MACF,KAAK,GACHlB,EAAOqB,GAAKX,EAAKO,EACjBjB,EAAOsB,GAAKX,EAAKO,EAKrB9oC,KAAK2nC,QAAS,MACL3nC,MAAK6nC,YAGd7nC,KAAK4nC,OAAOa,GAAKL,EAAMphC,EAAIhH,KAAK8nC,UAChC9nC,KAAK4nC,OAAOc,GAAKN,EAAMnhC,EAAIjH,KAAK+nC,UAChC/nC,KAAK2nC,QAAS,MLkoBfhlC,IAAK,aACLd,MAAO,WK5nBR7B,KAAK6nC,WAAY,EACjB7nC,KAAK2oC,gBAAiB,EACtB3oC,KAAKoE,IAAI,wBLqoBRzB,IAAK,WACLd,MAAO,SKhoBDsnC,GACP,KAAIA,EAAIC,QAAQ3mC,OAAS,GAAmB,aAAb0mC,EAAI//B,MAAuB+/B,EAAIC,QAAQ3mC,OAAS,GAA/E,CAIA,GAAM4mC,GAASrpC,KAAKiE,UAAUqlC,YAAY,eACtClgC,EAAO,KACPmgC,EAAQ,IAEZ,QAAQJ,EAAI//B,MACV,IAAK,aACHA,EAAO,YACPmgC,EAAQJ,EAAIK,eAAe,EAC3B,MACF,KAAK,YACHpgC,EAAO,YACPmgC,EAAQJ,EAAIK,eAAe,EAC3B,MACF,KAAK,WACHpgC,EAAO,UACPmgC,EAAQJ,EAAIK,eAAe,GAM/BH,EAAOI,eAAergC,GAAM,GAAM,EAAM+/B,EAAIO,eAAe/6B,cAAcC,YAAa,EACpF26B,EAAMI,QAASJ,EAAMK,QAASL,EAAMM,QAASN,EAAMO,QACnDX,EAAI9lC,QAAS8lC,EAAIY,OAAQZ,EAAI7lC,SAAU6lC,EAAIa,QAAS,EAAG,MACzDb,EAAIO,eAAeO,cAAcZ,OLuoBhC1mC,IAAK,cACLd,MAAO,WKjoBI,GACJiD,GAAY9E,KAAZ8E,OAERA,GAAQgB,iBAAiB,cAAe,SAACwC,GAEvC,MADAA,GAAE4hC,kBACK,IACN,GAGHplC,EAAQgB,iBAAiB,YAAa9F,KAAKknC,cAAc,GACzDpiC,EAAQgB,iBAAiB,YAAa9F,KAAKmnC,cAAc,GACzDriC,EAAQgB,iBAAiB,UAAW9F,KAAKonC,YAAY,GAErDtiC,EAAQgB,iBAAiB,WAAY9F,KAAKqnC,UAAU,GACpDviC,EAAQgB,iBAAiB,YAAa9F,KAAKqnC,UAAU,GACrDviC,EAAQgB,iBAAiB,WAAY9F,KAAKqnC,UAAU,GAEpDrnC,KAAKoE,IAAI,yBL2oBRzB,IAAK,YACLd,MAAO,WKpoBR7B,KAAK4nC,OAAS,GAAAb,cACZ/mC,KAAKsnC,OAAS,EACdtnC,KAAKunC,QAAU,EACfvnC,KAAKsnC,OAAS,EACdtnC,KAAKunC,QAAU,EACf,uBACAvnC,KAAKmE,YAEPnE,KAAK2nC,QAAS,KLuoBbhlC,IAAK,eACLd,MAAO,WKjoBK,GAAAsoC,GACcnqC,KAAK4nC,OAAxBa,EADK0B,EACL1B,GAAIC,EADCyB,EACDzB,GAAIO,EADHkB,EACGlB,GAAIC,EADPiB,EACOjB,EACpB,QAASliC,EAAGyhC,EAAIxhC,EAAGyhC,EAAIxhC,EAAG+hC,EAAI9hC,EAAG+hC,ML8oBhCvmC,IAAK,QACLd,MAAO,WKxoBR7B,KAAKwnC,KAAK4C,UAAU,EAAG,EAAGpqC,KAAKsnC,OAAQtnC,KAAKunC,YLkpB3C5kC,IAAK,OACLd,MAAO,WK1oBR,IAAK7B,KAAK2nC,OAAQ,CAChB3nC,KAAKoE,IAAI,gBADO,IAERojC,GAAiBxnC,KAAjBwnC,KAAMI,EAAW5nC,KAAX4nC,MACd5nC,MAAKqqC,QAGL7C,EAAKvH,UAAY,iBACjBuH,EAAKrH,YACLqH,EAAKjG,KAAKqG,EAAOa,GAAIb,EAAOc,GAAId,EAAOqB,GAAIrB,EAAOsB,IAClD1B,EAAKjG,KAAKvhC,KAAKsnC,OAAQ,GAAItnC,KAAKsnC,OAAQtnC,KAAKunC,SAC7CC,EAAKjH,OAGLqH,EAAOO,KAAKX,GAEZxnC,KAAK2nC,QAAS,EAEd3nC,KAAKoE,IAAI,aAAcwjC,EAAOa,GAAIb,EAAOc,GAAId,EAAOqB,GAAIrB,EAAOsB,QL0pBhEvmC,IAAK,WACLd,MAAO,SKjpBDyG,GACP,GAAIgiC,GAAKtqC,KAAK8E,QACV8oB,EAAU,EACVC,EAAU,CAGd,IAAwB/pB,SAApBwmC,EAAG/E,aACL,EACE3X,IAAW0c,EAAG9E,WACd3X,GAAWyc,EAAGrnB,UACdqnB,EAAKA,EAAG/E,mBACD+E,EAIX1c,IAAW5tB,KAAK0nC,UAChB7Z,GAAW7tB,KAAKynC,QAEhB,IAAMa,GAAKhgC,EAAEiiC,MAAQ3c,EACf2a,EAAKjgC,EAAEkiC,MAAQ3c,CAErB,QAAS7mB,EAAGshC,EAAIrhC,EAAGshC,OLqpBbvB,GACP/jC,aAEFrD,cK58BoBonC,EL68BpBnnC,EAAOD,QAAUA,EAAQ,YAIpB,SAASC,EAAQD,EAASM,GAE/B,YAYA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAEhH,QAASC,GAA2BC,EAAMb,GAAQ,IAAKa,EAAQ,KAAM,IAAIC,gBAAe,4DAAgE,QAAOd,GAAyB,gBAATA,IAAqC,kBAATA,GAA8Ba,EAAPb,EAElO,QAASe,GAAUC,EAAUC,GAAc,GAA0B,kBAAfA,IAA4C,OAAfA,EAAuB,KAAM,IAAIN,WAAU,iEAAoEM,GAAeD,GAASE,UAAYC,OAAOC,OAAOH,GAAcA,EAAWC,WAAaG,aAAeC,MAAON,EAAUO,YAAY,EAAOC,UAAU,EAAMC,cAAc,KAAeR,IAAYE,OAAOO,eAAiBP,OAAOO,eAAeV,EAAUC,GAAcD,EAASW,UAAYV,GAhBjeE,OAAOS,eAAevC,EAAS,cAC7BiC,OAAO,GAGT,IAAIO,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIC,GAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,GAAIE,GAAaH,EAAMC,EAAIE,GAAWZ,WAAaY,EAAWZ,aAAc,EAAOY,EAAWV,cAAe,EAAU,SAAWU,KAAYA,EAAWX,UAAW,GAAML,OAAOS,eAAeG,EAAQI,EAAWC,IAAKD,IAAiB,MAAO,UAAUzB,EAAa2B,EAAYC,GAAiJ,MAA9HD,IAAYP,EAAiBpB,EAAYQ,UAAWmB,GAAiBC,GAAaR,EAAiBpB,EAAa4B,GAAqB5B,MMh+BjiB+B,EAAA9C,EAAA,GNo+BK+C,EAAetC,EAAuBqC,GM99BtBynC,EN4+BT,SAAU/mC,GMn+BpB,QAAA+mC,GAAYzjC,EAAGC,EAAGC,EAAGC,EAAGo5B,GAAwB,GAAlB0G,GAAkBpjC,UAAApB,QAAA,GAAAqB,SAAAD,UAAA,IAAAA,UAAA,EAAA9C,GAAAf,KAAAyqC,EAAA,IAAA1mC,GAAA5C,EAAAnB,MAAAyqC,EAAAvoC,WAAAR,OAAAsC,eAAAymC,IAAAlqC,KAAAP,MAG9C+D,GAAK2mC,qBACL3mC,EAAK4mC,kBAAoB,CACzB,KAAK,GAAInoC,GAAI,EAAGA,EAAI,EAAGA,GAAK,EAC1BuB,EAAK2mC,kBAAkBjgC,MAAOzD,EAAG,EAAGC,EAAG,GANK,OAS9ClD,GAAK0kC,GAAKzhC,GAAK,EACfjD,EAAK2kC,GAAKzhC,GAAK,EACflD,EAAKklC,GAAK/hC,GAAK,EACfnD,EAAKmlC,GAAK/hC,GAAK,EACfpD,EAAK6mC,MAAQrK,GAAQ,UACrBx8B,EAAKI,WAAa8iC,EAElBljC,EAAKK,IAAI,eAhBqCL,ENynC/C,MArJAzC,GAAUmpC,EAAM/mC,GAwChBtB,EAAaqoC,IACX9nC,IAAK,UACLd,MAAO,WMt/BR,MAAO,UNggCNc,IAAK,OACLd,MAAO,SM1/BL6E,GAAK,GACA+hC,GAAgEzoC,KAAhEyoC,GAAIC,EAA4D1oC,KAA5D0oC,GAAIO,EAAwDjpC,KAAxDipC,GAAIC,EAAoDlpC,KAApDkpC,GAAI0B,EAAgD5qC,KAAhD4qC,MAAOF,EAAyC1qC,KAAzC0qC,kBAAmBC,EAAsB3qC,KAAtB2qC,iBAClDjkC,GAAIu5B,UAAY2K,EAChBlkC,EAAIg6B,YAAc,QAClBh6B,EAAIyc,UAAY,EAChBzc,EAAImkC,aAAa,EAAG,IACpBnkC,EAAIokC,WAAWrC,EAAIC,EAAIO,EAAIC,EAE3B,IAAM6B,GAAOJ,EAAoB,CAGjCD,GAAkB,GAAG1jC,EAAIyhC,EAAKsC,EAC9BL,EAAkB,GAAGzjC,EAAIyhC,EAAKqC,EAE9BL,EAAkB,GAAG1jC,EAAIyhC,EAAKQ,EAAK,EAAI8B,EACvCL,EAAkB,GAAGzjC,EAAIyhC,EAAKqC,EAE9BL,EAAkB,GAAG1jC,EAAIyhC,EAAKQ,EAAK8B,EACnCL,EAAkB,GAAGzjC,EAAIyhC,EAAKqC,EAG9BL,EAAkB,GAAG1jC,EAAIyhC,EAAKsC,EAC9BL,EAAkB,GAAGzjC,EAAIyhC,EAAKQ,EAAK,EAAI6B,EAGvCL,EAAkB,GAAG1jC,EAAIyhC,EAAKQ,EAAK8B,EACnCL,EAAkB,GAAGzjC,EAAIyhC,EAAKQ,EAAK,EAAI6B,EAGvCL,EAAkB,GAAG1jC,EAAIyhC,EAAKQ,EAAK,EAAI8B,EACvCL,EAAkB,GAAGzjC,EAAIyhC,EAAKQ,EAAK6B,EAEnCL,EAAkB,GAAG1jC,EAAIyhC,EAAKsC,EAC9BL,EAAkB,GAAGzjC,EAAIyhC,EAAKQ,EAAK6B,EAEnCL,EAAkB,GAAG1jC,EAAIyhC,EAAKQ,EAAK8B,EACnCL,EAAkB,GAAGzjC,EAAIyhC,EAAKQ,EAAK6B,EAEnC/qC,KAAKoE,IAAI,2BACTsC,EAAIu5B,UAAY,QAChByK,EAAkB5kB,QAAQ,SAACklB,GACzBtkC,EAAIw5B,SAAS8K,EAAIhkC,EAAGgkC,EAAI/jC,EAAG0jC,EAAmBA,KAGhD3qC,KAAKoE,IAAI,wBAAyBqkC,EAAIC,EAAIO,EAAIC,MN4gC7CvmC,IAAK,WACLd,MAAO,SMpgCDymC,EAAIC,GAAI,GACPE,GAAmBzoC,KAAnByoC,GAAIC,EAAe1oC,KAAf0oC,GAAIO,EAAWjpC,KAAXipC,GAAIC,EAAOlpC,KAAPkpC,EACpB,OAAQT,IAAMH,GAAQG,EAAKQ,GAAMX,GAC9BI,GAAMH,GAAQG,EAAKQ,GAAMX,KNkhC3B5lC,IAAK,0BACLd,MAAO,SM1gCcymC,EAAIC,GAE1B,IAAK,GADGmC,GAAyC1qC,KAAzC0qC,kBAAmBC,EAAsB3qC,KAAtB2qC,kBAClBnoC,EAAI,EAAGA,EAAIkoC,EAAkBjoC,OAAQD,GAAK,EAAG,CACpD,GAAMyoC,GAASP,EAAkBloC,EACjC,IACGyoC,EAAOjkC,GAAKshC,GACZ2C,EAAOjkC,EAAI2jC,GAAqBrC,GAChC2C,EAAOhkC,GAAKshC,GACZ0C,EAAOhkC,EAAI0jC,GAAqBpC,EAEjC,MAAO/lC,GAIX,OAAO,MN2gCDioC,GACPxnC,aAEFrD,cMroCoB6qC,ENsoCpB5qC,EAAOD,QAAUA,EAAQ","file":"HtmlCrop.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"HtmlCrop\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"HtmlCrop\"] = factory();\n\telse\n\t\troot[\"HtmlCrop\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"HtmlCrop\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"HtmlCrop\"] = factory();\n\telse\n\t\troot[\"HtmlCrop\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _html2canvas = __webpack_require__(1);\n\t\n\tvar _html2canvas2 = _interopRequireDefault(_html2canvas);\n\t\n\tvar _baseObject = __webpack_require__(2);\n\t\n\tvar _baseObject2 = _interopRequireDefault(_baseObject);\n\t\n\tvar _canvasState = __webpack_require__(3);\n\t\n\tvar _canvasState2 = _interopRequireDefault(_canvasState);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar defaultOptions = {\n\t  key: {\n\t    ctrlKey: false,\n\t    shiftKey: true,\n\t    key: 'F7'\n\t  },\n\t  startButton: true,\n\t  debug: true\n\t};\n\t\n\tvar HtmlCrop = function (_BaseObject) {\n\t  _inherits(HtmlCrop, _BaseObject);\n\t\n\t  /**\n\t   * object constructor\n\t   * @param {HTMLDocument} doc\n\t   * @param {Object} options\n\t   */\n\t  function HtmlCrop(doc) {\n\t    var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\t\n\t    _classCallCheck(this, HtmlCrop);\n\t\n\t    var _this = _possibleConstructorReturn(this, (HtmlCrop.__proto__ || Object.getPrototypeOf(HtmlCrop)).call(this));\n\t\n\t    _this._document = doc;\n\t    _this.options = Object.assign({}, defaultOptions, options);\n\t    _this._debugMode = options.debug;\n\t    _this.log('initialized');\n\t\n\t    // bind this context into keydown event here\n\t    // because it needs to be removed later\n\t    _this._onKeyDown = _this._onKeyDown.bind(_this);\n\t\n\t    _this.reset();\n\t    return _this;\n\t  }\n\t\n\t  /**\n\t   * resets to starting state\n\t   */\n\t\n\t\n\t  _createClass(HtmlCrop, [{\n\t    key: 'reset',\n\t    value: function reset() {\n\t      this._listenHotKey();\n\t\n\t      if (this.options.startButton) {\n\t        this._attachStartButton();\n\t      }\n\t    }\n\t\n\t    /**\n\t     * starts cropping the page\n\t     */\n\t\n\t  }, {\n\t    key: 'startCropping',\n\t    value: function startCropping() {\n\t      var _this2 = this;\n\t\n\t      (0, _html2canvas2.default)(this._document.html).then(function (canvas) {\n\t        _this2._canvas = canvas;\n\t\n\t        var selectionCanvas = _this2._document.createElement('canvas');\n\t        _this2._selectionCanvas = selectionCanvas;\n\t        selectionCanvas.width = canvas.width;\n\t        selectionCanvas.height = canvas.height;\n\t        selectionCanvas.style.position = 'fixed';\n\t        selectionCanvas.style.left = '0';\n\t        selectionCanvas.style.top = '0';\n\t        selectionCanvas.style['z-index'] = 9999998;\n\t\n\t        _this2._document.body.appendChild(selectionCanvas);\n\t\n\t        // debug mode is set as false because of lots of logging\n\t        _this2._canvasState = new _canvasState2.default(_this2._document, selectionCanvas, true);\n\t\n\t        // removes start button and event listener to avoid multiple cropping instances\n\t        if (_this2._startButton) {\n\t          _this2._document.body.removeChild(_this2._startButton);\n\t        }\n\t        _this2._document.removeEventListener('keydown', _this2._onKeyDown);\n\t        _this2._attachCaptureButton();\n\t      });\n\t    }\n\t\n\t    /**\n\t     * ends cropping\n\t     */\n\t\n\t  }, {\n\t    key: 'endCropping',\n\t    value: function endCropping() {}\n\t\n\t    /**\n\t     * returns class name\n\t     * @returns {string}\n\t     */\n\t\n\t  }, {\n\t    key: 'getName',\n\t    value: function getName() {\n\t      return 'HtmlCrop';\n\t    }\n\t\n\t    /**\n\t     * attaches listener which triggers cropping\n\t     */\n\t\n\t  }, {\n\t    key: '_listenHotKey',\n\t    value: function _listenHotKey() {\n\t      this._document.addEventListener('keydown', this._onKeyDown);\n\t    }\n\t\n\t    /**\n\t     * attaches start cropping button\n\t     */\n\t\n\t  }, {\n\t    key: '_attachStartButton',\n\t    value: function _attachStartButton() {\n\t      var _document = this._document;\n\t\n\t      var button = _document.createElement('button');\n\t      var textNode = _document.createTextNode('Start Cropping');\n\t      button.appendChild(textNode);\n\t      button.style.position = 'fixed';\n\t      button.style.right = '30px';\n\t      button.style.bottom = '30px';\n\t      button.style['z-index'] = 9999998;\n\t      button.onclick = this.startCropping.bind(this);\n\t\n\t      this._startButton = button;\n\t      _document.body.appendChild(button);\n\t    }\n\t\n\t    /**\n\t     * attaches button to capture\n\t     * @private\n\t     */\n\t\n\t  }, {\n\t    key: '_attachCaptureButton',\n\t    value: function _attachCaptureButton() {\n\t      var _document = this._document;\n\t\n\t      var button = _document.createElement('button');\n\t      var textNode = _document.createTextNode('Capture');\n\t      button.appendChild(textNode);\n\t      button.style.position = 'fixed';\n\t      button.style.right = '30px';\n\t      button.style.bottom = '30px';\n\t      button.style['z-index'] = 9999998;\n\t      button.onclick = this._onCapture.bind(this);\n\t\n\t      this._captureButton = button;\n\t      _document.body.appendChild(button);\n\t    }\n\t\n\t    /*\n\t     * handles key down for hot key capturing\n\t     * @param {KeyboardEvent} event\n\t     */\n\t\n\t  }, {\n\t    key: '_onKeyDown',\n\t    value: function _onKeyDown(event) {\n\t      var key = event.key;\n\t      var ctrlKey = event.ctrlKey;\n\t      var shiftKey = event.shiftKey;\n\t      var keyOptions = this.options.key;\n\t\n\t\n\t      this.log('keydown detected: ctrl=' + ctrlKey + ' shift=' + shiftKey + ' key=' + key);\n\t\n\t      if (key === keyOptions.key && ctrlKey === keyOptions.ctrlKey && keyOptions.shiftKey) {\n\t        this.log('key down matches with setting. starts cropping');\n\t        this.startCropping();\n\t      }\n\t    }\n\t\n\t    /**\n\t     * capture button click handler\n\t     * @private\n\t     */\n\t\n\t  }, {\n\t    key: '_onCapture',\n\t    value: function _onCapture() {\n\t      var ctx = this._canvas.getContext('2d');\n\t      var selection = this._canvasState.getSelection();\n\t      var imgData = ctx.getImageData(selection.x, selection.y, selection.w, selection.h);\n\t\n\t      var newCanvas = this._document.createElement('canvas');\n\t      newCanvas.width = selection.w;\n\t      newCanvas.height = selection.h;\n\t      var newCtx = newCanvas.getContext('2d');\n\t      newCtx.putImageData(imgData, 0, 0);\n\t\n\t      var dataURL = newCanvas.toDataURL('image/png');\n\t\n\t      // @TODO save dataURL to server\n\t      window.location.href = dataURL; // eslint-disable-line\n\t    }\n\t  }]);\n\t\n\t  return HtmlCrop;\n\t}(_baseObject2.default);\n\t\n\texports.default = HtmlCrop;\n\tmodule.exports = exports['default'];\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;var require;var require;/* WEBPACK VAR INJECTION */(function(global) {\"use strict\";var _typeof=typeof Symbol===\"function\"&&typeof Symbol.iterator===\"symbol\"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol===\"function\"&&obj.constructor===Symbol?\"symbol\":typeof obj;};/*\n\t  html2canvas 0.5.0-beta4 <http://html2canvas.hertzen.com>\n\t  Copyright (c) 2016 Niklas von Hertzen\n\t\n\t  Released under  License\n\t*/(function(f){if(( false?\"undefined\":_typeof(exports))===\"object\"&&typeof module!==\"undefined\"){module.exports=f();}else if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (f), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));}else{var g;if(typeof window!==\"undefined\"){g=window;}else if(typeof global!==\"undefined\"){g=global;}else if(typeof self!==\"undefined\"){g=self;}else{g=this;}g.html2canvas=f();}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return require(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f;}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e);},l,l.exports,e,t,n,r);}return n[o].exports;}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++){s(r[o]);}return s;}({1:[function(_dereq_,module,exports){(function(global){/*! https://mths.be/punycode v1.4.0 by @mathias */;(function(root){/** Detect free variables */var freeExports=(typeof exports===\"undefined\"?\"undefined\":_typeof(exports))=='object'&&exports&&!exports.nodeType&&exports;var freeModule=(typeof module===\"undefined\"?\"undefined\":_typeof(module))=='object'&&module&&!module.nodeType&&module;var freeGlobal=(typeof global===\"undefined\"?\"undefined\":_typeof(global))=='object'&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal;}/**\n\t\t * The `punycode` object.\n\t\t * @name punycode\n\t\t * @type Object\n\t\t */var punycode,/** Highest positive signed 32-bit float value */maxInt=2147483647,// aka. 0x7FFFFFFF or 2^31-1\n\t/** Bootstring parameters */base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,// 0x80\n\tdelimiter='-',// '\\x2D'\n\t/** Regular expressions */regexPunycode=/^xn--/,regexNonASCII=/[^\\x20-\\x7E]/,// unprintable ASCII chars + non-ASCII chars\n\tregexSeparators=/[\\x2E\\u3002\\uFF0E\\uFF61]/g,// RFC 3490 separators\n\t/** Error messages */errors={'overflow':'Overflow: input needs wider integers to process','not-basic':'Illegal input >= 0x80 (not a basic code point)','invalid-input':'Invalid input'},/** Convenience shortcuts */baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,/** Temporary variable */key;/*--------------------------------------------------------------------------*//**\n\t\t * A generic error utility function.\n\t\t * @private\n\t\t * @param {String} type The error type.\n\t\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t\t */function error(type){throw new RangeError(errors[type]);}/**\n\t\t * A generic `Array#map` utility function.\n\t\t * @private\n\t\t * @param {Array} array The array to iterate over.\n\t\t * @param {Function} callback The function that gets called for every array\n\t\t * item.\n\t\t * @returns {Array} A new array of values returned by the callback function.\n\t\t */function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length]);}return result;}/**\n\t\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t\t * addresses.\n\t\t * @private\n\t\t * @param {String} domain The domain name or email address.\n\t\t * @param {Function} callback The function that gets called for every\n\t\t * character.\n\t\t * @returns {Array} A new string of characters returned by the callback\n\t\t * function.\n\t\t */function mapDomain(string,fn){var parts=string.split('@');var result='';if(parts.length>1){// In email addresses, only the domain name should be punycoded. Leave\n\t// the local part (i.e. everything up to `@`) intact.\n\tresult=parts[0]+'@';string=parts[1];}// Avoid `split(regex)` for IE8 compatibility. See #17.\n\tstring=string.replace(regexSeparators,'\\x2E');var labels=string.split('.');var encoded=map(labels,fn).join('.');return result+encoded;}/**\n\t\t * Creates an array containing the numeric code points of each Unicode\n\t\t * character in the string. While JavaScript uses UCS-2 internally,\n\t\t * this function will convert a pair of surrogate halves (each of which\n\t\t * UCS-2 exposes as separate characters) into a single code point,\n\t\t * matching UTF-16.\n\t\t * @see `punycode.ucs2.encode`\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode.ucs2\n\t\t * @name decode\n\t\t * @param {String} string The Unicode input string (UCS-2).\n\t\t * @returns {Array} The new array of code points.\n\t\t */function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=0xD800&&value<=0xDBFF&&counter<length){// high surrogate, and there is a next character\n\textra=string.charCodeAt(counter++);if((extra&0xFC00)==0xDC00){// low surrogate\n\toutput.push(((value&0x3FF)<<10)+(extra&0x3FF)+0x10000);}else{// unmatched surrogate; only append this code unit, in case the next\n\t// code unit is the high surrogate of a surrogate pair\n\toutput.push(value);counter--;}}else{output.push(value);}}return output;}/**\n\t\t * Creates a string based on an array of numeric code points.\n\t\t * @see `punycode.ucs2.decode`\n\t\t * @memberOf punycode.ucs2\n\t\t * @name encode\n\t\t * @param {Array} codePoints The array of numeric code points.\n\t\t * @returns {String} The new Unicode string (UCS-2).\n\t\t */function ucs2encode(array){return map(array,function(value){var output='';if(value>0xFFFF){value-=0x10000;output+=stringFromCharCode(value>>>10&0x3FF|0xD800);value=0xDC00|value&0x3FF;}output+=stringFromCharCode(value);return output;}).join('');}/**\n\t\t * Converts a basic code point into a digit/integer.\n\t\t * @see `digitToBasic()`\n\t\t * @private\n\t\t * @param {Number} codePoint The basic numeric code point value.\n\t\t * @returns {Number} The numeric value of a basic code point (for use in\n\t\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t\t * the code point does not represent a value.\n\t\t */function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22;}if(codePoint-65<26){return codePoint-65;}if(codePoint-97<26){return codePoint-97;}return base;}/**\n\t\t * Converts a digit/integer into a basic code point.\n\t\t * @see `basicToDigit()`\n\t\t * @private\n\t\t * @param {Number} digit The numeric value of a basic code point.\n\t\t * @returns {Number} The basic code point whose value (when used for\n\t\t * representing integers) is `digit`, which needs to be in the range\n\t\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t\t * used; else, the lowercase form is used. The behavior is undefined\n\t\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t\t */function digitToBasic(digit,flag){//  0..25 map to ASCII a..z or A..Z\n\t// 26..35 map to ASCII 0..9\n\treturn digit+22+75*(digit<26)-((flag!=0)<<5);}/**\n\t\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t\t * @private\n\t\t */function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;/* no initialization */delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin);}return floor(k+(baseMinusTMin+1)*delta/(delta+skew));}/**\n\t\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t\t * symbols.\n\t\t * @memberOf punycode\n\t\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t\t * @returns {String} The resulting string of Unicode symbols.\n\t\t */function decode(input){// Don't use UCS-2\n\tvar output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,/** Cached calculation results */baseMinusT;// Handle the basic code points: let `basic` be the number of input code\n\t// points before the last delimiter, or `0` if there is none, then copy\n\t// the first basic code points to the output.\n\tbasic=input.lastIndexOf(delimiter);if(basic<0){basic=0;}for(j=0;j<basic;++j){// if it's not a basic code point\n\tif(input.charCodeAt(j)>=0x80){error('not-basic');}output.push(input.charCodeAt(j));}// Main decoding loop: start just after the last delimiter if any basic code\n\t// points were copied; start at the beginning otherwise.\n\tfor(index=basic>0?basic+1:0;index<inputLength;)/* no final expression */{// `index` is the index of the next character to be consumed.\n\t// Decode a generalized variable-length integer into `delta`,\n\t// which gets added to `i`. The overflow checking is easier\n\t// if we increase `i` as we go, then subtract off its starting\n\t// value at the end to obtain `delta`.\n\tfor(oldi=i,w=1,k=base;;/* no condition */k+=base){if(index>=inputLength){error('invalid-input');}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error('overflow');}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break;}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error('overflow');}w*=baseMinusT;}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);// `i` was supposed to wrap around from `out` to `0`,\n\t// incrementing `n` each time, so we'll fix that now:\n\tif(floor(i/out)>maxInt-n){error('overflow');}n+=floor(i/out);i%=out;// Insert `n` at position `i` of the output\n\toutput.splice(i++,0,n);}return ucs2encode(output);}/**\n\t\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t\t * Punycode string of ASCII-only symbols.\n\t\t * @memberOf punycode\n\t\t * @param {String} input The string of Unicode symbols.\n\t\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t\t */function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],/** `inputLength` will hold the number of code points in `input`. */inputLength,/** Cached calculation results */handledCPCountPlusOne,baseMinusT,qMinusT;// Convert the input in UCS-2 to Unicode\n\tinput=ucs2decode(input);// Cache the length\n\tinputLength=input.length;// Initialize the state\n\tn=initialN;delta=0;bias=initialBias;// Handle the basic code points\n\tfor(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<0x80){output.push(stringFromCharCode(currentValue));}}handledCPCount=basicLength=output.length;// `handledCPCount` is the number of code points that have been handled;\n\t// `basicLength` is the number of basic code points.\n\t// Finish the basic string - if it is not empty - with a delimiter\n\tif(basicLength){output.push(delimiter);}// Main encoding loop:\n\twhile(handledCPCount<inputLength){// All non-basic code points < n have been handled already. Find the next\n\t// larger one:\n\tfor(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue;}}// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t// but guard against overflow\n\thandledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error('overflow');}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error('overflow');}if(currentValue==n){// Represent delta as a generalized variable-length integer\n\tfor(q=delta,k=base;;/* no condition */k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break;}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT);}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount;}}++delta;++n;}return output.join('');}/**\n\t\t * Converts a Punycode string representing a domain name or an email address\n\t\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t\t * it doesn't matter if you call it on a string that has already been\n\t\t * converted to Unicode.\n\t\t * @memberOf punycode\n\t\t * @param {String} input The Punycoded domain name or email address to\n\t\t * convert to Unicode.\n\t\t * @returns {String} The Unicode representation of the given Punycode\n\t\t * string.\n\t\t */function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string;});}/**\n\t\t * Converts a Unicode string representing a domain name or an email address to\n\t\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t\t * ASCII.\n\t\t * @memberOf punycode\n\t\t * @param {String} input The domain name or email address to convert, as a\n\t\t * Unicode string.\n\t\t * @returns {String} The Punycode representation of the given domain name or\n\t\t * email address.\n\t\t */function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?'xn--'+encode(string):string;});}/*--------------------------------------------------------------------------*//** Define the public API */punycode={/**\n\t\t\t * A string representing the current Punycode.js version number.\n\t\t\t * @memberOf punycode\n\t\t\t * @type String\n\t\t\t */'version':'1.3.2',/**\n\t\t\t * An object of methods to convert from JavaScript's internal character\n\t\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t\t * @memberOf punycode\n\t\t\t * @type Object\n\t\t\t */'ucs2':{'decode':ucs2decode,'encode':ucs2encode},'decode':decode,'encode':encode,'toASCII':toASCII,'toUnicode':toUnicode};/** Expose `punycode` */// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif(typeof define=='function'&&_typeof(define.amd)=='object'&&define.amd){define('punycode',function(){return punycode;});}else if(freeExports&&freeModule){if(module.exports==freeExports){// in Node.js, io.js, or RingoJS v0.8.0+\n\tfreeModule.exports=punycode;}else{// in Narwhal or RingoJS v0.7.0-\n\tfor(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);}}}else{// in Rhino or a web browser\n\troot.punycode=punycode;}})(this);}).call(this,typeof global!==\"undefined\"?global:typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:{});},{}],2:[function(_dereq_,module,exports){var log=_dereq_('./log');function restoreOwnerScroll(ownerDocument,x,y){if(ownerDocument.defaultView&&(x!==ownerDocument.defaultView.pageXOffset||y!==ownerDocument.defaultView.pageYOffset)){ownerDocument.defaultView.scrollTo(x,y);}}function cloneCanvasContents(canvas,clonedCanvas){try{if(clonedCanvas){clonedCanvas.width=canvas.width;clonedCanvas.height=canvas.height;clonedCanvas.getContext(\"2d\").putImageData(canvas.getContext(\"2d\").getImageData(0,0,canvas.width,canvas.height),0,0);}}catch(e){log(\"Unable to copy canvas content from\",canvas,e);}}function cloneNode(node,javascriptEnabled){var clone=node.nodeType===3?document.createTextNode(node.nodeValue):node.cloneNode(false);var child=node.firstChild;while(child){if(javascriptEnabled===true||child.nodeType!==1||child.nodeName!=='SCRIPT'){clone.appendChild(cloneNode(child,javascriptEnabled));}child=child.nextSibling;}if(node.nodeType===1){clone._scrollTop=node.scrollTop;clone._scrollLeft=node.scrollLeft;if(node.nodeName===\"CANVAS\"){cloneCanvasContents(node,clone);}else if(node.nodeName===\"TEXTAREA\"||node.nodeName===\"SELECT\"){clone.value=node.value;}}return clone;}function initNode(node){if(node.nodeType===1){node.scrollTop=node._scrollTop;node.scrollLeft=node._scrollLeft;var child=node.firstChild;while(child){initNode(child);child=child.nextSibling;}}}module.exports=function(ownerDocument,containerDocument,width,height,options,x,y){var documentElement=cloneNode(ownerDocument.documentElement,options.javascriptEnabled);var container=containerDocument.createElement(\"iframe\");container.className=\"html2canvas-container\";container.style.visibility=\"hidden\";container.style.position=\"fixed\";container.style.left=\"-10000px\";container.style.top=\"0px\";container.style.border=\"0\";container.width=width;container.height=height;container.scrolling=\"no\";// ios won't scroll without it\n\tcontainerDocument.body.appendChild(container);return new Promise(function(resolve){var documentClone=container.contentWindow.document;/* Chrome doesn't detect relative background-images assigned in inline <style> sheets when fetched through getComputedStyle\n\t         if window url is about:blank, we can assign the url to current by writing onto the document\n\t         */container.contentWindow.onload=container.onload=function(){var interval=setInterval(function(){if(documentClone.body.childNodes.length>0){initNode(documentClone.documentElement);clearInterval(interval);if(options.type===\"view\"){container.contentWindow.scrollTo(x,y);if(/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(container.contentWindow.scrollY!==y||container.contentWindow.scrollX!==x)){documentClone.documentElement.style.top=-y+\"px\";documentClone.documentElement.style.left=-x+\"px\";documentClone.documentElement.style.position='absolute';}}resolve(container);}},50);};documentClone.open();documentClone.write(\"<!DOCTYPE html><html></html>\");// Chrome scrolls the parent document for some reason after the write to the cloned window???\n\trestoreOwnerScroll(ownerDocument,x,y);documentClone.replaceChild(documentClone.adoptNode(documentElement),documentClone.documentElement);documentClone.close();});};},{\"./log\":13}],3:[function(_dereq_,module,exports){// http://dev.w3.org/csswg/css-color/\n\tfunction Color(value){this.r=0;this.g=0;this.b=0;this.a=null;var result=this.fromArray(value)||this.namedColor(value)||this.rgb(value)||this.rgba(value)||this.hex6(value)||this.hex3(value);}Color.prototype.darken=function(amount){var a=1-amount;return new Color([Math.round(this.r*a),Math.round(this.g*a),Math.round(this.b*a),this.a]);};Color.prototype.isTransparent=function(){return this.a===0;};Color.prototype.isBlack=function(){return this.r===0&&this.g===0&&this.b===0;};Color.prototype.fromArray=function(array){if(Array.isArray(array)){this.r=Math.min(array[0],255);this.g=Math.min(array[1],255);this.b=Math.min(array[2],255);if(array.length>3){this.a=array[3];}}return Array.isArray(array);};var _hex3=/^#([a-f0-9]{3})$/i;Color.prototype.hex3=function(value){var match=null;if((match=value.match(_hex3))!==null){this.r=parseInt(match[1][0]+match[1][0],16);this.g=parseInt(match[1][1]+match[1][1],16);this.b=parseInt(match[1][2]+match[1][2],16);}return match!==null;};var _hex6=/^#([a-f0-9]{6})$/i;Color.prototype.hex6=function(value){var match=null;if((match=value.match(_hex6))!==null){this.r=parseInt(match[1].substring(0,2),16);this.g=parseInt(match[1].substring(2,4),16);this.b=parseInt(match[1].substring(4,6),16);}return match!==null;};var _rgb=/^rgb\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*\\)$/;Color.prototype.rgb=function(value){var match=null;if((match=value.match(_rgb))!==null){this.r=Number(match[1]);this.g=Number(match[2]);this.b=Number(match[3]);}return match!==null;};var _rgba=/^rgba\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d?\\.?\\d+)\\s*\\)$/;Color.prototype.rgba=function(value){var match=null;if((match=value.match(_rgba))!==null){this.r=Number(match[1]);this.g=Number(match[2]);this.b=Number(match[3]);this.a=Number(match[4]);}return match!==null;};Color.prototype.toString=function(){return this.a!==null&&this.a!==1?\"rgba(\"+[this.r,this.g,this.b,this.a].join(\",\")+\")\":\"rgb(\"+[this.r,this.g,this.b].join(\",\")+\")\";};Color.prototype.namedColor=function(value){value=value.toLowerCase();var color=colors[value];if(color){this.r=color[0];this.g=color[1];this.b=color[2];}else if(value===\"transparent\"){this.r=this.g=this.b=this.a=0;return true;}return!!color;};Color.prototype.isColor=true;// JSON.stringify([].slice.call($$('.named-color-table tr'), 1).map(function(row) { return [row.childNodes[3].textContent, row.childNodes[5].textContent.trim().split(\",\").map(Number)] }).reduce(function(data, row) {data[row[0]] = row[1]; return data}, {}))\n\tvar colors={\"aliceblue\":[240,248,255],\"antiquewhite\":[250,235,215],\"aqua\":[0,255,255],\"aquamarine\":[127,255,212],\"azure\":[240,255,255],\"beige\":[245,245,220],\"bisque\":[255,228,196],\"black\":[0,0,0],\"blanchedalmond\":[255,235,205],\"blue\":[0,0,255],\"blueviolet\":[138,43,226],\"brown\":[165,42,42],\"burlywood\":[222,184,135],\"cadetblue\":[95,158,160],\"chartreuse\":[127,255,0],\"chocolate\":[210,105,30],\"coral\":[255,127,80],\"cornflowerblue\":[100,149,237],\"cornsilk\":[255,248,220],\"crimson\":[220,20,60],\"cyan\":[0,255,255],\"darkblue\":[0,0,139],\"darkcyan\":[0,139,139],\"darkgoldenrod\":[184,134,11],\"darkgray\":[169,169,169],\"darkgreen\":[0,100,0],\"darkgrey\":[169,169,169],\"darkkhaki\":[189,183,107],\"darkmagenta\":[139,0,139],\"darkolivegreen\":[85,107,47],\"darkorange\":[255,140,0],\"darkorchid\":[153,50,204],\"darkred\":[139,0,0],\"darksalmon\":[233,150,122],\"darkseagreen\":[143,188,143],\"darkslateblue\":[72,61,139],\"darkslategray\":[47,79,79],\"darkslategrey\":[47,79,79],\"darkturquoise\":[0,206,209],\"darkviolet\":[148,0,211],\"deeppink\":[255,20,147],\"deepskyblue\":[0,191,255],\"dimgray\":[105,105,105],\"dimgrey\":[105,105,105],\"dodgerblue\":[30,144,255],\"firebrick\":[178,34,34],\"floralwhite\":[255,250,240],\"forestgreen\":[34,139,34],\"fuchsia\":[255,0,255],\"gainsboro\":[220,220,220],\"ghostwhite\":[248,248,255],\"gold\":[255,215,0],\"goldenrod\":[218,165,32],\"gray\":[128,128,128],\"green\":[0,128,0],\"greenyellow\":[173,255,47],\"grey\":[128,128,128],\"honeydew\":[240,255,240],\"hotpink\":[255,105,180],\"indianred\":[205,92,92],\"indigo\":[75,0,130],\"ivory\":[255,255,240],\"khaki\":[240,230,140],\"lavender\":[230,230,250],\"lavenderblush\":[255,240,245],\"lawngreen\":[124,252,0],\"lemonchiffon\":[255,250,205],\"lightblue\":[173,216,230],\"lightcoral\":[240,128,128],\"lightcyan\":[224,255,255],\"lightgoldenrodyellow\":[250,250,210],\"lightgray\":[211,211,211],\"lightgreen\":[144,238,144],\"lightgrey\":[211,211,211],\"lightpink\":[255,182,193],\"lightsalmon\":[255,160,122],\"lightseagreen\":[32,178,170],\"lightskyblue\":[135,206,250],\"lightslategray\":[119,136,153],\"lightslategrey\":[119,136,153],\"lightsteelblue\":[176,196,222],\"lightyellow\":[255,255,224],\"lime\":[0,255,0],\"limegreen\":[50,205,50],\"linen\":[250,240,230],\"magenta\":[255,0,255],\"maroon\":[128,0,0],\"mediumaquamarine\":[102,205,170],\"mediumblue\":[0,0,205],\"mediumorchid\":[186,85,211],\"mediumpurple\":[147,112,219],\"mediumseagreen\":[60,179,113],\"mediumslateblue\":[123,104,238],\"mediumspringgreen\":[0,250,154],\"mediumturquoise\":[72,209,204],\"mediumvioletred\":[199,21,133],\"midnightblue\":[25,25,112],\"mintcream\":[245,255,250],\"mistyrose\":[255,228,225],\"moccasin\":[255,228,181],\"navajowhite\":[255,222,173],\"navy\":[0,0,128],\"oldlace\":[253,245,230],\"olive\":[128,128,0],\"olivedrab\":[107,142,35],\"orange\":[255,165,0],\"orangered\":[255,69,0],\"orchid\":[218,112,214],\"palegoldenrod\":[238,232,170],\"palegreen\":[152,251,152],\"paleturquoise\":[175,238,238],\"palevioletred\":[219,112,147],\"papayawhip\":[255,239,213],\"peachpuff\":[255,218,185],\"peru\":[205,133,63],\"pink\":[255,192,203],\"plum\":[221,160,221],\"powderblue\":[176,224,230],\"purple\":[128,0,128],\"rebeccapurple\":[102,51,153],\"red\":[255,0,0],\"rosybrown\":[188,143,143],\"royalblue\":[65,105,225],\"saddlebrown\":[139,69,19],\"salmon\":[250,128,114],\"sandybrown\":[244,164,96],\"seagreen\":[46,139,87],\"seashell\":[255,245,238],\"sienna\":[160,82,45],\"silver\":[192,192,192],\"skyblue\":[135,206,235],\"slateblue\":[106,90,205],\"slategray\":[112,128,144],\"slategrey\":[112,128,144],\"snow\":[255,250,250],\"springgreen\":[0,255,127],\"steelblue\":[70,130,180],\"tan\":[210,180,140],\"teal\":[0,128,128],\"thistle\":[216,191,216],\"tomato\":[255,99,71],\"turquoise\":[64,224,208],\"violet\":[238,130,238],\"wheat\":[245,222,179],\"white\":[255,255,255],\"whitesmoke\":[245,245,245],\"yellow\":[255,255,0],\"yellowgreen\":[154,205,50]};module.exports=Color;},{}],4:[function(_dereq_,module,exports){var Support=_dereq_('./support');var CanvasRenderer=_dereq_('./renderers/canvas');var ImageLoader=_dereq_('./imageloader');var NodeParser=_dereq_('./nodeparser');var NodeContainer=_dereq_('./nodecontainer');var log=_dereq_('./log');var utils=_dereq_('./utils');var createWindowClone=_dereq_('./clone');var loadUrlDocument=_dereq_('./proxy').loadUrlDocument;var getBounds=utils.getBounds;var html2canvasNodeAttribute=\"data-html2canvas-node\";var html2canvasCloneIndex=0;function html2canvas(nodeList,options){var index=html2canvasCloneIndex++;options=options||{};if(options.logging){log.options.logging=true;log.options.start=Date.now();}options.async=typeof options.async===\"undefined\"?true:options.async;options.allowTaint=typeof options.allowTaint===\"undefined\"?false:options.allowTaint;options.removeContainer=typeof options.removeContainer===\"undefined\"?true:options.removeContainer;options.javascriptEnabled=typeof options.javascriptEnabled===\"undefined\"?false:options.javascriptEnabled;options.imageTimeout=typeof options.imageTimeout===\"undefined\"?10000:options.imageTimeout;options.renderer=typeof options.renderer===\"function\"?options.renderer:CanvasRenderer;options.strict=!!options.strict;if(typeof nodeList===\"string\"){if(typeof options.proxy!==\"string\"){return Promise.reject(\"Proxy must be used when rendering url\");}var width=options.width!=null?options.width:window.innerWidth;var height=options.height!=null?options.height:window.innerHeight;return loadUrlDocument(absoluteUrl(nodeList),options.proxy,document,width,height,options).then(function(container){return renderWindow(container.contentWindow.document.documentElement,container,options,width,height);});}var node=(nodeList===undefined?[document.documentElement]:nodeList.length?nodeList:[nodeList])[0];node.setAttribute(html2canvasNodeAttribute+index,index);return renderDocument(node.ownerDocument,options,node.ownerDocument.defaultView.innerWidth,node.ownerDocument.defaultView.innerHeight,index).then(function(canvas){if(typeof options.onrendered===\"function\"){log(\"options.onrendered is deprecated, html2canvas returns a Promise containing the canvas\");options.onrendered(canvas);}return canvas;});}html2canvas.CanvasRenderer=CanvasRenderer;html2canvas.NodeContainer=NodeContainer;html2canvas.log=log;html2canvas.utils=utils;var html2canvasExport=typeof document===\"undefined\"||typeof Object.create!==\"function\"||typeof document.createElement(\"canvas\").getContext!==\"function\"?function(){return Promise.reject(\"No canvas support\");}:html2canvas;module.exports=html2canvasExport;if(typeof define==='function'&&define.amd){define('html2canvas',[],function(){return html2canvasExport;});}function renderDocument(document,options,windowWidth,windowHeight,html2canvasIndex){return createWindowClone(document,document,windowWidth,windowHeight,options,document.defaultView.pageXOffset,document.defaultView.pageYOffset).then(function(container){log(\"Document cloned\");var attributeName=html2canvasNodeAttribute+html2canvasIndex;var selector=\"[\"+attributeName+\"='\"+html2canvasIndex+\"']\";document.querySelector(selector).removeAttribute(attributeName);var clonedWindow=container.contentWindow;var node=clonedWindow.document.querySelector(selector);var oncloneHandler=typeof options.onclone===\"function\"?Promise.resolve(options.onclone(clonedWindow.document)):Promise.resolve(true);return oncloneHandler.then(function(){return renderWindow(node,container,options,windowWidth,windowHeight);});});}function renderWindow(node,container,options,windowWidth,windowHeight){var clonedWindow=container.contentWindow;var support=new Support(clonedWindow.document);var imageLoader=new ImageLoader(options,support);var bounds=getBounds(node);var width=options.type===\"view\"?windowWidth:documentWidth(clonedWindow.document);var height=options.type===\"view\"?windowHeight:documentHeight(clonedWindow.document);var renderer=new options.renderer(width,height,imageLoader,options,document);var parser=new NodeParser(node,renderer,support,imageLoader,options);return parser.ready.then(function(){log(\"Finished rendering\");var canvas;if(options.type===\"view\"){canvas=crop(renderer.canvas,{width:renderer.canvas.width,height:renderer.canvas.height,top:0,left:0,x:0,y:0});}else if(node===clonedWindow.document.body||node===clonedWindow.document.documentElement||options.canvas!=null){canvas=renderer.canvas;}else{canvas=crop(renderer.canvas,{width:options.width!=null?options.width:bounds.width,height:options.height!=null?options.height:bounds.height,top:bounds.top,left:bounds.left,x:0,y:0});}cleanupContainer(container,options);return canvas;});}function cleanupContainer(container,options){if(options.removeContainer){container.parentNode.removeChild(container);log(\"Cleaned up container\");}}function crop(canvas,bounds){var croppedCanvas=document.createElement(\"canvas\");var x1=Math.min(canvas.width-1,Math.max(0,bounds.left));var x2=Math.min(canvas.width,Math.max(1,bounds.left+bounds.width));var y1=Math.min(canvas.height-1,Math.max(0,bounds.top));var y2=Math.min(canvas.height,Math.max(1,bounds.top+bounds.height));croppedCanvas.width=bounds.width;croppedCanvas.height=bounds.height;var width=x2-x1;var height=y2-y1;log(\"Cropping canvas at:\",\"left:\",bounds.left,\"top:\",bounds.top,\"width:\",width,\"height:\",height);log(\"Resulting crop with width\",bounds.width,\"and height\",bounds.height,\"with x\",x1,\"and y\",y1);croppedCanvas.getContext(\"2d\").drawImage(canvas,x1,y1,width,height,bounds.x,bounds.y,width,height);return croppedCanvas;}function documentWidth(doc){return Math.max(Math.max(doc.body.scrollWidth,doc.documentElement.scrollWidth),Math.max(doc.body.offsetWidth,doc.documentElement.offsetWidth),Math.max(doc.body.clientWidth,doc.documentElement.clientWidth));}function documentHeight(doc){return Math.max(Math.max(doc.body.scrollHeight,doc.documentElement.scrollHeight),Math.max(doc.body.offsetHeight,doc.documentElement.offsetHeight),Math.max(doc.body.clientHeight,doc.documentElement.clientHeight));}function absoluteUrl(url){var link=document.createElement(\"a\");link.href=url;link.href=link.href;return link;}},{\"./clone\":2,\"./imageloader\":11,\"./log\":13,\"./nodecontainer\":14,\"./nodeparser\":15,\"./proxy\":16,\"./renderers/canvas\":20,\"./support\":22,\"./utils\":26}],5:[function(_dereq_,module,exports){var log=_dereq_('./log');var smallImage=_dereq_('./utils').smallImage;function DummyImageContainer(src){this.src=src;log(\"DummyImageContainer for\",src);if(!this.promise||!this.image){log(\"Initiating DummyImageContainer\");DummyImageContainer.prototype.image=new Image();var image=this.image;DummyImageContainer.prototype.promise=new Promise(function(resolve,reject){image.onload=resolve;image.onerror=reject;image.src=smallImage();if(image.complete===true){resolve(image);}});}}module.exports=DummyImageContainer;},{\"./log\":13,\"./utils\":26}],6:[function(_dereq_,module,exports){var smallImage=_dereq_('./utils').smallImage;function Font(family,size){var container=document.createElement('div'),img=document.createElement('img'),span=document.createElement('span'),sampleText='Hidden Text',baseline,middle;container.style.visibility=\"hidden\";container.style.fontFamily=family;container.style.fontSize=size;container.style.margin=0;container.style.padding=0;document.body.appendChild(container);img.src=smallImage();img.width=1;img.height=1;img.style.margin=0;img.style.padding=0;img.style.verticalAlign=\"baseline\";span.style.fontFamily=family;span.style.fontSize=size;span.style.margin=0;span.style.padding=0;span.appendChild(document.createTextNode(sampleText));container.appendChild(span);container.appendChild(img);baseline=img.offsetTop-span.offsetTop+1;container.removeChild(span);container.appendChild(document.createTextNode(sampleText));container.style.lineHeight=\"normal\";img.style.verticalAlign=\"super\";middle=img.offsetTop-container.offsetTop+1;document.body.removeChild(container);this.baseline=baseline;this.lineWidth=1;this.middle=middle;}module.exports=Font;},{\"./utils\":26}],7:[function(_dereq_,module,exports){var Font=_dereq_('./font');function FontMetrics(){this.data={};}FontMetrics.prototype.getMetrics=function(family,size){if(this.data[family+\"-\"+size]===undefined){this.data[family+\"-\"+size]=new Font(family,size);}return this.data[family+\"-\"+size];};module.exports=FontMetrics;},{\"./font\":6}],8:[function(_dereq_,module,exports){var utils=_dereq_('./utils');var getBounds=utils.getBounds;var loadUrlDocument=_dereq_('./proxy').loadUrlDocument;function FrameContainer(container,sameOrigin,options){this.image=null;this.src=container;var self=this;var bounds=getBounds(container);this.promise=(!sameOrigin?this.proxyLoad(options.proxy,bounds,options):new Promise(function(resolve){if(container.contentWindow.document.URL===\"about:blank\"||container.contentWindow.document.documentElement==null){container.contentWindow.onload=container.onload=function(){resolve(container);};}else{resolve(container);}})).then(function(container){var html2canvas=_dereq_('./core');return html2canvas(container.contentWindow.document.documentElement,{type:'view',width:container.width,height:container.height,proxy:options.proxy,javascriptEnabled:options.javascriptEnabled,removeContainer:options.removeContainer,allowTaint:options.allowTaint,imageTimeout:options.imageTimeout/2});}).then(function(canvas){return self.image=canvas;});}FrameContainer.prototype.proxyLoad=function(proxy,bounds,options){var container=this.src;return loadUrlDocument(container.src,proxy,container.ownerDocument,bounds.width,bounds.height,options);};module.exports=FrameContainer;},{\"./core\":4,\"./proxy\":16,\"./utils\":26}],9:[function(_dereq_,module,exports){function GradientContainer(imageData){this.src=imageData.value;this.colorStops=[];this.type=null;this.x0=0.5;this.y0=0.5;this.x1=0.5;this.y1=0.5;this.promise=Promise.resolve(true);}GradientContainer.TYPES={LINEAR:1,RADIAL:2};// TODO: support hsl[a], negative %/length values\n\t// TODO: support <angle> (e.g. -?\\d{1,3}(?:\\.\\d+)deg, etc. : https://developer.mozilla.org/docs/Web/CSS/angle )\n\tGradientContainer.REGEXP_COLORSTOP=/^\\s*(rgba?\\(\\s*\\d{1,3},\\s*\\d{1,3},\\s*\\d{1,3}(?:,\\s*[0-9\\.]+)?\\s*\\)|[a-z]{3,20}|#[a-f0-9]{3,6})(?:\\s+(\\d{1,3}(?:\\.\\d+)?)(%|px)?)?(?:\\s|$)/i;module.exports=GradientContainer;},{}],10:[function(_dereq_,module,exports){function ImageContainer(src,cors){this.src=src;this.image=new Image();var self=this;this.tainted=null;this.promise=new Promise(function(resolve,reject){self.image.onload=resolve;self.image.onerror=reject;if(cors){self.image.crossOrigin=\"anonymous\";}self.image.src=src;if(self.image.complete===true){resolve(self.image);}});}module.exports=ImageContainer;},{}],11:[function(_dereq_,module,exports){var log=_dereq_('./log');var ImageContainer=_dereq_('./imagecontainer');var DummyImageContainer=_dereq_('./dummyimagecontainer');var ProxyImageContainer=_dereq_('./proxyimagecontainer');var FrameContainer=_dereq_('./framecontainer');var SVGContainer=_dereq_('./svgcontainer');var SVGNodeContainer=_dereq_('./svgnodecontainer');var LinearGradientContainer=_dereq_('./lineargradientcontainer');var WebkitGradientContainer=_dereq_('./webkitgradientcontainer');var bind=_dereq_('./utils').bind;function ImageLoader(options,support){this.link=null;this.options=options;this.support=support;this.origin=this.getOrigin(window.location.href);}ImageLoader.prototype.findImages=function(nodes){var images=[];nodes.reduce(function(imageNodes,container){switch(container.node.nodeName){case\"IMG\":return imageNodes.concat([{args:[container.node.src],method:\"url\"}]);case\"svg\":case\"IFRAME\":return imageNodes.concat([{args:[container.node],method:container.node.nodeName}]);}return imageNodes;},[]).forEach(this.addImage(images,this.loadImage),this);return images;};ImageLoader.prototype.findBackgroundImage=function(images,container){container.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(images,this.loadImage),this);return images;};ImageLoader.prototype.addImage=function(images,callback){return function(newImage){newImage.args.forEach(function(image){if(!this.imageExists(images,image)){images.splice(0,0,callback.call(this,newImage));log('Added image #'+images.length,typeof image===\"string\"?image.substring(0,100):image);}},this);};};ImageLoader.prototype.hasImageBackground=function(imageData){return imageData.method!==\"none\";};ImageLoader.prototype.loadImage=function(imageData){if(imageData.method===\"url\"){var src=imageData.args[0];if(this.isSVG(src)&&!this.support.svg&&!this.options.allowTaint){return new SVGContainer(src);}else if(src.match(/data:image\\/.*;base64,/i)){return new ImageContainer(src.replace(/url\\(['\"]{0,}|['\"]{0,}\\)$/ig,''),false);}else if(this.isSameOrigin(src)||this.options.allowTaint===true||this.isSVG(src)){return new ImageContainer(src,false);}else if(this.support.cors&&!this.options.allowTaint&&this.options.useCORS){return new ImageContainer(src,true);}else if(this.options.proxy){return new ProxyImageContainer(src,this.options.proxy);}else{return new DummyImageContainer(src);}}else if(imageData.method===\"linear-gradient\"){return new LinearGradientContainer(imageData);}else if(imageData.method===\"gradient\"){return new WebkitGradientContainer(imageData);}else if(imageData.method===\"svg\"){return new SVGNodeContainer(imageData.args[0],this.support.svg);}else if(imageData.method===\"IFRAME\"){return new FrameContainer(imageData.args[0],this.isSameOrigin(imageData.args[0].src),this.options);}else{return new DummyImageContainer(imageData);}};ImageLoader.prototype.isSVG=function(src){return src.substring(src.length-3).toLowerCase()===\"svg\"||SVGContainer.prototype.isInline(src);};ImageLoader.prototype.imageExists=function(images,src){return images.some(function(image){return image.src===src;});};ImageLoader.prototype.isSameOrigin=function(url){return this.getOrigin(url)===this.origin;};ImageLoader.prototype.getOrigin=function(url){var link=this.link||(this.link=document.createElement(\"a\"));link.href=url;link.href=link.href;// IE9, LOL! - http://jsfiddle.net/niklasvh/2e48b/\n\treturn link.protocol+link.hostname+link.port;};ImageLoader.prototype.getPromise=function(container){return this.timeout(container,this.options.imageTimeout)['catch'](function(){var dummy=new DummyImageContainer(container.src);return dummy.promise.then(function(image){container.image=image;});});};ImageLoader.prototype.get=function(src){var found=null;return this.images.some(function(img){return(found=img).src===src;})?found:null;};ImageLoader.prototype.fetch=function(nodes){this.images=nodes.reduce(bind(this.findBackgroundImage,this),this.findImages(nodes));this.images.forEach(function(image,index){image.promise.then(function(){log(\"Succesfully loaded image #\"+(index+1),image);},function(e){log(\"Failed loading image #\"+(index+1),image,e);});});this.ready=Promise.all(this.images.map(this.getPromise,this));log(\"Finished searching images\");return this;};ImageLoader.prototype.timeout=function(container,timeout){var timer;var promise=Promise.race([container.promise,new Promise(function(res,reject){timer=setTimeout(function(){log(\"Timed out loading image\",container);reject(container);},timeout);})]).then(function(container){clearTimeout(timer);return container;});promise['catch'](function(){clearTimeout(timer);});return promise;};module.exports=ImageLoader;},{\"./dummyimagecontainer\":5,\"./framecontainer\":8,\"./imagecontainer\":10,\"./lineargradientcontainer\":12,\"./log\":13,\"./proxyimagecontainer\":17,\"./svgcontainer\":23,\"./svgnodecontainer\":24,\"./utils\":26,\"./webkitgradientcontainer\":27}],12:[function(_dereq_,module,exports){var GradientContainer=_dereq_('./gradientcontainer');var Color=_dereq_('./color');function LinearGradientContainer(imageData){GradientContainer.apply(this,arguments);this.type=GradientContainer.TYPES.LINEAR;var hasDirection=LinearGradientContainer.REGEXP_DIRECTION.test(imageData.args[0])||!GradientContainer.REGEXP_COLORSTOP.test(imageData.args[0]);if(hasDirection){imageData.args[0].split(/\\s+/).reverse().forEach(function(position,index){switch(position){case\"left\":this.x0=0;this.x1=1;break;case\"top\":this.y0=0;this.y1=1;break;case\"right\":this.x0=1;this.x1=0;break;case\"bottom\":this.y0=1;this.y1=0;break;case\"to\":var y0=this.y0;var x0=this.x0;this.y0=this.y1;this.x0=this.x1;this.x1=x0;this.y1=y0;break;case\"center\":break;// centered by default\n\t// Firefox internally converts position keywords to percentages:\n\t// http://www.w3.org/TR/2010/WD-CSS2-20101207/colors.html#propdef-background-position\n\tdefault:// percentage or absolute length\n\t// TODO: support absolute start point positions (e.g., use bounds to convert px to a ratio)\n\tvar ratio=parseFloat(position,10)*1e-2;if(isNaN(ratio)){// invalid or unhandled value\n\tbreak;}if(index===0){this.y0=ratio;this.y1=1-this.y0;}else{this.x0=ratio;this.x1=1-this.x0;}break;}},this);}else{this.y0=0;this.y1=1;}this.colorStops=imageData.args.slice(hasDirection?1:0).map(function(colorStop){var colorStopMatch=colorStop.match(GradientContainer.REGEXP_COLORSTOP);var value=+colorStopMatch[2];var unit=value===0?\"%\":colorStopMatch[3];// treat \"0\" as \"0%\"\n\treturn{color:new Color(colorStopMatch[1]),// TODO: support absolute stop positions (e.g., compute gradient line length & convert px to ratio)\n\tstop:unit===\"%\"?value/100:null};});if(this.colorStops[0].stop===null){this.colorStops[0].stop=0;}if(this.colorStops[this.colorStops.length-1].stop===null){this.colorStops[this.colorStops.length-1].stop=1;}// calculates and fills-in explicit stop positions when omitted from rule\n\tthis.colorStops.forEach(function(colorStop,index){if(colorStop.stop===null){this.colorStops.slice(index).some(function(find,count){if(find.stop!==null){colorStop.stop=(find.stop-this.colorStops[index-1].stop)/(count+1)+this.colorStops[index-1].stop;return true;}else{return false;}},this);}},this);}LinearGradientContainer.prototype=Object.create(GradientContainer.prototype);// TODO: support <angle> (e.g. -?\\d{1,3}(?:\\.\\d+)deg, etc. : https://developer.mozilla.org/docs/Web/CSS/angle )\n\tLinearGradientContainer.REGEXP_DIRECTION=/^\\s*(?:to|left|right|top|bottom|center|\\d{1,3}(?:\\.\\d+)?%?)(?:\\s|$)/i;module.exports=LinearGradientContainer;},{\"./color\":3,\"./gradientcontainer\":9}],13:[function(_dereq_,module,exports){var logger=function logger(){if(logger.options.logging&&window.console&&window.console.log){Function.prototype.bind.call(window.console.log,window.console).apply(window.console,[Date.now()-logger.options.start+\"ms\",\"html2canvas:\"].concat([].slice.call(arguments,0)));}};logger.options={logging:false};module.exports=logger;},{}],14:[function(_dereq_,module,exports){var Color=_dereq_('./color');var utils=_dereq_('./utils');var getBounds=utils.getBounds;var parseBackgrounds=utils.parseBackgrounds;var offsetBounds=utils.offsetBounds;function NodeContainer(node,parent){this.node=node;this.parent=parent;this.stack=null;this.bounds=null;this.borders=null;this.clip=[];this.backgroundClip=[];this.offsetBounds=null;this.visible=null;this.computedStyles=null;this.colors={};this.styles={};this.backgroundImages=null;this.transformData=null;this.transformMatrix=null;this.isPseudoElement=false;this.opacity=null;}NodeContainer.prototype.cloneTo=function(stack){stack.visible=this.visible;stack.borders=this.borders;stack.bounds=this.bounds;stack.clip=this.clip;stack.backgroundClip=this.backgroundClip;stack.computedStyles=this.computedStyles;stack.styles=this.styles;stack.backgroundImages=this.backgroundImages;stack.opacity=this.opacity;};NodeContainer.prototype.getOpacity=function(){return this.opacity===null?this.opacity=this.cssFloat('opacity'):this.opacity;};NodeContainer.prototype.assignStack=function(stack){this.stack=stack;stack.children.push(this);};NodeContainer.prototype.isElementVisible=function(){return this.node.nodeType===Node.TEXT_NODE?this.parent.visible:this.css('display')!==\"none\"&&this.css('visibility')!==\"hidden\"&&!this.node.hasAttribute(\"data-html2canvas-ignore\")&&(this.node.nodeName!==\"INPUT\"||this.node.getAttribute(\"type\")!==\"hidden\");};NodeContainer.prototype.css=function(attribute){if(!this.computedStyles){this.computedStyles=this.isPseudoElement?this.parent.computedStyle(this.before?\":before\":\":after\"):this.computedStyle(null);}return this.styles[attribute]||(this.styles[attribute]=this.computedStyles[attribute]);};NodeContainer.prototype.prefixedCss=function(attribute){var prefixes=[\"webkit\",\"moz\",\"ms\",\"o\"];var value=this.css(attribute);if(value===undefined){prefixes.some(function(prefix){value=this.css(prefix+attribute.substr(0,1).toUpperCase()+attribute.substr(1));return value!==undefined;},this);}return value===undefined?null:value;};NodeContainer.prototype.computedStyle=function(type){return this.node.ownerDocument.defaultView.getComputedStyle(this.node,type);};NodeContainer.prototype.cssInt=function(attribute){var value=parseInt(this.css(attribute),10);return isNaN(value)?0:value;// borders in old IE are throwing 'medium' for demo.html\n\t};NodeContainer.prototype.color=function(attribute){return this.colors[attribute]||(this.colors[attribute]=new Color(this.css(attribute)));};NodeContainer.prototype.cssFloat=function(attribute){var value=parseFloat(this.css(attribute));return isNaN(value)?0:value;};NodeContainer.prototype.fontWeight=function(){var weight=this.css(\"fontWeight\");switch(parseInt(weight,10)){case 401:weight=\"bold\";break;case 400:weight=\"normal\";break;}return weight;};NodeContainer.prototype.parseClip=function(){var matches=this.css('clip').match(this.CLIP);if(matches){return{top:parseInt(matches[1],10),right:parseInt(matches[2],10),bottom:parseInt(matches[3],10),left:parseInt(matches[4],10)};}return null;};NodeContainer.prototype.parseBackgroundImages=function(){return this.backgroundImages||(this.backgroundImages=parseBackgrounds(this.css(\"backgroundImage\")));};NodeContainer.prototype.cssList=function(property,index){var value=(this.css(property)||'').split(',');value=value[index||0]||value[0]||'auto';value=value.trim().split(' ');if(value.length===1){value=[value[0],isPercentage(value[0])?'auto':value[0]];}return value;};NodeContainer.prototype.parseBackgroundSize=function(bounds,image,index){var size=this.cssList(\"backgroundSize\",index);var width,height;if(isPercentage(size[0])){width=bounds.width*parseFloat(size[0])/100;}else if(/contain|cover/.test(size[0])){var targetRatio=bounds.width/bounds.height,currentRatio=image.width/image.height;return targetRatio<currentRatio^size[0]==='contain'?{width:bounds.height*currentRatio,height:bounds.height}:{width:bounds.width,height:bounds.width/currentRatio};}else{width=parseInt(size[0],10);}if(size[0]==='auto'&&size[1]==='auto'){height=image.height;}else if(size[1]==='auto'){height=width/image.width*image.height;}else if(isPercentage(size[1])){height=bounds.height*parseFloat(size[1])/100;}else{height=parseInt(size[1],10);}if(size[0]==='auto'){width=height/image.height*image.width;}return{width:width,height:height};};NodeContainer.prototype.parseBackgroundPosition=function(bounds,image,index,backgroundSize){var position=this.cssList('backgroundPosition',index);var left,top;if(isPercentage(position[0])){left=(bounds.width-(backgroundSize||image).width)*(parseFloat(position[0])/100);}else{left=parseInt(position[0],10);}if(position[1]==='auto'){top=left/image.width*image.height;}else if(isPercentage(position[1])){top=(bounds.height-(backgroundSize||image).height)*parseFloat(position[1])/100;}else{top=parseInt(position[1],10);}if(position[0]==='auto'){left=top/image.height*image.width;}return{left:left,top:top};};NodeContainer.prototype.parseBackgroundRepeat=function(index){return this.cssList(\"backgroundRepeat\",index)[0];};NodeContainer.prototype.parseTextShadows=function(){var textShadow=this.css(\"textShadow\");var results=[];if(textShadow&&textShadow!=='none'){var shadows=textShadow.match(this.TEXT_SHADOW_PROPERTY);for(var i=0;shadows&&i<shadows.length;i++){var s=shadows[i].match(this.TEXT_SHADOW_VALUES);results.push({color:new Color(s[0]),offsetX:s[1]?parseFloat(s[1].replace('px','')):0,offsetY:s[2]?parseFloat(s[2].replace('px','')):0,blur:s[3]?s[3].replace('px',''):0});}}return results;};NodeContainer.prototype.parseTransform=function(){if(!this.transformData){if(this.hasTransform()){var offset=this.parseBounds();var origin=this.prefixedCss(\"transformOrigin\").split(\" \").map(removePx).map(asFloat);origin[0]+=offset.left;origin[1]+=offset.top;this.transformData={origin:origin,matrix:this.parseTransformMatrix()};}else{this.transformData={origin:[0,0],matrix:[1,0,0,1,0,0]};}}return this.transformData;};NodeContainer.prototype.parseTransformMatrix=function(){if(!this.transformMatrix){var transform=this.prefixedCss(\"transform\");var matrix=transform?parseMatrix(transform.match(this.MATRIX_PROPERTY)):null;this.transformMatrix=matrix?matrix:[1,0,0,1,0,0];}return this.transformMatrix;};NodeContainer.prototype.parseBounds=function(){return this.bounds||(this.bounds=this.hasTransform()?offsetBounds(this.node):getBounds(this.node));};NodeContainer.prototype.hasTransform=function(){return this.parseTransformMatrix().join(\",\")!==\"1,0,0,1,0,0\"||this.parent&&this.parent.hasTransform();};NodeContainer.prototype.getValue=function(){var value=this.node.value||\"\";if(this.node.tagName===\"SELECT\"){value=selectionValue(this.node);}else if(this.node.type===\"password\"){value=Array(value.length+1).join(\"\");// jshint ignore:line\n\t}return value.length===0?this.node.placeholder||\"\":value;};NodeContainer.prototype.MATRIX_PROPERTY=/(matrix|matrix3d)\\((.+)\\)/;NodeContainer.prototype.TEXT_SHADOW_PROPERTY=/((rgba|rgb)\\([^\\)]+\\)(\\s-?\\d+px){0,})/g;NodeContainer.prototype.TEXT_SHADOW_VALUES=/(-?\\d+px)|(#.+)|(rgb\\(.+\\))|(rgba\\(.+\\))/g;NodeContainer.prototype.CLIP=/^rect\\((\\d+)px,? (\\d+)px,? (\\d+)px,? (\\d+)px\\)$/;function selectionValue(node){var option=node.options[node.selectedIndex||0];return option?option.text||\"\":\"\";}function parseMatrix(match){if(match&&match[1]===\"matrix\"){return match[2].split(\",\").map(function(s){return parseFloat(s.trim());});}else if(match&&match[1]===\"matrix3d\"){var matrix3d=match[2].split(\",\").map(function(s){return parseFloat(s.trim());});return[matrix3d[0],matrix3d[1],matrix3d[4],matrix3d[5],matrix3d[12],matrix3d[13]];}}function isPercentage(value){return value.toString().indexOf(\"%\")!==-1;}function removePx(str){return str.replace(\"px\",\"\");}function asFloat(str){return parseFloat(str);}module.exports=NodeContainer;},{\"./color\":3,\"./utils\":26}],15:[function(_dereq_,module,exports){var log=_dereq_('./log');var punycode=_dereq_('punycode');var NodeContainer=_dereq_('./nodecontainer');var TextContainer=_dereq_('./textcontainer');var PseudoElementContainer=_dereq_('./pseudoelementcontainer');var FontMetrics=_dereq_('./fontmetrics');var Color=_dereq_('./color');var StackingContext=_dereq_('./stackingcontext');var utils=_dereq_('./utils');var bind=utils.bind;var getBounds=utils.getBounds;var parseBackgrounds=utils.parseBackgrounds;var offsetBounds=utils.offsetBounds;function NodeParser(element,renderer,support,imageLoader,options){log(\"Starting NodeParser\");this.renderer=renderer;this.options=options;this.range=null;this.support=support;this.renderQueue=[];this.stack=new StackingContext(true,1,element.ownerDocument,null);var parent=new NodeContainer(element,null);if(options.background){renderer.rectangle(0,0,renderer.width,renderer.height,new Color(options.background));}if(element===element.ownerDocument.documentElement){// http://www.w3.org/TR/css3-background/#special-backgrounds\n\tvar canvasBackground=new NodeContainer(parent.color('backgroundColor').isTransparent()?element.ownerDocument.body:element.ownerDocument.documentElement,null);renderer.rectangle(0,0,renderer.width,renderer.height,canvasBackground.color('backgroundColor'));}parent.visibile=parent.isElementVisible();this.createPseudoHideStyles(element.ownerDocument);this.disableAnimations(element.ownerDocument);this.nodes=flatten([parent].concat(this.getChildren(parent)).filter(function(container){return container.visible=container.isElementVisible();}).map(this.getPseudoElements,this));this.fontMetrics=new FontMetrics();log(\"Fetched nodes, total:\",this.nodes.length);log(\"Calculate overflow clips\");this.calculateOverflowClips();log(\"Start fetching images\");this.images=imageLoader.fetch(this.nodes.filter(isElement));this.ready=this.images.ready.then(bind(function(){log(\"Images loaded, starting parsing\");log(\"Creating stacking contexts\");this.createStackingContexts();log(\"Sorting stacking contexts\");this.sortStackingContexts(this.stack);this.parse(this.stack);log(\"Render queue created with \"+this.renderQueue.length+\" items\");return new Promise(bind(function(resolve){if(!options.async){this.renderQueue.forEach(this.paint,this);resolve();}else if(typeof options.async===\"function\"){options.async.call(this,this.renderQueue,resolve);}else if(this.renderQueue.length>0){this.renderIndex=0;this.asyncRenderer(this.renderQueue,resolve);}else{resolve();}},this));},this));}NodeParser.prototype.calculateOverflowClips=function(){this.nodes.forEach(function(container){if(isElement(container)){if(isPseudoElement(container)){container.appendToDOM();}container.borders=this.parseBorders(container);var clip=container.css('overflow')===\"hidden\"?[container.borders.clip]:[];var cssClip=container.parseClip();if(cssClip&&[\"absolute\",\"fixed\"].indexOf(container.css('position'))!==-1){clip.push([[\"rect\",container.bounds.left+cssClip.left,container.bounds.top+cssClip.top,cssClip.right-cssClip.left,cssClip.bottom-cssClip.top]]);}container.clip=hasParentClip(container)?container.parent.clip.concat(clip):clip;container.backgroundClip=container.css('overflow')!==\"hidden\"?container.clip.concat([container.borders.clip]):container.clip;if(isPseudoElement(container)){container.cleanDOM();}}else if(isTextNode(container)){container.clip=hasParentClip(container)?container.parent.clip:[];}if(!isPseudoElement(container)){container.bounds=null;}},this);};function hasParentClip(container){return container.parent&&container.parent.clip.length;}NodeParser.prototype.asyncRenderer=function(queue,resolve,asyncTimer){asyncTimer=asyncTimer||Date.now();this.paint(queue[this.renderIndex++]);if(queue.length===this.renderIndex){resolve();}else if(asyncTimer+20>Date.now()){this.asyncRenderer(queue,resolve,asyncTimer);}else{setTimeout(bind(function(){this.asyncRenderer(queue,resolve);},this),0);}};NodeParser.prototype.createPseudoHideStyles=function(document){this.createStyles(document,'.'+PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+':before { content: \"\" !important; display: none !important; }'+'.'+PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER+':after { content: \"\" !important; display: none !important; }');};NodeParser.prototype.disableAnimations=function(document){this.createStyles(document,'* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; '+'-webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}');};NodeParser.prototype.createStyles=function(document,styles){var hidePseudoElements=document.createElement('style');hidePseudoElements.innerHTML=styles;document.body.appendChild(hidePseudoElements);};NodeParser.prototype.getPseudoElements=function(container){var nodes=[[container]];if(container.node.nodeType===Node.ELEMENT_NODE){var before=this.getPseudoElement(container,\":before\");var after=this.getPseudoElement(container,\":after\");if(before){nodes.push(before);}if(after){nodes.push(after);}}return flatten(nodes);};function toCamelCase(str){return str.replace(/(\\-[a-z])/g,function(match){return match.toUpperCase().replace('-','');});}NodeParser.prototype.getPseudoElement=function(container,type){var style=container.computedStyle(type);if(!style||!style.content||style.content===\"none\"||style.content===\"-moz-alt-content\"||style.display===\"none\"){return null;}var content=stripQuotes(style.content);var isImage=content.substr(0,3)==='url';var pseudoNode=document.createElement(isImage?'img':'html2canvaspseudoelement');var pseudoContainer=new PseudoElementContainer(pseudoNode,container,type);for(var i=style.length-1;i>=0;i--){var property=toCamelCase(style.item(i));pseudoNode.style[property]=style[property];}pseudoNode.className=PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+\" \"+PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER;if(isImage){pseudoNode.src=parseBackgrounds(content)[0].args[0];return[pseudoContainer];}else{var text=document.createTextNode(content);pseudoNode.appendChild(text);return[pseudoContainer,new TextContainer(text,pseudoContainer)];}};NodeParser.prototype.getChildren=function(parentContainer){return flatten([].filter.call(parentContainer.node.childNodes,renderableNode).map(function(node){var container=[node.nodeType===Node.TEXT_NODE?new TextContainer(node,parentContainer):new NodeContainer(node,parentContainer)].filter(nonIgnoredElement);return node.nodeType===Node.ELEMENT_NODE&&container.length&&node.tagName!==\"TEXTAREA\"?container[0].isElementVisible()?container.concat(this.getChildren(container[0])):[]:container;},this));};NodeParser.prototype.newStackingContext=function(container,hasOwnStacking){var stack=new StackingContext(hasOwnStacking,container.getOpacity(),container.node,container.parent);container.cloneTo(stack);var parentStack=hasOwnStacking?stack.getParentStack(this):stack.parent.stack;parentStack.contexts.push(stack);container.stack=stack;};NodeParser.prototype.createStackingContexts=function(){this.nodes.forEach(function(container){if(isElement(container)&&(this.isRootElement(container)||hasOpacity(container)||isPositionedForStacking(container)||this.isBodyWithTransparentRoot(container)||container.hasTransform())){this.newStackingContext(container,true);}else if(isElement(container)&&(isPositioned(container)&&zIndex0(container)||isInlineBlock(container)||isFloating(container))){this.newStackingContext(container,false);}else{container.assignStack(container.parent.stack);}},this);};NodeParser.prototype.isBodyWithTransparentRoot=function(container){return container.node.nodeName===\"BODY\"&&container.parent.color('backgroundColor').isTransparent();};NodeParser.prototype.isRootElement=function(container){return container.parent===null;};NodeParser.prototype.sortStackingContexts=function(stack){stack.contexts.sort(zIndexSort(stack.contexts.slice(0)));stack.contexts.forEach(this.sortStackingContexts,this);};NodeParser.prototype.parseTextBounds=function(container){return function(text,index,textList){if(container.parent.css(\"textDecoration\").substr(0,4)!==\"none\"||text.trim().length!==0){if(this.support.rangeBounds&&!container.parent.hasTransform()){var offset=textList.slice(0,index).join(\"\").length;return this.getRangeBounds(container.node,offset,text.length);}else if(container.node&&typeof container.node.data===\"string\"){var replacementNode=container.node.splitText(text.length);var bounds=this.getWrapperBounds(container.node,container.parent.hasTransform());container.node=replacementNode;return bounds;}}else if(!this.support.rangeBounds||container.parent.hasTransform()){container.node=container.node.splitText(text.length);}return{};};};NodeParser.prototype.getWrapperBounds=function(node,transform){var wrapper=node.ownerDocument.createElement('html2canvaswrapper');var parent=node.parentNode,backupText=node.cloneNode(true);wrapper.appendChild(node.cloneNode(true));parent.replaceChild(wrapper,node);var bounds=transform?offsetBounds(wrapper):getBounds(wrapper);parent.replaceChild(backupText,wrapper);return bounds;};NodeParser.prototype.getRangeBounds=function(node,offset,length){var range=this.range||(this.range=node.ownerDocument.createRange());range.setStart(node,offset);range.setEnd(node,offset+length);return range.getBoundingClientRect();};function ClearTransform(){}NodeParser.prototype.parse=function(stack){// http://www.w3.org/TR/CSS21/visuren.html#z-index\n\tvar negativeZindex=stack.contexts.filter(negativeZIndex);// 2. the child stacking contexts with negative stack levels (most negative first).\n\tvar descendantElements=stack.children.filter(isElement);var descendantNonFloats=descendantElements.filter(not(isFloating));var nonInlineNonPositionedDescendants=descendantNonFloats.filter(not(isPositioned)).filter(not(inlineLevel));// 3 the in-flow, non-inline-level, non-positioned descendants.\n\tvar nonPositionedFloats=descendantElements.filter(not(isPositioned)).filter(isFloating);// 4. the non-positioned floats.\n\tvar inFlow=descendantNonFloats.filter(not(isPositioned)).filter(inlineLevel);// 5. the in-flow, inline-level, non-positioned descendants, including inline tables and inline blocks.\n\tvar stackLevel0=stack.contexts.concat(descendantNonFloats.filter(isPositioned)).filter(zIndex0);// 6. the child stacking contexts with stack level 0 and the positioned descendants with stack level 0.\n\tvar text=stack.children.filter(isTextNode).filter(hasText);var positiveZindex=stack.contexts.filter(positiveZIndex);// 7. the child stacking contexts with positive stack levels (least positive first).\n\tnegativeZindex.concat(nonInlineNonPositionedDescendants).concat(nonPositionedFloats).concat(inFlow).concat(stackLevel0).concat(text).concat(positiveZindex).forEach(function(container){this.renderQueue.push(container);if(isStackingContext(container)){this.parse(container);this.renderQueue.push(new ClearTransform());}},this);};NodeParser.prototype.paint=function(container){try{if(container instanceof ClearTransform){this.renderer.ctx.restore();}else if(isTextNode(container)){if(isPseudoElement(container.parent)){container.parent.appendToDOM();}this.paintText(container);if(isPseudoElement(container.parent)){container.parent.cleanDOM();}}else{this.paintNode(container);}}catch(e){log(e);if(this.options.strict){throw e;}}};NodeParser.prototype.paintNode=function(container){if(isStackingContext(container)){this.renderer.setOpacity(container.opacity);this.renderer.ctx.save();if(container.hasTransform()){this.renderer.setTransform(container.parseTransform());}}if(container.node.nodeName===\"INPUT\"&&container.node.type===\"checkbox\"){this.paintCheckbox(container);}else if(container.node.nodeName===\"INPUT\"&&container.node.type===\"radio\"){this.paintRadio(container);}else{this.paintElement(container);}};NodeParser.prototype.paintElement=function(container){var bounds=container.parseBounds();this.renderer.clip(container.backgroundClip,function(){this.renderer.renderBackground(container,bounds,container.borders.borders.map(getWidth));},this);this.renderer.clip(container.clip,function(){this.renderer.renderBorders(container.borders.borders);},this);this.renderer.clip(container.backgroundClip,function(){switch(container.node.nodeName){case\"svg\":case\"IFRAME\":var imgContainer=this.images.get(container.node);if(imgContainer){this.renderer.renderImage(container,bounds,container.borders,imgContainer);}else{log(\"Error loading <\"+container.node.nodeName+\">\",container.node);}break;case\"IMG\":var imageContainer=this.images.get(container.node.src);if(imageContainer){this.renderer.renderImage(container,bounds,container.borders,imageContainer);}else{log(\"Error loading <img>\",container.node.src);}break;case\"CANVAS\":this.renderer.renderImage(container,bounds,container.borders,{image:container.node});break;case\"SELECT\":case\"INPUT\":case\"TEXTAREA\":this.paintFormValue(container);break;}},this);};NodeParser.prototype.paintCheckbox=function(container){var b=container.parseBounds();var size=Math.min(b.width,b.height);var bounds={width:size-1,height:size-1,top:b.top,left:b.left};var r=[3,3];var radius=[r,r,r,r];var borders=[1,1,1,1].map(function(w){return{color:new Color('#A5A5A5'),width:w};});var borderPoints=calculateCurvePoints(bounds,radius,borders);this.renderer.clip(container.backgroundClip,function(){this.renderer.rectangle(bounds.left+1,bounds.top+1,bounds.width-2,bounds.height-2,new Color(\"#DEDEDE\"));this.renderer.renderBorders(calculateBorders(borders,bounds,borderPoints,radius));if(container.node.checked){this.renderer.font(new Color('#424242'),'normal','normal','bold',size-3+\"px\",'arial');this.renderer.text(\"\",bounds.left+size/6,bounds.top+size-1);}},this);};NodeParser.prototype.paintRadio=function(container){var bounds=container.parseBounds();var size=Math.min(bounds.width,bounds.height)-2;this.renderer.clip(container.backgroundClip,function(){this.renderer.circleStroke(bounds.left+1,bounds.top+1,size,new Color('#DEDEDE'),1,new Color('#A5A5A5'));if(container.node.checked){this.renderer.circle(Math.ceil(bounds.left+size/4)+1,Math.ceil(bounds.top+size/4)+1,Math.floor(size/2),new Color('#424242'));}},this);};NodeParser.prototype.paintFormValue=function(container){var value=container.getValue();if(value.length>0){var document=container.node.ownerDocument;var wrapper=document.createElement('html2canvaswrapper');var properties=['lineHeight','textAlign','fontFamily','fontWeight','fontSize','color','paddingLeft','paddingTop','paddingRight','paddingBottom','width','height','borderLeftStyle','borderTopStyle','borderLeftWidth','borderTopWidth','boxSizing','whiteSpace','wordWrap'];properties.forEach(function(property){try{wrapper.style[property]=container.css(property);}catch(e){// Older IE has issues with \"border\"\n\tlog(\"html2canvas: Parse: Exception caught in renderFormValue: \"+e.message);}});var bounds=container.parseBounds();wrapper.style.position=\"fixed\";wrapper.style.left=bounds.left+\"px\";wrapper.style.top=bounds.top+\"px\";wrapper.textContent=value;document.body.appendChild(wrapper);this.paintText(new TextContainer(wrapper.firstChild,container));document.body.removeChild(wrapper);}};NodeParser.prototype.paintText=function(container){container.applyTextTransform();var characters=punycode.ucs2.decode(container.node.data);var textList=(!this.options.letterRendering||noLetterSpacing(container))&&!hasUnicode(container.node.data)?getWords(characters):characters.map(function(character){return punycode.ucs2.encode([character]);});var weight=container.parent.fontWeight();var size=container.parent.css('fontSize');var family=container.parent.css('fontFamily');var shadows=container.parent.parseTextShadows();this.renderer.font(container.parent.color('color'),container.parent.css('fontStyle'),container.parent.css('fontVariant'),weight,size,family);if(shadows.length){// TODO: support multiple text shadows\n\tthis.renderer.fontShadow(shadows[0].color,shadows[0].offsetX,shadows[0].offsetY,shadows[0].blur);}else{this.renderer.clearShadow();}this.renderer.clip(container.parent.clip,function(){textList.map(this.parseTextBounds(container),this).forEach(function(bounds,index){if(bounds){this.renderer.text(textList[index],bounds.left,bounds.bottom);this.renderTextDecoration(container.parent,bounds,this.fontMetrics.getMetrics(family,size));}},this);},this);};NodeParser.prototype.renderTextDecoration=function(container,bounds,metrics){switch(container.css(\"textDecoration\").split(\" \")[0]){case\"underline\":// Draws a line at the baseline of the font\n\t// TODO As some browsers display the line as more than 1px if the font-size is big, need to take that into account both in position and size\n\tthis.renderer.rectangle(bounds.left,Math.round(bounds.top+metrics.baseline+metrics.lineWidth),bounds.width,1,container.color(\"color\"));break;case\"overline\":this.renderer.rectangle(bounds.left,Math.round(bounds.top),bounds.width,1,container.color(\"color\"));break;case\"line-through\":// TODO try and find exact position for line-through\n\tthis.renderer.rectangle(bounds.left,Math.ceil(bounds.top+metrics.middle+metrics.lineWidth),bounds.width,1,container.color(\"color\"));break;}};var borderColorTransforms={inset:[[\"darken\",0.60],[\"darken\",0.10],[\"darken\",0.10],[\"darken\",0.60]]};NodeParser.prototype.parseBorders=function(container){var nodeBounds=container.parseBounds();var radius=getBorderRadiusData(container);var borders=[\"Top\",\"Right\",\"Bottom\",\"Left\"].map(function(side,index){var style=container.css('border'+side+'Style');var color=container.color('border'+side+'Color');if(style===\"inset\"&&color.isBlack()){color=new Color([255,255,255,color.a]);// this is wrong, but\n\t}var colorTransform=borderColorTransforms[style]?borderColorTransforms[style][index]:null;return{width:container.cssInt('border'+side+'Width'),color:colorTransform?color[colorTransform[0]](colorTransform[1]):color,args:null};});var borderPoints=calculateCurvePoints(nodeBounds,radius,borders);return{clip:this.parseBackgroundClip(container,borderPoints,borders,radius,nodeBounds),borders:calculateBorders(borders,nodeBounds,borderPoints,radius)};};function calculateBorders(borders,nodeBounds,borderPoints,radius){return borders.map(function(border,borderSide){if(border.width>0){var bx=nodeBounds.left;var by=nodeBounds.top;var bw=nodeBounds.width;var bh=nodeBounds.height-borders[2].width;switch(borderSide){case 0:// top border\n\tbh=borders[0].width;border.args=drawSide({c1:[bx,by],c2:[bx+bw,by],c3:[bx+bw-borders[1].width,by+bh],c4:[bx+borders[3].width,by+bh]},radius[0],radius[1],borderPoints.topLeftOuter,borderPoints.topLeftInner,borderPoints.topRightOuter,borderPoints.topRightInner);break;case 1:// right border\n\tbx=nodeBounds.left+nodeBounds.width-borders[1].width;bw=borders[1].width;border.args=drawSide({c1:[bx+bw,by],c2:[bx+bw,by+bh+borders[2].width],c3:[bx,by+bh],c4:[bx,by+borders[0].width]},radius[1],radius[2],borderPoints.topRightOuter,borderPoints.topRightInner,borderPoints.bottomRightOuter,borderPoints.bottomRightInner);break;case 2:// bottom border\n\tby=by+nodeBounds.height-borders[2].width;bh=borders[2].width;border.args=drawSide({c1:[bx+bw,by+bh],c2:[bx,by+bh],c3:[bx+borders[3].width,by],c4:[bx+bw-borders[3].width,by]},radius[2],radius[3],borderPoints.bottomRightOuter,borderPoints.bottomRightInner,borderPoints.bottomLeftOuter,borderPoints.bottomLeftInner);break;case 3:// left border\n\tbw=borders[3].width;border.args=drawSide({c1:[bx,by+bh+borders[2].width],c2:[bx,by],c3:[bx+bw,by+borders[0].width],c4:[bx+bw,by+bh]},radius[3],radius[0],borderPoints.bottomLeftOuter,borderPoints.bottomLeftInner,borderPoints.topLeftOuter,borderPoints.topLeftInner);break;}}return border;});}NodeParser.prototype.parseBackgroundClip=function(container,borderPoints,borders,radius,bounds){var backgroundClip=container.css('backgroundClip'),borderArgs=[];switch(backgroundClip){case\"content-box\":case\"padding-box\":parseCorner(borderArgs,radius[0],radius[1],borderPoints.topLeftInner,borderPoints.topRightInner,bounds.left+borders[3].width,bounds.top+borders[0].width);parseCorner(borderArgs,radius[1],radius[2],borderPoints.topRightInner,borderPoints.bottomRightInner,bounds.left+bounds.width-borders[1].width,bounds.top+borders[0].width);parseCorner(borderArgs,radius[2],radius[3],borderPoints.bottomRightInner,borderPoints.bottomLeftInner,bounds.left+bounds.width-borders[1].width,bounds.top+bounds.height-borders[2].width);parseCorner(borderArgs,radius[3],radius[0],borderPoints.bottomLeftInner,borderPoints.topLeftInner,bounds.left+borders[3].width,bounds.top+bounds.height-borders[2].width);break;default:parseCorner(borderArgs,radius[0],radius[1],borderPoints.topLeftOuter,borderPoints.topRightOuter,bounds.left,bounds.top);parseCorner(borderArgs,radius[1],radius[2],borderPoints.topRightOuter,borderPoints.bottomRightOuter,bounds.left+bounds.width,bounds.top);parseCorner(borderArgs,radius[2],radius[3],borderPoints.bottomRightOuter,borderPoints.bottomLeftOuter,bounds.left+bounds.width,bounds.top+bounds.height);parseCorner(borderArgs,radius[3],radius[0],borderPoints.bottomLeftOuter,borderPoints.topLeftOuter,bounds.left,bounds.top+bounds.height);break;}return borderArgs;};function getCurvePoints(x,y,r1,r2){var kappa=4*((Math.sqrt(2)-1)/3);var ox=r1*kappa,// control point offset horizontal\n\toy=r2*kappa,// control point offset vertical\n\txm=x+r1,// x-middle\n\tym=y+r2;// y-middle\n\treturn{topLeft:bezierCurve({x:x,y:ym},{x:x,y:ym-oy},{x:xm-ox,y:y},{x:xm,y:y}),topRight:bezierCurve({x:x,y:y},{x:x+ox,y:y},{x:xm,y:ym-oy},{x:xm,y:ym}),bottomRight:bezierCurve({x:xm,y:y},{x:xm,y:y+oy},{x:x+ox,y:ym},{x:x,y:ym}),bottomLeft:bezierCurve({x:xm,y:ym},{x:xm-ox,y:ym},{x:x,y:y+oy},{x:x,y:y})};}function calculateCurvePoints(bounds,borderRadius,borders){var x=bounds.left,y=bounds.top,width=bounds.width,height=bounds.height,tlh=borderRadius[0][0]<width/2?borderRadius[0][0]:width/2,tlv=borderRadius[0][1]<height/2?borderRadius[0][1]:height/2,trh=borderRadius[1][0]<width/2?borderRadius[1][0]:width/2,trv=borderRadius[1][1]<height/2?borderRadius[1][1]:height/2,brh=borderRadius[2][0]<width/2?borderRadius[2][0]:width/2,brv=borderRadius[2][1]<height/2?borderRadius[2][1]:height/2,blh=borderRadius[3][0]<width/2?borderRadius[3][0]:width/2,blv=borderRadius[3][1]<height/2?borderRadius[3][1]:height/2;var topWidth=width-trh,rightHeight=height-brv,bottomWidth=width-brh,leftHeight=height-blv;return{topLeftOuter:getCurvePoints(x,y,tlh,tlv).topLeft.subdivide(0.5),topLeftInner:getCurvePoints(x+borders[3].width,y+borders[0].width,Math.max(0,tlh-borders[3].width),Math.max(0,tlv-borders[0].width)).topLeft.subdivide(0.5),topRightOuter:getCurvePoints(x+topWidth,y,trh,trv).topRight.subdivide(0.5),topRightInner:getCurvePoints(x+Math.min(topWidth,width+borders[3].width),y+borders[0].width,topWidth>width+borders[3].width?0:trh-borders[3].width,trv-borders[0].width).topRight.subdivide(0.5),bottomRightOuter:getCurvePoints(x+bottomWidth,y+rightHeight,brh,brv).bottomRight.subdivide(0.5),bottomRightInner:getCurvePoints(x+Math.min(bottomWidth,width-borders[3].width),y+Math.min(rightHeight,height+borders[0].width),Math.max(0,brh-borders[1].width),brv-borders[2].width).bottomRight.subdivide(0.5),bottomLeftOuter:getCurvePoints(x,y+leftHeight,blh,blv).bottomLeft.subdivide(0.5),bottomLeftInner:getCurvePoints(x+borders[3].width,y+leftHeight,Math.max(0,blh-borders[3].width),blv-borders[2].width).bottomLeft.subdivide(0.5)};}function bezierCurve(start,startControl,endControl,end){var lerp=function lerp(a,b,t){return{x:a.x+(b.x-a.x)*t,y:a.y+(b.y-a.y)*t};};return{start:start,startControl:startControl,endControl:endControl,end:end,subdivide:function subdivide(t){var ab=lerp(start,startControl,t),bc=lerp(startControl,endControl,t),cd=lerp(endControl,end,t),abbc=lerp(ab,bc,t),bccd=lerp(bc,cd,t),dest=lerp(abbc,bccd,t);return[bezierCurve(start,ab,abbc,dest),bezierCurve(dest,bccd,cd,end)];},curveTo:function curveTo(borderArgs){borderArgs.push([\"bezierCurve\",startControl.x,startControl.y,endControl.x,endControl.y,end.x,end.y]);},curveToReversed:function curveToReversed(borderArgs){borderArgs.push([\"bezierCurve\",endControl.x,endControl.y,startControl.x,startControl.y,start.x,start.y]);}};}function drawSide(borderData,radius1,radius2,outer1,inner1,outer2,inner2){var borderArgs=[];if(radius1[0]>0||radius1[1]>0){borderArgs.push([\"line\",outer1[1].start.x,outer1[1].start.y]);outer1[1].curveTo(borderArgs);}else{borderArgs.push([\"line\",borderData.c1[0],borderData.c1[1]]);}if(radius2[0]>0||radius2[1]>0){borderArgs.push([\"line\",outer2[0].start.x,outer2[0].start.y]);outer2[0].curveTo(borderArgs);borderArgs.push([\"line\",inner2[0].end.x,inner2[0].end.y]);inner2[0].curveToReversed(borderArgs);}else{borderArgs.push([\"line\",borderData.c2[0],borderData.c2[1]]);borderArgs.push([\"line\",borderData.c3[0],borderData.c3[1]]);}if(radius1[0]>0||radius1[1]>0){borderArgs.push([\"line\",inner1[1].end.x,inner1[1].end.y]);inner1[1].curveToReversed(borderArgs);}else{borderArgs.push([\"line\",borderData.c4[0],borderData.c4[1]]);}return borderArgs;}function parseCorner(borderArgs,radius1,radius2,corner1,corner2,x,y){if(radius1[0]>0||radius1[1]>0){borderArgs.push([\"line\",corner1[0].start.x,corner1[0].start.y]);corner1[0].curveTo(borderArgs);corner1[1].curveTo(borderArgs);}else{borderArgs.push([\"line\",x,y]);}if(radius2[0]>0||radius2[1]>0){borderArgs.push([\"line\",corner2[0].start.x,corner2[0].start.y]);}}function negativeZIndex(container){return container.cssInt(\"zIndex\")<0;}function positiveZIndex(container){return container.cssInt(\"zIndex\")>0;}function zIndex0(container){return container.cssInt(\"zIndex\")===0;}function inlineLevel(container){return[\"inline\",\"inline-block\",\"inline-table\"].indexOf(container.css(\"display\"))!==-1;}function isStackingContext(container){return container instanceof StackingContext;}function hasText(container){return container.node.data.trim().length>0;}function noLetterSpacing(container){return /^(normal|none|0px)$/.test(container.parent.css(\"letterSpacing\"));}function getBorderRadiusData(container){return[\"TopLeft\",\"TopRight\",\"BottomRight\",\"BottomLeft\"].map(function(side){var value=container.css('border'+side+'Radius');var arr=value.split(\" \");if(arr.length<=1){arr[1]=arr[0];}return arr.map(asInt);});}function renderableNode(node){return node.nodeType===Node.TEXT_NODE||node.nodeType===Node.ELEMENT_NODE;}function isPositionedForStacking(container){var position=container.css(\"position\");var zIndex=[\"absolute\",\"relative\",\"fixed\"].indexOf(position)!==-1?container.css(\"zIndex\"):\"auto\";return zIndex!==\"auto\";}function isPositioned(container){return container.css(\"position\")!==\"static\";}function isFloating(container){return container.css(\"float\")!==\"none\";}function isInlineBlock(container){return[\"inline-block\",\"inline-table\"].indexOf(container.css(\"display\"))!==-1;}function not(callback){var context=this;return function(){return!callback.apply(context,arguments);};}function isElement(container){return container.node.nodeType===Node.ELEMENT_NODE;}function isPseudoElement(container){return container.isPseudoElement===true;}function isTextNode(container){return container.node.nodeType===Node.TEXT_NODE;}function zIndexSort(contexts){return function(a,b){return a.cssInt(\"zIndex\")+contexts.indexOf(a)/contexts.length-(b.cssInt(\"zIndex\")+contexts.indexOf(b)/contexts.length);};}function hasOpacity(container){return container.getOpacity()<1;}function asInt(value){return parseInt(value,10);}function getWidth(border){return border.width;}function nonIgnoredElement(nodeContainer){return nodeContainer.node.nodeType!==Node.ELEMENT_NODE||[\"SCRIPT\",\"HEAD\",\"TITLE\",\"OBJECT\",\"BR\",\"OPTION\"].indexOf(nodeContainer.node.nodeName)===-1;}function flatten(arrays){return[].concat.apply([],arrays);}function stripQuotes(content){var first=content.substr(0,1);return first===content.substr(content.length-1)&&first.match(/'|\"/)?content.substr(1,content.length-2):content;}function getWords(characters){var words=[],i=0,onWordBoundary=false,word;while(characters.length){if(isWordBoundary(characters[i])===onWordBoundary){word=characters.splice(0,i);if(word.length){words.push(punycode.ucs2.encode(word));}onWordBoundary=!onWordBoundary;i=0;}else{i++;}if(i>=characters.length){word=characters.splice(0,i);if(word.length){words.push(punycode.ucs2.encode(word));}}}return words;}function isWordBoundary(characterCode){return[32,// <space>\n\t13,// \\r\n\t10,// \\n\n\t9,// \\t\n\t45// -\n\t].indexOf(characterCode)!==-1;}function hasUnicode(string){return /[^\\u0000-\\u00ff]/.test(string);}module.exports=NodeParser;},{\"./color\":3,\"./fontmetrics\":7,\"./log\":13,\"./nodecontainer\":14,\"./pseudoelementcontainer\":18,\"./stackingcontext\":21,\"./textcontainer\":25,\"./utils\":26,\"punycode\":1}],16:[function(_dereq_,module,exports){var XHR=_dereq_('./xhr');var utils=_dereq_('./utils');var log=_dereq_('./log');var createWindowClone=_dereq_('./clone');var decode64=utils.decode64;function Proxy(src,proxyUrl,document){var supportsCORS='withCredentials'in new XMLHttpRequest();if(!proxyUrl){return Promise.reject(\"No proxy configured\");}var callback=createCallback(supportsCORS);var url=createProxyUrl(proxyUrl,src,callback);return supportsCORS?XHR(url):jsonp(document,url,callback).then(function(response){return decode64(response.content);});}var proxyCount=0;function ProxyURL(src,proxyUrl,document){var supportsCORSImage='crossOrigin'in new Image();var callback=createCallback(supportsCORSImage);var url=createProxyUrl(proxyUrl,src,callback);return supportsCORSImage?Promise.resolve(url):jsonp(document,url,callback).then(function(response){return\"data:\"+response.type+\";base64,\"+response.content;});}function jsonp(document,url,callback){return new Promise(function(resolve,reject){var s=document.createElement(\"script\");var cleanup=function cleanup(){delete window.html2canvas.proxy[callback];document.body.removeChild(s);};window.html2canvas.proxy[callback]=function(response){cleanup();resolve(response);};s.src=url;s.onerror=function(e){cleanup();reject(e);};document.body.appendChild(s);});}function createCallback(useCORS){return!useCORS?\"html2canvas_\"+Date.now()+\"_\"+ ++proxyCount+\"_\"+Math.round(Math.random()*100000):\"\";}function createProxyUrl(proxyUrl,src,callback){return proxyUrl+\"?url=\"+encodeURIComponent(src)+(callback.length?\"&callback=html2canvas.proxy.\"+callback:\"\");}function documentFromHTML(src){return function(html){var parser=new DOMParser(),doc;try{doc=parser.parseFromString(html,\"text/html\");}catch(e){log(\"DOMParser not supported, falling back to createHTMLDocument\");doc=document.implementation.createHTMLDocument(\"\");try{doc.open();doc.write(html);doc.close();}catch(ee){log(\"createHTMLDocument write not supported, falling back to document.body.innerHTML\");doc.body.innerHTML=html;// ie9 doesnt support writing to documentElement\n\t}}var b=doc.querySelector(\"base\");if(!b||!b.href.host){var base=doc.createElement(\"base\");base.href=src;doc.head.insertBefore(base,doc.head.firstChild);}return doc;};}function loadUrlDocument(src,proxy,document,width,height,options){return new Proxy(src,proxy,window.document).then(documentFromHTML(src)).then(function(doc){return createWindowClone(doc,document,width,height,options,0,0);});}exports.Proxy=Proxy;exports.ProxyURL=ProxyURL;exports.loadUrlDocument=loadUrlDocument;},{\"./clone\":2,\"./log\":13,\"./utils\":26,\"./xhr\":28}],17:[function(_dereq_,module,exports){var ProxyURL=_dereq_('./proxy').ProxyURL;function ProxyImageContainer(src,proxy){var link=document.createElement(\"a\");link.href=src;src=link.href;this.src=src;this.image=new Image();var self=this;this.promise=new Promise(function(resolve,reject){self.image.crossOrigin=\"Anonymous\";self.image.onload=resolve;self.image.onerror=reject;new ProxyURL(src,proxy,document).then(function(url){self.image.src=url;})['catch'](reject);});}module.exports=ProxyImageContainer;},{\"./proxy\":16}],18:[function(_dereq_,module,exports){var NodeContainer=_dereq_('./nodecontainer');function PseudoElementContainer(node,parent,type){NodeContainer.call(this,node,parent);this.isPseudoElement=true;this.before=type===\":before\";}PseudoElementContainer.prototype.cloneTo=function(stack){PseudoElementContainer.prototype.cloneTo.call(this,stack);stack.isPseudoElement=true;stack.before=this.before;};PseudoElementContainer.prototype=Object.create(NodeContainer.prototype);PseudoElementContainer.prototype.appendToDOM=function(){if(this.before){this.parent.node.insertBefore(this.node,this.parent.node.firstChild);}else{this.parent.node.appendChild(this.node);}this.parent.node.className+=\" \"+this.getHideClass();};PseudoElementContainer.prototype.cleanDOM=function(){this.node.parentNode.removeChild(this.node);this.parent.node.className=this.parent.node.className.replace(this.getHideClass(),\"\");};PseudoElementContainer.prototype.getHideClass=function(){return this[\"PSEUDO_HIDE_ELEMENT_CLASS_\"+(this.before?\"BEFORE\":\"AFTER\")];};PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE=\"___html2canvas___pseudoelement_before\";PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER=\"___html2canvas___pseudoelement_after\";module.exports=PseudoElementContainer;},{\"./nodecontainer\":14}],19:[function(_dereq_,module,exports){var log=_dereq_('./log');function Renderer(width,height,images,options,document){this.width=width;this.height=height;this.images=images;this.options=options;this.document=document;}Renderer.prototype.renderImage=function(container,bounds,borderData,imageContainer){var paddingLeft=container.cssInt('paddingLeft'),paddingTop=container.cssInt('paddingTop'),paddingRight=container.cssInt('paddingRight'),paddingBottom=container.cssInt('paddingBottom'),borders=borderData.borders;var width=bounds.width-(borders[1].width+borders[3].width+paddingLeft+paddingRight);var height=bounds.height-(borders[0].width+borders[2].width+paddingTop+paddingBottom);this.drawImage(imageContainer,0,0,imageContainer.image.width||width,imageContainer.image.height||height,bounds.left+paddingLeft+borders[3].width,bounds.top+paddingTop+borders[0].width,width,height);};Renderer.prototype.renderBackground=function(container,bounds,borderData){if(bounds.height>0&&bounds.width>0){this.renderBackgroundColor(container,bounds);this.renderBackgroundImage(container,bounds,borderData);}};Renderer.prototype.renderBackgroundColor=function(container,bounds){var color=container.color(\"backgroundColor\");if(!color.isTransparent()){this.rectangle(bounds.left,bounds.top,bounds.width,bounds.height,color);}};Renderer.prototype.renderBorders=function(borders){borders.forEach(this.renderBorder,this);};Renderer.prototype.renderBorder=function(data){if(!data.color.isTransparent()&&data.args!==null){this.drawShape(data.args,data.color);}};Renderer.prototype.renderBackgroundImage=function(container,bounds,borderData){var backgroundImages=container.parseBackgroundImages();backgroundImages.reverse().forEach(function(backgroundImage,index,arr){switch(backgroundImage.method){case\"url\":var image=this.images.get(backgroundImage.args[0]);if(image){this.renderBackgroundRepeating(container,bounds,image,arr.length-(index+1),borderData);}else{log(\"Error loading background-image\",backgroundImage.args[0]);}break;case\"linear-gradient\":case\"gradient\":var gradientImage=this.images.get(backgroundImage.value);if(gradientImage){this.renderBackgroundGradient(gradientImage,bounds,borderData);}else{log(\"Error loading background-image\",backgroundImage.args[0]);}break;case\"none\":break;default:log(\"Unknown background-image type\",backgroundImage.args[0]);}},this);};Renderer.prototype.renderBackgroundRepeating=function(container,bounds,imageContainer,index,borderData){var size=container.parseBackgroundSize(bounds,imageContainer.image,index);var position=container.parseBackgroundPosition(bounds,imageContainer.image,index,size);var repeat=container.parseBackgroundRepeat(index);switch(repeat){case\"repeat-x\":case\"repeat no-repeat\":this.backgroundRepeatShape(imageContainer,position,size,bounds,bounds.left+borderData[3],bounds.top+position.top+borderData[0],99999,size.height,borderData);break;case\"repeat-y\":case\"no-repeat repeat\":this.backgroundRepeatShape(imageContainer,position,size,bounds,bounds.left+position.left+borderData[3],bounds.top+borderData[0],size.width,99999,borderData);break;case\"no-repeat\":this.backgroundRepeatShape(imageContainer,position,size,bounds,bounds.left+position.left+borderData[3],bounds.top+position.top+borderData[0],size.width,size.height,borderData);break;default:this.renderBackgroundRepeat(imageContainer,position,size,{top:bounds.top,left:bounds.left},borderData[3],borderData[0]);break;}};module.exports=Renderer;},{\"./log\":13}],20:[function(_dereq_,module,exports){var Renderer=_dereq_('../renderer');var LinearGradientContainer=_dereq_('../lineargradientcontainer');var log=_dereq_('../log');function CanvasRenderer(width,height){Renderer.apply(this,arguments);this.canvas=this.options.canvas||this.document.createElement(\"canvas\");if(!this.options.canvas){this.canvas.width=width;this.canvas.height=height;}this.ctx=this.canvas.getContext(\"2d\");this.taintCtx=this.document.createElement(\"canvas\").getContext(\"2d\");this.ctx.textBaseline=\"bottom\";this.variables={};log(\"Initialized CanvasRenderer with size\",width,\"x\",height);}CanvasRenderer.prototype=Object.create(Renderer.prototype);CanvasRenderer.prototype.setFillStyle=function(fillStyle){this.ctx.fillStyle=(typeof fillStyle===\"undefined\"?\"undefined\":_typeof(fillStyle))===\"object\"&&!!fillStyle.isColor?fillStyle.toString():fillStyle;return this.ctx;};CanvasRenderer.prototype.rectangle=function(left,top,width,height,color){this.setFillStyle(color).fillRect(left,top,width,height);};CanvasRenderer.prototype.circle=function(left,top,size,color){this.setFillStyle(color);this.ctx.beginPath();this.ctx.arc(left+size/2,top+size/2,size/2,0,Math.PI*2,true);this.ctx.closePath();this.ctx.fill();};CanvasRenderer.prototype.circleStroke=function(left,top,size,color,stroke,strokeColor){this.circle(left,top,size,color);this.ctx.strokeStyle=strokeColor.toString();this.ctx.stroke();};CanvasRenderer.prototype.drawShape=function(shape,color){this.shape(shape);this.setFillStyle(color).fill();};CanvasRenderer.prototype.taints=function(imageContainer){if(imageContainer.tainted===null){this.taintCtx.drawImage(imageContainer.image,0,0);try{this.taintCtx.getImageData(0,0,1,1);imageContainer.tainted=false;}catch(e){this.taintCtx=document.createElement(\"canvas\").getContext(\"2d\");imageContainer.tainted=true;}}return imageContainer.tainted;};CanvasRenderer.prototype.drawImage=function(imageContainer,sx,sy,sw,sh,dx,dy,dw,dh){if(!this.taints(imageContainer)||this.options.allowTaint){this.ctx.drawImage(imageContainer.image,sx,sy,sw,sh,dx,dy,dw,dh);}};CanvasRenderer.prototype.clip=function(shapes,callback,context){this.ctx.save();shapes.filter(hasEntries).forEach(function(shape){this.shape(shape).clip();},this);callback.call(context);this.ctx.restore();};CanvasRenderer.prototype.shape=function(shape){this.ctx.beginPath();shape.forEach(function(point,index){if(point[0]===\"rect\"){this.ctx.rect.apply(this.ctx,point.slice(1));}else{this.ctx[index===0?\"moveTo\":point[0]+\"To\"].apply(this.ctx,point.slice(1));}},this);this.ctx.closePath();return this.ctx;};CanvasRenderer.prototype.font=function(color,style,variant,weight,size,family){this.setFillStyle(color).font=[style,variant,weight,size,family].join(\" \").split(\",\")[0];};CanvasRenderer.prototype.fontShadow=function(color,offsetX,offsetY,blur){this.setVariable(\"shadowColor\",color.toString()).setVariable(\"shadowOffsetY\",offsetX).setVariable(\"shadowOffsetX\",offsetY).setVariable(\"shadowBlur\",blur);};CanvasRenderer.prototype.clearShadow=function(){this.setVariable(\"shadowColor\",\"rgba(0,0,0,0)\");};CanvasRenderer.prototype.setOpacity=function(opacity){this.ctx.globalAlpha=opacity;};CanvasRenderer.prototype.setTransform=function(transform){this.ctx.translate(transform.origin[0],transform.origin[1]);this.ctx.transform.apply(this.ctx,transform.matrix);this.ctx.translate(-transform.origin[0],-transform.origin[1]);};CanvasRenderer.prototype.setVariable=function(property,value){if(this.variables[property]!==value){this.variables[property]=this.ctx[property]=value;}return this;};CanvasRenderer.prototype.text=function(text,left,bottom){this.ctx.fillText(text,left,bottom);};CanvasRenderer.prototype.backgroundRepeatShape=function(imageContainer,backgroundPosition,size,bounds,left,top,width,height,borderData){var shape=[[\"line\",Math.round(left),Math.round(top)],[\"line\",Math.round(left+width),Math.round(top)],[\"line\",Math.round(left+width),Math.round(height+top)],[\"line\",Math.round(left),Math.round(height+top)]];this.clip([shape],function(){this.renderBackgroundRepeat(imageContainer,backgroundPosition,size,bounds,borderData[3],borderData[0]);},this);};CanvasRenderer.prototype.renderBackgroundRepeat=function(imageContainer,backgroundPosition,size,bounds,borderLeft,borderTop){var offsetX=Math.round(bounds.left+backgroundPosition.left+borderLeft),offsetY=Math.round(bounds.top+backgroundPosition.top+borderTop);this.setFillStyle(this.ctx.createPattern(this.resizeImage(imageContainer,size),\"repeat\"));this.ctx.translate(offsetX,offsetY);this.ctx.fill();this.ctx.translate(-offsetX,-offsetY);};CanvasRenderer.prototype.renderBackgroundGradient=function(gradientImage,bounds){if(gradientImage instanceof LinearGradientContainer){var gradient=this.ctx.createLinearGradient(bounds.left+bounds.width*gradientImage.x0,bounds.top+bounds.height*gradientImage.y0,bounds.left+bounds.width*gradientImage.x1,bounds.top+bounds.height*gradientImage.y1);gradientImage.colorStops.forEach(function(colorStop){gradient.addColorStop(colorStop.stop,colorStop.color.toString());});this.rectangle(bounds.left,bounds.top,bounds.width,bounds.height,gradient);}};CanvasRenderer.prototype.resizeImage=function(imageContainer,size){var image=imageContainer.image;if(image.width===size.width&&image.height===size.height){return image;}var ctx,canvas=document.createElement('canvas');canvas.width=size.width;canvas.height=size.height;ctx=canvas.getContext(\"2d\");ctx.drawImage(image,0,0,image.width,image.height,0,0,size.width,size.height);return canvas;};function hasEntries(array){return array.length>0;}module.exports=CanvasRenderer;},{\"../lineargradientcontainer\":12,\"../log\":13,\"../renderer\":19}],21:[function(_dereq_,module,exports){var NodeContainer=_dereq_('./nodecontainer');function StackingContext(hasOwnStacking,opacity,element,parent){NodeContainer.call(this,element,parent);this.ownStacking=hasOwnStacking;this.contexts=[];this.children=[];this.opacity=(this.parent?this.parent.stack.opacity:1)*opacity;}StackingContext.prototype=Object.create(NodeContainer.prototype);StackingContext.prototype.getParentStack=function(context){var parentStack=this.parent?this.parent.stack:null;return parentStack?parentStack.ownStacking?parentStack:parentStack.getParentStack(context):context.stack;};module.exports=StackingContext;},{\"./nodecontainer\":14}],22:[function(_dereq_,module,exports){function Support(document){this.rangeBounds=this.testRangeBounds(document);this.cors=this.testCORS();this.svg=this.testSVG();}Support.prototype.testRangeBounds=function(document){var range,testElement,rangeBounds,rangeHeight,support=false;if(document.createRange){range=document.createRange();if(range.getBoundingClientRect){testElement=document.createElement('boundtest');testElement.style.height=\"123px\";testElement.style.display=\"block\";document.body.appendChild(testElement);range.selectNode(testElement);rangeBounds=range.getBoundingClientRect();rangeHeight=rangeBounds.height;if(rangeHeight===123){support=true;}document.body.removeChild(testElement);}}return support;};Support.prototype.testCORS=function(){return typeof new Image().crossOrigin!==\"undefined\";};Support.prototype.testSVG=function(){var img=new Image();var canvas=document.createElement(\"canvas\");var ctx=canvas.getContext(\"2d\");img.src=\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>\";try{ctx.drawImage(img,0,0);canvas.toDataURL();}catch(e){return false;}return true;};module.exports=Support;},{}],23:[function(_dereq_,module,exports){var XHR=_dereq_('./xhr');var decode64=_dereq_('./utils').decode64;function SVGContainer(src){this.src=src;this.image=null;var self=this;this.promise=this.hasFabric().then(function(){return self.isInline(src)?Promise.resolve(self.inlineFormatting(src)):XHR(src);}).then(function(svg){return new Promise(function(resolve){window.html2canvas.svg.fabric.loadSVGFromString(svg,self.createCanvas.call(self,resolve));});});}SVGContainer.prototype.hasFabric=function(){return!window.html2canvas.svg||!window.html2canvas.svg.fabric?Promise.reject(new Error(\"html2canvas.svg.js is not loaded, cannot render svg\")):Promise.resolve();};SVGContainer.prototype.inlineFormatting=function(src){return /^data:image\\/svg\\+xml;base64,/.test(src)?this.decode64(this.removeContentType(src)):this.removeContentType(src);};SVGContainer.prototype.removeContentType=function(src){return src.replace(/^data:image\\/svg\\+xml(;base64)?,/,'');};SVGContainer.prototype.isInline=function(src){return /^data:image\\/svg\\+xml/i.test(src);};SVGContainer.prototype.createCanvas=function(resolve){var self=this;return function(objects,options){var canvas=new window.html2canvas.svg.fabric.StaticCanvas('c');self.image=canvas.lowerCanvasEl;canvas.setWidth(options.width).setHeight(options.height).add(window.html2canvas.svg.fabric.util.groupSVGElements(objects,options)).renderAll();resolve(canvas.lowerCanvasEl);};};SVGContainer.prototype.decode64=function(str){return typeof window.atob===\"function\"?window.atob(str):decode64(str);};module.exports=SVGContainer;},{\"./utils\":26,\"./xhr\":28}],24:[function(_dereq_,module,exports){var SVGContainer=_dereq_('./svgcontainer');function SVGNodeContainer(node,_native){this.src=node;this.image=null;var self=this;this.promise=_native?new Promise(function(resolve,reject){self.image=new Image();self.image.onload=resolve;self.image.onerror=reject;self.image.src=\"data:image/svg+xml,\"+new XMLSerializer().serializeToString(node);if(self.image.complete===true){resolve(self.image);}}):this.hasFabric().then(function(){return new Promise(function(resolve){window.html2canvas.svg.fabric.parseSVGDocument(node,self.createCanvas.call(self,resolve));});});}SVGNodeContainer.prototype=Object.create(SVGContainer.prototype);module.exports=SVGNodeContainer;},{\"./svgcontainer\":23}],25:[function(_dereq_,module,exports){var NodeContainer=_dereq_('./nodecontainer');function TextContainer(node,parent){NodeContainer.call(this,node,parent);}TextContainer.prototype=Object.create(NodeContainer.prototype);TextContainer.prototype.applyTextTransform=function(){this.node.data=this.transform(this.parent.css(\"textTransform\"));};TextContainer.prototype.transform=function(transform){var text=this.node.data;switch(transform){case\"lowercase\":return text.toLowerCase();case\"capitalize\":return text.replace(/(^|\\s|:|-|\\(|\\))([a-z])/g,capitalize);case\"uppercase\":return text.toUpperCase();default:return text;}};function capitalize(m,p1,p2){if(m.length>0){return p1+p2.toUpperCase();}}module.exports=TextContainer;},{\"./nodecontainer\":14}],26:[function(_dereq_,module,exports){exports.smallImage=function smallImage(){return\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";};exports.bind=function(callback,context){return function(){return callback.apply(context,arguments);};};/*\n\t * base64-arraybuffer\n\t * https://github.com/niklasvh/base64-arraybuffer\n\t *\n\t * Copyright (c) 2012 Niklas von Hertzen\n\t * Licensed under the MIT license.\n\t */exports.decode64=function(base64){var chars=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";var len=base64.length,i,encoded1,encoded2,encoded3,encoded4,byte1,byte2,byte3;var output=\"\";for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);byte1=encoded1<<2|encoded2>>4;byte2=(encoded2&15)<<4|encoded3>>2;byte3=(encoded3&3)<<6|encoded4;if(encoded3===64){output+=String.fromCharCode(byte1);}else if(encoded4===64||encoded4===-1){output+=String.fromCharCode(byte1,byte2);}else{output+=String.fromCharCode(byte1,byte2,byte3);}}return output;};exports.getBounds=function(node){if(node.getBoundingClientRect){var clientRect=node.getBoundingClientRect();var width=node.offsetWidth==null?clientRect.width:node.offsetWidth;return{top:clientRect.top,bottom:clientRect.bottom||clientRect.top+clientRect.height,right:clientRect.left+width,left:clientRect.left,width:width,height:node.offsetHeight==null?clientRect.height:node.offsetHeight};}return{};};exports.offsetBounds=function(node){var parent=node.offsetParent?exports.offsetBounds(node.offsetParent):{top:0,left:0};return{top:node.offsetTop+parent.top,bottom:node.offsetTop+node.offsetHeight+parent.top,right:node.offsetLeft+parent.left+node.offsetWidth,left:node.offsetLeft+parent.left,width:node.offsetWidth,height:node.offsetHeight};};exports.parseBackgrounds=function(backgroundImage){var whitespace=' \\r\\n\\t',method,definition,prefix,prefix_i,block,results=[],mode=0,numParen=0,quote,args;var appendResult=function appendResult(){if(method){if(definition.substr(0,1)==='\"'){definition=definition.substr(1,definition.length-2);}if(definition){args.push(definition);}if(method.substr(0,1)==='-'&&(prefix_i=method.indexOf('-',1)+1)>0){prefix=method.substr(0,prefix_i);method=method.substr(prefix_i);}results.push({prefix:prefix,method:method.toLowerCase(),value:block,args:args,image:null});}args=[];method=prefix=definition=block='';};args=[];method=prefix=definition=block='';backgroundImage.split(\"\").forEach(function(c){if(mode===0&&whitespace.indexOf(c)>-1){return;}switch(c){case'\"':if(!quote){quote=c;}else if(quote===c){quote=null;}break;case'(':if(quote){break;}else if(mode===0){mode=1;block+=c;return;}else{numParen++;}break;case')':if(quote){break;}else if(mode===1){if(numParen===0){mode=0;block+=c;appendResult();return;}else{numParen--;}}break;case',':if(quote){break;}else if(mode===0){appendResult();return;}else if(mode===1){if(numParen===0&&!method.match(/^url$/i)){args.push(definition);definition='';block+=c;return;}}break;}block+=c;if(mode===0){method+=c;}else{definition+=c;}});appendResult();return results;};},{}],27:[function(_dereq_,module,exports){var GradientContainer=_dereq_('./gradientcontainer');function WebkitGradientContainer(imageData){GradientContainer.apply(this,arguments);this.type=imageData.args[0]===\"linear\"?GradientContainer.TYPES.LINEAR:GradientContainer.TYPES.RADIAL;}WebkitGradientContainer.prototype=Object.create(GradientContainer.prototype);module.exports=WebkitGradientContainer;},{\"./gradientcontainer\":9}],28:[function(_dereq_,module,exports){function XHR(url){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest();xhr.open('GET',url);xhr.onload=function(){if(xhr.status===200){resolve(xhr.responseText);}else{reject(new Error(xhr.statusText));}};xhr.onerror=function(){reject(new Error(\"Network Error\"));};xhr.send();});}module.exports=XHR;},{}]},{},[4])(4);});\n\t/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }())))\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * base class for all object in the library\n\t * @class Baseobject\n\t */\n\tvar BaseObject = function () {\n\t  function BaseObject() {\n\t    _classCallCheck(this, BaseObject);\n\t  }\n\t\n\t  _createClass(BaseObject, [{\n\t    key: 'getName',\n\t\n\t    /**\n\t     * virtual function for returning class name\n\t     * @returns {string}\n\t     */\n\t    value: function getName() {\n\t      return '';\n\t    }\n\t\n\t    /**\n\t     * returns if current mode is debugging mode\n\t     * @returns {bool}\n\t     */\n\t\n\t  }, {\n\t    key: 'isDebug',\n\t    value: function isDebug() {\n\t      return this._debugMode;\n\t    }\n\t\n\t    /**\n\t     * logs message and object for debugging purpose\n\t     * @param {string} message\n\t     * @param {Array<any>} args\n\t     */\n\t\n\t  }, {\n\t    key: 'log',\n\t    value: function log(message) {\n\t      var _console;\n\t\n\t      if (!this.isDebug()) {\n\t        return;\n\t      }\n\t\n\t      for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t        args[_key - 1] = arguments[_key];\n\t      }\n\t\n\t      (_console = console).log.apply(_console, [this.getName() + ': ' + message].concat(args));\n\t    }\n\t  }]);\n\t\n\t  return BaseObject;\n\t}();\n\t\n\texports.default = BaseObject;\n\tmodule.exports = exports['default'];\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _baseObject = __webpack_require__(2);\n\t\n\tvar _baseObject2 = _interopRequireDefault(_baseObject);\n\t\n\tvar _rect = __webpack_require__(4);\n\t\n\tvar _rect2 = _interopRequireDefault(_rect);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\t/**\n\t * State enabled class to manage grey canvas on top of html page for cropping\n\t * @class CanvasState\n\t */\n\tvar CanvasState = function (_BaseObject) {\n\t  _inherits(CanvasState, _BaseObject);\n\t\n\t  /**\n\t   * object constructor\n\t   * @param {HTMLDocument} doc\n\t   * @param {HTMLElement} canvas - canvas DOM element\n\t   */\n\t  function CanvasState(doc, canvas) {\n\t    var debugMode = arguments.length <= 2 || arguments[2] === undefined ? true : arguments[2];\n\t\n\t    _classCallCheck(this, CanvasState);\n\t\n\t    var _this = _possibleConstructorReturn(this, (CanvasState.__proto__ || Object.getPrototypeOf(CanvasState)).call(this));\n\t\n\t    _this._onMouseDown = _this._onMouseDown.bind(_this);\n\t    _this._onMouseMove = _this._onMouseMove.bind(_this);\n\t    _this._onMouseUp = _this._onMouseUp.bind(_this);\n\t    _this._onTouch = _this._onTouch.bind(_this);\n\t\n\t    _this._document = doc;\n\t    _this._canvas = canvas;\n\t    _this._width = canvas.width;\n\t    _this._height = canvas.height;\n\t    _this._ctx = canvas.getContext('2d');\n\t    _this._debugMode = debugMode;\n\t\n\t    var html = _this._document.body.parentNode;\n\t\n\t    _this._htmlTop = html.offsetTop;\n\t    _this._htmlLeft = html.offsetLeft;\n\t\n\t    _this._valid = false; // when set to false, the canvas will redraw everything\n\t    _this._shape = null; // the rectangle shape\n\t    _this._dragging = false; // Keep track of when we are dragging\n\t    _this._dragoffx = 0; // See mousedown and mousemove events for explanation\n\t    _this._dragoffy = 0;\n\t\n\t    _this.log('initialized');\n\t\n\t    _this._initRect();\n\t    _this._initEvents();\n\t\n\t    _this._interval = 30;\n\t    setInterval(function () {\n\t      _this.draw();\n\t    }, _this._interval);\n\t    return _this;\n\t  }\n\t\n\t  /**\n\t   * returns class name\n\t   * @returns {string}\n\t   */\n\t\n\t\n\t  _createClass(CanvasState, [{\n\t    key: 'getName',\n\t    value: function getName() {\n\t      return 'CanvasState';\n\t    }\n\t  }, {\n\t    key: '_onMouseDown',\n\t    value: function _onMouseDown(e) {\n\t      var _shape = this._shape;\n\t\n\t      var mouse = this.getMouse(e);\n\t      var mx = mouse.x;\n\t      var my = mouse.y;\n\t      this._valid = false;\n\t      if (_shape.contains(mx, my)) {\n\t        this._dragoffx = mx - _shape._x;\n\t        this._dragoffy = my - _shape._y;\n\t        this._dragging = true;\n\t\n\t        this.log('mouse down detected. starting drag', mx, my);\n\t      }\n\t\n\t      this._currentHandle = this._shape.getHoverSelectionHandle(mouse.x, mouse.y);\n\t    }\n\t  }, {\n\t    key: '_onMouseMove',\n\t    value: function _onMouseMove(e) {\n\t      var _shape = this._shape;\n\t      var _canvas = this._canvas;\n\t\n\t      var mouse = this.getMouse(e);\n\t      var oldx = _shape._x;\n\t      var oldy = _shape._y;\n\t      var mx = mouse.x;\n\t      var my = mouse.y;\n\t      var handleIndex = _shape.getHoverSelectionHandle(mx, my);\n\t      switch (handleIndex) {\n\t        case 0:\n\t          _canvas.style.cursor = 'nw-resize';\n\t          break;\n\t        case 1:\n\t          _canvas.style.cursor = 'n-resize';\n\t          break;\n\t        case 2:\n\t          _canvas.style.cursor = 'ne-resize';\n\t          break;\n\t        case 3:\n\t          _canvas.style.cursor = 'w-resize';\n\t          break;\n\t        case 4:\n\t          _canvas.style.cursor = 'e-resize';\n\t          break;\n\t        case 5:\n\t          _canvas.style.cursor = 'sw-resize';\n\t          break;\n\t        case 6:\n\t          _canvas.style.cursor = 's-resize';\n\t          break;\n\t        case 7:\n\t          _canvas.style.cursor = 'se-resize';\n\t          break;\n\t        default:\n\t          _canvas.style.cursor = 'auto';\n\t      }\n\t\n\t      if (this._currentHandle !== false) {\n\t        // Handles resizing\n\t        switch (this._currentHandle) {\n\t          case 0:\n\t            _shape._x = mx;\n\t            _shape._y = my;\n\t            _shape._w += oldx - mx;\n\t            _shape._h += oldy - my;\n\t            break;\n\t          case 1:\n\t            _shape._y = my;\n\t            _shape._h += oldy - my;\n\t            break;\n\t          case 2:\n\t            _shape._y = my;\n\t            _shape._w = mx - oldx;\n\t            _shape._h += oldy - my;\n\t            break;\n\t          case 3:\n\t            _shape._x = mx;\n\t            _shape._w += oldx - mx;\n\t            break;\n\t          case 4:\n\t            _shape._w = mx - oldx;\n\t            break;\n\t          case 5:\n\t            _shape._x = mx;\n\t            _shape._w += oldx - mx;\n\t            _shape._h = my - oldy;\n\t            break;\n\t          case 6:\n\t            _shape._h = my - oldy;\n\t            break;\n\t          case 7:\n\t            _shape._w = mx - oldx;\n\t            _shape._h = my - oldy;\n\t            break;\n\t          default:\n\t            break;\n\t        }\n\t        this._valid = false;\n\t      } else if (this._dragging) {\n\t        // We don't want to drag the object by its top-left corner, we want to drag it\n\t        // from where we clicked. Thats why we saved the offset and use it here\n\t        this._shape._x = mouse.x - this._dragoffx;\n\t        this._shape._y = mouse.y - this._dragoffy;\n\t        this._valid = false; // Something's dragging so we must redraw\n\t\n\t        // this.log('moving the rect', mouse.x, mouse.y);\n\t      }\n\t    }\n\t  }, {\n\t    key: '_onMouseUp',\n\t    value: function _onMouseUp() {\n\t      this._dragging = false;\n\t      this._currentHandle = false;\n\t      this.log('dragging finished');\n\t    }\n\t\n\t    /**\n\t     * dispatches mouse events on touch\n\t     */\n\t\n\t  }, {\n\t    key: '_onTouch',\n\t    value: function _onTouch(evt) {\n\t      if (evt.touches.length > 1 || evt.type === 'touchend' && evt.touches.length > 0) {\n\t        return;\n\t      }\n\t\n\t      var newEvt = this._document.createEvent('MouseEvents');\n\t      var type = null;\n\t      var touch = null;\n\t\n\t      switch (evt.type) {\n\t        case 'touchstart':\n\t          type = 'mousedown';\n\t          touch = evt.changedTouches[0];\n\t          break;\n\t        case 'touchmove':\n\t          type = 'mousemove';\n\t          touch = evt.changedTouches[0];\n\t          break;\n\t        case 'touchend':\n\t          type = 'mouseup';\n\t          touch = evt.changedTouches[0];\n\t          break;\n\t        default:\n\t          break;\n\t      }\n\t\n\t      newEvt.initMouseEvent(type, true, true, evt.originalTarget.ownerDocument.defaultView, 0, touch.screenX, touch.screenY, touch.clientX, touch.clientY, evt.ctrlKey, evt.altKey, evt.shiftKey, evt.metaKey, 0, null);\n\t      evt.originalTarget.dispatchEvent(newEvt);\n\t    }\n\t\n\t    /**\n\t     * attaches event handlers to canvas\n\t     * @private\n\t     */\n\t\n\t  }, {\n\t    key: '_initEvents',\n\t    value: function _initEvents() {\n\t      var _canvas = this._canvas;\n\t      // fixes a problem where double clicking causesShape text to get selected on the canvas\n\t\n\t      _canvas.addEventListener('selectstart', function (e) {\n\t        e.preventDefault();\n\t        return false;\n\t      }, false);\n\t\n\t      // up, down, and move are for dragging\n\t      _canvas.addEventListener('mousedown', this._onMouseDown, true);\n\t      _canvas.addEventListener('mousemove', this._onMouseMove, true);\n\t      _canvas.addEventListener('mouseup', this._onMouseUp, true);\n\t\n\t      _canvas.addEventListener('tapstart', this._onTouch, true);\n\t      _canvas.addEventListener('touchmove', this._onTouch, true);\n\t      _canvas.addEventListener('touchend', this._onTouch, true);\n\t\n\t      this.log('initialized events');\n\t    }\n\t\n\t    /**\n\t     * creates a movable rectangle and attach to canvas\n\t     * @private\n\t     */\n\t\n\t  }, {\n\t    key: '_initRect',\n\t    value: function _initRect() {\n\t      this._shape = new _rect2.default(this._width / 4, this._height / 4, this._width / 2, this._height / 2, 'rgba(0, 200, 0, 0.5)', this._debugMode);\n\t      this._valid = false;\n\t    }\n\t\n\t    /**\n\t     * Returns shape positions\n\t     * @returns {{x, y, w, h}}\n\t     */\n\t\n\t  }, {\n\t    key: 'getSelection',\n\t    value: function getSelection() {\n\t      var _shape2 = this._shape;\n\t      var _x = _shape2._x;\n\t      var _y = _shape2._y;\n\t      var _w = _shape2._w;\n\t      var _h = _shape2._h;\n\t\n\t      return { x: _x, y: _y, w: _w, h: _h };\n\t    }\n\t\n\t    /**\n\t     * clears the canvas for next draw\n\t     */\n\t\n\t  }, {\n\t    key: 'clear',\n\t    value: function clear() {\n\t      this._ctx.clearRect(0, 0, this._width, this._height);\n\t    }\n\t\n\t    /**\n\t     * while draw is called as often as the INTERVAL variable demands,\n\t     * it only ever does something if the canvas gets invalidated by our code\n\t     */\n\t\n\t  }, {\n\t    key: 'draw',\n\t    value: function draw() {\n\t      // if our state is invalid, redraw and validate!\n\t      if (!this._valid) {\n\t        this.log('starting draw');\n\t        var _ctx = this._ctx;\n\t        var _shape = this._shape;\n\t\n\t        this.clear();\n\t\n\t        // fill outside of the rectangle\n\t        _ctx.fillStyle = 'rgba(0,0,0,.8)';\n\t        _ctx.beginPath();\n\t        _ctx.rect(_shape._x, _shape._y, _shape._w, _shape._h);\n\t        _ctx.rect(this._width, 0, -this._width, this._height);\n\t        _ctx.fill();\n\t\n\t        // draw shape\n\t        _shape.draw(_ctx);\n\t\n\t        this._valid = true;\n\t\n\t        this.log('shape drew', _shape._x, _shape._y, _shape._w, _shape._h);\n\t      }\n\t    }\n\t\n\t    /**\n\t     * creates an object with x and y defined, set to the mouse position relative to the state's canvas\n\t     * If you wanna be super-correct this can be tricky, we have to worry about padding and borders\n\t     * @param {Event} e\n\t     * @returns {{x: number, y: number}}\n\t     */\n\t\n\t  }, {\n\t    key: 'getMouse',\n\t    value: function getMouse(e) {\n\t      var el = this._canvas;\n\t      var offsetX = 0;\n\t      var offsetY = 0;\n\t\n\t      // Compute the total offset\n\t      if (el.offsetParent !== undefined) {\n\t        do {\n\t          offsetX += el.offsetLeft;\n\t          offsetY += el.offsetTop;\n\t          el = el.offsetParent;\n\t        } while (el);\n\t      }\n\t\n\t      // Also add the <html> offsets in case there's a position:fixed bar\n\t      offsetX += this._htmlLeft;\n\t      offsetY += this._htmlTop;\n\t\n\t      var mx = e.pageX - offsetX;\n\t      var my = e.pageY - offsetY;\n\t\n\t      return { x: mx, y: my };\n\t    }\n\t  }]);\n\t\n\t  return CanvasState;\n\t}(_baseObject2.default);\n\t\n\texports.default = CanvasState;\n\tmodule.exports = exports['default'];\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _baseObject = __webpack_require__(2);\n\t\n\tvar _baseObject2 = _interopRequireDefault(_baseObject);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\t/**\n\t * Rectangle for highlighting the cropping area\n\t * @class Rect\n\t */\n\tvar Rect = function (_BaseObject) {\n\t  _inherits(Rect, _BaseObject);\n\t\n\t  /**\n\t   * object constructor\n\t   * @param {number} x - left position of shape\n\t   * @param {number} y - top position of shape\n\t   * @param {number} w - width\n\t   * @param {number} h - height\n\t   * @param {string} fill - background color of the shape\n\t   */\n\t  function Rect(x, y, w, h, fill) {\n\t    var debugMode = arguments.length <= 5 || arguments[5] === undefined ? true : arguments[5];\n\t\n\t    _classCallCheck(this, Rect);\n\t\n\t    var _this = _possibleConstructorReturn(this, (Rect.__proto__ || Object.getPrototypeOf(Rect)).call(this));\n\t\n\t    _this._selectionHandles = [];\n\t    _this._selectionBoxSize = 6;\n\t    for (var i = 0; i < 8; i += 1) {\n\t      _this._selectionHandles.push({ x: 0, y: 0 });\n\t    }\n\t\n\t    _this._x = x || 0;\n\t    _this._y = y || 0;\n\t    _this._w = w || 1;\n\t    _this._h = h || 1;\n\t    _this._fill = fill || '#AAAAAA';\n\t    _this._debugMode = debugMode;\n\t\n\t    _this.log('initialized');\n\t    return _this;\n\t  }\n\t\n\t  /**\n\t   * returns class name\n\t   * @returns {string}\n\t   */\n\t\n\t\n\t  _createClass(Rect, [{\n\t    key: 'getName',\n\t    value: function getName() {\n\t      return 'Rect';\n\t    }\n\t\n\t    /**\n\t     * draws the shape\n\t     * @param {CanvasContext} ctx\n\t     */\n\t\n\t  }, {\n\t    key: 'draw',\n\t    value: function draw(ctx) {\n\t      var _x = this._x;\n\t      var _y = this._y;\n\t      var _w = this._w;\n\t      var _h = this._h;\n\t      var _fill = this._fill;\n\t      var _selectionHandles = this._selectionHandles;\n\t      var _selectionBoxSize = this._selectionBoxSize;\n\t\n\t      ctx.fillStyle = _fill; // eslint-disable-line\n\t      ctx.strokeStyle = 'white'; // eslint-disable-line\n\t      ctx.lineWidth = 1; // eslint-disable-line\n\t      ctx.setLineDash([7, 7]);\n\t      ctx.strokeRect(_x, _y, _w, _h);\n\t\n\t      var half = _selectionBoxSize / 2;\n\t\n\t      // top left, middle, right\n\t      _selectionHandles[0].x = _x - half;\n\t      _selectionHandles[0].y = _y - half;\n\t\n\t      _selectionHandles[1].x = _x + _w / 2 - half;\n\t      _selectionHandles[1].y = _y - half;\n\t\n\t      _selectionHandles[2].x = _x + _w - half;\n\t      _selectionHandles[2].y = _y - half;\n\t\n\t      // middle left\n\t      _selectionHandles[3].x = _x - half;\n\t      _selectionHandles[3].y = _y + _h / 2 - half;\n\t\n\t      // middle right\n\t      _selectionHandles[4].x = _x + _w - half;\n\t      _selectionHandles[4].y = _y + _h / 2 - half;\n\t\n\t      // bottom left, middle, right\n\t      _selectionHandles[6].x = _x + _w / 2 - half;\n\t      _selectionHandles[6].y = _y + _h - half;\n\t\n\t      _selectionHandles[5].x = _x - half;\n\t      _selectionHandles[5].y = _y + _h - half;\n\t\n\t      _selectionHandles[7].x = _x + _w - half;\n\t      _selectionHandles[7].y = _y + _h - half;\n\t\n\t      this.log('drawing selection boxes');\n\t      ctx.fillStyle = 'white'; // eslint-disable-line\n\t      _selectionHandles.forEach(function (cur) {\n\t        ctx.fillRect(cur.x, cur.y, _selectionBoxSize, _selectionBoxSize);\n\t      });\n\t\n\t      this.log('filling the rectangle', _x, _y, _w, _h);\n\t    }\n\t\n\t    /**\n\t     * checks if point is inside the shape\n\t     * @param {number} mx\n\t     * @param {number} my\n\t     * @returns {bool}\n\t     */\n\t\n\t  }, {\n\t    key: 'contains',\n\t    value: function contains(mx, my) {\n\t      var _x = this._x;\n\t      var _y = this._y;\n\t      var _w = this._w;\n\t      var _h = this._h;\n\t\n\t      return _x <= mx && _x + _w >= mx && _y <= my && _y + _h >= my;\n\t    }\n\t\n\t    /**\n\t     * returns selection handle if point is inside\n\t     * @param {number} mx\n\t     * @param {number} my\n\t     * @returns {?number}\n\t     */\n\t\n\t  }, {\n\t    key: 'getHoverSelectionHandle',\n\t    value: function getHoverSelectionHandle(mx, my) {\n\t      var _selectionHandles = this._selectionHandles;\n\t      var _selectionBoxSize = this._selectionBoxSize;\n\t\n\t      for (var i = 0; i < _selectionHandles.length; i += 1) {\n\t        var handle = _selectionHandles[i];\n\t        if (handle.x <= mx && handle.x + _selectionBoxSize >= mx && handle.y <= my && handle.y + _selectionBoxSize >= my) {\n\t          return i;\n\t        }\n\t      }\n\t\n\t      return false;\n\t    }\n\t  }]);\n\t\n\t  return Rect;\n\t}(_baseObject2.default);\n\t\n\texports.default = Rect;\n\tmodule.exports = exports['default'];\n\n/***/ }\n/******/ ])\n});\n;\n\n\n/** WEBPACK FOOTER **\n ** HtmlCrop.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 4d15a1dd9686a73b7634\n **/","import html2canvas from 'html2canvas';\nimport BaseObject from './base-object';\nimport CanvasState from './canvas-state';\n\nconst defaultOptions = {\n  key: {\n    ctrlKey: false,\n    shiftKey: true,\n    key: 'F7'\n  },\n  startButton: true,\n  debug: true\n};\n\nexport default class HtmlCrop extends BaseObject {\n  /**\n   * object constructor\n   * @param {HTMLDocument} doc\n   * @param {Object} options\n   */\n  constructor(doc, options = {}) {\n    super();\n\n    this._document = doc;\n    this.options = Object.assign({}, defaultOptions, options);\n    this._debugMode = options.debug;\n    this.log('initialized');\n\n    // bind this context into keydown event here\n    // because it needs to be removed later\n    this._onKeyDown = this._onKeyDown.bind(this);\n\n    this.reset();\n  }\n\n  /**\n   * resets to starting state\n   */\n  reset() {\n    this._listenHotKey();\n\n    if (this.options.startButton) {\n      this._attachStartButton();\n    }\n  }\n\n  /**\n   * starts cropping the page\n   */\n  startCropping() {\n    html2canvas(this._document.html).then((canvas) => {\n      this._canvas = canvas;\n\n      const selectionCanvas = this._document.createElement('canvas');\n      this._selectionCanvas = selectionCanvas;\n      selectionCanvas.width = canvas.width;\n      selectionCanvas.height = canvas.height;\n      selectionCanvas.style.position = 'fixed';\n      selectionCanvas.style.left = '0';\n      selectionCanvas.style.top = '0';\n      selectionCanvas.style['z-index'] = 9999998;\n\n      this._document.body.appendChild(selectionCanvas);\n\n      // debug mode is set as false because of lots of logging\n      this._canvasState = new CanvasState(this._document, selectionCanvas, true);\n\n      // removes start button and event listener to avoid multiple cropping instances\n      if (this._startButton) {\n        this._document.body.removeChild(this._startButton);\n      }\n      this._document.removeEventListener('keydown', this._onKeyDown);\n      this._attachCaptureButton();\n    });\n  }\n\n  /**\n   * ends cropping\n   */\n  endCropping() {\n\n  }\n\n  /**\n   * returns class name\n   * @returns {string}\n   */\n  getName() {\n    return 'HtmlCrop';\n  }\n\n  /**\n   * attaches listener which triggers cropping\n   */\n  _listenHotKey() {\n    this._document.addEventListener('keydown', this._onKeyDown);\n  }\n\n  /**\n   * attaches start cropping button\n   */\n  _attachStartButton() {\n    const { _document } = this;\n    const button = _document.createElement('button');\n    const textNode = _document.createTextNode('Start Cropping');\n    button.appendChild(textNode);\n    button.style.position = 'fixed';\n    button.style.right = '30px';\n    button.style.bottom = '30px';\n    button.style['z-index'] = 9999998;\n    button.onclick = this.startCropping.bind(this);\n\n    this._startButton = button;\n    _document.body.appendChild(button);\n  }\n\n  /**\n   * attaches button to capture\n   * @private\n   */\n  _attachCaptureButton() {\n    const { _document } = this;\n    const button = _document.createElement('button');\n    const textNode = _document.createTextNode('Capture');\n    button.appendChild(textNode);\n    button.style.position = 'fixed';\n    button.style.right = '30px';\n    button.style.bottom = '30px';\n    button.style['z-index'] = 9999998;\n    button.onclick = this._onCapture.bind(this);\n\n    this._captureButton = button;\n    _document.body.appendChild(button);\n  }\n\n  /*\n   * handles key down for hot key capturing\n   * @param {KeyboardEvent} event\n   */\n  _onKeyDown(event) {\n    const {\n      key,\n      ctrlKey,\n      shiftKey\n    } = event;\n    const {\n      key: keyOptions\n    } = this.options;\n\n    this.log(`keydown detected: ctrl=${ctrlKey} shift=${shiftKey} key=${key}`);\n\n    if (key === keyOptions.key && ctrlKey === keyOptions.ctrlKey && keyOptions.shiftKey) {\n      this.log('key down matches with setting. starts cropping');\n      this.startCropping();\n    }\n  }\n\n  /**\n   * capture button click handler\n   * @private\n   */\n  _onCapture() {\n    const ctx = this._canvas.getContext('2d');\n    const selection = this._canvasState.getSelection();\n    const imgData = ctx.getImageData(selection.x, selection.y, selection.w, selection.h);\n\n    const newCanvas = this._document.createElement('canvas');\n    newCanvas.width = selection.w;\n    newCanvas.height = selection.h;\n    const newCtx = newCanvas.getContext('2d');\n    newCtx.putImageData(imgData, 0, 0);\n\n    const dataURL = newCanvas.toDataURL('image/png');\n\n    // @TODO save dataURL to server\n    window.location.href = dataURL; // eslint-disable-line\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","/*\n  html2canvas 0.5.0-beta4 <http://html2canvas.hertzen.com>\n  Copyright (c) 2016 Niklas von Hertzen\n\n  Released under  License\n*/\n\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.html2canvas = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n(function (global){\n/*! https://mths.be/punycode v1.4.0 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow new RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.3.2',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && freeModule) {\n\t\tif (module.exports == freeExports) {\n\t\t\t// in Node.js, io.js, or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else {\n\t\t\t// in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],2:[function(_dereq_,module,exports){\nvar log = _dereq_('./log');\n\nfunction restoreOwnerScroll(ownerDocument, x, y) {\n    if (ownerDocument.defaultView && (x !== ownerDocument.defaultView.pageXOffset || y !== ownerDocument.defaultView.pageYOffset)) {\n        ownerDocument.defaultView.scrollTo(x, y);\n    }\n}\n\nfunction cloneCanvasContents(canvas, clonedCanvas) {\n    try {\n        if (clonedCanvas) {\n            clonedCanvas.width = canvas.width;\n            clonedCanvas.height = canvas.height;\n            clonedCanvas.getContext(\"2d\").putImageData(canvas.getContext(\"2d\").getImageData(0, 0, canvas.width, canvas.height), 0, 0);\n        }\n    } catch(e) {\n        log(\"Unable to copy canvas content from\", canvas, e);\n    }\n}\n\nfunction cloneNode(node, javascriptEnabled) {\n    var clone = node.nodeType === 3 ? document.createTextNode(node.nodeValue) : node.cloneNode(false);\n\n    var child = node.firstChild;\n    while(child) {\n        if (javascriptEnabled === true || child.nodeType !== 1 || child.nodeName !== 'SCRIPT') {\n            clone.appendChild(cloneNode(child, javascriptEnabled));\n        }\n        child = child.nextSibling;\n    }\n\n    if (node.nodeType === 1) {\n        clone._scrollTop = node.scrollTop;\n        clone._scrollLeft = node.scrollLeft;\n        if (node.nodeName === \"CANVAS\") {\n            cloneCanvasContents(node, clone);\n        } else if (node.nodeName === \"TEXTAREA\" || node.nodeName === \"SELECT\") {\n            clone.value = node.value;\n        }\n    }\n\n    return clone;\n}\n\nfunction initNode(node) {\n    if (node.nodeType === 1) {\n        node.scrollTop = node._scrollTop;\n        node.scrollLeft = node._scrollLeft;\n\n        var child = node.firstChild;\n        while(child) {\n            initNode(child);\n            child = child.nextSibling;\n        }\n    }\n}\n\nmodule.exports = function(ownerDocument, containerDocument, width, height, options, x ,y) {\n    var documentElement = cloneNode(ownerDocument.documentElement, options.javascriptEnabled);\n    var container = containerDocument.createElement(\"iframe\");\n\n    container.className = \"html2canvas-container\";\n    container.style.visibility = \"hidden\";\n    container.style.position = \"fixed\";\n    container.style.left = \"-10000px\";\n    container.style.top = \"0px\";\n    container.style.border = \"0\";\n    container.width = width;\n    container.height = height;\n    container.scrolling = \"no\"; // ios won't scroll without it\n    containerDocument.body.appendChild(container);\n\n    return new Promise(function(resolve) {\n        var documentClone = container.contentWindow.document;\n\n        /* Chrome doesn't detect relative background-images assigned in inline <style> sheets when fetched through getComputedStyle\n         if window url is about:blank, we can assign the url to current by writing onto the document\n         */\n        container.contentWindow.onload = container.onload = function() {\n            var interval = setInterval(function() {\n                if (documentClone.body.childNodes.length > 0) {\n                    initNode(documentClone.documentElement);\n                    clearInterval(interval);\n                    if (options.type === \"view\") {\n                        container.contentWindow.scrollTo(x, y);\n                        if ((/(iPad|iPhone|iPod)/g).test(navigator.userAgent) && (container.contentWindow.scrollY !== y || container.contentWindow.scrollX !== x)) {\n                            documentClone.documentElement.style.top = (-y) + \"px\";\n                            documentClone.documentElement.style.left = (-x) + \"px\";\n                            documentClone.documentElement.style.position = 'absolute';\n                        }\n                    }\n                    resolve(container);\n                }\n            }, 50);\n        };\n\n        documentClone.open();\n        documentClone.write(\"<!DOCTYPE html><html></html>\");\n        // Chrome scrolls the parent document for some reason after the write to the cloned window???\n        restoreOwnerScroll(ownerDocument, x, y);\n        documentClone.replaceChild(documentClone.adoptNode(documentElement), documentClone.documentElement);\n        documentClone.close();\n    });\n};\n\n},{\"./log\":13}],3:[function(_dereq_,module,exports){\n// http://dev.w3.org/csswg/css-color/\n\nfunction Color(value) {\n    this.r = 0;\n    this.g = 0;\n    this.b = 0;\n    this.a = null;\n    var result = this.fromArray(value) ||\n        this.namedColor(value) ||\n        this.rgb(value) ||\n        this.rgba(value) ||\n        this.hex6(value) ||\n        this.hex3(value);\n}\n\nColor.prototype.darken = function(amount) {\n    var a = 1 - amount;\n    return  new Color([\n        Math.round(this.r * a),\n        Math.round(this.g * a),\n        Math.round(this.b * a),\n        this.a\n    ]);\n};\n\nColor.prototype.isTransparent = function() {\n    return this.a === 0;\n};\n\nColor.prototype.isBlack = function() {\n    return this.r === 0 && this.g === 0 && this.b === 0;\n};\n\nColor.prototype.fromArray = function(array) {\n    if (Array.isArray(array)) {\n        this.r = Math.min(array[0], 255);\n        this.g = Math.min(array[1], 255);\n        this.b = Math.min(array[2], 255);\n        if (array.length > 3) {\n            this.a = array[3];\n        }\n    }\n\n    return (Array.isArray(array));\n};\n\nvar _hex3 = /^#([a-f0-9]{3})$/i;\n\nColor.prototype.hex3 = function(value) {\n    var match = null;\n    if ((match = value.match(_hex3)) !== null) {\n        this.r = parseInt(match[1][0] + match[1][0], 16);\n        this.g = parseInt(match[1][1] + match[1][1], 16);\n        this.b = parseInt(match[1][2] + match[1][2], 16);\n    }\n    return match !== null;\n};\n\nvar _hex6 = /^#([a-f0-9]{6})$/i;\n\nColor.prototype.hex6 = function(value) {\n    var match = null;\n    if ((match = value.match(_hex6)) !== null) {\n        this.r = parseInt(match[1].substring(0, 2), 16);\n        this.g = parseInt(match[1].substring(2, 4), 16);\n        this.b = parseInt(match[1].substring(4, 6), 16);\n    }\n    return match !== null;\n};\n\n\nvar _rgb = /^rgb\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*\\)$/;\n\nColor.prototype.rgb = function(value) {\n    var match = null;\n    if ((match = value.match(_rgb)) !== null) {\n        this.r = Number(match[1]);\n        this.g = Number(match[2]);\n        this.b = Number(match[3]);\n    }\n    return match !== null;\n};\n\nvar _rgba = /^rgba\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d?\\.?\\d+)\\s*\\)$/;\n\nColor.prototype.rgba = function(value) {\n    var match = null;\n    if ((match = value.match(_rgba)) !== null) {\n        this.r = Number(match[1]);\n        this.g = Number(match[2]);\n        this.b = Number(match[3]);\n        this.a = Number(match[4]);\n    }\n    return match !== null;\n};\n\nColor.prototype.toString = function() {\n    return this.a !== null && this.a !== 1 ?\n    \"rgba(\" + [this.r, this.g, this.b, this.a].join(\",\") + \")\" :\n    \"rgb(\" + [this.r, this.g, this.b].join(\",\") + \")\";\n};\n\nColor.prototype.namedColor = function(value) {\n    value = value.toLowerCase();\n    var color = colors[value];\n    if (color) {\n        this.r = color[0];\n        this.g = color[1];\n        this.b = color[2];\n    } else if (value === \"transparent\") {\n        this.r = this.g = this.b = this.a = 0;\n        return true;\n    }\n\n    return !!color;\n};\n\nColor.prototype.isColor = true;\n\n// JSON.stringify([].slice.call($$('.named-color-table tr'), 1).map(function(row) { return [row.childNodes[3].textContent, row.childNodes[5].textContent.trim().split(\",\").map(Number)] }).reduce(function(data, row) {data[row[0]] = row[1]; return data}, {}))\nvar colors = {\n    \"aliceblue\": [240, 248, 255],\n    \"antiquewhite\": [250, 235, 215],\n    \"aqua\": [0, 255, 255],\n    \"aquamarine\": [127, 255, 212],\n    \"azure\": [240, 255, 255],\n    \"beige\": [245, 245, 220],\n    \"bisque\": [255, 228, 196],\n    \"black\": [0, 0, 0],\n    \"blanchedalmond\": [255, 235, 205],\n    \"blue\": [0, 0, 255],\n    \"blueviolet\": [138, 43, 226],\n    \"brown\": [165, 42, 42],\n    \"burlywood\": [222, 184, 135],\n    \"cadetblue\": [95, 158, 160],\n    \"chartreuse\": [127, 255, 0],\n    \"chocolate\": [210, 105, 30],\n    \"coral\": [255, 127, 80],\n    \"cornflowerblue\": [100, 149, 237],\n    \"cornsilk\": [255, 248, 220],\n    \"crimson\": [220, 20, 60],\n    \"cyan\": [0, 255, 255],\n    \"darkblue\": [0, 0, 139],\n    \"darkcyan\": [0, 139, 139],\n    \"darkgoldenrod\": [184, 134, 11],\n    \"darkgray\": [169, 169, 169],\n    \"darkgreen\": [0, 100, 0],\n    \"darkgrey\": [169, 169, 169],\n    \"darkkhaki\": [189, 183, 107],\n    \"darkmagenta\": [139, 0, 139],\n    \"darkolivegreen\": [85, 107, 47],\n    \"darkorange\": [255, 140, 0],\n    \"darkorchid\": [153, 50, 204],\n    \"darkred\": [139, 0, 0],\n    \"darksalmon\": [233, 150, 122],\n    \"darkseagreen\": [143, 188, 143],\n    \"darkslateblue\": [72, 61, 139],\n    \"darkslategray\": [47, 79, 79],\n    \"darkslategrey\": [47, 79, 79],\n    \"darkturquoise\": [0, 206, 209],\n    \"darkviolet\": [148, 0, 211],\n    \"deeppink\": [255, 20, 147],\n    \"deepskyblue\": [0, 191, 255],\n    \"dimgray\": [105, 105, 105],\n    \"dimgrey\": [105, 105, 105],\n    \"dodgerblue\": [30, 144, 255],\n    \"firebrick\": [178, 34, 34],\n    \"floralwhite\": [255, 250, 240],\n    \"forestgreen\": [34, 139, 34],\n    \"fuchsia\": [255, 0, 255],\n    \"gainsboro\": [220, 220, 220],\n    \"ghostwhite\": [248, 248, 255],\n    \"gold\": [255, 215, 0],\n    \"goldenrod\": [218, 165, 32],\n    \"gray\": [128, 128, 128],\n    \"green\": [0, 128, 0],\n    \"greenyellow\": [173, 255, 47],\n    \"grey\": [128, 128, 128],\n    \"honeydew\": [240, 255, 240],\n    \"hotpink\": [255, 105, 180],\n    \"indianred\": [205, 92, 92],\n    \"indigo\": [75, 0, 130],\n    \"ivory\": [255, 255, 240],\n    \"khaki\": [240, 230, 140],\n    \"lavender\": [230, 230, 250],\n    \"lavenderblush\": [255, 240, 245],\n    \"lawngreen\": [124, 252, 0],\n    \"lemonchiffon\": [255, 250, 205],\n    \"lightblue\": [173, 216, 230],\n    \"lightcoral\": [240, 128, 128],\n    \"lightcyan\": [224, 255, 255],\n    \"lightgoldenrodyellow\": [250, 250, 210],\n    \"lightgray\": [211, 211, 211],\n    \"lightgreen\": [144, 238, 144],\n    \"lightgrey\": [211, 211, 211],\n    \"lightpink\": [255, 182, 193],\n    \"lightsalmon\": [255, 160, 122],\n    \"lightseagreen\": [32, 178, 170],\n    \"lightskyblue\": [135, 206, 250],\n    \"lightslategray\": [119, 136, 153],\n    \"lightslategrey\": [119, 136, 153],\n    \"lightsteelblue\": [176, 196, 222],\n    \"lightyellow\": [255, 255, 224],\n    \"lime\": [0, 255, 0],\n    \"limegreen\": [50, 205, 50],\n    \"linen\": [250, 240, 230],\n    \"magenta\": [255, 0, 255],\n    \"maroon\": [128, 0, 0],\n    \"mediumaquamarine\": [102, 205, 170],\n    \"mediumblue\": [0, 0, 205],\n    \"mediumorchid\": [186, 85, 211],\n    \"mediumpurple\": [147, 112, 219],\n    \"mediumseagreen\": [60, 179, 113],\n    \"mediumslateblue\": [123, 104, 238],\n    \"mediumspringgreen\": [0, 250, 154],\n    \"mediumturquoise\": [72, 209, 204],\n    \"mediumvioletred\": [199, 21, 133],\n    \"midnightblue\": [25, 25, 112],\n    \"mintcream\": [245, 255, 250],\n    \"mistyrose\": [255, 228, 225],\n    \"moccasin\": [255, 228, 181],\n    \"navajowhite\": [255, 222, 173],\n    \"navy\": [0, 0, 128],\n    \"oldlace\": [253, 245, 230],\n    \"olive\": [128, 128, 0],\n    \"olivedrab\": [107, 142, 35],\n    \"orange\": [255, 165, 0],\n    \"orangered\": [255, 69, 0],\n    \"orchid\": [218, 112, 214],\n    \"palegoldenrod\": [238, 232, 170],\n    \"palegreen\": [152, 251, 152],\n    \"paleturquoise\": [175, 238, 238],\n    \"palevioletred\": [219, 112, 147],\n    \"papayawhip\": [255, 239, 213],\n    \"peachpuff\": [255, 218, 185],\n    \"peru\": [205, 133, 63],\n    \"pink\": [255, 192, 203],\n    \"plum\": [221, 160, 221],\n    \"powderblue\": [176, 224, 230],\n    \"purple\": [128, 0, 128],\n    \"rebeccapurple\": [102, 51, 153],\n    \"red\": [255, 0, 0],\n    \"rosybrown\": [188, 143, 143],\n    \"royalblue\": [65, 105, 225],\n    \"saddlebrown\": [139, 69, 19],\n    \"salmon\": [250, 128, 114],\n    \"sandybrown\": [244, 164, 96],\n    \"seagreen\": [46, 139, 87],\n    \"seashell\": [255, 245, 238],\n    \"sienna\": [160, 82, 45],\n    \"silver\": [192, 192, 192],\n    \"skyblue\": [135, 206, 235],\n    \"slateblue\": [106, 90, 205],\n    \"slategray\": [112, 128, 144],\n    \"slategrey\": [112, 128, 144],\n    \"snow\": [255, 250, 250],\n    \"springgreen\": [0, 255, 127],\n    \"steelblue\": [70, 130, 180],\n    \"tan\": [210, 180, 140],\n    \"teal\": [0, 128, 128],\n    \"thistle\": [216, 191, 216],\n    \"tomato\": [255, 99, 71],\n    \"turquoise\": [64, 224, 208],\n    \"violet\": [238, 130, 238],\n    \"wheat\": [245, 222, 179],\n    \"white\": [255, 255, 255],\n    \"whitesmoke\": [245, 245, 245],\n    \"yellow\": [255, 255, 0],\n    \"yellowgreen\": [154, 205, 50]\n};\n\nmodule.exports = Color;\n\n},{}],4:[function(_dereq_,module,exports){\nvar Support = _dereq_('./support');\nvar CanvasRenderer = _dereq_('./renderers/canvas');\nvar ImageLoader = _dereq_('./imageloader');\nvar NodeParser = _dereq_('./nodeparser');\nvar NodeContainer = _dereq_('./nodecontainer');\nvar log = _dereq_('./log');\nvar utils = _dereq_('./utils');\nvar createWindowClone = _dereq_('./clone');\nvar loadUrlDocument = _dereq_('./proxy').loadUrlDocument;\nvar getBounds = utils.getBounds;\n\nvar html2canvasNodeAttribute = \"data-html2canvas-node\";\nvar html2canvasCloneIndex = 0;\n\nfunction html2canvas(nodeList, options) {\n    var index = html2canvasCloneIndex++;\n    options = options || {};\n    if (options.logging) {\n        log.options.logging = true;\n        log.options.start = Date.now();\n    }\n\n    options.async = typeof(options.async) === \"undefined\" ? true : options.async;\n    options.allowTaint = typeof(options.allowTaint) === \"undefined\" ? false : options.allowTaint;\n    options.removeContainer = typeof(options.removeContainer) === \"undefined\" ? true : options.removeContainer;\n    options.javascriptEnabled = typeof(options.javascriptEnabled) === \"undefined\" ? false : options.javascriptEnabled;\n    options.imageTimeout = typeof(options.imageTimeout) === \"undefined\" ? 10000 : options.imageTimeout;\n    options.renderer = typeof(options.renderer) === \"function\" ? options.renderer : CanvasRenderer;\n    options.strict = !!options.strict;\n\n    if (typeof(nodeList) === \"string\") {\n        if (typeof(options.proxy) !== \"string\") {\n            return Promise.reject(\"Proxy must be used when rendering url\");\n        }\n        var width = options.width != null ? options.width : window.innerWidth;\n        var height = options.height != null ? options.height : window.innerHeight;\n        return loadUrlDocument(absoluteUrl(nodeList), options.proxy, document, width, height, options).then(function(container) {\n            return renderWindow(container.contentWindow.document.documentElement, container, options, width, height);\n        });\n    }\n\n    var node = ((nodeList === undefined) ? [document.documentElement] : ((nodeList.length) ? nodeList : [nodeList]))[0];\n    node.setAttribute(html2canvasNodeAttribute + index, index);\n    return renderDocument(node.ownerDocument, options, node.ownerDocument.defaultView.innerWidth, node.ownerDocument.defaultView.innerHeight, index).then(function(canvas) {\n        if (typeof(options.onrendered) === \"function\") {\n            log(\"options.onrendered is deprecated, html2canvas returns a Promise containing the canvas\");\n            options.onrendered(canvas);\n        }\n        return canvas;\n    });\n}\n\nhtml2canvas.CanvasRenderer = CanvasRenderer;\nhtml2canvas.NodeContainer = NodeContainer;\nhtml2canvas.log = log;\nhtml2canvas.utils = utils;\n\nvar html2canvasExport = (typeof(document) === \"undefined\" || typeof(Object.create) !== \"function\" || typeof(document.createElement(\"canvas\").getContext) !== \"function\") ? function() {\n    return Promise.reject(\"No canvas support\");\n} : html2canvas;\n\nmodule.exports = html2canvasExport;\n\nif (typeof(define) === 'function' && define.amd) {\n    define('html2canvas', [], function() {\n        return html2canvasExport;\n    });\n}\n\nfunction renderDocument(document, options, windowWidth, windowHeight, html2canvasIndex) {\n    return createWindowClone(document, document, windowWidth, windowHeight, options, document.defaultView.pageXOffset, document.defaultView.pageYOffset).then(function(container) {\n        log(\"Document cloned\");\n        var attributeName = html2canvasNodeAttribute + html2canvasIndex;\n        var selector = \"[\" + attributeName + \"='\" + html2canvasIndex + \"']\";\n        document.querySelector(selector).removeAttribute(attributeName);\n        var clonedWindow = container.contentWindow;\n        var node = clonedWindow.document.querySelector(selector);\n        var oncloneHandler = (typeof(options.onclone) === \"function\") ? Promise.resolve(options.onclone(clonedWindow.document)) : Promise.resolve(true);\n        return oncloneHandler.then(function() {\n            return renderWindow(node, container, options, windowWidth, windowHeight);\n        });\n    });\n}\n\nfunction renderWindow(node, container, options, windowWidth, windowHeight) {\n    var clonedWindow = container.contentWindow;\n    var support = new Support(clonedWindow.document);\n    var imageLoader = new ImageLoader(options, support);\n    var bounds = getBounds(node);\n    var width = options.type === \"view\" ? windowWidth : documentWidth(clonedWindow.document);\n    var height = options.type === \"view\" ? windowHeight : documentHeight(clonedWindow.document);\n    var renderer = new options.renderer(width, height, imageLoader, options, document);\n    var parser = new NodeParser(node, renderer, support, imageLoader, options);\n    return parser.ready.then(function() {\n        log(\"Finished rendering\");\n        var canvas;\n\n        if (options.type === \"view\") {\n            canvas = crop(renderer.canvas, {width: renderer.canvas.width, height: renderer.canvas.height, top: 0, left: 0, x: 0, y: 0});\n        } else if (node === clonedWindow.document.body || node === clonedWindow.document.documentElement || options.canvas != null) {\n            canvas = renderer.canvas;\n        } else {\n            canvas = crop(renderer.canvas, {width:  options.width != null ? options.width : bounds.width, height: options.height != null ? options.height : bounds.height, top: bounds.top, left: bounds.left, x: 0, y: 0});\n        }\n\n        cleanupContainer(container, options);\n        return canvas;\n    });\n}\n\nfunction cleanupContainer(container, options) {\n    if (options.removeContainer) {\n        container.parentNode.removeChild(container);\n        log(\"Cleaned up container\");\n    }\n}\n\nfunction crop(canvas, bounds) {\n    var croppedCanvas = document.createElement(\"canvas\");\n    var x1 = Math.min(canvas.width - 1, Math.max(0, bounds.left));\n    var x2 = Math.min(canvas.width, Math.max(1, bounds.left + bounds.width));\n    var y1 = Math.min(canvas.height - 1, Math.max(0, bounds.top));\n    var y2 = Math.min(canvas.height, Math.max(1, bounds.top + bounds.height));\n    croppedCanvas.width = bounds.width;\n    croppedCanvas.height =  bounds.height;\n    var width = x2-x1;\n    var height = y2-y1;\n    log(\"Cropping canvas at:\", \"left:\", bounds.left, \"top:\", bounds.top, \"width:\", width, \"height:\", height);\n    log(\"Resulting crop with width\", bounds.width, \"and height\", bounds.height, \"with x\", x1, \"and y\", y1);\n    croppedCanvas.getContext(\"2d\").drawImage(canvas, x1, y1, width, height, bounds.x, bounds.y, width, height);\n    return croppedCanvas;\n}\n\nfunction documentWidth (doc) {\n    return Math.max(\n        Math.max(doc.body.scrollWidth, doc.documentElement.scrollWidth),\n        Math.max(doc.body.offsetWidth, doc.documentElement.offsetWidth),\n        Math.max(doc.body.clientWidth, doc.documentElement.clientWidth)\n    );\n}\n\nfunction documentHeight (doc) {\n    return Math.max(\n        Math.max(doc.body.scrollHeight, doc.documentElement.scrollHeight),\n        Math.max(doc.body.offsetHeight, doc.documentElement.offsetHeight),\n        Math.max(doc.body.clientHeight, doc.documentElement.clientHeight)\n    );\n}\n\nfunction absoluteUrl(url) {\n    var link = document.createElement(\"a\");\n    link.href = url;\n    link.href = link.href;\n    return link;\n}\n\n},{\"./clone\":2,\"./imageloader\":11,\"./log\":13,\"./nodecontainer\":14,\"./nodeparser\":15,\"./proxy\":16,\"./renderers/canvas\":20,\"./support\":22,\"./utils\":26}],5:[function(_dereq_,module,exports){\nvar log = _dereq_('./log');\nvar smallImage = _dereq_('./utils').smallImage;\n\nfunction DummyImageContainer(src) {\n    this.src = src;\n    log(\"DummyImageContainer for\", src);\n    if (!this.promise || !this.image) {\n        log(\"Initiating DummyImageContainer\");\n        DummyImageContainer.prototype.image = new Image();\n        var image = this.image;\n        DummyImageContainer.prototype.promise = new Promise(function(resolve, reject) {\n            image.onload = resolve;\n            image.onerror = reject;\n            image.src = smallImage();\n            if (image.complete === true) {\n                resolve(image);\n            }\n        });\n    }\n}\n\nmodule.exports = DummyImageContainer;\n\n},{\"./log\":13,\"./utils\":26}],6:[function(_dereq_,module,exports){\nvar smallImage = _dereq_('./utils').smallImage;\n\nfunction Font(family, size) {\n    var container = document.createElement('div'),\n        img = document.createElement('img'),\n        span = document.createElement('span'),\n        sampleText = 'Hidden Text',\n        baseline,\n        middle;\n\n    container.style.visibility = \"hidden\";\n    container.style.fontFamily = family;\n    container.style.fontSize = size;\n    container.style.margin = 0;\n    container.style.padding = 0;\n\n    document.body.appendChild(container);\n\n    img.src = smallImage();\n    img.width = 1;\n    img.height = 1;\n\n    img.style.margin = 0;\n    img.style.padding = 0;\n    img.style.verticalAlign = \"baseline\";\n\n    span.style.fontFamily = family;\n    span.style.fontSize = size;\n    span.style.margin = 0;\n    span.style.padding = 0;\n\n    span.appendChild(document.createTextNode(sampleText));\n    container.appendChild(span);\n    container.appendChild(img);\n    baseline = (img.offsetTop - span.offsetTop) + 1;\n\n    container.removeChild(span);\n    container.appendChild(document.createTextNode(sampleText));\n\n    container.style.lineHeight = \"normal\";\n    img.style.verticalAlign = \"super\";\n\n    middle = (img.offsetTop-container.offsetTop) + 1;\n\n    document.body.removeChild(container);\n\n    this.baseline = baseline;\n    this.lineWidth = 1;\n    this.middle = middle;\n}\n\nmodule.exports = Font;\n\n},{\"./utils\":26}],7:[function(_dereq_,module,exports){\nvar Font = _dereq_('./font');\n\nfunction FontMetrics() {\n    this.data = {};\n}\n\nFontMetrics.prototype.getMetrics = function(family, size) {\n    if (this.data[family + \"-\" + size] === undefined) {\n        this.data[family + \"-\" + size] = new Font(family, size);\n    }\n    return this.data[family + \"-\" + size];\n};\n\nmodule.exports = FontMetrics;\n\n},{\"./font\":6}],8:[function(_dereq_,module,exports){\nvar utils = _dereq_('./utils');\nvar getBounds = utils.getBounds;\nvar loadUrlDocument = _dereq_('./proxy').loadUrlDocument;\n\nfunction FrameContainer(container, sameOrigin, options) {\n    this.image = null;\n    this.src = container;\n    var self = this;\n    var bounds = getBounds(container);\n    this.promise = (!sameOrigin ? this.proxyLoad(options.proxy, bounds, options) : new Promise(function(resolve) {\n        if (container.contentWindow.document.URL === \"about:blank\" || container.contentWindow.document.documentElement == null) {\n            container.contentWindow.onload = container.onload = function() {\n                resolve(container);\n            };\n        } else {\n            resolve(container);\n        }\n    })).then(function(container) {\n        var html2canvas = _dereq_('./core');\n        return html2canvas(container.contentWindow.document.documentElement, {type: 'view', width: container.width, height: container.height, proxy: options.proxy, javascriptEnabled: options.javascriptEnabled, removeContainer: options.removeContainer, allowTaint: options.allowTaint, imageTimeout: options.imageTimeout / 2});\n    }).then(function(canvas) {\n        return self.image = canvas;\n    });\n}\n\nFrameContainer.prototype.proxyLoad = function(proxy, bounds, options) {\n    var container = this.src;\n    return loadUrlDocument(container.src, proxy, container.ownerDocument, bounds.width, bounds.height, options);\n};\n\nmodule.exports = FrameContainer;\n\n},{\"./core\":4,\"./proxy\":16,\"./utils\":26}],9:[function(_dereq_,module,exports){\nfunction GradientContainer(imageData) {\n    this.src = imageData.value;\n    this.colorStops = [];\n    this.type = null;\n    this.x0 = 0.5;\n    this.y0 = 0.5;\n    this.x1 = 0.5;\n    this.y1 = 0.5;\n    this.promise = Promise.resolve(true);\n}\n\nGradientContainer.TYPES = {\n    LINEAR: 1,\n    RADIAL: 2\n};\n\n// TODO: support hsl[a], negative %/length values\n// TODO: support <angle> (e.g. -?\\d{1,3}(?:\\.\\d+)deg, etc. : https://developer.mozilla.org/docs/Web/CSS/angle )\nGradientContainer.REGEXP_COLORSTOP = /^\\s*(rgba?\\(\\s*\\d{1,3},\\s*\\d{1,3},\\s*\\d{1,3}(?:,\\s*[0-9\\.]+)?\\s*\\)|[a-z]{3,20}|#[a-f0-9]{3,6})(?:\\s+(\\d{1,3}(?:\\.\\d+)?)(%|px)?)?(?:\\s|$)/i;\n\nmodule.exports = GradientContainer;\n\n},{}],10:[function(_dereq_,module,exports){\nfunction ImageContainer(src, cors) {\n    this.src = src;\n    this.image = new Image();\n    var self = this;\n    this.tainted = null;\n    this.promise = new Promise(function(resolve, reject) {\n        self.image.onload = resolve;\n        self.image.onerror = reject;\n        if (cors) {\n            self.image.crossOrigin = \"anonymous\";\n        }\n        self.image.src = src;\n        if (self.image.complete === true) {\n            resolve(self.image);\n        }\n    });\n}\n\nmodule.exports = ImageContainer;\n\n},{}],11:[function(_dereq_,module,exports){\nvar log = _dereq_('./log');\nvar ImageContainer = _dereq_('./imagecontainer');\nvar DummyImageContainer = _dereq_('./dummyimagecontainer');\nvar ProxyImageContainer = _dereq_('./proxyimagecontainer');\nvar FrameContainer = _dereq_('./framecontainer');\nvar SVGContainer = _dereq_('./svgcontainer');\nvar SVGNodeContainer = _dereq_('./svgnodecontainer');\nvar LinearGradientContainer = _dereq_('./lineargradientcontainer');\nvar WebkitGradientContainer = _dereq_('./webkitgradientcontainer');\nvar bind = _dereq_('./utils').bind;\n\nfunction ImageLoader(options, support) {\n    this.link = null;\n    this.options = options;\n    this.support = support;\n    this.origin = this.getOrigin(window.location.href);\n}\n\nImageLoader.prototype.findImages = function(nodes) {\n    var images = [];\n    nodes.reduce(function(imageNodes, container) {\n        switch(container.node.nodeName) {\n        case \"IMG\":\n            return imageNodes.concat([{\n                args: [container.node.src],\n                method: \"url\"\n            }]);\n        case \"svg\":\n        case \"IFRAME\":\n            return imageNodes.concat([{\n                args: [container.node],\n                method: container.node.nodeName\n            }]);\n        }\n        return imageNodes;\n    }, []).forEach(this.addImage(images, this.loadImage), this);\n    return images;\n};\n\nImageLoader.prototype.findBackgroundImage = function(images, container) {\n    container.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(images, this.loadImage), this);\n    return images;\n};\n\nImageLoader.prototype.addImage = function(images, callback) {\n    return function(newImage) {\n        newImage.args.forEach(function(image) {\n            if (!this.imageExists(images, image)) {\n                images.splice(0, 0, callback.call(this, newImage));\n                log('Added image #' + (images.length), typeof(image) === \"string\" ? image.substring(0, 100) : image);\n            }\n        }, this);\n    };\n};\n\nImageLoader.prototype.hasImageBackground = function(imageData) {\n    return imageData.method !== \"none\";\n};\n\nImageLoader.prototype.loadImage = function(imageData) {\n    if (imageData.method === \"url\") {\n        var src = imageData.args[0];\n        if (this.isSVG(src) && !this.support.svg && !this.options.allowTaint) {\n            return new SVGContainer(src);\n        } else if (src.match(/data:image\\/.*;base64,/i)) {\n            return new ImageContainer(src.replace(/url\\(['\"]{0,}|['\"]{0,}\\)$/ig, ''), false);\n        } else if (this.isSameOrigin(src) || this.options.allowTaint === true || this.isSVG(src)) {\n            return new ImageContainer(src, false);\n        } else if (this.support.cors && !this.options.allowTaint && this.options.useCORS) {\n            return new ImageContainer(src, true);\n        } else if (this.options.proxy) {\n            return new ProxyImageContainer(src, this.options.proxy);\n        } else {\n            return new DummyImageContainer(src);\n        }\n    } else if (imageData.method === \"linear-gradient\") {\n        return new LinearGradientContainer(imageData);\n    } else if (imageData.method === \"gradient\") {\n        return new WebkitGradientContainer(imageData);\n    } else if (imageData.method === \"svg\") {\n        return new SVGNodeContainer(imageData.args[0], this.support.svg);\n    } else if (imageData.method === \"IFRAME\") {\n        return new FrameContainer(imageData.args[0], this.isSameOrigin(imageData.args[0].src), this.options);\n    } else {\n        return new DummyImageContainer(imageData);\n    }\n};\n\nImageLoader.prototype.isSVG = function(src) {\n    return src.substring(src.length - 3).toLowerCase() === \"svg\" || SVGContainer.prototype.isInline(src);\n};\n\nImageLoader.prototype.imageExists = function(images, src) {\n    return images.some(function(image) {\n        return image.src === src;\n    });\n};\n\nImageLoader.prototype.isSameOrigin = function(url) {\n    return (this.getOrigin(url) === this.origin);\n};\n\nImageLoader.prototype.getOrigin = function(url) {\n    var link = this.link || (this.link = document.createElement(\"a\"));\n    link.href = url;\n    link.href = link.href; // IE9, LOL! - http://jsfiddle.net/niklasvh/2e48b/\n    return link.protocol + link.hostname + link.port;\n};\n\nImageLoader.prototype.getPromise = function(container) {\n    return this.timeout(container, this.options.imageTimeout)['catch'](function() {\n        var dummy = new DummyImageContainer(container.src);\n        return dummy.promise.then(function(image) {\n            container.image = image;\n        });\n    });\n};\n\nImageLoader.prototype.get = function(src) {\n    var found = null;\n    return this.images.some(function(img) {\n        return (found = img).src === src;\n    }) ? found : null;\n};\n\nImageLoader.prototype.fetch = function(nodes) {\n    this.images = nodes.reduce(bind(this.findBackgroundImage, this), this.findImages(nodes));\n    this.images.forEach(function(image, index) {\n        image.promise.then(function() {\n            log(\"Succesfully loaded image #\"+ (index+1), image);\n        }, function(e) {\n            log(\"Failed loading image #\"+ (index+1), image, e);\n        });\n    });\n    this.ready = Promise.all(this.images.map(this.getPromise, this));\n    log(\"Finished searching images\");\n    return this;\n};\n\nImageLoader.prototype.timeout = function(container, timeout) {\n    var timer;\n    var promise = Promise.race([container.promise, new Promise(function(res, reject) {\n        timer = setTimeout(function() {\n            log(\"Timed out loading image\", container);\n            reject(container);\n        }, timeout);\n    })]).then(function(container) {\n        clearTimeout(timer);\n        return container;\n    });\n    promise['catch'](function() {\n        clearTimeout(timer);\n    });\n    return promise;\n};\n\nmodule.exports = ImageLoader;\n\n},{\"./dummyimagecontainer\":5,\"./framecontainer\":8,\"./imagecontainer\":10,\"./lineargradientcontainer\":12,\"./log\":13,\"./proxyimagecontainer\":17,\"./svgcontainer\":23,\"./svgnodecontainer\":24,\"./utils\":26,\"./webkitgradientcontainer\":27}],12:[function(_dereq_,module,exports){\nvar GradientContainer = _dereq_('./gradientcontainer');\nvar Color = _dereq_('./color');\n\nfunction LinearGradientContainer(imageData) {\n    GradientContainer.apply(this, arguments);\n    this.type = GradientContainer.TYPES.LINEAR;\n\n    var hasDirection = LinearGradientContainer.REGEXP_DIRECTION.test( imageData.args[0] ) ||\n        !GradientContainer.REGEXP_COLORSTOP.test( imageData.args[0] );\n\n    if (hasDirection) {\n        imageData.args[0].split(/\\s+/).reverse().forEach(function(position, index) {\n            switch(position) {\n            case \"left\":\n                this.x0 = 0;\n                this.x1 = 1;\n                break;\n            case \"top\":\n                this.y0 = 0;\n                this.y1 = 1;\n                break;\n            case \"right\":\n                this.x0 = 1;\n                this.x1 = 0;\n                break;\n            case \"bottom\":\n                this.y0 = 1;\n                this.y1 = 0;\n                break;\n            case \"to\":\n                var y0 = this.y0;\n                var x0 = this.x0;\n                this.y0 = this.y1;\n                this.x0 = this.x1;\n                this.x1 = x0;\n                this.y1 = y0;\n                break;\n            case \"center\":\n                break; // centered by default\n            // Firefox internally converts position keywords to percentages:\n            // http://www.w3.org/TR/2010/WD-CSS2-20101207/colors.html#propdef-background-position\n            default: // percentage or absolute length\n                // TODO: support absolute start point positions (e.g., use bounds to convert px to a ratio)\n                var ratio = parseFloat(position, 10) * 1e-2;\n                if (isNaN(ratio)) { // invalid or unhandled value\n                    break;\n                }\n                if (index === 0) {\n                    this.y0 = ratio;\n                    this.y1 = 1 - this.y0;\n                } else {\n                    this.x0 = ratio;\n                    this.x1 = 1 - this.x0;\n                }\n                break;\n            }\n        }, this);\n    } else {\n        this.y0 = 0;\n        this.y1 = 1;\n    }\n\n    this.colorStops = imageData.args.slice(hasDirection ? 1 : 0).map(function(colorStop) {\n        var colorStopMatch = colorStop.match(GradientContainer.REGEXP_COLORSTOP);\n        var value = +colorStopMatch[2];\n        var unit = value === 0 ? \"%\" : colorStopMatch[3]; // treat \"0\" as \"0%\"\n        return {\n            color: new Color(colorStopMatch[1]),\n            // TODO: support absolute stop positions (e.g., compute gradient line length & convert px to ratio)\n            stop: unit === \"%\" ? value / 100 : null\n        };\n    });\n\n    if (this.colorStops[0].stop === null) {\n        this.colorStops[0].stop = 0;\n    }\n\n    if (this.colorStops[this.colorStops.length - 1].stop === null) {\n        this.colorStops[this.colorStops.length - 1].stop = 1;\n    }\n\n    // calculates and fills-in explicit stop positions when omitted from rule\n    this.colorStops.forEach(function(colorStop, index) {\n        if (colorStop.stop === null) {\n            this.colorStops.slice(index).some(function(find, count) {\n                if (find.stop !== null) {\n                    colorStop.stop = ((find.stop - this.colorStops[index - 1].stop) / (count + 1)) + this.colorStops[index - 1].stop;\n                    return true;\n                } else {\n                    return false;\n                }\n            }, this);\n        }\n    }, this);\n}\n\nLinearGradientContainer.prototype = Object.create(GradientContainer.prototype);\n\n// TODO: support <angle> (e.g. -?\\d{1,3}(?:\\.\\d+)deg, etc. : https://developer.mozilla.org/docs/Web/CSS/angle )\nLinearGradientContainer.REGEXP_DIRECTION = /^\\s*(?:to|left|right|top|bottom|center|\\d{1,3}(?:\\.\\d+)?%?)(?:\\s|$)/i;\n\nmodule.exports = LinearGradientContainer;\n\n},{\"./color\":3,\"./gradientcontainer\":9}],13:[function(_dereq_,module,exports){\nvar logger = function() {\n    if (logger.options.logging && window.console && window.console.log) {\n        Function.prototype.bind.call(window.console.log, (window.console)).apply(window.console, [(Date.now() - logger.options.start) + \"ms\", \"html2canvas:\"].concat([].slice.call(arguments, 0)));\n    }\n};\n\nlogger.options = {logging: false};\nmodule.exports = logger;\n\n},{}],14:[function(_dereq_,module,exports){\nvar Color = _dereq_('./color');\nvar utils = _dereq_('./utils');\nvar getBounds = utils.getBounds;\nvar parseBackgrounds = utils.parseBackgrounds;\nvar offsetBounds = utils.offsetBounds;\n\nfunction NodeContainer(node, parent) {\n    this.node = node;\n    this.parent = parent;\n    this.stack = null;\n    this.bounds = null;\n    this.borders = null;\n    this.clip = [];\n    this.backgroundClip = [];\n    this.offsetBounds = null;\n    this.visible = null;\n    this.computedStyles = null;\n    this.colors = {};\n    this.styles = {};\n    this.backgroundImages = null;\n    this.transformData = null;\n    this.transformMatrix = null;\n    this.isPseudoElement = false;\n    this.opacity = null;\n}\n\nNodeContainer.prototype.cloneTo = function(stack) {\n    stack.visible = this.visible;\n    stack.borders = this.borders;\n    stack.bounds = this.bounds;\n    stack.clip = this.clip;\n    stack.backgroundClip = this.backgroundClip;\n    stack.computedStyles = this.computedStyles;\n    stack.styles = this.styles;\n    stack.backgroundImages = this.backgroundImages;\n    stack.opacity = this.opacity;\n};\n\nNodeContainer.prototype.getOpacity = function() {\n    return this.opacity === null ? (this.opacity = this.cssFloat('opacity')) : this.opacity;\n};\n\nNodeContainer.prototype.assignStack = function(stack) {\n    this.stack = stack;\n    stack.children.push(this);\n};\n\nNodeContainer.prototype.isElementVisible = function() {\n    return this.node.nodeType === Node.TEXT_NODE ? this.parent.visible : (\n        this.css('display') !== \"none\" &&\n        this.css('visibility') !== \"hidden\" &&\n        !this.node.hasAttribute(\"data-html2canvas-ignore\") &&\n        (this.node.nodeName !== \"INPUT\" || this.node.getAttribute(\"type\") !== \"hidden\")\n    );\n};\n\nNodeContainer.prototype.css = function(attribute) {\n    if (!this.computedStyles) {\n        this.computedStyles = this.isPseudoElement ? this.parent.computedStyle(this.before ? \":before\" : \":after\") : this.computedStyle(null);\n    }\n\n    return this.styles[attribute] || (this.styles[attribute] = this.computedStyles[attribute]);\n};\n\nNodeContainer.prototype.prefixedCss = function(attribute) {\n    var prefixes = [\"webkit\", \"moz\", \"ms\", \"o\"];\n    var value = this.css(attribute);\n    if (value === undefined) {\n        prefixes.some(function(prefix) {\n            value = this.css(prefix + attribute.substr(0, 1).toUpperCase() + attribute.substr(1));\n            return value !== undefined;\n        }, this);\n    }\n    return value === undefined ? null : value;\n};\n\nNodeContainer.prototype.computedStyle = function(type) {\n    return this.node.ownerDocument.defaultView.getComputedStyle(this.node, type);\n};\n\nNodeContainer.prototype.cssInt = function(attribute) {\n    var value = parseInt(this.css(attribute), 10);\n    return (isNaN(value)) ? 0 : value; // borders in old IE are throwing 'medium' for demo.html\n};\n\nNodeContainer.prototype.color = function(attribute) {\n    return this.colors[attribute] || (this.colors[attribute] = new Color(this.css(attribute)));\n};\n\nNodeContainer.prototype.cssFloat = function(attribute) {\n    var value = parseFloat(this.css(attribute));\n    return (isNaN(value)) ? 0 : value;\n};\n\nNodeContainer.prototype.fontWeight = function() {\n    var weight = this.css(\"fontWeight\");\n    switch(parseInt(weight, 10)){\n    case 401:\n        weight = \"bold\";\n        break;\n    case 400:\n        weight = \"normal\";\n        break;\n    }\n    return weight;\n};\n\nNodeContainer.prototype.parseClip = function() {\n    var matches = this.css('clip').match(this.CLIP);\n    if (matches) {\n        return {\n            top: parseInt(matches[1], 10),\n            right: parseInt(matches[2], 10),\n            bottom: parseInt(matches[3], 10),\n            left: parseInt(matches[4], 10)\n        };\n    }\n    return null;\n};\n\nNodeContainer.prototype.parseBackgroundImages = function() {\n    return this.backgroundImages || (this.backgroundImages = parseBackgrounds(this.css(\"backgroundImage\")));\n};\n\nNodeContainer.prototype.cssList = function(property, index) {\n    var value = (this.css(property) || '').split(',');\n    value = value[index || 0] || value[0] || 'auto';\n    value = value.trim().split(' ');\n    if (value.length === 1) {\n        value = [value[0], isPercentage(value[0]) ? 'auto' : value[0]];\n    }\n    return value;\n};\n\nNodeContainer.prototype.parseBackgroundSize = function(bounds, image, index) {\n    var size = this.cssList(\"backgroundSize\", index);\n    var width, height;\n\n    if (isPercentage(size[0])) {\n        width = bounds.width * parseFloat(size[0]) / 100;\n    } else if (/contain|cover/.test(size[0])) {\n        var targetRatio = bounds.width / bounds.height, currentRatio = image.width / image.height;\n        return (targetRatio < currentRatio ^ size[0] === 'contain') ?  {width: bounds.height * currentRatio, height: bounds.height} : {width: bounds.width, height: bounds.width / currentRatio};\n    } else {\n        width = parseInt(size[0], 10);\n    }\n\n    if (size[0] === 'auto' && size[1] === 'auto') {\n        height = image.height;\n    } else if (size[1] === 'auto') {\n        height = width / image.width * image.height;\n    } else if (isPercentage(size[1])) {\n        height =  bounds.height * parseFloat(size[1]) / 100;\n    } else {\n        height = parseInt(size[1], 10);\n    }\n\n    if (size[0] === 'auto') {\n        width = height / image.height * image.width;\n    }\n\n    return {width: width, height: height};\n};\n\nNodeContainer.prototype.parseBackgroundPosition = function(bounds, image, index, backgroundSize) {\n    var position = this.cssList('backgroundPosition', index);\n    var left, top;\n\n    if (isPercentage(position[0])){\n        left = (bounds.width - (backgroundSize || image).width) * (parseFloat(position[0]) / 100);\n    } else {\n        left = parseInt(position[0], 10);\n    }\n\n    if (position[1] === 'auto') {\n        top = left / image.width * image.height;\n    } else if (isPercentage(position[1])){\n        top =  (bounds.height - (backgroundSize || image).height) * parseFloat(position[1]) / 100;\n    } else {\n        top = parseInt(position[1], 10);\n    }\n\n    if (position[0] === 'auto') {\n        left = top / image.height * image.width;\n    }\n\n    return {left: left, top: top};\n};\n\nNodeContainer.prototype.parseBackgroundRepeat = function(index) {\n    return this.cssList(\"backgroundRepeat\", index)[0];\n};\n\nNodeContainer.prototype.parseTextShadows = function() {\n    var textShadow = this.css(\"textShadow\");\n    var results = [];\n\n    if (textShadow && textShadow !== 'none') {\n        var shadows = textShadow.match(this.TEXT_SHADOW_PROPERTY);\n        for (var i = 0; shadows && (i < shadows.length); i++) {\n            var s = shadows[i].match(this.TEXT_SHADOW_VALUES);\n            results.push({\n                color: new Color(s[0]),\n                offsetX: s[1] ? parseFloat(s[1].replace('px', '')) : 0,\n                offsetY: s[2] ? parseFloat(s[2].replace('px', '')) : 0,\n                blur: s[3] ? s[3].replace('px', '') : 0\n            });\n        }\n    }\n    return results;\n};\n\nNodeContainer.prototype.parseTransform = function() {\n    if (!this.transformData) {\n        if (this.hasTransform()) {\n            var offset = this.parseBounds();\n            var origin = this.prefixedCss(\"transformOrigin\").split(\" \").map(removePx).map(asFloat);\n            origin[0] += offset.left;\n            origin[1] += offset.top;\n            this.transformData = {\n                origin: origin,\n                matrix: this.parseTransformMatrix()\n            };\n        } else {\n            this.transformData = {\n                origin: [0, 0],\n                matrix: [1, 0, 0, 1, 0, 0]\n            };\n        }\n    }\n    return this.transformData;\n};\n\nNodeContainer.prototype.parseTransformMatrix = function() {\n    if (!this.transformMatrix) {\n        var transform = this.prefixedCss(\"transform\");\n        var matrix = transform ? parseMatrix(transform.match(this.MATRIX_PROPERTY)) : null;\n        this.transformMatrix = matrix ? matrix : [1, 0, 0, 1, 0, 0];\n    }\n    return this.transformMatrix;\n};\n\nNodeContainer.prototype.parseBounds = function() {\n    return this.bounds || (this.bounds = this.hasTransform() ? offsetBounds(this.node) : getBounds(this.node));\n};\n\nNodeContainer.prototype.hasTransform = function() {\n    return this.parseTransformMatrix().join(\",\") !== \"1,0,0,1,0,0\" || (this.parent && this.parent.hasTransform());\n};\n\nNodeContainer.prototype.getValue = function() {\n    var value = this.node.value || \"\";\n    if (this.node.tagName === \"SELECT\") {\n        value = selectionValue(this.node);\n    } else if (this.node.type === \"password\") {\n        value = Array(value.length + 1).join('\\u2022'); // jshint ignore:line\n    }\n    return value.length === 0 ? (this.node.placeholder || \"\") : value;\n};\n\nNodeContainer.prototype.MATRIX_PROPERTY = /(matrix|matrix3d)\\((.+)\\)/;\nNodeContainer.prototype.TEXT_SHADOW_PROPERTY = /((rgba|rgb)\\([^\\)]+\\)(\\s-?\\d+px){0,})/g;\nNodeContainer.prototype.TEXT_SHADOW_VALUES = /(-?\\d+px)|(#.+)|(rgb\\(.+\\))|(rgba\\(.+\\))/g;\nNodeContainer.prototype.CLIP = /^rect\\((\\d+)px,? (\\d+)px,? (\\d+)px,? (\\d+)px\\)$/;\n\nfunction selectionValue(node) {\n    var option = node.options[node.selectedIndex || 0];\n    return option ? (option.text || \"\") : \"\";\n}\n\nfunction parseMatrix(match) {\n    if (match && match[1] === \"matrix\") {\n        return match[2].split(\",\").map(function(s) {\n            return parseFloat(s.trim());\n        });\n    } else if (match && match[1] === \"matrix3d\") {\n        var matrix3d = match[2].split(\",\").map(function(s) {\n          return parseFloat(s.trim());\n        });\n        return [matrix3d[0], matrix3d[1], matrix3d[4], matrix3d[5], matrix3d[12], matrix3d[13]];\n    }\n}\n\nfunction isPercentage(value) {\n    return value.toString().indexOf(\"%\") !== -1;\n}\n\nfunction removePx(str) {\n    return str.replace(\"px\", \"\");\n}\n\nfunction asFloat(str) {\n    return parseFloat(str);\n}\n\nmodule.exports = NodeContainer;\n\n},{\"./color\":3,\"./utils\":26}],15:[function(_dereq_,module,exports){\nvar log = _dereq_('./log');\nvar punycode = _dereq_('punycode');\nvar NodeContainer = _dereq_('./nodecontainer');\nvar TextContainer = _dereq_('./textcontainer');\nvar PseudoElementContainer = _dereq_('./pseudoelementcontainer');\nvar FontMetrics = _dereq_('./fontmetrics');\nvar Color = _dereq_('./color');\nvar StackingContext = _dereq_('./stackingcontext');\nvar utils = _dereq_('./utils');\nvar bind = utils.bind;\nvar getBounds = utils.getBounds;\nvar parseBackgrounds = utils.parseBackgrounds;\nvar offsetBounds = utils.offsetBounds;\n\nfunction NodeParser(element, renderer, support, imageLoader, options) {\n    log(\"Starting NodeParser\");\n    this.renderer = renderer;\n    this.options = options;\n    this.range = null;\n    this.support = support;\n    this.renderQueue = [];\n    this.stack = new StackingContext(true, 1, element.ownerDocument, null);\n    var parent = new NodeContainer(element, null);\n    if (options.background) {\n        renderer.rectangle(0, 0, renderer.width, renderer.height, new Color(options.background));\n    }\n    if (element === element.ownerDocument.documentElement) {\n        // http://www.w3.org/TR/css3-background/#special-backgrounds\n        var canvasBackground = new NodeContainer(parent.color('backgroundColor').isTransparent() ? element.ownerDocument.body : element.ownerDocument.documentElement, null);\n        renderer.rectangle(0, 0, renderer.width, renderer.height, canvasBackground.color('backgroundColor'));\n    }\n    parent.visibile = parent.isElementVisible();\n    this.createPseudoHideStyles(element.ownerDocument);\n    this.disableAnimations(element.ownerDocument);\n    this.nodes = flatten([parent].concat(this.getChildren(parent)).filter(function(container) {\n        return container.visible = container.isElementVisible();\n    }).map(this.getPseudoElements, this));\n    this.fontMetrics = new FontMetrics();\n    log(\"Fetched nodes, total:\", this.nodes.length);\n    log(\"Calculate overflow clips\");\n    this.calculateOverflowClips();\n    log(\"Start fetching images\");\n    this.images = imageLoader.fetch(this.nodes.filter(isElement));\n    this.ready = this.images.ready.then(bind(function() {\n        log(\"Images loaded, starting parsing\");\n        log(\"Creating stacking contexts\");\n        this.createStackingContexts();\n        log(\"Sorting stacking contexts\");\n        this.sortStackingContexts(this.stack);\n        this.parse(this.stack);\n        log(\"Render queue created with \" + this.renderQueue.length + \" items\");\n        return new Promise(bind(function(resolve) {\n            if (!options.async) {\n                this.renderQueue.forEach(this.paint, this);\n                resolve();\n            } else if (typeof(options.async) === \"function\") {\n                options.async.call(this, this.renderQueue, resolve);\n            } else if (this.renderQueue.length > 0){\n                this.renderIndex = 0;\n                this.asyncRenderer(this.renderQueue, resolve);\n            } else {\n                resolve();\n            }\n        }, this));\n    }, this));\n}\n\nNodeParser.prototype.calculateOverflowClips = function() {\n    this.nodes.forEach(function(container) {\n        if (isElement(container)) {\n            if (isPseudoElement(container)) {\n                container.appendToDOM();\n            }\n            container.borders = this.parseBorders(container);\n            var clip = (container.css('overflow') === \"hidden\") ? [container.borders.clip] : [];\n            var cssClip = container.parseClip();\n            if (cssClip && [\"absolute\", \"fixed\"].indexOf(container.css('position')) !== -1) {\n                clip.push([[\"rect\",\n                        container.bounds.left + cssClip.left,\n                        container.bounds.top + cssClip.top,\n                        cssClip.right - cssClip.left,\n                        cssClip.bottom - cssClip.top\n                ]]);\n            }\n            container.clip = hasParentClip(container) ? container.parent.clip.concat(clip) : clip;\n            container.backgroundClip = (container.css('overflow') !== \"hidden\") ? container.clip.concat([container.borders.clip]) : container.clip;\n            if (isPseudoElement(container)) {\n                container.cleanDOM();\n            }\n        } else if (isTextNode(container)) {\n            container.clip = hasParentClip(container) ? container.parent.clip : [];\n        }\n        if (!isPseudoElement(container)) {\n            container.bounds = null;\n        }\n    }, this);\n};\n\nfunction hasParentClip(container) {\n    return container.parent && container.parent.clip.length;\n}\n\nNodeParser.prototype.asyncRenderer = function(queue, resolve, asyncTimer) {\n    asyncTimer = asyncTimer || Date.now();\n    this.paint(queue[this.renderIndex++]);\n    if (queue.length === this.renderIndex) {\n        resolve();\n    } else if (asyncTimer + 20 > Date.now()) {\n        this.asyncRenderer(queue, resolve, asyncTimer);\n    } else {\n        setTimeout(bind(function() {\n            this.asyncRenderer(queue, resolve);\n        }, this), 0);\n    }\n};\n\nNodeParser.prototype.createPseudoHideStyles = function(document) {\n    this.createStyles(document, '.' + PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + ':before { content: \"\" !important; display: none !important; }' +\n        '.' + PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER + ':after { content: \"\" !important; display: none !important; }');\n};\n\nNodeParser.prototype.disableAnimations = function(document) {\n    this.createStyles(document, '* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; ' +\n        '-webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}');\n};\n\nNodeParser.prototype.createStyles = function(document, styles) {\n    var hidePseudoElements = document.createElement('style');\n    hidePseudoElements.innerHTML = styles;\n    document.body.appendChild(hidePseudoElements);\n};\n\nNodeParser.prototype.getPseudoElements = function(container) {\n    var nodes = [[container]];\n    if (container.node.nodeType === Node.ELEMENT_NODE) {\n        var before = this.getPseudoElement(container, \":before\");\n        var after = this.getPseudoElement(container, \":after\");\n\n        if (before) {\n            nodes.push(before);\n        }\n\n        if (after) {\n            nodes.push(after);\n        }\n    }\n    return flatten(nodes);\n};\n\nfunction toCamelCase(str) {\n    return str.replace(/(\\-[a-z])/g, function(match){\n        return match.toUpperCase().replace('-','');\n    });\n}\n\nNodeParser.prototype.getPseudoElement = function(container, type) {\n    var style = container.computedStyle(type);\n    if(!style || !style.content || style.content === \"none\" || style.content === \"-moz-alt-content\" || style.display === \"none\") {\n        return null;\n    }\n\n    var content = stripQuotes(style.content);\n    var isImage = content.substr(0, 3) === 'url';\n    var pseudoNode = document.createElement(isImage ? 'img' : 'html2canvaspseudoelement');\n    var pseudoContainer = new PseudoElementContainer(pseudoNode, container, type);\n\n    for (var i = style.length-1; i >= 0; i--) {\n        var property = toCamelCase(style.item(i));\n        pseudoNode.style[property] = style[property];\n    }\n\n    pseudoNode.className = PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + \" \" + PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER;\n\n    if (isImage) {\n        pseudoNode.src = parseBackgrounds(content)[0].args[0];\n        return [pseudoContainer];\n    } else {\n        var text = document.createTextNode(content);\n        pseudoNode.appendChild(text);\n        return [pseudoContainer, new TextContainer(text, pseudoContainer)];\n    }\n};\n\n\nNodeParser.prototype.getChildren = function(parentContainer) {\n    return flatten([].filter.call(parentContainer.node.childNodes, renderableNode).map(function(node) {\n        var container = [node.nodeType === Node.TEXT_NODE ? new TextContainer(node, parentContainer) : new NodeContainer(node, parentContainer)].filter(nonIgnoredElement);\n        return node.nodeType === Node.ELEMENT_NODE && container.length && node.tagName !== \"TEXTAREA\" ? (container[0].isElementVisible() ? container.concat(this.getChildren(container[0])) : []) : container;\n    }, this));\n};\n\nNodeParser.prototype.newStackingContext = function(container, hasOwnStacking) {\n    var stack = new StackingContext(hasOwnStacking, container.getOpacity(), container.node, container.parent);\n    container.cloneTo(stack);\n    var parentStack = hasOwnStacking ? stack.getParentStack(this) : stack.parent.stack;\n    parentStack.contexts.push(stack);\n    container.stack = stack;\n};\n\nNodeParser.prototype.createStackingContexts = function() {\n    this.nodes.forEach(function(container) {\n        if (isElement(container) && (this.isRootElement(container) || hasOpacity(container) || isPositionedForStacking(container) || this.isBodyWithTransparentRoot(container) || container.hasTransform())) {\n            this.newStackingContext(container, true);\n        } else if (isElement(container) && ((isPositioned(container) && zIndex0(container)) || isInlineBlock(container) || isFloating(container))) {\n            this.newStackingContext(container, false);\n        } else {\n            container.assignStack(container.parent.stack);\n        }\n    }, this);\n};\n\nNodeParser.prototype.isBodyWithTransparentRoot = function(container) {\n    return container.node.nodeName === \"BODY\" && container.parent.color('backgroundColor').isTransparent();\n};\n\nNodeParser.prototype.isRootElement = function(container) {\n    return container.parent === null;\n};\n\nNodeParser.prototype.sortStackingContexts = function(stack) {\n    stack.contexts.sort(zIndexSort(stack.contexts.slice(0)));\n    stack.contexts.forEach(this.sortStackingContexts, this);\n};\n\nNodeParser.prototype.parseTextBounds = function(container) {\n    return function(text, index, textList) {\n        if (container.parent.css(\"textDecoration\").substr(0, 4) !== \"none\" || text.trim().length !== 0) {\n            if (this.support.rangeBounds && !container.parent.hasTransform()) {\n                var offset = textList.slice(0, index).join(\"\").length;\n                return this.getRangeBounds(container.node, offset, text.length);\n            } else if (container.node && typeof(container.node.data) === \"string\") {\n                var replacementNode = container.node.splitText(text.length);\n                var bounds = this.getWrapperBounds(container.node, container.parent.hasTransform());\n                container.node = replacementNode;\n                return bounds;\n            }\n        } else if(!this.support.rangeBounds || container.parent.hasTransform()){\n            container.node = container.node.splitText(text.length);\n        }\n        return {};\n    };\n};\n\nNodeParser.prototype.getWrapperBounds = function(node, transform) {\n    var wrapper = node.ownerDocument.createElement('html2canvaswrapper');\n    var parent = node.parentNode,\n        backupText = node.cloneNode(true);\n\n    wrapper.appendChild(node.cloneNode(true));\n    parent.replaceChild(wrapper, node);\n    var bounds = transform ? offsetBounds(wrapper) : getBounds(wrapper);\n    parent.replaceChild(backupText, wrapper);\n    return bounds;\n};\n\nNodeParser.prototype.getRangeBounds = function(node, offset, length) {\n    var range = this.range || (this.range = node.ownerDocument.createRange());\n    range.setStart(node, offset);\n    range.setEnd(node, offset + length);\n    return range.getBoundingClientRect();\n};\n\nfunction ClearTransform() {}\n\nNodeParser.prototype.parse = function(stack) {\n    // http://www.w3.org/TR/CSS21/visuren.html#z-index\n    var negativeZindex = stack.contexts.filter(negativeZIndex); // 2. the child stacking contexts with negative stack levels (most negative first).\n    var descendantElements = stack.children.filter(isElement);\n    var descendantNonFloats = descendantElements.filter(not(isFloating));\n    var nonInlineNonPositionedDescendants = descendantNonFloats.filter(not(isPositioned)).filter(not(inlineLevel)); // 3 the in-flow, non-inline-level, non-positioned descendants.\n    var nonPositionedFloats = descendantElements.filter(not(isPositioned)).filter(isFloating); // 4. the non-positioned floats.\n    var inFlow = descendantNonFloats.filter(not(isPositioned)).filter(inlineLevel); // 5. the in-flow, inline-level, non-positioned descendants, including inline tables and inline blocks.\n    var stackLevel0 = stack.contexts.concat(descendantNonFloats.filter(isPositioned)).filter(zIndex0); // 6. the child stacking contexts with stack level 0 and the positioned descendants with stack level 0.\n    var text = stack.children.filter(isTextNode).filter(hasText);\n    var positiveZindex = stack.contexts.filter(positiveZIndex); // 7. the child stacking contexts with positive stack levels (least positive first).\n    negativeZindex.concat(nonInlineNonPositionedDescendants).concat(nonPositionedFloats)\n        .concat(inFlow).concat(stackLevel0).concat(text).concat(positiveZindex).forEach(function(container) {\n            this.renderQueue.push(container);\n            if (isStackingContext(container)) {\n                this.parse(container);\n                this.renderQueue.push(new ClearTransform());\n            }\n        }, this);\n};\n\nNodeParser.prototype.paint = function(container) {\n    try {\n        if (container instanceof ClearTransform) {\n            this.renderer.ctx.restore();\n        } else if (isTextNode(container)) {\n            if (isPseudoElement(container.parent)) {\n                container.parent.appendToDOM();\n            }\n            this.paintText(container);\n            if (isPseudoElement(container.parent)) {\n                container.parent.cleanDOM();\n            }\n        } else {\n            this.paintNode(container);\n        }\n    } catch(e) {\n        log(e);\n        if (this.options.strict) {\n            throw e;\n        }\n    }\n};\n\nNodeParser.prototype.paintNode = function(container) {\n    if (isStackingContext(container)) {\n        this.renderer.setOpacity(container.opacity);\n        this.renderer.ctx.save();\n        if (container.hasTransform()) {\n            this.renderer.setTransform(container.parseTransform());\n        }\n    }\n\n    if (container.node.nodeName === \"INPUT\" && container.node.type === \"checkbox\") {\n        this.paintCheckbox(container);\n    } else if (container.node.nodeName === \"INPUT\" && container.node.type === \"radio\") {\n        this.paintRadio(container);\n    } else {\n        this.paintElement(container);\n    }\n};\n\nNodeParser.prototype.paintElement = function(container) {\n    var bounds = container.parseBounds();\n    this.renderer.clip(container.backgroundClip, function() {\n        this.renderer.renderBackground(container, bounds, container.borders.borders.map(getWidth));\n    }, this);\n\n    this.renderer.clip(container.clip, function() {\n        this.renderer.renderBorders(container.borders.borders);\n    }, this);\n\n    this.renderer.clip(container.backgroundClip, function() {\n        switch (container.node.nodeName) {\n        case \"svg\":\n        case \"IFRAME\":\n            var imgContainer = this.images.get(container.node);\n            if (imgContainer) {\n                this.renderer.renderImage(container, bounds, container.borders, imgContainer);\n            } else {\n                log(\"Error loading <\" + container.node.nodeName + \">\", container.node);\n            }\n            break;\n        case \"IMG\":\n            var imageContainer = this.images.get(container.node.src);\n            if (imageContainer) {\n                this.renderer.renderImage(container, bounds, container.borders, imageContainer);\n            } else {\n                log(\"Error loading <img>\", container.node.src);\n            }\n            break;\n        case \"CANVAS\":\n            this.renderer.renderImage(container, bounds, container.borders, {image: container.node});\n            break;\n        case \"SELECT\":\n        case \"INPUT\":\n        case \"TEXTAREA\":\n            this.paintFormValue(container);\n            break;\n        }\n    }, this);\n};\n\nNodeParser.prototype.paintCheckbox = function(container) {\n    var b = container.parseBounds();\n\n    var size = Math.min(b.width, b.height);\n    var bounds = {width: size - 1, height: size - 1, top: b.top, left: b.left};\n    var r = [3, 3];\n    var radius = [r, r, r, r];\n    var borders = [1,1,1,1].map(function(w) {\n        return {color: new Color('#A5A5A5'), width: w};\n    });\n\n    var borderPoints = calculateCurvePoints(bounds, radius, borders);\n\n    this.renderer.clip(container.backgroundClip, function() {\n        this.renderer.rectangle(bounds.left + 1, bounds.top + 1, bounds.width - 2, bounds.height - 2, new Color(\"#DEDEDE\"));\n        this.renderer.renderBorders(calculateBorders(borders, bounds, borderPoints, radius));\n        if (container.node.checked) {\n            this.renderer.font(new Color('#424242'), 'normal', 'normal', 'bold', (size - 3) + \"px\", 'arial');\n            this.renderer.text(\"\\u2714\", bounds.left + size / 6, bounds.top + size - 1);\n        }\n    }, this);\n};\n\nNodeParser.prototype.paintRadio = function(container) {\n    var bounds = container.parseBounds();\n\n    var size = Math.min(bounds.width, bounds.height) - 2;\n\n    this.renderer.clip(container.backgroundClip, function() {\n        this.renderer.circleStroke(bounds.left + 1, bounds.top + 1, size, new Color('#DEDEDE'), 1, new Color('#A5A5A5'));\n        if (container.node.checked) {\n            this.renderer.circle(Math.ceil(bounds.left + size / 4) + 1, Math.ceil(bounds.top + size / 4) + 1, Math.floor(size / 2), new Color('#424242'));\n        }\n    }, this);\n};\n\nNodeParser.prototype.paintFormValue = function(container) {\n    var value = container.getValue();\n    if (value.length > 0) {\n        var document = container.node.ownerDocument;\n        var wrapper = document.createElement('html2canvaswrapper');\n        var properties = ['lineHeight', 'textAlign', 'fontFamily', 'fontWeight', 'fontSize', 'color',\n            'paddingLeft', 'paddingTop', 'paddingRight', 'paddingBottom',\n            'width', 'height', 'borderLeftStyle', 'borderTopStyle', 'borderLeftWidth', 'borderTopWidth',\n            'boxSizing', 'whiteSpace', 'wordWrap'];\n\n        properties.forEach(function(property) {\n            try {\n                wrapper.style[property] = container.css(property);\n            } catch(e) {\n                // Older IE has issues with \"border\"\n                log(\"html2canvas: Parse: Exception caught in renderFormValue: \" + e.message);\n            }\n        });\n        var bounds = container.parseBounds();\n        wrapper.style.position = \"fixed\";\n        wrapper.style.left = bounds.left + \"px\";\n        wrapper.style.top = bounds.top + \"px\";\n        wrapper.textContent = value;\n        document.body.appendChild(wrapper);\n        this.paintText(new TextContainer(wrapper.firstChild, container));\n        document.body.removeChild(wrapper);\n    }\n};\n\nNodeParser.prototype.paintText = function(container) {\n    container.applyTextTransform();\n    var characters = punycode.ucs2.decode(container.node.data);\n    var textList = (!this.options.letterRendering || noLetterSpacing(container)) && !hasUnicode(container.node.data) ? getWords(characters) : characters.map(function(character) {\n        return punycode.ucs2.encode([character]);\n    });\n\n    var weight = container.parent.fontWeight();\n    var size = container.parent.css('fontSize');\n    var family = container.parent.css('fontFamily');\n    var shadows = container.parent.parseTextShadows();\n\n    this.renderer.font(container.parent.color('color'), container.parent.css('fontStyle'), container.parent.css('fontVariant'), weight, size, family);\n    if (shadows.length) {\n        // TODO: support multiple text shadows\n        this.renderer.fontShadow(shadows[0].color, shadows[0].offsetX, shadows[0].offsetY, shadows[0].blur);\n    } else {\n        this.renderer.clearShadow();\n    }\n\n    this.renderer.clip(container.parent.clip, function() {\n        textList.map(this.parseTextBounds(container), this).forEach(function(bounds, index) {\n            if (bounds) {\n                this.renderer.text(textList[index], bounds.left, bounds.bottom);\n                this.renderTextDecoration(container.parent, bounds, this.fontMetrics.getMetrics(family, size));\n            }\n        }, this);\n    }, this);\n};\n\nNodeParser.prototype.renderTextDecoration = function(container, bounds, metrics) {\n    switch(container.css(\"textDecoration\").split(\" \")[0]) {\n    case \"underline\":\n        // Draws a line at the baseline of the font\n        // TODO As some browsers display the line as more than 1px if the font-size is big, need to take that into account both in position and size\n        this.renderer.rectangle(bounds.left, Math.round(bounds.top + metrics.baseline + metrics.lineWidth), bounds.width, 1, container.color(\"color\"));\n        break;\n    case \"overline\":\n        this.renderer.rectangle(bounds.left, Math.round(bounds.top), bounds.width, 1, container.color(\"color\"));\n        break;\n    case \"line-through\":\n        // TODO try and find exact position for line-through\n        this.renderer.rectangle(bounds.left, Math.ceil(bounds.top + metrics.middle + metrics.lineWidth), bounds.width, 1, container.color(\"color\"));\n        break;\n    }\n};\n\nvar borderColorTransforms = {\n    inset: [\n        [\"darken\", 0.60],\n        [\"darken\", 0.10],\n        [\"darken\", 0.10],\n        [\"darken\", 0.60]\n    ]\n};\n\nNodeParser.prototype.parseBorders = function(container) {\n    var nodeBounds = container.parseBounds();\n    var radius = getBorderRadiusData(container);\n    var borders = [\"Top\", \"Right\", \"Bottom\", \"Left\"].map(function(side, index) {\n        var style = container.css('border' + side + 'Style');\n        var color = container.color('border' + side + 'Color');\n        if (style === \"inset\" && color.isBlack()) {\n            color = new Color([255, 255, 255, color.a]); // this is wrong, but\n        }\n        var colorTransform = borderColorTransforms[style] ? borderColorTransforms[style][index] : null;\n        return {\n            width: container.cssInt('border' + side + 'Width'),\n            color: colorTransform ? color[colorTransform[0]](colorTransform[1]) : color,\n            args: null\n        };\n    });\n    var borderPoints = calculateCurvePoints(nodeBounds, radius, borders);\n\n    return {\n        clip: this.parseBackgroundClip(container, borderPoints, borders, radius, nodeBounds),\n        borders: calculateBorders(borders, nodeBounds, borderPoints, radius)\n    };\n};\n\nfunction calculateBorders(borders, nodeBounds, borderPoints, radius) {\n    return borders.map(function(border, borderSide) {\n        if (border.width > 0) {\n            var bx = nodeBounds.left;\n            var by = nodeBounds.top;\n            var bw = nodeBounds.width;\n            var bh = nodeBounds.height - (borders[2].width);\n\n            switch(borderSide) {\n            case 0:\n                // top border\n                bh = borders[0].width;\n                border.args = drawSide({\n                        c1: [bx, by],\n                        c2: [bx + bw, by],\n                        c3: [bx + bw - borders[1].width, by + bh],\n                        c4: [bx + borders[3].width, by + bh]\n                    }, radius[0], radius[1],\n                    borderPoints.topLeftOuter, borderPoints.topLeftInner, borderPoints.topRightOuter, borderPoints.topRightInner);\n                break;\n            case 1:\n                // right border\n                bx = nodeBounds.left + nodeBounds.width - (borders[1].width);\n                bw = borders[1].width;\n\n                border.args = drawSide({\n                        c1: [bx + bw, by],\n                        c2: [bx + bw, by + bh + borders[2].width],\n                        c3: [bx, by + bh],\n                        c4: [bx, by + borders[0].width]\n                    }, radius[1], radius[2],\n                    borderPoints.topRightOuter, borderPoints.topRightInner, borderPoints.bottomRightOuter, borderPoints.bottomRightInner);\n                break;\n            case 2:\n                // bottom border\n                by = (by + nodeBounds.height) - (borders[2].width);\n                bh = borders[2].width;\n                border.args = drawSide({\n                        c1: [bx + bw, by + bh],\n                        c2: [bx, by + bh],\n                        c3: [bx + borders[3].width, by],\n                        c4: [bx + bw - borders[3].width, by]\n                    }, radius[2], radius[3],\n                    borderPoints.bottomRightOuter, borderPoints.bottomRightInner, borderPoints.bottomLeftOuter, borderPoints.bottomLeftInner);\n                break;\n            case 3:\n                // left border\n                bw = borders[3].width;\n                border.args = drawSide({\n                        c1: [bx, by + bh + borders[2].width],\n                        c2: [bx, by],\n                        c3: [bx + bw, by + borders[0].width],\n                        c4: [bx + bw, by + bh]\n                    }, radius[3], radius[0],\n                    borderPoints.bottomLeftOuter, borderPoints.bottomLeftInner, borderPoints.topLeftOuter, borderPoints.topLeftInner);\n                break;\n            }\n        }\n        return border;\n    });\n}\n\nNodeParser.prototype.parseBackgroundClip = function(container, borderPoints, borders, radius, bounds) {\n    var backgroundClip = container.css('backgroundClip'),\n        borderArgs = [];\n\n    switch(backgroundClip) {\n    case \"content-box\":\n    case \"padding-box\":\n        parseCorner(borderArgs, radius[0], radius[1], borderPoints.topLeftInner, borderPoints.topRightInner, bounds.left + borders[3].width, bounds.top + borders[0].width);\n        parseCorner(borderArgs, radius[1], radius[2], borderPoints.topRightInner, borderPoints.bottomRightInner, bounds.left + bounds.width - borders[1].width, bounds.top + borders[0].width);\n        parseCorner(borderArgs, radius[2], radius[3], borderPoints.bottomRightInner, borderPoints.bottomLeftInner, bounds.left + bounds.width - borders[1].width, bounds.top + bounds.height - borders[2].width);\n        parseCorner(borderArgs, radius[3], radius[0], borderPoints.bottomLeftInner, borderPoints.topLeftInner, bounds.left + borders[3].width, bounds.top + bounds.height - borders[2].width);\n        break;\n\n    default:\n        parseCorner(borderArgs, radius[0], radius[1], borderPoints.topLeftOuter, borderPoints.topRightOuter, bounds.left, bounds.top);\n        parseCorner(borderArgs, radius[1], radius[2], borderPoints.topRightOuter, borderPoints.bottomRightOuter, bounds.left + bounds.width, bounds.top);\n        parseCorner(borderArgs, radius[2], radius[3], borderPoints.bottomRightOuter, borderPoints.bottomLeftOuter, bounds.left + bounds.width, bounds.top + bounds.height);\n        parseCorner(borderArgs, radius[3], radius[0], borderPoints.bottomLeftOuter, borderPoints.topLeftOuter, bounds.left, bounds.top + bounds.height);\n        break;\n    }\n\n    return borderArgs;\n};\n\nfunction getCurvePoints(x, y, r1, r2) {\n    var kappa = 4 * ((Math.sqrt(2) - 1) / 3);\n    var ox = (r1) * kappa, // control point offset horizontal\n        oy = (r2) * kappa, // control point offset vertical\n        xm = x + r1, // x-middle\n        ym = y + r2; // y-middle\n    return {\n        topLeft: bezierCurve({x: x, y: ym}, {x: x, y: ym - oy}, {x: xm - ox, y: y}, {x: xm, y: y}),\n        topRight: bezierCurve({x: x, y: y}, {x: x + ox,y: y}, {x: xm, y: ym - oy}, {x: xm, y: ym}),\n        bottomRight: bezierCurve({x: xm, y: y}, {x: xm, y: y + oy}, {x: x + ox, y: ym}, {x: x, y: ym}),\n        bottomLeft: bezierCurve({x: xm, y: ym}, {x: xm - ox, y: ym}, {x: x, y: y + oy}, {x: x, y:y})\n    };\n}\n\nfunction calculateCurvePoints(bounds, borderRadius, borders) {\n    var x = bounds.left,\n        y = bounds.top,\n        width = bounds.width,\n        height = bounds.height,\n\n        tlh = borderRadius[0][0] < width / 2 ? borderRadius[0][0] : width / 2,\n        tlv = borderRadius[0][1] < height / 2 ? borderRadius[0][1] : height / 2,\n        trh = borderRadius[1][0] < width / 2 ? borderRadius[1][0] : width / 2,\n        trv = borderRadius[1][1] < height / 2 ? borderRadius[1][1] : height / 2,\n        brh = borderRadius[2][0] < width / 2 ? borderRadius[2][0] : width / 2,\n        brv = borderRadius[2][1] < height / 2 ? borderRadius[2][1] : height / 2,\n        blh = borderRadius[3][0] < width / 2 ? borderRadius[3][0] : width / 2,\n        blv = borderRadius[3][1] < height / 2 ? borderRadius[3][1] : height / 2;\n\n    var topWidth = width - trh,\n        rightHeight = height - brv,\n        bottomWidth = width - brh,\n        leftHeight = height - blv;\n\n    return {\n        topLeftOuter: getCurvePoints(x, y, tlh, tlv).topLeft.subdivide(0.5),\n        topLeftInner: getCurvePoints(x + borders[3].width, y + borders[0].width, Math.max(0, tlh - borders[3].width), Math.max(0, tlv - borders[0].width)).topLeft.subdivide(0.5),\n        topRightOuter: getCurvePoints(x + topWidth, y, trh, trv).topRight.subdivide(0.5),\n        topRightInner: getCurvePoints(x + Math.min(topWidth, width + borders[3].width), y + borders[0].width, (topWidth > width + borders[3].width) ? 0 :trh - borders[3].width, trv - borders[0].width).topRight.subdivide(0.5),\n        bottomRightOuter: getCurvePoints(x + bottomWidth, y + rightHeight, brh, brv).bottomRight.subdivide(0.5),\n        bottomRightInner: getCurvePoints(x + Math.min(bottomWidth, width - borders[3].width), y + Math.min(rightHeight, height + borders[0].width), Math.max(0, brh - borders[1].width),  brv - borders[2].width).bottomRight.subdivide(0.5),\n        bottomLeftOuter: getCurvePoints(x, y + leftHeight, blh, blv).bottomLeft.subdivide(0.5),\n        bottomLeftInner: getCurvePoints(x + borders[3].width, y + leftHeight, Math.max(0, blh - borders[3].width), blv - borders[2].width).bottomLeft.subdivide(0.5)\n    };\n}\n\nfunction bezierCurve(start, startControl, endControl, end) {\n    var lerp = function (a, b, t) {\n        return {\n            x: a.x + (b.x - a.x) * t,\n            y: a.y + (b.y - a.y) * t\n        };\n    };\n\n    return {\n        start: start,\n        startControl: startControl,\n        endControl: endControl,\n        end: end,\n        subdivide: function(t) {\n            var ab = lerp(start, startControl, t),\n                bc = lerp(startControl, endControl, t),\n                cd = lerp(endControl, end, t),\n                abbc = lerp(ab, bc, t),\n                bccd = lerp(bc, cd, t),\n                dest = lerp(abbc, bccd, t);\n            return [bezierCurve(start, ab, abbc, dest), bezierCurve(dest, bccd, cd, end)];\n        },\n        curveTo: function(borderArgs) {\n            borderArgs.push([\"bezierCurve\", startControl.x, startControl.y, endControl.x, endControl.y, end.x, end.y]);\n        },\n        curveToReversed: function(borderArgs) {\n            borderArgs.push([\"bezierCurve\", endControl.x, endControl.y, startControl.x, startControl.y, start.x, start.y]);\n        }\n    };\n}\n\nfunction drawSide(borderData, radius1, radius2, outer1, inner1, outer2, inner2) {\n    var borderArgs = [];\n\n    if (radius1[0] > 0 || radius1[1] > 0) {\n        borderArgs.push([\"line\", outer1[1].start.x, outer1[1].start.y]);\n        outer1[1].curveTo(borderArgs);\n    } else {\n        borderArgs.push([ \"line\", borderData.c1[0], borderData.c1[1]]);\n    }\n\n    if (radius2[0] > 0 || radius2[1] > 0) {\n        borderArgs.push([\"line\", outer2[0].start.x, outer2[0].start.y]);\n        outer2[0].curveTo(borderArgs);\n        borderArgs.push([\"line\", inner2[0].end.x, inner2[0].end.y]);\n        inner2[0].curveToReversed(borderArgs);\n    } else {\n        borderArgs.push([\"line\", borderData.c2[0], borderData.c2[1]]);\n        borderArgs.push([\"line\", borderData.c3[0], borderData.c3[1]]);\n    }\n\n    if (radius1[0] > 0 || radius1[1] > 0) {\n        borderArgs.push([\"line\", inner1[1].end.x, inner1[1].end.y]);\n        inner1[1].curveToReversed(borderArgs);\n    } else {\n        borderArgs.push([\"line\", borderData.c4[0], borderData.c4[1]]);\n    }\n\n    return borderArgs;\n}\n\nfunction parseCorner(borderArgs, radius1, radius2, corner1, corner2, x, y) {\n    if (radius1[0] > 0 || radius1[1] > 0) {\n        borderArgs.push([\"line\", corner1[0].start.x, corner1[0].start.y]);\n        corner1[0].curveTo(borderArgs);\n        corner1[1].curveTo(borderArgs);\n    } else {\n        borderArgs.push([\"line\", x, y]);\n    }\n\n    if (radius2[0] > 0 || radius2[1] > 0) {\n        borderArgs.push([\"line\", corner2[0].start.x, corner2[0].start.y]);\n    }\n}\n\nfunction negativeZIndex(container) {\n    return container.cssInt(\"zIndex\") < 0;\n}\n\nfunction positiveZIndex(container) {\n    return container.cssInt(\"zIndex\") > 0;\n}\n\nfunction zIndex0(container) {\n    return container.cssInt(\"zIndex\") === 0;\n}\n\nfunction inlineLevel(container) {\n    return [\"inline\", \"inline-block\", \"inline-table\"].indexOf(container.css(\"display\")) !== -1;\n}\n\nfunction isStackingContext(container) {\n    return (container instanceof StackingContext);\n}\n\nfunction hasText(container) {\n    return container.node.data.trim().length > 0;\n}\n\nfunction noLetterSpacing(container) {\n    return (/^(normal|none|0px)$/.test(container.parent.css(\"letterSpacing\")));\n}\n\nfunction getBorderRadiusData(container) {\n    return [\"TopLeft\", \"TopRight\", \"BottomRight\", \"BottomLeft\"].map(function(side) {\n        var value = container.css('border' + side + 'Radius');\n        var arr = value.split(\" \");\n        if (arr.length <= 1) {\n            arr[1] = arr[0];\n        }\n        return arr.map(asInt);\n    });\n}\n\nfunction renderableNode(node) {\n    return (node.nodeType === Node.TEXT_NODE || node.nodeType === Node.ELEMENT_NODE);\n}\n\nfunction isPositionedForStacking(container) {\n    var position = container.css(\"position\");\n    var zIndex = ([\"absolute\", \"relative\", \"fixed\"].indexOf(position) !== -1) ? container.css(\"zIndex\") : \"auto\";\n    return zIndex !== \"auto\";\n}\n\nfunction isPositioned(container) {\n    return container.css(\"position\") !== \"static\";\n}\n\nfunction isFloating(container) {\n    return container.css(\"float\") !== \"none\";\n}\n\nfunction isInlineBlock(container) {\n    return [\"inline-block\", \"inline-table\"].indexOf(container.css(\"display\")) !== -1;\n}\n\nfunction not(callback) {\n    var context = this;\n    return function() {\n        return !callback.apply(context, arguments);\n    };\n}\n\nfunction isElement(container) {\n    return container.node.nodeType === Node.ELEMENT_NODE;\n}\n\nfunction isPseudoElement(container) {\n    return container.isPseudoElement === true;\n}\n\nfunction isTextNode(container) {\n    return container.node.nodeType === Node.TEXT_NODE;\n}\n\nfunction zIndexSort(contexts) {\n    return function(a, b) {\n        return (a.cssInt(\"zIndex\") + (contexts.indexOf(a) / contexts.length)) - (b.cssInt(\"zIndex\") + (contexts.indexOf(b) / contexts.length));\n    };\n}\n\nfunction hasOpacity(container) {\n    return container.getOpacity() < 1;\n}\n\nfunction asInt(value) {\n    return parseInt(value, 10);\n}\n\nfunction getWidth(border) {\n    return border.width;\n}\n\nfunction nonIgnoredElement(nodeContainer) {\n    return (nodeContainer.node.nodeType !== Node.ELEMENT_NODE || [\"SCRIPT\", \"HEAD\", \"TITLE\", \"OBJECT\", \"BR\", \"OPTION\"].indexOf(nodeContainer.node.nodeName) === -1);\n}\n\nfunction flatten(arrays) {\n    return [].concat.apply([], arrays);\n}\n\nfunction stripQuotes(content) {\n    var first = content.substr(0, 1);\n    return (first === content.substr(content.length - 1) && first.match(/'|\"/)) ? content.substr(1, content.length - 2) : content;\n}\n\nfunction getWords(characters) {\n    var words = [], i = 0, onWordBoundary = false, word;\n    while(characters.length) {\n        if (isWordBoundary(characters[i]) === onWordBoundary) {\n            word = characters.splice(0, i);\n            if (word.length) {\n                words.push(punycode.ucs2.encode(word));\n            }\n            onWordBoundary =! onWordBoundary;\n            i = 0;\n        } else {\n            i++;\n        }\n\n        if (i >= characters.length) {\n            word = characters.splice(0, i);\n            if (word.length) {\n                words.push(punycode.ucs2.encode(word));\n            }\n        }\n    }\n    return words;\n}\n\nfunction isWordBoundary(characterCode) {\n    return [\n        32, // <space>\n        13, // \\r\n        10, // \\n\n        9, // \\t\n        45 // -\n    ].indexOf(characterCode) !== -1;\n}\n\nfunction hasUnicode(string) {\n    return (/[^\\u0000-\\u00ff]/).test(string);\n}\n\nmodule.exports = NodeParser;\n\n},{\"./color\":3,\"./fontmetrics\":7,\"./log\":13,\"./nodecontainer\":14,\"./pseudoelementcontainer\":18,\"./stackingcontext\":21,\"./textcontainer\":25,\"./utils\":26,\"punycode\":1}],16:[function(_dereq_,module,exports){\nvar XHR = _dereq_('./xhr');\nvar utils = _dereq_('./utils');\nvar log = _dereq_('./log');\nvar createWindowClone = _dereq_('./clone');\nvar decode64 = utils.decode64;\n\nfunction Proxy(src, proxyUrl, document) {\n    var supportsCORS = ('withCredentials' in new XMLHttpRequest());\n    if (!proxyUrl) {\n        return Promise.reject(\"No proxy configured\");\n    }\n    var callback = createCallback(supportsCORS);\n    var url = createProxyUrl(proxyUrl, src, callback);\n\n    return supportsCORS ? XHR(url) : (jsonp(document, url, callback).then(function(response) {\n        return decode64(response.content);\n    }));\n}\nvar proxyCount = 0;\n\nfunction ProxyURL(src, proxyUrl, document) {\n    var supportsCORSImage = ('crossOrigin' in new Image());\n    var callback = createCallback(supportsCORSImage);\n    var url = createProxyUrl(proxyUrl, src, callback);\n    return (supportsCORSImage ? Promise.resolve(url) : jsonp(document, url, callback).then(function(response) {\n        return \"data:\" + response.type + \";base64,\" + response.content;\n    }));\n}\n\nfunction jsonp(document, url, callback) {\n    return new Promise(function(resolve, reject) {\n        var s = document.createElement(\"script\");\n        var cleanup = function() {\n            delete window.html2canvas.proxy[callback];\n            document.body.removeChild(s);\n        };\n        window.html2canvas.proxy[callback] = function(response) {\n            cleanup();\n            resolve(response);\n        };\n        s.src = url;\n        s.onerror = function(e) {\n            cleanup();\n            reject(e);\n        };\n        document.body.appendChild(s);\n    });\n}\n\nfunction createCallback(useCORS) {\n    return !useCORS ? \"html2canvas_\" + Date.now() + \"_\" + (++proxyCount) + \"_\" + Math.round(Math.random() * 100000) : \"\";\n}\n\nfunction createProxyUrl(proxyUrl, src, callback) {\n    return proxyUrl + \"?url=\" + encodeURIComponent(src) + (callback.length ? \"&callback=html2canvas.proxy.\" + callback : \"\");\n}\n\nfunction documentFromHTML(src) {\n    return function(html) {\n        var parser = new DOMParser(), doc;\n        try {\n            doc = parser.parseFromString(html, \"text/html\");\n        } catch(e) {\n            log(\"DOMParser not supported, falling back to createHTMLDocument\");\n            doc = document.implementation.createHTMLDocument(\"\");\n            try {\n                doc.open();\n                doc.write(html);\n                doc.close();\n            } catch(ee) {\n                log(\"createHTMLDocument write not supported, falling back to document.body.innerHTML\");\n                doc.body.innerHTML = html; // ie9 doesnt support writing to documentElement\n            }\n        }\n\n        var b = doc.querySelector(\"base\");\n        if (!b || !b.href.host) {\n            var base = doc.createElement(\"base\");\n            base.href = src;\n            doc.head.insertBefore(base, doc.head.firstChild);\n        }\n\n        return doc;\n    };\n}\n\nfunction loadUrlDocument(src, proxy, document, width, height, options) {\n    return new Proxy(src, proxy, window.document).then(documentFromHTML(src)).then(function(doc) {\n        return createWindowClone(doc, document, width, height, options, 0, 0);\n    });\n}\n\nexports.Proxy = Proxy;\nexports.ProxyURL = ProxyURL;\nexports.loadUrlDocument = loadUrlDocument;\n\n},{\"./clone\":2,\"./log\":13,\"./utils\":26,\"./xhr\":28}],17:[function(_dereq_,module,exports){\nvar ProxyURL = _dereq_('./proxy').ProxyURL;\n\nfunction ProxyImageContainer(src, proxy) {\n    var link = document.createElement(\"a\");\n    link.href = src;\n    src = link.href;\n    this.src = src;\n    this.image = new Image();\n    var self = this;\n    this.promise = new Promise(function(resolve, reject) {\n        self.image.crossOrigin = \"Anonymous\";\n        self.image.onload = resolve;\n        self.image.onerror = reject;\n\n        new ProxyURL(src, proxy, document).then(function(url) {\n            self.image.src = url;\n        })['catch'](reject);\n    });\n}\n\nmodule.exports = ProxyImageContainer;\n\n},{\"./proxy\":16}],18:[function(_dereq_,module,exports){\nvar NodeContainer = _dereq_('./nodecontainer');\n\nfunction PseudoElementContainer(node, parent, type) {\n    NodeContainer.call(this, node, parent);\n    this.isPseudoElement = true;\n    this.before = type === \":before\";\n}\n\nPseudoElementContainer.prototype.cloneTo = function(stack) {\n    PseudoElementContainer.prototype.cloneTo.call(this, stack);\n    stack.isPseudoElement = true;\n    stack.before = this.before;\n};\n\nPseudoElementContainer.prototype = Object.create(NodeContainer.prototype);\n\nPseudoElementContainer.prototype.appendToDOM = function() {\n    if (this.before) {\n        this.parent.node.insertBefore(this.node, this.parent.node.firstChild);\n    } else {\n        this.parent.node.appendChild(this.node);\n    }\n    this.parent.node.className += \" \" + this.getHideClass();\n};\n\nPseudoElementContainer.prototype.cleanDOM = function() {\n    this.node.parentNode.removeChild(this.node);\n    this.parent.node.className = this.parent.node.className.replace(this.getHideClass(), \"\");\n};\n\nPseudoElementContainer.prototype.getHideClass = function() {\n    return this[\"PSEUDO_HIDE_ELEMENT_CLASS_\" + (this.before ? \"BEFORE\" : \"AFTER\")];\n};\n\nPseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE = \"___html2canvas___pseudoelement_before\";\nPseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER = \"___html2canvas___pseudoelement_after\";\n\nmodule.exports = PseudoElementContainer;\n\n},{\"./nodecontainer\":14}],19:[function(_dereq_,module,exports){\nvar log = _dereq_('./log');\n\nfunction Renderer(width, height, images, options, document) {\n    this.width = width;\n    this.height = height;\n    this.images = images;\n    this.options = options;\n    this.document = document;\n}\n\nRenderer.prototype.renderImage = function(container, bounds, borderData, imageContainer) {\n    var paddingLeft = container.cssInt('paddingLeft'),\n        paddingTop = container.cssInt('paddingTop'),\n        paddingRight = container.cssInt('paddingRight'),\n        paddingBottom = container.cssInt('paddingBottom'),\n        borders = borderData.borders;\n\n    var width = bounds.width - (borders[1].width + borders[3].width + paddingLeft + paddingRight);\n    var height = bounds.height - (borders[0].width + borders[2].width + paddingTop + paddingBottom);\n    this.drawImage(\n        imageContainer,\n        0,\n        0,\n        imageContainer.image.width || width,\n        imageContainer.image.height || height,\n        bounds.left + paddingLeft + borders[3].width,\n        bounds.top + paddingTop + borders[0].width,\n        width,\n        height\n    );\n};\n\nRenderer.prototype.renderBackground = function(container, bounds, borderData) {\n    if (bounds.height > 0 && bounds.width > 0) {\n        this.renderBackgroundColor(container, bounds);\n        this.renderBackgroundImage(container, bounds, borderData);\n    }\n};\n\nRenderer.prototype.renderBackgroundColor = function(container, bounds) {\n    var color = container.color(\"backgroundColor\");\n    if (!color.isTransparent()) {\n        this.rectangle(bounds.left, bounds.top, bounds.width, bounds.height, color);\n    }\n};\n\nRenderer.prototype.renderBorders = function(borders) {\n    borders.forEach(this.renderBorder, this);\n};\n\nRenderer.prototype.renderBorder = function(data) {\n    if (!data.color.isTransparent() && data.args !== null) {\n        this.drawShape(data.args, data.color);\n    }\n};\n\nRenderer.prototype.renderBackgroundImage = function(container, bounds, borderData) {\n    var backgroundImages = container.parseBackgroundImages();\n    backgroundImages.reverse().forEach(function(backgroundImage, index, arr) {\n        switch(backgroundImage.method) {\n        case \"url\":\n            var image = this.images.get(backgroundImage.args[0]);\n            if (image) {\n                this.renderBackgroundRepeating(container, bounds, image, arr.length - (index+1), borderData);\n            } else {\n                log(\"Error loading background-image\", backgroundImage.args[0]);\n            }\n            break;\n        case \"linear-gradient\":\n        case \"gradient\":\n            var gradientImage = this.images.get(backgroundImage.value);\n            if (gradientImage) {\n                this.renderBackgroundGradient(gradientImage, bounds, borderData);\n            } else {\n                log(\"Error loading background-image\", backgroundImage.args[0]);\n            }\n            break;\n        case \"none\":\n            break;\n        default:\n            log(\"Unknown background-image type\", backgroundImage.args[0]);\n        }\n    }, this);\n};\n\nRenderer.prototype.renderBackgroundRepeating = function(container, bounds, imageContainer, index, borderData) {\n    var size = container.parseBackgroundSize(bounds, imageContainer.image, index);\n    var position = container.parseBackgroundPosition(bounds, imageContainer.image, index, size);\n    var repeat = container.parseBackgroundRepeat(index);\n    switch (repeat) {\n    case \"repeat-x\":\n    case \"repeat no-repeat\":\n        this.backgroundRepeatShape(imageContainer, position, size, bounds, bounds.left + borderData[3], bounds.top + position.top + borderData[0], 99999, size.height, borderData);\n        break;\n    case \"repeat-y\":\n    case \"no-repeat repeat\":\n        this.backgroundRepeatShape(imageContainer, position, size, bounds, bounds.left + position.left + borderData[3], bounds.top + borderData[0], size.width, 99999, borderData);\n        break;\n    case \"no-repeat\":\n        this.backgroundRepeatShape(imageContainer, position, size, bounds, bounds.left + position.left + borderData[3], bounds.top + position.top + borderData[0], size.width, size.height, borderData);\n        break;\n    default:\n        this.renderBackgroundRepeat(imageContainer, position, size, {top: bounds.top, left: bounds.left}, borderData[3], borderData[0]);\n        break;\n    }\n};\n\nmodule.exports = Renderer;\n\n},{\"./log\":13}],20:[function(_dereq_,module,exports){\nvar Renderer = _dereq_('../renderer');\nvar LinearGradientContainer = _dereq_('../lineargradientcontainer');\nvar log = _dereq_('../log');\n\nfunction CanvasRenderer(width, height) {\n    Renderer.apply(this, arguments);\n    this.canvas = this.options.canvas || this.document.createElement(\"canvas\");\n    if (!this.options.canvas) {\n        this.canvas.width = width;\n        this.canvas.height = height;\n    }\n    this.ctx = this.canvas.getContext(\"2d\");\n    this.taintCtx = this.document.createElement(\"canvas\").getContext(\"2d\");\n    this.ctx.textBaseline = \"bottom\";\n    this.variables = {};\n    log(\"Initialized CanvasRenderer with size\", width, \"x\", height);\n}\n\nCanvasRenderer.prototype = Object.create(Renderer.prototype);\n\nCanvasRenderer.prototype.setFillStyle = function(fillStyle) {\n    this.ctx.fillStyle = typeof(fillStyle) === \"object\" && !!fillStyle.isColor ? fillStyle.toString() : fillStyle;\n    return this.ctx;\n};\n\nCanvasRenderer.prototype.rectangle = function(left, top, width, height, color) {\n    this.setFillStyle(color).fillRect(left, top, width, height);\n};\n\nCanvasRenderer.prototype.circle = function(left, top, size, color) {\n    this.setFillStyle(color);\n    this.ctx.beginPath();\n    this.ctx.arc(left + size / 2, top + size / 2, size / 2, 0, Math.PI*2, true);\n    this.ctx.closePath();\n    this.ctx.fill();\n};\n\nCanvasRenderer.prototype.circleStroke = function(left, top, size, color, stroke, strokeColor) {\n    this.circle(left, top, size, color);\n    this.ctx.strokeStyle = strokeColor.toString();\n    this.ctx.stroke();\n};\n\nCanvasRenderer.prototype.drawShape = function(shape, color) {\n    this.shape(shape);\n    this.setFillStyle(color).fill();\n};\n\nCanvasRenderer.prototype.taints = function(imageContainer) {\n    if (imageContainer.tainted === null) {\n        this.taintCtx.drawImage(imageContainer.image, 0, 0);\n        try {\n            this.taintCtx.getImageData(0, 0, 1, 1);\n            imageContainer.tainted = false;\n        } catch(e) {\n            this.taintCtx = document.createElement(\"canvas\").getContext(\"2d\");\n            imageContainer.tainted = true;\n        }\n    }\n\n    return imageContainer.tainted;\n};\n\nCanvasRenderer.prototype.drawImage = function(imageContainer, sx, sy, sw, sh, dx, dy, dw, dh) {\n    if (!this.taints(imageContainer) || this.options.allowTaint) {\n        this.ctx.drawImage(imageContainer.image, sx, sy, sw, sh, dx, dy, dw, dh);\n    }\n};\n\nCanvasRenderer.prototype.clip = function(shapes, callback, context) {\n    this.ctx.save();\n    shapes.filter(hasEntries).forEach(function(shape) {\n        this.shape(shape).clip();\n    }, this);\n    callback.call(context);\n    this.ctx.restore();\n};\n\nCanvasRenderer.prototype.shape = function(shape) {\n    this.ctx.beginPath();\n    shape.forEach(function(point, index) {\n        if (point[0] === \"rect\") {\n            this.ctx.rect.apply(this.ctx, point.slice(1));\n        } else {\n            this.ctx[(index === 0) ? \"moveTo\" : point[0] + \"To\" ].apply(this.ctx, point.slice(1));\n        }\n    }, this);\n    this.ctx.closePath();\n    return this.ctx;\n};\n\nCanvasRenderer.prototype.font = function(color, style, variant, weight, size, family) {\n    this.setFillStyle(color).font = [style, variant, weight, size, family].join(\" \").split(\",\")[0];\n};\n\nCanvasRenderer.prototype.fontShadow = function(color, offsetX, offsetY, blur) {\n    this.setVariable(\"shadowColor\", color.toString())\n        .setVariable(\"shadowOffsetY\", offsetX)\n        .setVariable(\"shadowOffsetX\", offsetY)\n        .setVariable(\"shadowBlur\", blur);\n};\n\nCanvasRenderer.prototype.clearShadow = function() {\n    this.setVariable(\"shadowColor\", \"rgba(0,0,0,0)\");\n};\n\nCanvasRenderer.prototype.setOpacity = function(opacity) {\n    this.ctx.globalAlpha = opacity;\n};\n\nCanvasRenderer.prototype.setTransform = function(transform) {\n    this.ctx.translate(transform.origin[0], transform.origin[1]);\n    this.ctx.transform.apply(this.ctx, transform.matrix);\n    this.ctx.translate(-transform.origin[0], -transform.origin[1]);\n};\n\nCanvasRenderer.prototype.setVariable = function(property, value) {\n    if (this.variables[property] !== value) {\n        this.variables[property] = this.ctx[property] = value;\n    }\n\n    return this;\n};\n\nCanvasRenderer.prototype.text = function(text, left, bottom) {\n    this.ctx.fillText(text, left, bottom);\n};\n\nCanvasRenderer.prototype.backgroundRepeatShape = function(imageContainer, backgroundPosition, size, bounds, left, top, width, height, borderData) {\n    var shape = [\n        [\"line\", Math.round(left), Math.round(top)],\n        [\"line\", Math.round(left + width), Math.round(top)],\n        [\"line\", Math.round(left + width), Math.round(height + top)],\n        [\"line\", Math.round(left), Math.round(height + top)]\n    ];\n    this.clip([shape], function() {\n        this.renderBackgroundRepeat(imageContainer, backgroundPosition, size, bounds, borderData[3], borderData[0]);\n    }, this);\n};\n\nCanvasRenderer.prototype.renderBackgroundRepeat = function(imageContainer, backgroundPosition, size, bounds, borderLeft, borderTop) {\n    var offsetX = Math.round(bounds.left + backgroundPosition.left + borderLeft), offsetY = Math.round(bounds.top + backgroundPosition.top + borderTop);\n    this.setFillStyle(this.ctx.createPattern(this.resizeImage(imageContainer, size), \"repeat\"));\n    this.ctx.translate(offsetX, offsetY);\n    this.ctx.fill();\n    this.ctx.translate(-offsetX, -offsetY);\n};\n\nCanvasRenderer.prototype.renderBackgroundGradient = function(gradientImage, bounds) {\n    if (gradientImage instanceof LinearGradientContainer) {\n        var gradient = this.ctx.createLinearGradient(\n            bounds.left + bounds.width * gradientImage.x0,\n            bounds.top + bounds.height * gradientImage.y0,\n            bounds.left +  bounds.width * gradientImage.x1,\n            bounds.top +  bounds.height * gradientImage.y1);\n        gradientImage.colorStops.forEach(function(colorStop) {\n            gradient.addColorStop(colorStop.stop, colorStop.color.toString());\n        });\n        this.rectangle(bounds.left, bounds.top, bounds.width, bounds.height, gradient);\n    }\n};\n\nCanvasRenderer.prototype.resizeImage = function(imageContainer, size) {\n    var image = imageContainer.image;\n    if(image.width === size.width && image.height === size.height) {\n        return image;\n    }\n\n    var ctx, canvas = document.createElement('canvas');\n    canvas.width = size.width;\n    canvas.height = size.height;\n    ctx = canvas.getContext(\"2d\");\n    ctx.drawImage(image, 0, 0, image.width, image.height, 0, 0, size.width, size.height );\n    return canvas;\n};\n\nfunction hasEntries(array) {\n    return array.length > 0;\n}\n\nmodule.exports = CanvasRenderer;\n\n},{\"../lineargradientcontainer\":12,\"../log\":13,\"../renderer\":19}],21:[function(_dereq_,module,exports){\nvar NodeContainer = _dereq_('./nodecontainer');\n\nfunction StackingContext(hasOwnStacking, opacity, element, parent) {\n    NodeContainer.call(this, element, parent);\n    this.ownStacking = hasOwnStacking;\n    this.contexts = [];\n    this.children = [];\n    this.opacity = (this.parent ? this.parent.stack.opacity : 1) * opacity;\n}\n\nStackingContext.prototype = Object.create(NodeContainer.prototype);\n\nStackingContext.prototype.getParentStack = function(context) {\n    var parentStack = (this.parent) ? this.parent.stack : null;\n    return parentStack ? (parentStack.ownStacking ? parentStack : parentStack.getParentStack(context)) : context.stack;\n};\n\nmodule.exports = StackingContext;\n\n},{\"./nodecontainer\":14}],22:[function(_dereq_,module,exports){\nfunction Support(document) {\n    this.rangeBounds = this.testRangeBounds(document);\n    this.cors = this.testCORS();\n    this.svg = this.testSVG();\n}\n\nSupport.prototype.testRangeBounds = function(document) {\n    var range, testElement, rangeBounds, rangeHeight, support = false;\n\n    if (document.createRange) {\n        range = document.createRange();\n        if (range.getBoundingClientRect) {\n            testElement = document.createElement('boundtest');\n            testElement.style.height = \"123px\";\n            testElement.style.display = \"block\";\n            document.body.appendChild(testElement);\n\n            range.selectNode(testElement);\n            rangeBounds = range.getBoundingClientRect();\n            rangeHeight = rangeBounds.height;\n\n            if (rangeHeight === 123) {\n                support = true;\n            }\n            document.body.removeChild(testElement);\n        }\n    }\n\n    return support;\n};\n\nSupport.prototype.testCORS = function() {\n    return typeof((new Image()).crossOrigin) !== \"undefined\";\n};\n\nSupport.prototype.testSVG = function() {\n    var img = new Image();\n    var canvas = document.createElement(\"canvas\");\n    var ctx =  canvas.getContext(\"2d\");\n    img.src = \"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>\";\n\n    try {\n        ctx.drawImage(img, 0, 0);\n        canvas.toDataURL();\n    } catch(e) {\n        return false;\n    }\n    return true;\n};\n\nmodule.exports = Support;\n\n},{}],23:[function(_dereq_,module,exports){\nvar XHR = _dereq_('./xhr');\nvar decode64 = _dereq_('./utils').decode64;\n\nfunction SVGContainer(src) {\n    this.src = src;\n    this.image = null;\n    var self = this;\n\n    this.promise = this.hasFabric().then(function() {\n        return (self.isInline(src) ? Promise.resolve(self.inlineFormatting(src)) : XHR(src));\n    }).then(function(svg) {\n        return new Promise(function(resolve) {\n            window.html2canvas.svg.fabric.loadSVGFromString(svg, self.createCanvas.call(self, resolve));\n        });\n    });\n}\n\nSVGContainer.prototype.hasFabric = function() {\n    return !window.html2canvas.svg || !window.html2canvas.svg.fabric ? Promise.reject(new Error(\"html2canvas.svg.js is not loaded, cannot render svg\")) : Promise.resolve();\n};\n\nSVGContainer.prototype.inlineFormatting = function(src) {\n    return (/^data:image\\/svg\\+xml;base64,/.test(src)) ? this.decode64(this.removeContentType(src)) : this.removeContentType(src);\n};\n\nSVGContainer.prototype.removeContentType = function(src) {\n    return src.replace(/^data:image\\/svg\\+xml(;base64)?,/,'');\n};\n\nSVGContainer.prototype.isInline = function(src) {\n    return (/^data:image\\/svg\\+xml/i.test(src));\n};\n\nSVGContainer.prototype.createCanvas = function(resolve) {\n    var self = this;\n    return function (objects, options) {\n        var canvas = new window.html2canvas.svg.fabric.StaticCanvas('c');\n        self.image = canvas.lowerCanvasEl;\n        canvas\n            .setWidth(options.width)\n            .setHeight(options.height)\n            .add(window.html2canvas.svg.fabric.util.groupSVGElements(objects, options))\n            .renderAll();\n        resolve(canvas.lowerCanvasEl);\n    };\n};\n\nSVGContainer.prototype.decode64 = function(str) {\n    return (typeof(window.atob) === \"function\") ? window.atob(str) : decode64(str);\n};\n\nmodule.exports = SVGContainer;\n\n},{\"./utils\":26,\"./xhr\":28}],24:[function(_dereq_,module,exports){\nvar SVGContainer = _dereq_('./svgcontainer');\n\nfunction SVGNodeContainer(node, _native) {\n    this.src = node;\n    this.image = null;\n    var self = this;\n\n    this.promise = _native ? new Promise(function(resolve, reject) {\n        self.image = new Image();\n        self.image.onload = resolve;\n        self.image.onerror = reject;\n        self.image.src = \"data:image/svg+xml,\" + (new XMLSerializer()).serializeToString(node);\n        if (self.image.complete === true) {\n            resolve(self.image);\n        }\n    }) : this.hasFabric().then(function() {\n        return new Promise(function(resolve) {\n            window.html2canvas.svg.fabric.parseSVGDocument(node, self.createCanvas.call(self, resolve));\n        });\n    });\n}\n\nSVGNodeContainer.prototype = Object.create(SVGContainer.prototype);\n\nmodule.exports = SVGNodeContainer;\n\n},{\"./svgcontainer\":23}],25:[function(_dereq_,module,exports){\nvar NodeContainer = _dereq_('./nodecontainer');\n\nfunction TextContainer(node, parent) {\n    NodeContainer.call(this, node, parent);\n}\n\nTextContainer.prototype = Object.create(NodeContainer.prototype);\n\nTextContainer.prototype.applyTextTransform = function() {\n    this.node.data = this.transform(this.parent.css(\"textTransform\"));\n};\n\nTextContainer.prototype.transform = function(transform) {\n    var text = this.node.data;\n    switch(transform){\n        case \"lowercase\":\n            return text.toLowerCase();\n        case \"capitalize\":\n            return text.replace(/(^|\\s|:|-|\\(|\\))([a-z])/g, capitalize);\n        case \"uppercase\":\n            return text.toUpperCase();\n        default:\n            return text;\n    }\n};\n\nfunction capitalize(m, p1, p2) {\n    if (m.length > 0) {\n        return p1 + p2.toUpperCase();\n    }\n}\n\nmodule.exports = TextContainer;\n\n},{\"./nodecontainer\":14}],26:[function(_dereq_,module,exports){\nexports.smallImage = function smallImage() {\n    return \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\n};\n\nexports.bind = function(callback, context) {\n    return function() {\n        return callback.apply(context, arguments);\n    };\n};\n\n/*\n * base64-arraybuffer\n * https://github.com/niklasvh/base64-arraybuffer\n *\n * Copyright (c) 2012 Niklas von Hertzen\n * Licensed under the MIT license.\n */\n\nexports.decode64 = function(base64) {\n    var chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n    var len = base64.length, i, encoded1, encoded2, encoded3, encoded4, byte1, byte2, byte3;\n\n    var output = \"\";\n\n    for (i = 0; i < len; i+=4) {\n        encoded1 = chars.indexOf(base64[i]);\n        encoded2 = chars.indexOf(base64[i+1]);\n        encoded3 = chars.indexOf(base64[i+2]);\n        encoded4 = chars.indexOf(base64[i+3]);\n\n        byte1 = (encoded1 << 2) | (encoded2 >> 4);\n        byte2 = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n        byte3 = ((encoded3 & 3) << 6) | encoded4;\n        if (encoded3 === 64) {\n            output += String.fromCharCode(byte1);\n        } else if (encoded4 === 64 || encoded4 === -1) {\n            output += String.fromCharCode(byte1, byte2);\n        } else{\n            output += String.fromCharCode(byte1, byte2, byte3);\n        }\n    }\n\n    return output;\n};\n\nexports.getBounds = function(node) {\n    if (node.getBoundingClientRect) {\n        var clientRect = node.getBoundingClientRect();\n        var width = node.offsetWidth == null ? clientRect.width : node.offsetWidth;\n        return {\n            top: clientRect.top,\n            bottom: clientRect.bottom || (clientRect.top + clientRect.height),\n            right: clientRect.left + width,\n            left: clientRect.left,\n            width:  width,\n            height: node.offsetHeight == null ? clientRect.height : node.offsetHeight\n        };\n    }\n    return {};\n};\n\nexports.offsetBounds = function(node) {\n    var parent = node.offsetParent ? exports.offsetBounds(node.offsetParent) : {top: 0, left: 0};\n\n    return {\n        top: node.offsetTop + parent.top,\n        bottom: node.offsetTop + node.offsetHeight + parent.top,\n        right: node.offsetLeft + parent.left + node.offsetWidth,\n        left: node.offsetLeft + parent.left,\n        width: node.offsetWidth,\n        height: node.offsetHeight\n    };\n};\n\nexports.parseBackgrounds = function(backgroundImage) {\n    var whitespace = ' \\r\\n\\t',\n        method, definition, prefix, prefix_i, block, results = [],\n        mode = 0, numParen = 0, quote, args;\n    var appendResult = function() {\n        if(method) {\n            if (definition.substr(0, 1) === '\"') {\n                definition = definition.substr(1, definition.length - 2);\n            }\n            if (definition) {\n                args.push(definition);\n            }\n            if (method.substr(0, 1) === '-' && (prefix_i = method.indexOf('-', 1 ) + 1) > 0) {\n                prefix = method.substr(0, prefix_i);\n                method = method.substr(prefix_i);\n            }\n            results.push({\n                prefix: prefix,\n                method: method.toLowerCase(),\n                value: block,\n                args: args,\n                image: null\n            });\n        }\n        args = [];\n        method = prefix = definition = block = '';\n    };\n    args = [];\n    method = prefix = definition = block = '';\n    backgroundImage.split(\"\").forEach(function(c) {\n        if (mode === 0 && whitespace.indexOf(c) > -1) {\n            return;\n        }\n        switch(c) {\n        case '\"':\n            if(!quote) {\n                quote = c;\n            } else if(quote === c) {\n                quote = null;\n            }\n            break;\n        case '(':\n            if(quote) {\n                break;\n            } else if(mode === 0) {\n                mode = 1;\n                block += c;\n                return;\n            } else {\n                numParen++;\n            }\n            break;\n        case ')':\n            if (quote) {\n                break;\n            } else if(mode === 1) {\n                if(numParen === 0) {\n                    mode = 0;\n                    block += c;\n                    appendResult();\n                    return;\n                } else {\n                    numParen--;\n                }\n            }\n            break;\n\n        case ',':\n            if (quote) {\n                break;\n            } else if(mode === 0) {\n                appendResult();\n                return;\n            } else if (mode === 1) {\n                if (numParen === 0 && !method.match(/^url$/i)) {\n                    args.push(definition);\n                    definition = '';\n                    block += c;\n                    return;\n                }\n            }\n            break;\n        }\n\n        block += c;\n        if (mode === 0) {\n            method += c;\n        } else {\n            definition += c;\n        }\n    });\n\n    appendResult();\n    return results;\n};\n\n},{}],27:[function(_dereq_,module,exports){\nvar GradientContainer = _dereq_('./gradientcontainer');\n\nfunction WebkitGradientContainer(imageData) {\n    GradientContainer.apply(this, arguments);\n    this.type = imageData.args[0] === \"linear\" ? GradientContainer.TYPES.LINEAR : GradientContainer.TYPES.RADIAL;\n}\n\nWebkitGradientContainer.prototype = Object.create(GradientContainer.prototype);\n\nmodule.exports = WebkitGradientContainer;\n\n},{\"./gradientcontainer\":9}],28:[function(_dereq_,module,exports){\nfunction XHR(url) {\n    return new Promise(function(resolve, reject) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', url);\n\n        xhr.onload = function() {\n            if (xhr.status === 200) {\n                resolve(xhr.responseText);\n            } else {\n                reject(new Error(xhr.statusText));\n            }\n        };\n\n        xhr.onerror = function() {\n            reject(new Error(\"Network Error\"));\n        };\n\n        xhr.send();\n    });\n}\n\nmodule.exports = XHR;\n\n},{}]},{},[4])(4)\n});\n\n\n/** WEBPACK FOOTER **\n ** ./~/html2canvas/dist/html2canvas.js\n **/","/**\n * base class for all object in the library\n * @class Baseobject\n */\nexport default class BaseObject {\n  /**\n   * virtual function for returning class name\n   * @returns {string}\n   */\n  getName() {\n    return '';\n  }\n\n  /**\n   * returns if current mode is debugging mode\n   * @returns {bool}\n   */\n  isDebug() {\n    return this._debugMode;\n  }\n\n  /**\n   * logs message and object for debugging purpose\n   * @param {string} message\n   * @param {Array<any>} args\n   */\n  log(message, ...args) {\n    if (!this.isDebug()) {\n      return;\n    }\n\n    console.log(`${this.getName()}: ${message}`, ...args);\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/base-object.js\n **/","import BaseObject from './base-object';\nimport Rect from './rect';\n\n/**\n * State enabled class to manage grey canvas on top of html page for cropping\n * @class CanvasState\n */\nexport default class CanvasState extends BaseObject {\n  /**\n   * object constructor\n   * @param {HTMLDocument} doc\n   * @param {HTMLElement} canvas - canvas DOM element\n   */\n  constructor(doc, canvas, debugMode = true) {\n    super();\n\n    this._onMouseDown = this._onMouseDown.bind(this);\n    this._onMouseMove = this._onMouseMove.bind(this);\n    this._onMouseUp = this._onMouseUp.bind(this);\n    this._onTouch = this._onTouch.bind(this);\n\n    this._document = doc;\n    this._canvas = canvas;\n    this._width = canvas.width;\n    this._height = canvas.height;\n    this._ctx = canvas.getContext('2d');\n    this._debugMode = debugMode;\n\n    const html = this._document.body.parentNode;\n\n    this._htmlTop = html.offsetTop;\n    this._htmlLeft = html.offsetLeft;\n\n    this._valid = false; // when set to false, the canvas will redraw everything\n    this._shape = null;  // the rectangle shape\n    this._dragging = false; // Keep track of when we are dragging\n    this._dragoffx = 0; // See mousedown and mousemove events for explanation\n    this._dragoffy = 0;\n\n    this.log('initialized');\n\n    this._initRect();\n    this._initEvents();\n\n    this._interval = 30;\n    setInterval(() => {\n      this.draw();\n    }, this._interval);\n  }\n\n  /**\n   * returns class name\n   * @returns {string}\n   */\n  getName() {\n    return 'CanvasState';\n  }\n\n  _onMouseDown(e) {\n    const { _shape } = this;\n    const mouse = this.getMouse(e);\n    const mx = mouse.x;\n    const my = mouse.y;\n    this._valid = false;\n    if (_shape.contains(mx, my)) {\n      this._dragoffx = mx - _shape._x;\n      this._dragoffy = my - _shape._y;\n      this._dragging = true;\n\n      this.log('mouse down detected. starting drag', mx, my);\n    }\n\n    this._currentHandle = this._shape.getHoverSelectionHandle(mouse.x, mouse.y);\n  }\n\n  _onMouseMove(e) {\n    const { _shape, _canvas } = this;\n    const mouse = this.getMouse(e);\n    const oldx = _shape._x;\n    const oldy = _shape._y;\n    const mx = mouse.x;\n    const my = mouse.y;\n    const handleIndex = _shape.getHoverSelectionHandle(mx, my);\n    switch (handleIndex) {\n      case 0:\n        _canvas.style.cursor = 'nw-resize';\n        break;\n      case 1:\n        _canvas.style.cursor = 'n-resize';\n        break;\n      case 2:\n        _canvas.style.cursor = 'ne-resize';\n        break;\n      case 3:\n        _canvas.style.cursor = 'w-resize';\n        break;\n      case 4:\n        _canvas.style.cursor = 'e-resize';\n        break;\n      case 5:\n        _canvas.style.cursor = 'sw-resize';\n        break;\n      case 6:\n        _canvas.style.cursor = 's-resize';\n        break;\n      case 7:\n        _canvas.style.cursor = 'se-resize';\n        break;\n      default:\n        _canvas.style.cursor = 'auto';\n    }\n\n    if (this._currentHandle !== false) {\n      // Handles resizing\n      switch (this._currentHandle) {\n        case 0:\n          _shape._x = mx;\n          _shape._y = my;\n          _shape._w += oldx - mx;\n          _shape._h += oldy - my;\n          break;\n        case 1:\n          _shape._y = my;\n          _shape._h += oldy - my;\n          break;\n        case 2:\n          _shape._y = my;\n          _shape._w = mx - oldx;\n          _shape._h += oldy - my;\n          break;\n        case 3:\n          _shape._x = mx;\n          _shape._w += oldx - mx;\n          break;\n        case 4:\n          _shape._w = mx - oldx;\n          break;\n        case 5:\n          _shape._x = mx;\n          _shape._w += oldx - mx;\n          _shape._h = my - oldy;\n          break;\n        case 6:\n          _shape._h = my - oldy;\n          break;\n        case 7:\n          _shape._w = mx - oldx;\n          _shape._h = my - oldy;\n          break;\n        default:\n          break;\n      }\n      this._valid = false;\n    } else if (this._dragging) {\n      // We don't want to drag the object by its top-left corner, we want to drag it\n      // from where we clicked. Thats why we saved the offset and use it here\n      this._shape._x = mouse.x - this._dragoffx;\n      this._shape._y = mouse.y - this._dragoffy;\n      this._valid = false; // Something's dragging so we must redraw\n\n      // this.log('moving the rect', mouse.x, mouse.y);\n    }\n  }\n\n  _onMouseUp() {\n    this._dragging = false;\n    this._currentHandle = false;\n    this.log('dragging finished');\n  }\n\n  /**\n   * dispatches mouse events on touch\n   */\n  _onTouch(evt) {\n    if (evt.touches.length > 1 || (evt.type === 'touchend' && evt.touches.length > 0)) {\n      return;\n    }\n\n    const newEvt = this._document.createEvent('MouseEvents');\n    let type = null;\n    let touch = null;\n\n    switch (evt.type) {\n      case 'touchstart':\n        type = 'mousedown';\n        touch = evt.changedTouches[0];\n        break;\n      case 'touchmove':\n        type = 'mousemove';\n        touch = evt.changedTouches[0];\n        break;\n      case 'touchend':\n        type = 'mouseup';\n        touch = evt.changedTouches[0];\n        break;\n      default:\n        break;\n    }\n\n    newEvt.initMouseEvent(type, true, true, evt.originalTarget.ownerDocument.defaultView, 0,\n      touch.screenX, touch.screenY, touch.clientX, touch.clientY,\n      evt.ctrlKey, evt.altKey, evt.shiftKey, evt.metaKey, 0, null);\n    evt.originalTarget.dispatchEvent(newEvt);\n  }\n\n  /**\n   * attaches event handlers to canvas\n   * @private\n   */\n  _initEvents() {\n    const { _canvas } = this;\n    // fixes a problem where double clicking causesShape text to get selected on the canvas\n    _canvas.addEventListener('selectstart', (e) => {\n      e.preventDefault();\n      return false;\n    }, false);\n\n    // up, down, and move are for dragging\n    _canvas.addEventListener('mousedown', this._onMouseDown, true);\n    _canvas.addEventListener('mousemove', this._onMouseMove, true);\n    _canvas.addEventListener('mouseup', this._onMouseUp, true);\n\n    _canvas.addEventListener('tapstart', this._onTouch, true);\n    _canvas.addEventListener('touchmove', this._onTouch, true);\n    _canvas.addEventListener('touchend', this._onTouch, true);\n\n    this.log('initialized events');\n  }\n\n  /**\n   * creates a movable rectangle and attach to canvas\n   * @private\n   */\n  _initRect() {\n    this._shape = new Rect(\n      this._width / 4,\n      this._height / 4,\n      this._width / 2,\n      this._height / 2,\n      'rgba(0, 200, 0, 0.5)',\n      this._debugMode\n    );\n    this._valid = false;\n  }\n\n  /**\n   * Returns shape positions\n   * @returns {{x, y, w, h}}\n   */\n  getSelection() {\n    const { _x, _y, _w, _h } = this._shape;\n    return { x: _x, y: _y, w: _w, h: _h };\n  }\n\n  /**\n   * clears the canvas for next draw\n   */\n  clear() {\n    this._ctx.clearRect(0, 0, this._width, this._height);\n  }\n\n  /**\n   * while draw is called as often as the INTERVAL variable demands,\n   * it only ever does something if the canvas gets invalidated by our code\n   */\n  draw() {\n    // if our state is invalid, redraw and validate!\n    if (!this._valid) {\n      this.log('starting draw');\n      const { _ctx, _shape } = this;\n      this.clear();\n\n      // fill outside of the rectangle\n      _ctx.fillStyle = 'rgba(0,0,0,.8)';\n      _ctx.beginPath();\n      _ctx.rect(_shape._x, _shape._y, _shape._w, _shape._h);\n      _ctx.rect(this._width, 0, -this._width, this._height);\n      _ctx.fill();\n\n      // draw shape\n      _shape.draw(_ctx);\n\n      this._valid = true;\n\n      this.log('shape drew', _shape._x, _shape._y, _shape._w, _shape._h);\n    }\n  }\n\n  /**\n   * creates an object with x and y defined, set to the mouse position relative to the state's canvas\n   * If you wanna be super-correct this can be tricky, we have to worry about padding and borders\n   * @param {Event} e\n   * @returns {{x: number, y: number}}\n   */\n  getMouse(e) {\n    let el = this._canvas;\n    let offsetX = 0;\n    let offsetY = 0;\n\n    // Compute the total offset\n    if (el.offsetParent !== undefined) {\n      do {\n        offsetX += el.offsetLeft;\n        offsetY += el.offsetTop;\n        el = el.offsetParent;\n      } while (el);\n    }\n\n    // Also add the <html> offsets in case there's a position:fixed bar\n    offsetX += this._htmlLeft;\n    offsetY += this._htmlTop;\n\n    const mx = e.pageX - offsetX;\n    const my = e.pageY - offsetY;\n\n    return { x: mx, y: my };\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/canvas-state.js\n **/","import BaseObject from './base-object';\n\n/**\n * Rectangle for highlighting the cropping area\n * @class Rect\n */\nexport default class Rect extends BaseObject {\n  /**\n   * object constructor\n   * @param {number} x - left position of shape\n   * @param {number} y - top position of shape\n   * @param {number} w - width\n   * @param {number} h - height\n   * @param {string} fill - background color of the shape\n   */\n  constructor(x, y, w, h, fill, debugMode = true) {\n    super();\n\n    this._selectionHandles = [];\n    this._selectionBoxSize = 6;\n    for (let i = 0; i < 8; i += 1) {\n      this._selectionHandles.push({ x: 0, y: 0 });\n    }\n\n    this._x = x || 0;\n    this._y = y || 0;\n    this._w = w || 1;\n    this._h = h || 1;\n    this._fill = fill || '#AAAAAA';\n    this._debugMode = debugMode;\n\n    this.log('initialized');\n  }\n\n  /**\n   * returns class name\n   * @returns {string}\n   */\n  getName() {\n    return 'Rect';\n  }\n\n  /**\n   * draws the shape\n   * @param {CanvasContext} ctx\n   */\n  draw(ctx) {\n    const { _x, _y, _w, _h, _fill, _selectionHandles, _selectionBoxSize } = this;\n    ctx.fillStyle = _fill; // eslint-disable-line\n    ctx.strokeStyle = 'white'; // eslint-disable-line\n    ctx.lineWidth = 1; // eslint-disable-line\n    ctx.setLineDash([7, 7]);\n    ctx.strokeRect(_x, _y, _w, _h);\n\n    const half = _selectionBoxSize / 2;\n\n    // top left, middle, right\n    _selectionHandles[0].x = _x - half;\n    _selectionHandles[0].y = _y - half;\n\n    _selectionHandles[1].x = _x + _w / 2 - half;\n    _selectionHandles[1].y = _y - half;\n\n    _selectionHandles[2].x = _x + _w - half;\n    _selectionHandles[2].y = _y - half;\n\n    // middle left\n    _selectionHandles[3].x = _x - half;\n    _selectionHandles[3].y = _y + _h / 2 - half;\n\n    // middle right\n    _selectionHandles[4].x = _x + _w - half;\n    _selectionHandles[4].y = _y + _h / 2 - half;\n\n    // bottom left, middle, right\n    _selectionHandles[6].x = _x + _w / 2 - half;\n    _selectionHandles[6].y = _y + _h - half;\n\n    _selectionHandles[5].x = _x - half;\n    _selectionHandles[5].y = _y + _h - half;\n\n    _selectionHandles[7].x = _x + _w - half;\n    _selectionHandles[7].y = _y + _h - half;\n\n    this.log('drawing selection boxes');\n    ctx.fillStyle = 'white'; // eslint-disable-line\n    _selectionHandles.forEach((cur) => {\n      ctx.fillRect(cur.x, cur.y, _selectionBoxSize, _selectionBoxSize);\n    });\n\n    this.log('filling the rectangle', _x, _y, _w, _h);\n  }\n\n  /**\n   * checks if point is inside the shape\n   * @param {number} mx\n   * @param {number} my\n   * @returns {bool}\n   */\n  contains(mx, my) {\n    const { _x, _y, _w, _h } = this;\n    return (_x <= mx) && (_x + _w >= mx) &&\n      (_y <= my) && (_y + _h >= my);\n  }\n\n  /**\n   * returns selection handle if point is inside\n   * @param {number} mx\n   * @param {number} my\n   * @returns {?number}\n   */\n  getHoverSelectionHandle(mx, my) {\n    const { _selectionHandles, _selectionBoxSize } = this;\n    for (let i = 0; i < _selectionHandles.length; i += 1) {\n      const handle = _selectionHandles[i];\n      if (\n        (handle.x <= mx) &&\n        (handle.x + _selectionBoxSize >= mx) &&\n        (handle.y <= my) &&\n        (handle.y + _selectionBoxSize >= my)\n      ) {\n        return i;\n      }\n    }\n\n    return false;\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/rect.js\n **/"],"sourceRoot":""}